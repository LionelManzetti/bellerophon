var TU=Object.defineProperty;var FU=(t,e,n)=>e in t?TU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var VU=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var H1=(t,e,n)=>(FU(t,typeof e!="symbol"?e+"":e,n),n);var yGe=VU((Xe,js)=>{function yT(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function l0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var BT={exports:{}},Yb={},GT={exports:{}},sn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g0=Symbol.for("react.element"),LU=Symbol.for("react.portal"),kU=Symbol.for("react.fragment"),HU=Symbol.for("react.strict_mode"),_U=Symbol.for("react.profiler"),XU=Symbol.for("react.provider"),YU=Symbol.for("react.context"),KU=Symbol.for("react.forward_ref"),zU=Symbol.for("react.suspense"),UU=Symbol.for("react.memo"),DU=Symbol.for("react.lazy"),AE=Symbol.iterator;function PU(t){return t===null||typeof t!="object"?null:(t=AE&&t[AE]||t["@@iterator"],typeof t=="function"?t:null)}var ST={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wT=Object.assign,RT={};function NA(t,e,n){this.props=t,this.context=e,this.refs=RT,this.updater=n||ST}NA.prototype.isReactComponent={};NA.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};NA.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function xT(){}xT.prototype=NA.prototype;function pw(t,e,n){this.props=t,this.context=e,this.refs=RT,this.updater=n||ST}var mw=pw.prototype=new xT;mw.constructor=pw;wT(mw,NA.prototype);mw.isPureReactComponent=!0;var hE=Array.isArray,ZT=Object.prototype.hasOwnProperty,bw={current:null},ET={key:!0,ref:!0,__self:!0,__source:!0};function WT(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)ZT.call(e,i)&&!ET.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),g=0;g<a;g++)l[g]=arguments[g+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:g0,type:t,key:s,ref:o,props:r,_owner:bw.current}}function OU(t,e){return{$$typeof:g0,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vw(t){return typeof t=="object"&&t!==null&&t.$$typeof===g0}function QU(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var CE=/\/+/g;function _1(t,e){return typeof t=="object"&&t!==null&&t.key!=null?QU(""+t.key):e.toString(36)}function V2(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case g0:case LU:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+_1(o,0):i,hE(r)?(n="",t!=null&&(n=t.replace(CE,"$&/")+"/"),V2(r,e,n,"",function(g){return g})):r!=null&&(vw(r)&&(r=OU(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(CE,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",hE(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+_1(s,a);o+=V2(s,e,n,l,r)}else if(l=PU(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+_1(s,a++),o+=V2(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Dp(t,e,n){if(t==null)return t;var i=[],r=0;return V2(t,i,"","",function(s){return e.call(n,s,r++)}),i}function JU(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var rs={current:null},L2={transition:null},jU={ReactCurrentDispatcher:rs,ReactCurrentBatchConfig:L2,ReactCurrentOwner:bw};sn.Children={map:Dp,forEach:function(t,e,n){Dp(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Dp(t,function(){e++}),e},toArray:function(t){return Dp(t,function(e){return e})||[]},only:function(t){if(!vw(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};sn.Component=NA;sn.Fragment=kU;sn.Profiler=_U;sn.PureComponent=pw;sn.StrictMode=HU;sn.Suspense=zU;sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jU;sn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=wT({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=bw.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)ZT.call(e,l)&&!ET.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var g=0;g<l;g++)a[g]=arguments[g+2];i.children=a}return{$$typeof:g0,type:t.type,key:r,ref:s,props:i,_owner:o}};sn.createContext=function(t){return t={$$typeof:YU,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:XU,_context:t},t.Consumer=t};sn.createElement=WT;sn.createFactory=function(t){var e=WT.bind(null,t);return e.type=t,e};sn.createRef=function(){return{current:null}};sn.forwardRef=function(t){return{$$typeof:KU,render:t}};sn.isValidElement=vw;sn.lazy=function(t){return{$$typeof:DU,_payload:{_status:-1,_result:t},_init:JU}};sn.memo=function(t,e){return{$$typeof:UU,type:t,compare:e===void 0?null:e}};sn.startTransition=function(t){var e=L2.transition;L2.transition={};try{t()}finally{L2.transition=e}};sn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};sn.useCallback=function(t,e){return rs.current.useCallback(t,e)};sn.useContext=function(t){return rs.current.useContext(t)};sn.useDebugValue=function(){};sn.useDeferredValue=function(t){return rs.current.useDeferredValue(t)};sn.useEffect=function(t,e){return rs.current.useEffect(t,e)};sn.useId=function(){return rs.current.useId()};sn.useImperativeHandle=function(t,e,n){return rs.current.useImperativeHandle(t,e,n)};sn.useInsertionEffect=function(t,e){return rs.current.useInsertionEffect(t,e)};sn.useLayoutEffect=function(t,e){return rs.current.useLayoutEffect(t,e)};sn.useMemo=function(t,e){return rs.current.useMemo(t,e)};sn.useReducer=function(t,e,n){return rs.current.useReducer(t,e,n)};sn.useRef=function(t){return rs.current.useRef(t)};sn.useState=function(t){return rs.current.useState(t)};sn.useSyncExternalStore=function(t,e,n){return rs.current.useSyncExternalStore(t,e,n)};sn.useTransition=function(){return rs.current.useTransition()};sn.version="18.2.0";GT.exports=sn;var H=GT.exports;const yt=l0(H),Kb=yT({__proto__:null,default:yt},[H]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qU=H,$U=Symbol.for("react.element"),eD=Symbol.for("react.fragment"),tD=Object.prototype.hasOwnProperty,nD=qU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,iD={key:!0,ref:!0,__self:!0,__source:!0};function NT(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)tD.call(e,i)&&!iD.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:$U,type:t,key:s,ref:o,props:r,_owner:nD.current}}Yb.Fragment=eD;Yb.jsx=NT;Yb.jsxs=NT;BT.exports=Yb;var ne=BT.exports,dG={},MT={exports:{}},oo={},TT={exports:{}},FT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(N,L){var V=N.length;N.push(L);e:for(;0<V;){var M=V-1>>>1,X=N[M];if(0<r(X,L))N[M]=L,N[V]=X,V=M;else break e}}function n(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var L=N[0],V=N.pop();if(V!==L){N[0]=V;e:for(var M=0,X=N.length,J=X>>>1;M<J;){var re=2*(M+1)-1,se=N[re],le=re+1,ae=N[le];if(0>r(se,V))le<X&&0>r(ae,se)?(N[M]=ae,N[le]=V,M=le):(N[M]=se,N[re]=V,M=re);else if(le<X&&0>r(ae,V))N[M]=ae,N[le]=V,M=le;else break e}}return L}function r(N,L){var V=N.sortIndex-L.sortIndex;return V!==0?V:N.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],g=[],c=1,u=null,I=3,h=!1,C=!1,b=!1,m=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(N){for(var L=n(g);L!==null;){if(L.callback===null)i(g);else if(L.startTime<=N)i(g),L.sortIndex=L.expirationTime,e(l,L);else break;L=n(g)}}function B(N){if(b=!1,v(N),!C)if(n(l)!==null)C=!0,Y(G);else{var L=n(g);L!==null&&z(B,L.startTime-N)}}function G(N,L){C=!1,b&&(b=!1,f(E),E=-1),h=!0;var V=I;try{for(v(L),u=n(l);u!==null&&(!(u.expirationTime>L)||N&&!T());){var M=u.callback;if(typeof M=="function"){u.callback=null,I=u.priorityLevel;var X=M(u.expirationTime<=L);L=t.unstable_now(),typeof X=="function"?u.callback=X:u===n(l)&&i(l),v(L)}else i(l);u=n(l)}if(u!==null)var J=!0;else{var re=n(g);re!==null&&z(B,re.startTime-L),J=!1}return J}finally{u=null,I=V,h=!1}}var R=!1,w=null,E=-1,x=5,W=-1;function T(){return!(t.unstable_now()-W<x)}function k(){if(w!==null){var N=t.unstable_now();W=N;var L=!0;try{L=w(!0,N)}finally{L?_():(R=!1,w=null)}}else R=!1}var _;if(typeof p=="function")_=function(){p(k)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,O=U.port2;U.port1.onmessage=k,_=function(){O.postMessage(null)}}else _=function(){m(k,0)};function Y(N){w=N,R||(R=!0,_())}function z(N,L){E=m(function(){N(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_continueExecution=function(){C||h||(C=!0,Y(G))},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(N){switch(I){case 1:case 2:case 3:var L=3;break;default:L=I}var V=I;I=L;try{return N()}finally{I=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(N,L){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var V=I;I=N;try{return L()}finally{I=V}},t.unstable_scheduleCallback=function(N,L,V){var M=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?M+V:M):V=M,N){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=V+X,N={id:c++,callback:L,priorityLevel:N,startTime:V,expirationTime:X,sortIndex:-1},V>M?(N.sortIndex=V,e(g,N),n(l)===null&&N===n(g)&&(b?(f(E),E=-1):b=!0,z(B,V-M))):(N.sortIndex=X,e(l,N),C||h||(C=!0,Y(G))),N},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(N){var L=I;return function(){var V=I;I=L;try{return N.apply(this,arguments)}finally{I=V}}}})(FT);TT.exports=FT;var rD=TT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VT=H,eo=rD;function $e(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var LT=new Set,PC={};function AI(t,e){gA(t,e),gA(t+"Capture",e)}function gA(t,e){for(PC[t]=e,t=0;t<e.length;t++)LT.add(e[t])}var Jl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),AG=Object.prototype.hasOwnProperty,sD=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fE={},pE={};function oD(t){return AG.call(pE,t)?!0:AG.call(fE,t)?!1:sD.test(t)?pE[t]=!0:(fE[t]=!0,!1)}function aD(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function lD(t,e,n,i){if(e===null||typeof e>"u"||aD(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ss(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var mr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){mr[t]=new ss(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];mr[e]=new ss(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){mr[t]=new ss(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){mr[t]=new ss(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){mr[t]=new ss(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){mr[t]=new ss(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){mr[t]=new ss(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){mr[t]=new ss(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){mr[t]=new ss(t,5,!1,t.toLowerCase(),null,!1,!1)});var yw=/[\-:]([a-z])/g;function Bw(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(yw,Bw);mr[e]=new ss(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(yw,Bw);mr[e]=new ss(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(yw,Bw);mr[e]=new ss(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){mr[t]=new ss(t,1,!1,t.toLowerCase(),null,!1,!1)});mr.xlinkHref=new ss("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){mr[t]=new ss(t,1,!1,t.toLowerCase(),null,!0,!0)});function Gw(t,e,n,i){var r=mr.hasOwnProperty(e)?mr[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(lD(e,n,r,i)&&(n=null),i||r===null?oD(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var og=VT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Pp=Symbol.for("react.element"),Bd=Symbol.for("react.portal"),Gd=Symbol.for("react.fragment"),Sw=Symbol.for("react.strict_mode"),hG=Symbol.for("react.profiler"),kT=Symbol.for("react.provider"),HT=Symbol.for("react.context"),ww=Symbol.for("react.forward_ref"),CG=Symbol.for("react.suspense"),fG=Symbol.for("react.suspense_list"),Rw=Symbol.for("react.memo"),Vg=Symbol.for("react.lazy"),_T=Symbol.for("react.offscreen"),mE=Symbol.iterator;function yh(t){return t===null||typeof t!="object"?null:(t=mE&&t[mE]||t["@@iterator"],typeof t=="function"?t:null)}var li=Object.assign,X1;function sC(t){if(X1===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);X1=e&&e[1]||""}return`
`+X1+t}var Y1=!1;function K1(t,e){if(!t||Y1)return"";Y1=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(g){var i=g}Reflect.construct(t,[],e)}else{try{e.call()}catch(g){i=g}t.call(e.prototype)}else{try{throw Error()}catch(g){i=g}t()}}catch(g){if(g&&i&&typeof g.stack=="string"){for(var r=g.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Y1=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?sC(t):""}function gD(t){switch(t.tag){case 5:return sC(t.type);case 16:return sC("Lazy");case 13:return sC("Suspense");case 19:return sC("SuspenseList");case 0:case 2:case 15:return t=K1(t.type,!1),t;case 11:return t=K1(t.type.render,!1),t;case 1:return t=K1(t.type,!0),t;default:return""}}function pG(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Gd:return"Fragment";case Bd:return"Portal";case hG:return"Profiler";case Sw:return"StrictMode";case CG:return"Suspense";case fG:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case HT:return(t.displayName||"Context")+".Consumer";case kT:return(t._context.displayName||"Context")+".Provider";case ww:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Rw:return e=t.displayName||null,e!==null?e:pG(t.type)||"Memo";case Vg:e=t._payload,t=t._init;try{return pG(t(e))}catch{}}return null}function cD(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pG(e);case 8:return e===Sw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function gc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function XT(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function uD(t){var e=XT(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Op(t){t._valueTracker||(t._valueTracker=uD(t))}function YT(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=XT(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function b3(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function mG(t,e){var n=e.checked;return li({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function bE(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=gc(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function KT(t,e){e=e.checked,e!=null&&Gw(t,"checked",e,!1)}function bG(t,e){KT(t,e);var n=gc(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?vG(t,e.type,n):e.hasOwnProperty("defaultValue")&&vG(t,e.type,gc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function vE(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function vG(t,e,n){(e!=="number"||b3(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var oC=Array.isArray;function Dd(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+gc(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function yG(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error($e(91));return li({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function yE(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error($e(92));if(oC(n)){if(1<n.length)throw Error($e(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:gc(n)}}function zT(t,e){var n=gc(e.value),i=gc(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function BE(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function UT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function BG(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?UT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Qp,DT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Qp=Qp||document.createElement("div"),Qp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Qp.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function OC(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var fC={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ID=["Webkit","ms","Moz","O"];Object.keys(fC).forEach(function(t){ID.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),fC[e]=fC[t]})});function PT(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||fC.hasOwnProperty(t)&&fC[t]?(""+e).trim():e+"px"}function OT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=PT(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var dD=li({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function GG(t,e){if(e){if(dD[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error($e(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error($e(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error($e(61))}if(e.style!=null&&typeof e.style!="object")throw Error($e(62))}}function SG(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wG=null;function xw(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var RG=null,Pd=null,Od=null;function GE(t){if(t=I0(t)){if(typeof RG!="function")throw Error($e(280));var e=t.stateNode;e&&(e=Ob(e),RG(t.stateNode,t.type,e))}}function QT(t){Pd?Od?Od.push(t):Od=[t]:Pd=t}function JT(){if(Pd){var t=Pd,e=Od;if(Od=Pd=null,GE(t),e)for(t=0;t<e.length;t++)GE(e[t])}}function jT(t,e){return t(e)}function qT(){}var z1=!1;function $T(t,e,n){if(z1)return t(e,n);z1=!0;try{return jT(t,e,n)}finally{z1=!1,(Pd!==null||Od!==null)&&(qT(),JT())}}function QC(t,e){var n=t.stateNode;if(n===null)return null;var i=Ob(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error($e(231,e,typeof n));return n}var xG=!1;if(Jl)try{var Bh={};Object.defineProperty(Bh,"passive",{get:function(){xG=!0}}),window.addEventListener("test",Bh,Bh),window.removeEventListener("test",Bh,Bh)}catch{xG=!1}function AD(t,e,n,i,r,s,o,a,l){var g=Array.prototype.slice.call(arguments,3);try{e.apply(n,g)}catch(c){this.onError(c)}}var pC=!1,v3=null,y3=!1,ZG=null,hD={onError:function(t){pC=!0,v3=t}};function CD(t,e,n,i,r,s,o,a,l){pC=!1,v3=null,AD.apply(hD,arguments)}function fD(t,e,n,i,r,s,o,a,l){if(CD.apply(this,arguments),pC){if(pC){var g=v3;pC=!1,v3=null}else throw Error($e(198));y3||(y3=!0,ZG=g)}}function hI(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function eF(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function SE(t){if(hI(t)!==t)throw Error($e(188))}function pD(t){var e=t.alternate;if(!e){if(e=hI(t),e===null)throw Error($e(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return SE(r),t;if(s===i)return SE(r),e;s=s.sibling}throw Error($e(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error($e(189))}}if(n.alternate!==i)throw Error($e(190))}if(n.tag!==3)throw Error($e(188));return n.stateNode.current===n?t:e}function tF(t){return t=pD(t),t!==null?nF(t):null}function nF(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=nF(t);if(e!==null)return e;t=t.sibling}return null}var iF=eo.unstable_scheduleCallback,wE=eo.unstable_cancelCallback,mD=eo.unstable_shouldYield,bD=eo.unstable_requestPaint,wi=eo.unstable_now,vD=eo.unstable_getCurrentPriorityLevel,Zw=eo.unstable_ImmediatePriority,rF=eo.unstable_UserBlockingPriority,B3=eo.unstable_NormalPriority,yD=eo.unstable_LowPriority,sF=eo.unstable_IdlePriority,zb=null,Oa=null;function BD(t){if(Oa&&typeof Oa.onCommitFiberRoot=="function")try{Oa.onCommitFiberRoot(zb,t,void 0,(t.current.flags&128)===128)}catch{}}var la=Math.clz32?Math.clz32:wD,GD=Math.log,SD=Math.LN2;function wD(t){return t>>>=0,t===0?32:31-(GD(t)/SD|0)|0}var Jp=64,jp=4194304;function aC(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function G3(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=aC(a):(s&=o,s!==0&&(i=aC(s)))}else o=n&~r,o!==0?i=aC(o):s!==0&&(i=aC(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-la(e),r=1<<n,i|=t[n],e&=~r;return i}function RD(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xD(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-la(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=RD(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function EG(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function oF(){var t=Jp;return Jp<<=1,!(Jp&4194240)&&(Jp=64),t}function U1(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function c0(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-la(e),t[e]=n}function ZD(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-la(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Ew(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-la(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var mn=0;function aF(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var lF,Ww,gF,cF,uF,WG=!1,qp=[],Dg=null,Pg=null,Og=null,JC=new Map,jC=new Map,kg=[],ED="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function RE(t,e){switch(t){case"focusin":case"focusout":Dg=null;break;case"dragenter":case"dragleave":Pg=null;break;case"mouseover":case"mouseout":Og=null;break;case"pointerover":case"pointerout":JC.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":jC.delete(e.pointerId)}}function Gh(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=I0(e),e!==null&&Ww(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function WD(t,e,n,i,r){switch(e){case"focusin":return Dg=Gh(Dg,t,e,n,i,r),!0;case"dragenter":return Pg=Gh(Pg,t,e,n,i,r),!0;case"mouseover":return Og=Gh(Og,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return JC.set(s,Gh(JC.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,jC.set(s,Gh(jC.get(s)||null,t,e,n,i,r)),!0}return!1}function IF(t){var e=Su(t.target);if(e!==null){var n=hI(e);if(n!==null){if(e=n.tag,e===13){if(e=eF(n),e!==null){t.blockedOn=e,uF(t.priority,function(){gF(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function k2(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=NG(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);wG=i,n.target.dispatchEvent(i),wG=null}else return e=I0(n),e!==null&&Ww(e),t.blockedOn=n,!1;e.shift()}return!0}function xE(t,e,n){k2(t)&&n.delete(e)}function ND(){WG=!1,Dg!==null&&k2(Dg)&&(Dg=null),Pg!==null&&k2(Pg)&&(Pg=null),Og!==null&&k2(Og)&&(Og=null),JC.forEach(xE),jC.forEach(xE)}function Sh(t,e){t.blockedOn===e&&(t.blockedOn=null,WG||(WG=!0,eo.unstable_scheduleCallback(eo.unstable_NormalPriority,ND)))}function qC(t){function e(r){return Sh(r,t)}if(0<qp.length){Sh(qp[0],t);for(var n=1;n<qp.length;n++){var i=qp[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Dg!==null&&Sh(Dg,t),Pg!==null&&Sh(Pg,t),Og!==null&&Sh(Og,t),JC.forEach(e),jC.forEach(e),n=0;n<kg.length;n++)i=kg[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<kg.length&&(n=kg[0],n.blockedOn===null);)IF(n),n.blockedOn===null&&kg.shift()}var Qd=og.ReactCurrentBatchConfig,S3=!0;function MD(t,e,n,i){var r=mn,s=Qd.transition;Qd.transition=null;try{mn=1,Nw(t,e,n,i)}finally{mn=r,Qd.transition=s}}function TD(t,e,n,i){var r=mn,s=Qd.transition;Qd.transition=null;try{mn=4,Nw(t,e,n,i)}finally{mn=r,Qd.transition=s}}function Nw(t,e,n,i){if(S3){var r=NG(t,e,n,i);if(r===null)t5(t,e,i,w3,n),RE(t,i);else if(WD(r,t,e,n,i))i.stopPropagation();else if(RE(t,i),e&4&&-1<ED.indexOf(t)){for(;r!==null;){var s=I0(r);if(s!==null&&lF(s),s=NG(t,e,n,i),s===null&&t5(t,e,i,w3,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else t5(t,e,i,null,n)}}var w3=null;function NG(t,e,n,i){if(w3=null,t=xw(i),t=Su(t),t!==null)if(e=hI(t),e===null)t=null;else if(n=e.tag,n===13){if(t=eF(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return w3=t,null}function dF(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vD()){case Zw:return 1;case rF:return 4;case B3:case yD:return 16;case sF:return 536870912;default:return 16}default:return 16}}var _g=null,Mw=null,H2=null;function AF(){if(H2)return H2;var t,e=Mw,n=e.length,i,r="value"in _g?_g.value:_g.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return H2=r.slice(t,1<i?1-i:void 0)}function _2(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function $p(){return!0}function ZE(){return!1}function ao(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?$p:ZE,this.isPropagationStopped=ZE,this}return li(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=$p)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=$p)},persist:function(){},isPersistent:$p}),e}var MA={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tw=ao(MA),u0=li({},MA,{view:0,detail:0}),FD=ao(u0),D1,P1,wh,Ub=li({},u0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fw,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==wh&&(wh&&t.type==="mousemove"?(D1=t.screenX-wh.screenX,P1=t.screenY-wh.screenY):P1=D1=0,wh=t),D1)},movementY:function(t){return"movementY"in t?t.movementY:P1}}),EE=ao(Ub),VD=li({},Ub,{dataTransfer:0}),LD=ao(VD),kD=li({},u0,{relatedTarget:0}),O1=ao(kD),HD=li({},MA,{animationName:0,elapsedTime:0,pseudoElement:0}),_D=ao(HD),XD=li({},MA,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),YD=ao(XD),KD=li({},MA,{data:0}),WE=ao(KD),zD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},UD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function PD(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=DD[t])?!!e[t]:!1}function Fw(){return PD}var OD=li({},u0,{key:function(t){if(t.key){var e=zD[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=_2(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?UD[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fw,charCode:function(t){return t.type==="keypress"?_2(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?_2(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),QD=ao(OD),JD=li({},Ub,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),NE=ao(JD),jD=li({},u0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fw}),qD=ao(jD),$D=li({},MA,{propertyName:0,elapsedTime:0,pseudoElement:0}),eP=ao($D),tP=li({},Ub,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),nP=ao(tP),iP=[9,13,27,32],Vw=Jl&&"CompositionEvent"in window,mC=null;Jl&&"documentMode"in document&&(mC=document.documentMode);var rP=Jl&&"TextEvent"in window&&!mC,hF=Jl&&(!Vw||mC&&8<mC&&11>=mC),ME=String.fromCharCode(32),TE=!1;function CF(t,e){switch(t){case"keyup":return iP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fF(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Sd=!1;function sP(t,e){switch(t){case"compositionend":return fF(e);case"keypress":return e.which!==32?null:(TE=!0,ME);case"textInput":return t=e.data,t===ME&&TE?null:t;default:return null}}function oP(t,e){if(Sd)return t==="compositionend"||!Vw&&CF(t,e)?(t=AF(),H2=Mw=_g=null,Sd=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hF&&e.locale!=="ko"?null:e.data;default:return null}}var aP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function FE(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!aP[t.type]:e==="textarea"}function pF(t,e,n,i){QT(i),e=R3(e,"onChange"),0<e.length&&(n=new Tw("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var bC=null,$C=null;function lP(t){ZF(t,0)}function Db(t){var e=xd(t);if(YT(e))return t}function gP(t,e){if(t==="change")return e}var mF=!1;if(Jl){var Q1;if(Jl){var J1="oninput"in document;if(!J1){var VE=document.createElement("div");VE.setAttribute("oninput","return;"),J1=typeof VE.oninput=="function"}Q1=J1}else Q1=!1;mF=Q1&&(!document.documentMode||9<document.documentMode)}function LE(){bC&&(bC.detachEvent("onpropertychange",bF),$C=bC=null)}function bF(t){if(t.propertyName==="value"&&Db($C)){var e=[];pF(e,$C,t,xw(t)),$T(lP,e)}}function cP(t,e,n){t==="focusin"?(LE(),bC=e,$C=n,bC.attachEvent("onpropertychange",bF)):t==="focusout"&&LE()}function uP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Db($C)}function IP(t,e){if(t==="click")return Db(e)}function dP(t,e){if(t==="input"||t==="change")return Db(e)}function AP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ha=typeof Object.is=="function"?Object.is:AP;function ef(t,e){if(ha(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!AG.call(e,r)||!ha(t[r],e[r]))return!1}return!0}function kE(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function HE(t,e){var n=kE(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=kE(n)}}function vF(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?vF(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function yF(){for(var t=window,e=b3();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=b3(t.document)}return e}function Lw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function hP(t){var e=yF(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&vF(n.ownerDocument.documentElement,n)){if(i!==null&&Lw(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=HE(n,s);var o=HE(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var CP=Jl&&"documentMode"in document&&11>=document.documentMode,wd=null,MG=null,vC=null,TG=!1;function _E(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;TG||wd==null||wd!==b3(i)||(i=wd,"selectionStart"in i&&Lw(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),vC&&ef(vC,i)||(vC=i,i=R3(MG,"onSelect"),0<i.length&&(e=new Tw("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=wd)))}function em(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Rd={animationend:em("Animation","AnimationEnd"),animationiteration:em("Animation","AnimationIteration"),animationstart:em("Animation","AnimationStart"),transitionend:em("Transition","TransitionEnd")},j1={},BF={};Jl&&(BF=document.createElement("div").style,"AnimationEvent"in window||(delete Rd.animationend.animation,delete Rd.animationiteration.animation,delete Rd.animationstart.animation),"TransitionEvent"in window||delete Rd.transitionend.transition);function Pb(t){if(j1[t])return j1[t];if(!Rd[t])return t;var e=Rd[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in BF)return j1[t]=e[n];return t}var GF=Pb("animationend"),SF=Pb("animationiteration"),wF=Pb("animationstart"),RF=Pb("transitionend"),xF=new Map,XE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yc(t,e){xF.set(t,e),AI(e,[t])}for(var q1=0;q1<XE.length;q1++){var $1=XE[q1],fP=$1.toLowerCase(),pP=$1[0].toUpperCase()+$1.slice(1);yc(fP,"on"+pP)}yc(GF,"onAnimationEnd");yc(SF,"onAnimationIteration");yc(wF,"onAnimationStart");yc("dblclick","onDoubleClick");yc("focusin","onFocus");yc("focusout","onBlur");yc(RF,"onTransitionEnd");gA("onMouseEnter",["mouseout","mouseover"]);gA("onMouseLeave",["mouseout","mouseover"]);gA("onPointerEnter",["pointerout","pointerover"]);gA("onPointerLeave",["pointerout","pointerover"]);AI("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));AI("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));AI("onBeforeInput",["compositionend","keypress","textInput","paste"]);AI("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));AI("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));AI("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lC="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mP=new Set("cancel close invalid load scroll toggle".split(" ").concat(lC));function YE(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,fD(i,e,void 0,t),t.currentTarget=null}function ZF(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,g=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;YE(r,a,g),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,g=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;YE(r,a,g),s=l}}}if(y3)throw t=ZG,y3=!1,ZG=null,t}function Kn(t,e){var n=e[HG];n===void 0&&(n=e[HG]=new Set);var i=t+"__bubble";n.has(i)||(EF(e,t,2,!1),n.add(i))}function e5(t,e,n){var i=0;e&&(i|=4),EF(n,t,i,e)}var tm="_reactListening"+Math.random().toString(36).slice(2);function tf(t){if(!t[tm]){t[tm]=!0,LT.forEach(function(n){n!=="selectionchange"&&(mP.has(n)||e5(n,!1,t),e5(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[tm]||(e[tm]=!0,e5("selectionchange",!1,e))}}function EF(t,e,n,i){switch(dF(e)){case 1:var r=MD;break;case 4:r=TD;break;default:r=Nw}n=r.bind(null,e,n,t),r=void 0,!xG||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function t5(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Su(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}$T(function(){var g=s,c=xw(n),u=[];e:{var I=xF.get(t);if(I!==void 0){var h=Tw,C=t;switch(t){case"keypress":if(_2(n)===0)break e;case"keydown":case"keyup":h=QD;break;case"focusin":C="focus",h=O1;break;case"focusout":C="blur",h=O1;break;case"beforeblur":case"afterblur":h=O1;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=EE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=LD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=qD;break;case GF:case SF:case wF:h=_D;break;case RF:h=eP;break;case"scroll":h=FD;break;case"wheel":h=nP;break;case"copy":case"cut":case"paste":h=YD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=NE}var b=(e&4)!==0,m=!b&&t==="scroll",f=b?I!==null?I+"Capture":null:I;b=[];for(var p=g,v;p!==null;){v=p;var B=v.stateNode;if(v.tag===5&&B!==null&&(v=B,f!==null&&(B=QC(p,f),B!=null&&b.push(nf(p,B,v)))),m)break;p=p.return}0<b.length&&(I=new h(I,C,null,n,c),u.push({event:I,listeners:b}))}}if(!(e&7)){e:{if(I=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",I&&n!==wG&&(C=n.relatedTarget||n.fromElement)&&(Su(C)||C[jl]))break e;if((h||I)&&(I=c.window===c?c:(I=c.ownerDocument)?I.defaultView||I.parentWindow:window,h?(C=n.relatedTarget||n.toElement,h=g,C=C?Su(C):null,C!==null&&(m=hI(C),C!==m||C.tag!==5&&C.tag!==6)&&(C=null)):(h=null,C=g),h!==C)){if(b=EE,B="onMouseLeave",f="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(b=NE,B="onPointerLeave",f="onPointerEnter",p="pointer"),m=h==null?I:xd(h),v=C==null?I:xd(C),I=new b(B,p+"leave",h,n,c),I.target=m,I.relatedTarget=v,B=null,Su(c)===g&&(b=new b(f,p+"enter",C,n,c),b.target=v,b.relatedTarget=m,B=b),m=B,h&&C)t:{for(b=h,f=C,p=0,v=b;v;v=zI(v))p++;for(v=0,B=f;B;B=zI(B))v++;for(;0<p-v;)b=zI(b),p--;for(;0<v-p;)f=zI(f),v--;for(;p--;){if(b===f||f!==null&&b===f.alternate)break t;b=zI(b),f=zI(f)}b=null}else b=null;h!==null&&KE(u,I,h,b,!1),C!==null&&m!==null&&KE(u,m,C,b,!0)}}e:{if(I=g?xd(g):window,h=I.nodeName&&I.nodeName.toLowerCase(),h==="select"||h==="input"&&I.type==="file")var G=gP;else if(FE(I))if(mF)G=dP;else{G=uP;var R=cP}else(h=I.nodeName)&&h.toLowerCase()==="input"&&(I.type==="checkbox"||I.type==="radio")&&(G=IP);if(G&&(G=G(t,g))){pF(u,G,n,c);break e}R&&R(t,I,g),t==="focusout"&&(R=I._wrapperState)&&R.controlled&&I.type==="number"&&vG(I,"number",I.value)}switch(R=g?xd(g):window,t){case"focusin":(FE(R)||R.contentEditable==="true")&&(wd=R,MG=g,vC=null);break;case"focusout":vC=MG=wd=null;break;case"mousedown":TG=!0;break;case"contextmenu":case"mouseup":case"dragend":TG=!1,_E(u,n,c);break;case"selectionchange":if(CP)break;case"keydown":case"keyup":_E(u,n,c)}var w;if(Vw)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Sd?CF(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(hF&&n.locale!=="ko"&&(Sd||E!=="onCompositionStart"?E==="onCompositionEnd"&&Sd&&(w=AF()):(_g=c,Mw="value"in _g?_g.value:_g.textContent,Sd=!0)),R=R3(g,E),0<R.length&&(E=new WE(E,t,null,n,c),u.push({event:E,listeners:R}),w?E.data=w:(w=fF(n),w!==null&&(E.data=w)))),(w=rP?sP(t,n):oP(t,n))&&(g=R3(g,"onBeforeInput"),0<g.length&&(c=new WE("onBeforeInput","beforeinput",null,n,c),u.push({event:c,listeners:g}),c.data=w))}ZF(u,e)})}function nf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function R3(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=QC(t,n),s!=null&&i.unshift(nf(t,s,r)),s=QC(t,e),s!=null&&i.push(nf(t,s,r))),t=t.return}return i}function zI(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function KE(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,g=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&g!==null&&(a=g,r?(l=QC(n,s),l!=null&&o.unshift(nf(n,l,a))):r||(l=QC(n,s),l!=null&&o.push(nf(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var bP=/\r\n?/g,vP=/\u0000|\uFFFD/g;function zE(t){return(typeof t=="string"?t:""+t).replace(bP,`
`).replace(vP,"")}function nm(t,e,n){if(e=zE(e),zE(t)!==e&&n)throw Error($e(425))}function x3(){}var FG=null,VG=null;function LG(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var kG=typeof setTimeout=="function"?setTimeout:void 0,yP=typeof clearTimeout=="function"?clearTimeout:void 0,UE=typeof Promise=="function"?Promise:void 0,BP=typeof queueMicrotask=="function"?queueMicrotask:typeof UE<"u"?function(t){return UE.resolve(null).then(t).catch(GP)}:kG;function GP(t){setTimeout(function(){throw t})}function n5(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),qC(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);qC(e)}function Qg(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function DE(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var TA=Math.random().toString(36).slice(2),Ua="__reactFiber$"+TA,rf="__reactProps$"+TA,jl="__reactContainer$"+TA,HG="__reactEvents$"+TA,SP="__reactListeners$"+TA,wP="__reactHandles$"+TA;function Su(t){var e=t[Ua];if(e)return e;for(var n=t.parentNode;n;){if(e=n[jl]||n[Ua]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=DE(t);t!==null;){if(n=t[Ua])return n;t=DE(t)}return e}t=n,n=t.parentNode}return null}function I0(t){return t=t[Ua]||t[jl],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function xd(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error($e(33))}function Ob(t){return t[rf]||null}var _G=[],Zd=-1;function Bc(t){return{current:t}}function On(t){0>Zd||(t.current=_G[Zd],_G[Zd]=null,Zd--)}function _n(t,e){Zd++,_G[Zd]=t.current,t.current=e}var cc={},Fr=Bc(cc),Gs=Bc(!1),Ou=cc;function cA(t,e){var n=t.type.contextTypes;if(!n)return cc;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Ss(t){return t=t.childContextTypes,t!=null}function Z3(){On(Gs),On(Fr)}function PE(t,e,n){if(Fr.current!==cc)throw Error($e(168));_n(Fr,e),_n(Gs,n)}function WF(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error($e(108,cD(t)||"Unknown",r));return li({},n,i)}function E3(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||cc,Ou=Fr.current,_n(Fr,t),_n(Gs,Gs.current),!0}function OE(t,e,n){var i=t.stateNode;if(!i)throw Error($e(169));n?(t=WF(t,e,Ou),i.__reactInternalMemoizedMergedChildContext=t,On(Gs),On(Fr),_n(Fr,t)):On(Gs),_n(Gs,n)}var Vl=null,Qb=!1,i5=!1;function NF(t){Vl===null?Vl=[t]:Vl.push(t)}function RP(t){Qb=!0,NF(t)}function Gc(){if(!i5&&Vl!==null){i5=!0;var t=0,e=mn;try{var n=Vl;for(mn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Vl=null,Qb=!1}catch(r){throw Vl!==null&&(Vl=Vl.slice(t+1)),iF(Zw,Gc),r}finally{mn=e,i5=!1}}return null}var Ed=[],Wd=0,W3=null,N3=0,wo=[],Ro=0,Qu=null,Hl=1,_l="";function au(t,e){Ed[Wd++]=N3,Ed[Wd++]=W3,W3=t,N3=e}function MF(t,e,n){wo[Ro++]=Hl,wo[Ro++]=_l,wo[Ro++]=Qu,Qu=t;var i=Hl;t=_l;var r=32-la(i)-1;i&=~(1<<r),n+=1;var s=32-la(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Hl=1<<32-la(e)+r|n<<r|i,_l=s+t}else Hl=1<<s|n<<r|i,_l=t}function kw(t){t.return!==null&&(au(t,1),MF(t,1,0))}function Hw(t){for(;t===W3;)W3=Ed[--Wd],Ed[Wd]=null,N3=Ed[--Wd],Ed[Wd]=null;for(;t===Qu;)Qu=wo[--Ro],wo[Ro]=null,_l=wo[--Ro],wo[Ro]=null,Hl=wo[--Ro],wo[Ro]=null}var qs=null,Qs=null,qn=!1,ia=null;function TF(t,e){var n=xo(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function QE(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,qs=t,Qs=Qg(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,qs=t,Qs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Qu!==null?{id:Hl,overflow:_l}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=xo(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,qs=t,Qs=null,!0):!1;default:return!1}}function XG(t){return(t.mode&1)!==0&&(t.flags&128)===0}function YG(t){if(qn){var e=Qs;if(e){var n=e;if(!QE(t,e)){if(XG(t))throw Error($e(418));e=Qg(n.nextSibling);var i=qs;e&&QE(t,e)?TF(i,n):(t.flags=t.flags&-4097|2,qn=!1,qs=t)}}else{if(XG(t))throw Error($e(418));t.flags=t.flags&-4097|2,qn=!1,qs=t}}}function JE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;qs=t}function im(t){if(t!==qs)return!1;if(!qn)return JE(t),qn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!LG(t.type,t.memoizedProps)),e&&(e=Qs)){if(XG(t))throw FF(),Error($e(418));for(;e;)TF(t,e),e=Qg(e.nextSibling)}if(JE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error($e(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Qs=Qg(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Qs=null}}else Qs=qs?Qg(t.stateNode.nextSibling):null;return!0}function FF(){for(var t=Qs;t;)t=Qg(t.nextSibling)}function uA(){Qs=qs=null,qn=!1}function _w(t){ia===null?ia=[t]:ia.push(t)}var xP=og.ReactCurrentBatchConfig;function $o(t,e){if(t&&t.defaultProps){e=li({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var M3=Bc(null),T3=null,Nd=null,Xw=null;function Yw(){Xw=Nd=T3=null}function Kw(t){var e=M3.current;On(M3),t._currentValue=e}function KG(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Jd(t,e){T3=t,Xw=Nd=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(vs=!0),t.firstContext=null)}function To(t){var e=t._currentValue;if(Xw!==t)if(t={context:t,memoizedValue:e,next:null},Nd===null){if(T3===null)throw Error($e(308));Nd=t,T3.dependencies={lanes:0,firstContext:t}}else Nd=Nd.next=t;return e}var wu=null;function zw(t){wu===null?wu=[t]:wu.push(t)}function VF(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,zw(e)):(n.next=r.next,r.next=n),e.interleaved=n,ql(t,i)}function ql(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Lg=!1;function Uw(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function LF(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Dl(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Jg(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,gn&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,ql(t,n)}return r=i.interleaved,r===null?(e.next=e,zw(i)):(e.next=r.next,r.next=e),i.interleaved=e,ql(t,n)}function X2(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Ew(t,n)}}function jE(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function F3(t,e,n,i){var r=t.updateQueue;Lg=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,g=l.next;l.next=null,o===null?s=g:o.next=g,o=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=g:a.next=g,c.lastBaseUpdate=l))}if(s!==null){var u=r.baseState;o=0,c=g=l=null,a=s;do{var I=a.lane,h=a.eventTime;if((i&I)===I){c!==null&&(c=c.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var C=t,b=a;switch(I=e,h=n,b.tag){case 1:if(C=b.payload,typeof C=="function"){u=C.call(h,u,I);break e}u=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=b.payload,I=typeof C=="function"?C.call(h,u,I):C,I==null)break e;u=li({},u,I);break e;case 2:Lg=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,I=r.effects,I===null?r.effects=[a]:I.push(a))}else h={eventTime:h,lane:I,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(g=c=h,l=u):c=c.next=h,o|=I;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;I=a,a=I.next,I.next=null,r.lastBaseUpdate=I,r.shared.pending=null}}while(1);if(c===null&&(l=u),r.baseState=l,r.firstBaseUpdate=g,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);ju|=o,t.lanes=o,t.memoizedState=u}}function qE(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error($e(191,r));r.call(i)}}}var kF=new VT.Component().refs;function zG(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:li({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Jb={isMounted:function(t){return(t=t._reactInternals)?hI(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=ts(),r=qg(t),s=Dl(i,r);s.payload=e,n!=null&&(s.callback=n),e=Jg(t,s,r),e!==null&&(ga(e,t,r,i),X2(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=ts(),r=qg(t),s=Dl(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Jg(t,s,r),e!==null&&(ga(e,t,r,i),X2(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=ts(),i=qg(t),r=Dl(n,i);r.tag=2,e!=null&&(r.callback=e),e=Jg(t,r,i),e!==null&&(ga(e,t,i,n),X2(e,t,i))}};function $E(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!ef(n,i)||!ef(r,s):!0}function HF(t,e,n){var i=!1,r=cc,s=e.contextType;return typeof s=="object"&&s!==null?s=To(s):(r=Ss(e)?Ou:Fr.current,i=e.contextTypes,s=(i=i!=null)?cA(t,r):cc),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jb,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function e6(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Jb.enqueueReplaceState(e,e.state,null)}function UG(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=kF,Uw(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=To(s):(s=Ss(e)?Ou:Fr.current,r.context=cA(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(zG(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Jb.enqueueReplaceState(r,r.state,null),F3(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Rh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error($e(309));var i=n.stateNode}if(!i)throw Error($e(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===kF&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error($e(284));if(!n._owner)throw Error($e(290,t))}return t}function rm(t,e){throw t=Object.prototype.toString.call(e),Error($e(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function t6(t){var e=t._init;return e(t._payload)}function _F(t){function e(f,p){if(t){var v=f.deletions;v===null?(f.deletions=[p],f.flags|=16):v.push(p)}}function n(f,p){if(!t)return null;for(;p!==null;)e(f,p),p=p.sibling;return null}function i(f,p){for(f=new Map;p!==null;)p.key!==null?f.set(p.key,p):f.set(p.index,p),p=p.sibling;return f}function r(f,p){return f=$g(f,p),f.index=0,f.sibling=null,f}function s(f,p,v){return f.index=v,t?(v=f.alternate,v!==null?(v=v.index,v<p?(f.flags|=2,p):v):(f.flags|=2,p)):(f.flags|=1048576,p)}function o(f){return t&&f.alternate===null&&(f.flags|=2),f}function a(f,p,v,B){return p===null||p.tag!==6?(p=c5(v,f.mode,B),p.return=f,p):(p=r(p,v),p.return=f,p)}function l(f,p,v,B){var G=v.type;return G===Gd?c(f,p,v.props.children,B,v.key):p!==null&&(p.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===Vg&&t6(G)===p.type)?(B=r(p,v.props),B.ref=Rh(f,p,v),B.return=f,B):(B=P2(v.type,v.key,v.props,null,f.mode,B),B.ref=Rh(f,p,v),B.return=f,B)}function g(f,p,v,B){return p===null||p.tag!==4||p.stateNode.containerInfo!==v.containerInfo||p.stateNode.implementation!==v.implementation?(p=u5(v,f.mode,B),p.return=f,p):(p=r(p,v.children||[]),p.return=f,p)}function c(f,p,v,B,G){return p===null||p.tag!==7?(p=ku(v,f.mode,B,G),p.return=f,p):(p=r(p,v),p.return=f,p)}function u(f,p,v){if(typeof p=="string"&&p!==""||typeof p=="number")return p=c5(""+p,f.mode,v),p.return=f,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Pp:return v=P2(p.type,p.key,p.props,null,f.mode,v),v.ref=Rh(f,null,p),v.return=f,v;case Bd:return p=u5(p,f.mode,v),p.return=f,p;case Vg:var B=p._init;return u(f,B(p._payload),v)}if(oC(p)||yh(p))return p=ku(p,f.mode,v,null),p.return=f,p;rm(f,p)}return null}function I(f,p,v,B){var G=p!==null?p.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return G!==null?null:a(f,p,""+v,B);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Pp:return v.key===G?l(f,p,v,B):null;case Bd:return v.key===G?g(f,p,v,B):null;case Vg:return G=v._init,I(f,p,G(v._payload),B)}if(oC(v)||yh(v))return G!==null?null:c(f,p,v,B,null);rm(f,v)}return null}function h(f,p,v,B,G){if(typeof B=="string"&&B!==""||typeof B=="number")return f=f.get(v)||null,a(p,f,""+B,G);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Pp:return f=f.get(B.key===null?v:B.key)||null,l(p,f,B,G);case Bd:return f=f.get(B.key===null?v:B.key)||null,g(p,f,B,G);case Vg:var R=B._init;return h(f,p,v,R(B._payload),G)}if(oC(B)||yh(B))return f=f.get(v)||null,c(p,f,B,G,null);rm(p,B)}return null}function C(f,p,v,B){for(var G=null,R=null,w=p,E=p=0,x=null;w!==null&&E<v.length;E++){w.index>E?(x=w,w=null):x=w.sibling;var W=I(f,w,v[E],B);if(W===null){w===null&&(w=x);break}t&&w&&W.alternate===null&&e(f,w),p=s(W,p,E),R===null?G=W:R.sibling=W,R=W,w=x}if(E===v.length)return n(f,w),qn&&au(f,E),G;if(w===null){for(;E<v.length;E++)w=u(f,v[E],B),w!==null&&(p=s(w,p,E),R===null?G=w:R.sibling=w,R=w);return qn&&au(f,E),G}for(w=i(f,w);E<v.length;E++)x=h(w,f,E,v[E],B),x!==null&&(t&&x.alternate!==null&&w.delete(x.key===null?E:x.key),p=s(x,p,E),R===null?G=x:R.sibling=x,R=x);return t&&w.forEach(function(T){return e(f,T)}),qn&&au(f,E),G}function b(f,p,v,B){var G=yh(v);if(typeof G!="function")throw Error($e(150));if(v=G.call(v),v==null)throw Error($e(151));for(var R=G=null,w=p,E=p=0,x=null,W=v.next();w!==null&&!W.done;E++,W=v.next()){w.index>E?(x=w,w=null):x=w.sibling;var T=I(f,w,W.value,B);if(T===null){w===null&&(w=x);break}t&&w&&T.alternate===null&&e(f,w),p=s(T,p,E),R===null?G=T:R.sibling=T,R=T,w=x}if(W.done)return n(f,w),qn&&au(f,E),G;if(w===null){for(;!W.done;E++,W=v.next())W=u(f,W.value,B),W!==null&&(p=s(W,p,E),R===null?G=W:R.sibling=W,R=W);return qn&&au(f,E),G}for(w=i(f,w);!W.done;E++,W=v.next())W=h(w,f,E,W.value,B),W!==null&&(t&&W.alternate!==null&&w.delete(W.key===null?E:W.key),p=s(W,p,E),R===null?G=W:R.sibling=W,R=W);return t&&w.forEach(function(k){return e(f,k)}),qn&&au(f,E),G}function m(f,p,v,B){if(typeof v=="object"&&v!==null&&v.type===Gd&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Pp:e:{for(var G=v.key,R=p;R!==null;){if(R.key===G){if(G=v.type,G===Gd){if(R.tag===7){n(f,R.sibling),p=r(R,v.props.children),p.return=f,f=p;break e}}else if(R.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===Vg&&t6(G)===R.type){n(f,R.sibling),p=r(R,v.props),p.ref=Rh(f,R,v),p.return=f,f=p;break e}n(f,R);break}else e(f,R);R=R.sibling}v.type===Gd?(p=ku(v.props.children,f.mode,B,v.key),p.return=f,f=p):(B=P2(v.type,v.key,v.props,null,f.mode,B),B.ref=Rh(f,p,v),B.return=f,f=B)}return o(f);case Bd:e:{for(R=v.key;p!==null;){if(p.key===R)if(p.tag===4&&p.stateNode.containerInfo===v.containerInfo&&p.stateNode.implementation===v.implementation){n(f,p.sibling),p=r(p,v.children||[]),p.return=f,f=p;break e}else{n(f,p);break}else e(f,p);p=p.sibling}p=u5(v,f.mode,B),p.return=f,f=p}return o(f);case Vg:return R=v._init,m(f,p,R(v._payload),B)}if(oC(v))return C(f,p,v,B);if(yh(v))return b(f,p,v,B);rm(f,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,p!==null&&p.tag===6?(n(f,p.sibling),p=r(p,v),p.return=f,f=p):(n(f,p),p=c5(v,f.mode,B),p.return=f,f=p),o(f)):n(f,p)}return m}var IA=_F(!0),XF=_F(!1),d0={},Qa=Bc(d0),sf=Bc(d0),of=Bc(d0);function Ru(t){if(t===d0)throw Error($e(174));return t}function Dw(t,e){switch(_n(of,e),_n(sf,t),_n(Qa,d0),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:BG(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=BG(e,t)}On(Qa),_n(Qa,e)}function dA(){On(Qa),On(sf),On(of)}function YF(t){Ru(of.current);var e=Ru(Qa.current),n=BG(e,t.type);e!==n&&(_n(sf,t),_n(Qa,n))}function Pw(t){sf.current===t&&(On(Qa),On(sf))}var ri=Bc(0);function V3(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var r5=[];function Ow(){for(var t=0;t<r5.length;t++)r5[t]._workInProgressVersionPrimary=null;r5.length=0}var Y2=og.ReactCurrentDispatcher,s5=og.ReactCurrentBatchConfig,Ju=0,oi=null,_i=null,rr=null,L3=!1,yC=!1,af=0,ZP=0;function Rr(){throw Error($e(321))}function Qw(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ha(t[n],e[n]))return!1;return!0}function Jw(t,e,n,i,r,s){if(Ju=s,oi=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Y2.current=t===null||t.memoizedState===null?MP:TP,t=n(i,r),yC){s=0;do{if(yC=!1,af=0,25<=s)throw Error($e(301));s+=1,rr=_i=null,e.updateQueue=null,Y2.current=FP,t=n(i,r)}while(yC)}if(Y2.current=k3,e=_i!==null&&_i.next!==null,Ju=0,rr=_i=oi=null,L3=!1,e)throw Error($e(300));return t}function jw(){var t=af!==0;return af=0,t}function Ka(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rr===null?oi.memoizedState=rr=t:rr=rr.next=t,rr}function Fo(){if(_i===null){var t=oi.alternate;t=t!==null?t.memoizedState:null}else t=_i.next;var e=rr===null?oi.memoizedState:rr.next;if(e!==null)rr=e,_i=t;else{if(t===null)throw Error($e(310));_i=t,t={memoizedState:_i.memoizedState,baseState:_i.baseState,baseQueue:_i.baseQueue,queue:_i.queue,next:null},rr===null?oi.memoizedState=rr=t:rr=rr.next=t}return rr}function lf(t,e){return typeof e=="function"?e(t):e}function o5(t){var e=Fo(),n=e.queue;if(n===null)throw Error($e(311));n.lastRenderedReducer=t;var i=_i,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,g=s;do{var c=g.lane;if((Ju&c)===c)l!==null&&(l=l.next={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null}),i=g.hasEagerState?g.eagerState:t(i,g.action);else{var u={lane:c,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};l===null?(a=l=u,o=i):l=l.next=u,oi.lanes|=c,ju|=c}g=g.next}while(g!==null&&g!==s);l===null?o=i:l.next=a,ha(i,e.memoizedState)||(vs=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,oi.lanes|=s,ju|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function a5(t){var e=Fo(),n=e.queue;if(n===null)throw Error($e(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);ha(s,e.memoizedState)||(vs=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function KF(){}function zF(t,e){var n=oi,i=Fo(),r=e(),s=!ha(i.memoizedState,r);if(s&&(i.memoizedState=r,vs=!0),i=i.queue,qw(PF.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||rr!==null&&rr.memoizedState.tag&1){if(n.flags|=2048,gf(9,DF.bind(null,n,i,r,e),void 0,null),lr===null)throw Error($e(349));Ju&30||UF(n,e,r)}return r}function UF(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=oi.updateQueue,e===null?(e={lastEffect:null,stores:null},oi.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function DF(t,e,n,i){e.value=n,e.getSnapshot=i,OF(e)&&QF(t)}function PF(t,e,n){return n(function(){OF(e)&&QF(t)})}function OF(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ha(t,n)}catch{return!0}}function QF(t){var e=ql(t,1);e!==null&&ga(e,t,1,-1)}function n6(t){var e=Ka();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lf,lastRenderedState:t},e.queue=t,t=t.dispatch=NP.bind(null,oi,t),[e.memoizedState,t]}function gf(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=oi.updateQueue,e===null?(e={lastEffect:null,stores:null},oi.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function JF(){return Fo().memoizedState}function K2(t,e,n,i){var r=Ka();oi.flags|=t,r.memoizedState=gf(1|e,n,void 0,i===void 0?null:i)}function jb(t,e,n,i){var r=Fo();i=i===void 0?null:i;var s=void 0;if(_i!==null){var o=_i.memoizedState;if(s=o.destroy,i!==null&&Qw(i,o.deps)){r.memoizedState=gf(e,n,s,i);return}}oi.flags|=t,r.memoizedState=gf(1|e,n,s,i)}function i6(t,e){return K2(8390656,8,t,e)}function qw(t,e){return jb(2048,8,t,e)}function jF(t,e){return jb(4,2,t,e)}function qF(t,e){return jb(4,4,t,e)}function $F(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function eV(t,e,n){return n=n!=null?n.concat([t]):null,jb(4,4,$F.bind(null,e,t),n)}function $w(){}function tV(t,e){var n=Fo();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Qw(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function nV(t,e){var n=Fo();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Qw(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function iV(t,e,n){return Ju&21?(ha(n,e)||(n=oF(),oi.lanes|=n,ju|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,vs=!0),t.memoizedState=n)}function EP(t,e){var n=mn;mn=n!==0&&4>n?n:4,t(!0);var i=s5.transition;s5.transition={};try{t(!1),e()}finally{mn=n,s5.transition=i}}function rV(){return Fo().memoizedState}function WP(t,e,n){var i=qg(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},sV(t))oV(e,n);else if(n=VF(t,e,n,i),n!==null){var r=ts();ga(n,t,i,r),aV(n,e,i)}}function NP(t,e,n){var i=qg(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(sV(t))oV(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,ha(a,o)){var l=e.interleaved;l===null?(r.next=r,zw(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=VF(t,e,r,i),n!==null&&(r=ts(),ga(n,t,i,r),aV(n,e,i))}}function sV(t){var e=t.alternate;return t===oi||e!==null&&e===oi}function oV(t,e){yC=L3=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function aV(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Ew(t,n)}}var k3={readContext:To,useCallback:Rr,useContext:Rr,useEffect:Rr,useImperativeHandle:Rr,useInsertionEffect:Rr,useLayoutEffect:Rr,useMemo:Rr,useReducer:Rr,useRef:Rr,useState:Rr,useDebugValue:Rr,useDeferredValue:Rr,useTransition:Rr,useMutableSource:Rr,useSyncExternalStore:Rr,useId:Rr,unstable_isNewReconciler:!1},MP={readContext:To,useCallback:function(t,e){return Ka().memoizedState=[t,e===void 0?null:e],t},useContext:To,useEffect:i6,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,K2(4194308,4,$F.bind(null,e,t),n)},useLayoutEffect:function(t,e){return K2(4194308,4,t,e)},useInsertionEffect:function(t,e){return K2(4,2,t,e)},useMemo:function(t,e){var n=Ka();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Ka();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=WP.bind(null,oi,t),[i.memoizedState,t]},useRef:function(t){var e=Ka();return t={current:t},e.memoizedState=t},useState:n6,useDebugValue:$w,useDeferredValue:function(t){return Ka().memoizedState=t},useTransition:function(){var t=n6(!1),e=t[0];return t=EP.bind(null,t[1]),Ka().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=oi,r=Ka();if(qn){if(n===void 0)throw Error($e(407));n=n()}else{if(n=e(),lr===null)throw Error($e(349));Ju&30||UF(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,i6(PF.bind(null,i,s,t),[t]),i.flags|=2048,gf(9,DF.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Ka(),e=lr.identifierPrefix;if(qn){var n=_l,i=Hl;n=(i&~(1<<32-la(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=af++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ZP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},TP={readContext:To,useCallback:tV,useContext:To,useEffect:qw,useImperativeHandle:eV,useInsertionEffect:jF,useLayoutEffect:qF,useMemo:nV,useReducer:o5,useRef:JF,useState:function(){return o5(lf)},useDebugValue:$w,useDeferredValue:function(t){var e=Fo();return iV(e,_i.memoizedState,t)},useTransition:function(){var t=o5(lf)[0],e=Fo().memoizedState;return[t,e]},useMutableSource:KF,useSyncExternalStore:zF,useId:rV,unstable_isNewReconciler:!1},FP={readContext:To,useCallback:tV,useContext:To,useEffect:qw,useImperativeHandle:eV,useInsertionEffect:jF,useLayoutEffect:qF,useMemo:nV,useReducer:a5,useRef:JF,useState:function(){return a5(lf)},useDebugValue:$w,useDeferredValue:function(t){var e=Fo();return _i===null?e.memoizedState=t:iV(e,_i.memoizedState,t)},useTransition:function(){var t=a5(lf)[0],e=Fo().memoizedState;return[t,e]},useMutableSource:KF,useSyncExternalStore:zF,useId:rV,unstable_isNewReconciler:!1};function AA(t,e){try{var n="",i=e;do n+=gD(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function l5(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function DG(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var VP=typeof WeakMap=="function"?WeakMap:Map;function lV(t,e,n){n=Dl(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){_3||(_3=!0,n9=i),DG(t,e)},n}function gV(t,e,n){n=Dl(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){DG(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){DG(t,e),typeof i!="function"&&(jg===null?jg=new Set([this]):jg.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function r6(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new VP;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=JP.bind(null,t,e,n),e.then(t,t))}function s6(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function o6(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Dl(-1,1),e.tag=2,Jg(n,e,1))),n.lanes|=1),t)}var LP=og.ReactCurrentOwner,vs=!1;function Jr(t,e,n,i){e.child=t===null?XF(e,null,n,i):IA(e,t.child,n,i)}function a6(t,e,n,i,r){n=n.render;var s=e.ref;return Jd(e,r),i=Jw(t,e,n,i,s,r),n=jw(),t!==null&&!vs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,$l(t,e,r)):(qn&&n&&kw(e),e.flags|=1,Jr(t,e,i,r),e.child)}function l6(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!aR(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,cV(t,e,s,i,r)):(t=P2(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:ef,n(o,i)&&t.ref===e.ref)return $l(t,e,r)}return e.flags|=1,t=$g(s,i),t.ref=e.ref,t.return=e,e.child=t}function cV(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(ef(s,i)&&t.ref===e.ref)if(vs=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(vs=!0);else return e.lanes=t.lanes,$l(t,e,r)}return PG(t,e,n,i,r)}function uV(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_n(Td,Us),Us|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,_n(Td,Us),Us|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,_n(Td,Us),Us|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,_n(Td,Us),Us|=i;return Jr(t,e,r,n),e.child}function IV(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function PG(t,e,n,i,r){var s=Ss(n)?Ou:Fr.current;return s=cA(e,s),Jd(e,r),n=Jw(t,e,n,i,s,r),i=jw(),t!==null&&!vs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,$l(t,e,r)):(qn&&i&&kw(e),e.flags|=1,Jr(t,e,n,r),e.child)}function g6(t,e,n,i,r){if(Ss(n)){var s=!0;E3(e)}else s=!1;if(Jd(e,r),e.stateNode===null)z2(t,e),HF(e,n,i),UG(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,g=n.contextType;typeof g=="object"&&g!==null?g=To(g):(g=Ss(n)?Ou:Fr.current,g=cA(e,g));var c=n.getDerivedStateFromProps,u=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";u||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==g)&&e6(e,o,i,g),Lg=!1;var I=e.memoizedState;o.state=I,F3(e,i,o,r),l=e.memoizedState,a!==i||I!==l||Gs.current||Lg?(typeof c=="function"&&(zG(e,n,c,i),l=e.memoizedState),(a=Lg||$E(e,n,a,i,I,l,g))?(u||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=g,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,LF(t,e),a=e.memoizedProps,g=e.type===e.elementType?a:$o(e.type,a),o.props=g,u=e.pendingProps,I=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=To(l):(l=Ss(n)?Ou:Fr.current,l=cA(e,l));var h=n.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==u||I!==l)&&e6(e,o,i,l),Lg=!1,I=e.memoizedState,o.state=I,F3(e,i,o,r);var C=e.memoizedState;a!==u||I!==C||Gs.current||Lg?(typeof h=="function"&&(zG(e,n,h,i),C=e.memoizedState),(g=Lg||$E(e,n,g,i,I,C,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,C,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,C,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&I===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&I===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=C),o.props=i,o.state=C,o.context=l,i=g):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&I===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&I===t.memoizedState||(e.flags|=1024),i=!1)}return OG(t,e,n,i,s,r)}function OG(t,e,n,i,r,s){IV(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&OE(e,n,!1),$l(t,e,s);i=e.stateNode,LP.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=IA(e,t.child,null,s),e.child=IA(e,null,a,s)):Jr(t,e,a,s),e.memoizedState=i.state,r&&OE(e,n,!0),e.child}function dV(t){var e=t.stateNode;e.pendingContext?PE(t,e.pendingContext,e.pendingContext!==e.context):e.context&&PE(t,e.context,!1),Dw(t,e.containerInfo)}function c6(t,e,n,i,r){return uA(),_w(r),e.flags|=256,Jr(t,e,n,i),e.child}var QG={dehydrated:null,treeContext:null,retryLane:0};function JG(t){return{baseLanes:t,cachePool:null,transitions:null}}function AV(t,e,n){var i=e.pendingProps,r=ri.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),_n(ri,r&1),t===null)return YG(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=ev(o,i,0,null),t=ku(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=JG(n),e.memoizedState=QG,t):eR(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return kP(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=$g(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=$g(a,s):(s=ku(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?JG(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=QG,i}return s=t.child,t=s.sibling,i=$g(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function eR(t,e){return e=ev({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function sm(t,e,n,i){return i!==null&&_w(i),IA(e,t.child,null,n),t=eR(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function kP(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=l5(Error($e(422))),sm(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=ev({mode:"visible",children:i.children},r,0,null),s=ku(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&IA(e,t.child,null,o),e.child.memoizedState=JG(o),e.memoizedState=QG,s);if(!(e.mode&1))return sm(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error($e(419)),i=l5(s,i,void 0),sm(t,e,o,i)}if(a=(o&t.childLanes)!==0,vs||a){if(i=lr,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,ql(t,r),ga(i,t,r,-1))}return oR(),i=l5(Error($e(421))),sm(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=jP.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,Qs=Qg(r.nextSibling),qs=e,qn=!0,ia=null,t!==null&&(wo[Ro++]=Hl,wo[Ro++]=_l,wo[Ro++]=Qu,Hl=t.id,_l=t.overflow,Qu=e),e=eR(e,i.children),e.flags|=4096,e)}function u6(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),KG(t.return,e,n)}function g5(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function hV(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Jr(t,e,i.children,n),i=ri.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&u6(t,n,e);else if(t.tag===19)u6(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(_n(ri,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&V3(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),g5(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&V3(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}g5(e,!0,n,null,s);break;case"together":g5(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function z2(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function $l(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ju|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error($e(153));if(e.child!==null){for(t=e.child,n=$g(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$g(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function HP(t,e,n){switch(e.tag){case 3:dV(e),uA();break;case 5:YF(e);break;case 1:Ss(e.type)&&E3(e);break;case 4:Dw(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;_n(M3,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(_n(ri,ri.current&1),e.flags|=128,null):n&e.child.childLanes?AV(t,e,n):(_n(ri,ri.current&1),t=$l(t,e,n),t!==null?t.sibling:null);_n(ri,ri.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return hV(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),_n(ri,ri.current),i)break;return null;case 22:case 23:return e.lanes=0,uV(t,e,n)}return $l(t,e,n)}var CV,jG,fV,pV;CV=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};jG=function(){};fV=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Ru(Qa.current);var s=null;switch(n){case"input":r=mG(t,r),i=mG(t,i),s=[];break;case"select":r=li({},r,{value:void 0}),i=li({},i,{value:void 0}),s=[];break;case"textarea":r=yG(t,r),i=yG(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=x3)}GG(n,i);var o;n=null;for(g in r)if(!i.hasOwnProperty(g)&&r.hasOwnProperty(g)&&r[g]!=null)if(g==="style"){var a=r[g];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else g!=="dangerouslySetInnerHTML"&&g!=="children"&&g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(PC.hasOwnProperty(g)?s||(s=[]):(s=s||[]).push(g,null));for(g in i){var l=i[g];if(a=r!=null?r[g]:void 0,i.hasOwnProperty(g)&&l!==a&&(l!=null||a!=null))if(g==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(g,n)),n=l;else g==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(g,l)):g==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(g,""+l):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&(PC.hasOwnProperty(g)?(l!=null&&g==="onScroll"&&Kn("scroll",t),s||a===l||(s=[])):(s=s||[]).push(g,l))}n&&(s=s||[]).push("style",n);var g=s;(e.updateQueue=g)&&(e.flags|=4)}};pV=function(t,e,n,i){n!==i&&(e.flags|=4)};function xh(t,e){if(!qn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function xr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function _P(t,e,n){var i=e.pendingProps;switch(Hw(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xr(e),null;case 1:return Ss(e.type)&&Z3(),xr(e),null;case 3:return i=e.stateNode,dA(),On(Gs),On(Fr),Ow(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(im(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ia!==null&&(s9(ia),ia=null))),jG(t,e),xr(e),null;case 5:Pw(e);var r=Ru(of.current);if(n=e.type,t!==null&&e.stateNode!=null)fV(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error($e(166));return xr(e),null}if(t=Ru(Qa.current),im(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Ua]=e,i[rf]=s,t=(e.mode&1)!==0,n){case"dialog":Kn("cancel",i),Kn("close",i);break;case"iframe":case"object":case"embed":Kn("load",i);break;case"video":case"audio":for(r=0;r<lC.length;r++)Kn(lC[r],i);break;case"source":Kn("error",i);break;case"img":case"image":case"link":Kn("error",i),Kn("load",i);break;case"details":Kn("toggle",i);break;case"input":bE(i,s),Kn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Kn("invalid",i);break;case"textarea":yE(i,s),Kn("invalid",i)}GG(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&nm(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&nm(i.textContent,a,t),r=["children",""+a]):PC.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Kn("scroll",i)}switch(n){case"input":Op(i),vE(i,s,!0);break;case"textarea":Op(i),BE(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=x3)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=UT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Ua]=e,t[rf]=i,CV(t,e,!1,!1),e.stateNode=t;e:{switch(o=SG(n,i),n){case"dialog":Kn("cancel",t),Kn("close",t),r=i;break;case"iframe":case"object":case"embed":Kn("load",t),r=i;break;case"video":case"audio":for(r=0;r<lC.length;r++)Kn(lC[r],t);r=i;break;case"source":Kn("error",t),r=i;break;case"img":case"image":case"link":Kn("error",t),Kn("load",t),r=i;break;case"details":Kn("toggle",t),r=i;break;case"input":bE(t,i),r=mG(t,i),Kn("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=li({},i,{value:void 0}),Kn("invalid",t);break;case"textarea":yE(t,i),r=yG(t,i),Kn("invalid",t);break;default:r=i}GG(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?OT(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&DT(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&OC(t,l):typeof l=="number"&&OC(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(PC.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Kn("scroll",t):l!=null&&Gw(t,s,l,o))}switch(n){case"input":Op(t),vE(t,i,!1);break;case"textarea":Op(t),BE(t);break;case"option":i.value!=null&&t.setAttribute("value",""+gc(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Dd(t,!!i.multiple,s,!1):i.defaultValue!=null&&Dd(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=x3)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xr(e),null;case 6:if(t&&e.stateNode!=null)pV(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error($e(166));if(n=Ru(of.current),Ru(Qa.current),im(e)){if(i=e.stateNode,n=e.memoizedProps,i[Ua]=e,(s=i.nodeValue!==n)&&(t=qs,t!==null))switch(t.tag){case 3:nm(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&nm(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Ua]=e,e.stateNode=i}return xr(e),null;case 13:if(On(ri),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(qn&&Qs!==null&&e.mode&1&&!(e.flags&128))FF(),uA(),e.flags|=98560,s=!1;else if(s=im(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error($e(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error($e(317));s[Ua]=e}else uA(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xr(e),s=!1}else ia!==null&&(s9(ia),ia=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||ri.current&1?Di===0&&(Di=3):oR())),e.updateQueue!==null&&(e.flags|=4),xr(e),null);case 4:return dA(),jG(t,e),t===null&&tf(e.stateNode.containerInfo),xr(e),null;case 10:return Kw(e.type._context),xr(e),null;case 17:return Ss(e.type)&&Z3(),xr(e),null;case 19:if(On(ri),s=e.memoizedState,s===null)return xr(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)xh(s,!1);else{if(Di!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=V3(t),o!==null){for(e.flags|=128,xh(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return _n(ri,ri.current&1|2),e.child}t=t.sibling}s.tail!==null&&wi()>hA&&(e.flags|=128,i=!0,xh(s,!1),e.lanes=4194304)}else{if(!i)if(t=V3(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),xh(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!qn)return xr(e),null}else 2*wi()-s.renderingStartTime>hA&&n!==1073741824&&(e.flags|=128,i=!0,xh(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=wi(),e.sibling=null,n=ri.current,_n(ri,i?n&1|2:n&1),e):(xr(e),null);case 22:case 23:return sR(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Us&1073741824&&(xr(e),e.subtreeFlags&6&&(e.flags|=8192)):xr(e),null;case 24:return null;case 25:return null}throw Error($e(156,e.tag))}function XP(t,e){switch(Hw(e),e.tag){case 1:return Ss(e.type)&&Z3(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return dA(),On(Gs),On(Fr),Ow(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Pw(e),null;case 13:if(On(ri),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error($e(340));uA()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return On(ri),null;case 4:return dA(),null;case 10:return Kw(e.type._context),null;case 22:case 23:return sR(),null;case 24:return null;default:return null}}var om=!1,Mr=!1,YP=typeof WeakSet=="function"?WeakSet:Set,lt=null;function Md(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){di(t,e,i)}else n.current=null}function qG(t,e,n){try{n()}catch(i){di(t,e,i)}}var I6=!1;function KP(t,e){if(FG=S3,t=yF(),Lw(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,g=0,c=0,u=t,I=null;t:for(;;){for(var h;u!==n||r!==0&&u.nodeType!==3||(a=o+r),u!==s||i!==0&&u.nodeType!==3||(l=o+i),u.nodeType===3&&(o+=u.nodeValue.length),(h=u.firstChild)!==null;)I=u,u=h;for(;;){if(u===t)break t;if(I===n&&++g===r&&(a=o),I===s&&++c===i&&(l=o),(h=u.nextSibling)!==null)break;u=I,I=u.parentNode}u=h}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(VG={focusedElem:t,selectionRange:n},S3=!1,lt=e;lt!==null;)if(e=lt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,lt=t;else for(;lt!==null;){e=lt;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var b=C.memoizedProps,m=C.memoizedState,f=e.stateNode,p=f.getSnapshotBeforeUpdate(e.elementType===e.type?b:$o(e.type,b),m);f.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($e(163))}}catch(B){di(e,e.return,B)}if(t=e.sibling,t!==null){t.return=e.return,lt=t;break}lt=e.return}return C=I6,I6=!1,C}function BC(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&qG(e,n,s)}r=r.next}while(r!==i)}}function qb(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function $G(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function mV(t){var e=t.alternate;e!==null&&(t.alternate=null,mV(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ua],delete e[rf],delete e[HG],delete e[SP],delete e[wP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function bV(t){return t.tag===5||t.tag===3||t.tag===4}function d6(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||bV(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function e9(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=x3));else if(i!==4&&(t=t.child,t!==null))for(e9(t,e,n),t=t.sibling;t!==null;)e9(t,e,n),t=t.sibling}function t9(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(t9(t,e,n),t=t.sibling;t!==null;)t9(t,e,n),t=t.sibling}var hr=null,ta=!1;function Sg(t,e,n){for(n=n.child;n!==null;)vV(t,e,n),n=n.sibling}function vV(t,e,n){if(Oa&&typeof Oa.onCommitFiberUnmount=="function")try{Oa.onCommitFiberUnmount(zb,n)}catch{}switch(n.tag){case 5:Mr||Md(n,e);case 6:var i=hr,r=ta;hr=null,Sg(t,e,n),hr=i,ta=r,hr!==null&&(ta?(t=hr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):hr.removeChild(n.stateNode));break;case 18:hr!==null&&(ta?(t=hr,n=n.stateNode,t.nodeType===8?n5(t.parentNode,n):t.nodeType===1&&n5(t,n),qC(t)):n5(hr,n.stateNode));break;case 4:i=hr,r=ta,hr=n.stateNode.containerInfo,ta=!0,Sg(t,e,n),hr=i,ta=r;break;case 0:case 11:case 14:case 15:if(!Mr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&qG(n,e,o),r=r.next}while(r!==i)}Sg(t,e,n);break;case 1:if(!Mr&&(Md(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){di(n,e,a)}Sg(t,e,n);break;case 21:Sg(t,e,n);break;case 22:n.mode&1?(Mr=(i=Mr)||n.memoizedState!==null,Sg(t,e,n),Mr=i):Sg(t,e,n);break;default:Sg(t,e,n)}}function A6(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new YP),e.forEach(function(i){var r=qP.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Do(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:hr=a.stateNode,ta=!1;break e;case 3:hr=a.stateNode.containerInfo,ta=!0;break e;case 4:hr=a.stateNode.containerInfo,ta=!0;break e}a=a.return}if(hr===null)throw Error($e(160));vV(s,o,r),hr=null,ta=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(g){di(r,e,g)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yV(e,t),e=e.sibling}function yV(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Do(e,t),La(t),i&4){try{BC(3,t,t.return),qb(3,t)}catch(b){di(t,t.return,b)}try{BC(5,t,t.return)}catch(b){di(t,t.return,b)}}break;case 1:Do(e,t),La(t),i&512&&n!==null&&Md(n,n.return);break;case 5:if(Do(e,t),La(t),i&512&&n!==null&&Md(n,n.return),t.flags&32){var r=t.stateNode;try{OC(r,"")}catch(b){di(t,t.return,b)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&KT(r,s),SG(a,o);var g=SG(a,s);for(o=0;o<l.length;o+=2){var c=l[o],u=l[o+1];c==="style"?OT(r,u):c==="dangerouslySetInnerHTML"?DT(r,u):c==="children"?OC(r,u):Gw(r,c,u,g)}switch(a){case"input":bG(r,s);break;case"textarea":zT(r,s);break;case"select":var I=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?Dd(r,!!s.multiple,h,!1):I!==!!s.multiple&&(s.defaultValue!=null?Dd(r,!!s.multiple,s.defaultValue,!0):Dd(r,!!s.multiple,s.multiple?[]:"",!1))}r[rf]=s}catch(b){di(t,t.return,b)}}break;case 6:if(Do(e,t),La(t),i&4){if(t.stateNode===null)throw Error($e(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(b){di(t,t.return,b)}}break;case 3:if(Do(e,t),La(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{qC(e.containerInfo)}catch(b){di(t,t.return,b)}break;case 4:Do(e,t),La(t);break;case 13:Do(e,t),La(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(iR=wi())),i&4&&A6(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Mr=(g=Mr)||c,Do(e,t),Mr=g):Do(e,t),La(t),i&8192){if(g=t.memoizedState!==null,(t.stateNode.isHidden=g)&&!c&&t.mode&1)for(lt=t,c=t.child;c!==null;){for(u=lt=c;lt!==null;){switch(I=lt,h=I.child,I.tag){case 0:case 11:case 14:case 15:BC(4,I,I.return);break;case 1:Md(I,I.return);var C=I.stateNode;if(typeof C.componentWillUnmount=="function"){i=I,n=I.return;try{e=i,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(b){di(i,n,b)}}break;case 5:Md(I,I.return);break;case 22:if(I.memoizedState!==null){C6(u);continue}}h!==null?(h.return=I,lt=h):C6(u)}c=c.sibling}e:for(c=null,u=t;;){if(u.tag===5){if(c===null){c=u;try{r=u.stateNode,g?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=u.stateNode,l=u.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=PT("display",o))}catch(b){di(t,t.return,b)}}}else if(u.tag===6){if(c===null)try{u.stateNode.nodeValue=g?"":u.memoizedProps}catch(b){di(t,t.return,b)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;c===u&&(c=null),u=u.return}c===u&&(c=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Do(e,t),La(t),i&4&&A6(t);break;case 21:break;default:Do(e,t),La(t)}}function La(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(bV(n)){var i=n;break e}n=n.return}throw Error($e(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(OC(r,""),i.flags&=-33);var s=d6(t);t9(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=d6(t);e9(t,a,o);break;default:throw Error($e(161))}}catch(l){di(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function zP(t,e,n){lt=t,BV(t)}function BV(t,e,n){for(var i=(t.mode&1)!==0;lt!==null;){var r=lt,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||om;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Mr;a=om;var g=Mr;if(om=o,(Mr=l)&&!g)for(lt=r;lt!==null;)o=lt,l=o.child,o.tag===22&&o.memoizedState!==null?f6(r):l!==null?(l.return=o,lt=l):f6(r);for(;s!==null;)lt=s,BV(s),s=s.sibling;lt=r,om=a,Mr=g}h6(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,lt=s):h6(t)}}function h6(t){for(;lt!==null;){var e=lt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Mr||qb(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Mr)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:$o(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&qE(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}qE(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var g=e.alternate;if(g!==null){var c=g.memoizedState;if(c!==null){var u=c.dehydrated;u!==null&&qC(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($e(163))}Mr||e.flags&512&&$G(e)}catch(I){di(e,e.return,I)}}if(e===t){lt=null;break}if(n=e.sibling,n!==null){n.return=e.return,lt=n;break}lt=e.return}}function C6(t){for(;lt!==null;){var e=lt;if(e===t){lt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,lt=n;break}lt=e.return}}function f6(t){for(;lt!==null;){var e=lt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{qb(4,e)}catch(l){di(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){di(e,r,l)}}var s=e.return;try{$G(e)}catch(l){di(e,s,l)}break;case 5:var o=e.return;try{$G(e)}catch(l){di(e,o,l)}}}catch(l){di(e,e.return,l)}if(e===t){lt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,lt=a;break}lt=e.return}}var UP=Math.ceil,H3=og.ReactCurrentDispatcher,tR=og.ReactCurrentOwner,Eo=og.ReactCurrentBatchConfig,gn=0,lr=null,Mi=null,Cr=0,Us=0,Td=Bc(0),Di=0,cf=null,ju=0,$b=0,nR=0,GC=null,ps=null,iR=0,hA=1/0,Fl=null,_3=!1,n9=null,jg=null,am=!1,Xg=null,X3=0,SC=0,i9=null,U2=-1,D2=0;function ts(){return gn&6?wi():U2!==-1?U2:U2=wi()}function qg(t){return t.mode&1?gn&2&&Cr!==0?Cr&-Cr:xP.transition!==null?(D2===0&&(D2=oF()),D2):(t=mn,t!==0||(t=window.event,t=t===void 0?16:dF(t.type)),t):1}function ga(t,e,n,i){if(50<SC)throw SC=0,i9=null,Error($e(185));c0(t,n,i),(!(gn&2)||t!==lr)&&(t===lr&&(!(gn&2)&&($b|=n),Di===4&&Hg(t,Cr)),ws(t,i),n===1&&gn===0&&!(e.mode&1)&&(hA=wi()+500,Qb&&Gc()))}function ws(t,e){var n=t.callbackNode;xD(t,e);var i=G3(t,t===lr?Cr:0);if(i===0)n!==null&&wE(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&wE(n),e===1)t.tag===0?RP(p6.bind(null,t)):NF(p6.bind(null,t)),BP(function(){!(gn&6)&&Gc()}),n=null;else{switch(aF(i)){case 1:n=Zw;break;case 4:n=rF;break;case 16:n=B3;break;case 536870912:n=sF;break;default:n=B3}n=WV(n,GV.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function GV(t,e){if(U2=-1,D2=0,gn&6)throw Error($e(327));var n=t.callbackNode;if(jd()&&t.callbackNode!==n)return null;var i=G3(t,t===lr?Cr:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Y3(t,i);else{e=i;var r=gn;gn|=2;var s=wV();(lr!==t||Cr!==e)&&(Fl=null,hA=wi()+500,Lu(t,e));do try{OP();break}catch(a){SV(t,a)}while(1);Yw(),H3.current=s,gn=r,Mi!==null?e=0:(lr=null,Cr=0,e=Di)}if(e!==0){if(e===2&&(r=EG(t),r!==0&&(i=r,e=r9(t,r))),e===1)throw n=cf,Lu(t,0),Hg(t,i),ws(t,wi()),n;if(e===6)Hg(t,i);else{if(r=t.current.alternate,!(i&30)&&!DP(r)&&(e=Y3(t,i),e===2&&(s=EG(t),s!==0&&(i=s,e=r9(t,s))),e===1))throw n=cf,Lu(t,0),Hg(t,i),ws(t,wi()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error($e(345));case 2:lu(t,ps,Fl);break;case 3:if(Hg(t,i),(i&130023424)===i&&(e=iR+500-wi(),10<e)){if(G3(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){ts(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=kG(lu.bind(null,t,ps,Fl),e);break}lu(t,ps,Fl);break;case 4:if(Hg(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-la(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=wi()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*UP(i/1960))-i,10<i){t.timeoutHandle=kG(lu.bind(null,t,ps,Fl),i);break}lu(t,ps,Fl);break;case 5:lu(t,ps,Fl);break;default:throw Error($e(329))}}}return ws(t,wi()),t.callbackNode===n?GV.bind(null,t):null}function r9(t,e){var n=GC;return t.current.memoizedState.isDehydrated&&(Lu(t,e).flags|=256),t=Y3(t,e),t!==2&&(e=ps,ps=n,e!==null&&s9(e)),t}function s9(t){ps===null?ps=t:ps.push.apply(ps,t)}function DP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!ha(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Hg(t,e){for(e&=~nR,e&=~$b,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-la(e),i=1<<n;t[n]=-1,e&=~i}}function p6(t){if(gn&6)throw Error($e(327));jd();var e=G3(t,0);if(!(e&1))return ws(t,wi()),null;var n=Y3(t,e);if(t.tag!==0&&n===2){var i=EG(t);i!==0&&(e=i,n=r9(t,i))}if(n===1)throw n=cf,Lu(t,0),Hg(t,e),ws(t,wi()),n;if(n===6)throw Error($e(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,lu(t,ps,Fl),ws(t,wi()),null}function rR(t,e){var n=gn;gn|=1;try{return t(e)}finally{gn=n,gn===0&&(hA=wi()+500,Qb&&Gc())}}function qu(t){Xg!==null&&Xg.tag===0&&!(gn&6)&&jd();var e=gn;gn|=1;var n=Eo.transition,i=mn;try{if(Eo.transition=null,mn=1,t)return t()}finally{mn=i,Eo.transition=n,gn=e,!(gn&6)&&Gc()}}function sR(){Us=Td.current,On(Td)}function Lu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,yP(n)),Mi!==null)for(n=Mi.return;n!==null;){var i=n;switch(Hw(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Z3();break;case 3:dA(),On(Gs),On(Fr),Ow();break;case 5:Pw(i);break;case 4:dA();break;case 13:On(ri);break;case 19:On(ri);break;case 10:Kw(i.type._context);break;case 22:case 23:sR()}n=n.return}if(lr=t,Mi=t=$g(t.current,null),Cr=Us=e,Di=0,cf=null,nR=$b=ju=0,ps=GC=null,wu!==null){for(e=0;e<wu.length;e++)if(n=wu[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}wu=null}return t}function SV(t,e){do{var n=Mi;try{if(Yw(),Y2.current=k3,L3){for(var i=oi.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}L3=!1}if(Ju=0,rr=_i=oi=null,yC=!1,af=0,tR.current=null,n===null||n.return===null){Di=1,cf=e,Mi=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Cr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var g=l,c=a,u=c.tag;if(!(c.mode&1)&&(u===0||u===11||u===15)){var I=c.alternate;I?(c.updateQueue=I.updateQueue,c.memoizedState=I.memoizedState,c.lanes=I.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=s6(o);if(h!==null){h.flags&=-257,o6(h,o,a,s,e),h.mode&1&&r6(s,g,e),e=h,l=g;var C=e.updateQueue;if(C===null){var b=new Set;b.add(l),e.updateQueue=b}else C.add(l);break e}else{if(!(e&1)){r6(s,g,e),oR();break e}l=Error($e(426))}}else if(qn&&a.mode&1){var m=s6(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),o6(m,o,a,s,e),_w(AA(l,a));break e}}s=l=AA(l,a),Di!==4&&(Di=2),GC===null?GC=[s]:GC.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var f=lV(s,l,e);jE(s,f);break e;case 1:a=l;var p=s.type,v=s.stateNode;if(!(s.flags&128)&&(typeof p.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(jg===null||!jg.has(v)))){s.flags|=65536,e&=-e,s.lanes|=e;var B=gV(s,a,e);jE(s,B);break e}}s=s.return}while(s!==null)}xV(n)}catch(G){e=G,Mi===n&&n!==null&&(Mi=n=n.return);continue}break}while(1)}function wV(){var t=H3.current;return H3.current=k3,t===null?k3:t}function oR(){(Di===0||Di===3||Di===2)&&(Di=4),lr===null||!(ju&268435455)&&!($b&268435455)||Hg(lr,Cr)}function Y3(t,e){var n=gn;gn|=2;var i=wV();(lr!==t||Cr!==e)&&(Fl=null,Lu(t,e));do try{PP();break}catch(r){SV(t,r)}while(1);if(Yw(),gn=n,H3.current=i,Mi!==null)throw Error($e(261));return lr=null,Cr=0,Di}function PP(){for(;Mi!==null;)RV(Mi)}function OP(){for(;Mi!==null&&!mD();)RV(Mi)}function RV(t){var e=EV(t.alternate,t,Us);t.memoizedProps=t.pendingProps,e===null?xV(t):Mi=e,tR.current=null}function xV(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=XP(n,e),n!==null){n.flags&=32767,Mi=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Di=6,Mi=null;return}}else if(n=_P(n,e,Us),n!==null){Mi=n;return}if(e=e.sibling,e!==null){Mi=e;return}Mi=e=t}while(e!==null);Di===0&&(Di=5)}function lu(t,e,n){var i=mn,r=Eo.transition;try{Eo.transition=null,mn=1,QP(t,e,n,i)}finally{Eo.transition=r,mn=i}return null}function QP(t,e,n,i){do jd();while(Xg!==null);if(gn&6)throw Error($e(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error($e(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(ZD(t,s),t===lr&&(Mi=lr=null,Cr=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||am||(am=!0,WV(B3,function(){return jd(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Eo.transition,Eo.transition=null;var o=mn;mn=1;var a=gn;gn|=4,tR.current=null,KP(t,n),yV(n,t),hP(VG),S3=!!FG,VG=FG=null,t.current=n,zP(n),bD(),gn=a,mn=o,Eo.transition=s}else t.current=n;if(am&&(am=!1,Xg=t,X3=r),s=t.pendingLanes,s===0&&(jg=null),BD(n.stateNode),ws(t,wi()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(_3)throw _3=!1,t=n9,n9=null,t;return X3&1&&t.tag!==0&&jd(),s=t.pendingLanes,s&1?t===i9?SC++:(SC=0,i9=t):SC=0,Gc(),null}function jd(){if(Xg!==null){var t=aF(X3),e=Eo.transition,n=mn;try{if(Eo.transition=null,mn=16>t?16:t,Xg===null)var i=!1;else{if(t=Xg,Xg=null,X3=0,gn&6)throw Error($e(331));var r=gn;for(gn|=4,lt=t.current;lt!==null;){var s=lt,o=s.child;if(lt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var g=a[l];for(lt=g;lt!==null;){var c=lt;switch(c.tag){case 0:case 11:case 15:BC(8,c,s)}var u=c.child;if(u!==null)u.return=c,lt=u;else for(;lt!==null;){c=lt;var I=c.sibling,h=c.return;if(mV(c),c===g){lt=null;break}if(I!==null){I.return=h,lt=I;break}lt=h}}}var C=s.alternate;if(C!==null){var b=C.child;if(b!==null){C.child=null;do{var m=b.sibling;b.sibling=null,b=m}while(b!==null)}}lt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,lt=o;else e:for(;lt!==null;){if(s=lt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:BC(9,s,s.return)}var f=s.sibling;if(f!==null){f.return=s.return,lt=f;break e}lt=s.return}}var p=t.current;for(lt=p;lt!==null;){o=lt;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,lt=v;else e:for(o=p;lt!==null;){if(a=lt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:qb(9,a)}}catch(G){di(a,a.return,G)}if(a===o){lt=null;break e}var B=a.sibling;if(B!==null){B.return=a.return,lt=B;break e}lt=a.return}}if(gn=r,Gc(),Oa&&typeof Oa.onPostCommitFiberRoot=="function")try{Oa.onPostCommitFiberRoot(zb,t)}catch{}i=!0}return i}finally{mn=n,Eo.transition=e}}return!1}function m6(t,e,n){e=AA(n,e),e=lV(t,e,1),t=Jg(t,e,1),e=ts(),t!==null&&(c0(t,1,e),ws(t,e))}function di(t,e,n){if(t.tag===3)m6(t,t,n);else for(;e!==null;){if(e.tag===3){m6(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(jg===null||!jg.has(i))){t=AA(n,t),t=gV(e,t,1),e=Jg(e,t,1),t=ts(),e!==null&&(c0(e,1,t),ws(e,t));break}}e=e.return}}function JP(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=ts(),t.pingedLanes|=t.suspendedLanes&n,lr===t&&(Cr&n)===n&&(Di===4||Di===3&&(Cr&130023424)===Cr&&500>wi()-iR?Lu(t,0):nR|=n),ws(t,e)}function ZV(t,e){e===0&&(t.mode&1?(e=jp,jp<<=1,!(jp&130023424)&&(jp=4194304)):e=1);var n=ts();t=ql(t,e),t!==null&&(c0(t,e,n),ws(t,n))}function jP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ZV(t,n)}function qP(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error($e(314))}i!==null&&i.delete(e),ZV(t,n)}var EV;EV=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Gs.current)vs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return vs=!1,HP(t,e,n);vs=!!(t.flags&131072)}else vs=!1,qn&&e.flags&1048576&&MF(e,N3,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;z2(t,e),t=e.pendingProps;var r=cA(e,Fr.current);Jd(e,n),r=Jw(null,e,i,t,r,n);var s=jw();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ss(i)?(s=!0,E3(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Uw(e),r.updater=Jb,e.stateNode=r,r._reactInternals=e,UG(e,i,t,n),e=OG(null,e,i,!0,s,n)):(e.tag=0,qn&&s&&kw(e),Jr(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(z2(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=eO(i),t=$o(i,t),r){case 0:e=PG(null,e,i,t,n);break e;case 1:e=g6(null,e,i,t,n);break e;case 11:e=a6(null,e,i,t,n);break e;case 14:e=l6(null,e,i,$o(i.type,t),n);break e}throw Error($e(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$o(i,r),PG(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$o(i,r),g6(t,e,i,r,n);case 3:e:{if(dV(e),t===null)throw Error($e(387));i=e.pendingProps,s=e.memoizedState,r=s.element,LF(t,e),F3(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=AA(Error($e(423)),e),e=c6(t,e,i,n,r);break e}else if(i!==r){r=AA(Error($e(424)),e),e=c6(t,e,i,n,r);break e}else for(Qs=Qg(e.stateNode.containerInfo.firstChild),qs=e,qn=!0,ia=null,n=XF(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(uA(),i===r){e=$l(t,e,n);break e}Jr(t,e,i,n)}e=e.child}return e;case 5:return YF(e),t===null&&YG(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,LG(i,r)?o=null:s!==null&&LG(i,s)&&(e.flags|=32),IV(t,e),Jr(t,e,o,n),e.child;case 6:return t===null&&YG(e),null;case 13:return AV(t,e,n);case 4:return Dw(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=IA(e,null,i,n):Jr(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$o(i,r),a6(t,e,i,r,n);case 7:return Jr(t,e,e.pendingProps,n),e.child;case 8:return Jr(t,e,e.pendingProps.children,n),e.child;case 12:return Jr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,_n(M3,i._currentValue),i._currentValue=o,s!==null)if(ha(s.value,o)){if(s.children===r.children&&!Gs.current){e=$l(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Dl(-1,n&-n),l.tag=2;var g=s.updateQueue;if(g!==null){g=g.shared;var c=g.pending;c===null?l.next=l:(l.next=c.next,c.next=l),g.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),KG(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error($e(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),KG(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Jr(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Jd(e,n),r=To(r),i=i(r),e.flags|=1,Jr(t,e,i,n),e.child;case 14:return i=e.type,r=$o(i,e.pendingProps),r=$o(i.type,r),l6(t,e,i,r,n);case 15:return cV(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:$o(i,r),z2(t,e),e.tag=1,Ss(i)?(t=!0,E3(e)):t=!1,Jd(e,n),HF(e,i,r),UG(e,i,r,n),OG(null,e,i,!0,t,n);case 19:return hV(t,e,n);case 22:return uV(t,e,n)}throw Error($e(156,e.tag))};function WV(t,e){return iF(t,e)}function $P(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xo(t,e,n,i){return new $P(t,e,n,i)}function aR(t){return t=t.prototype,!(!t||!t.isReactComponent)}function eO(t){if(typeof t=="function")return aR(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ww)return 11;if(t===Rw)return 14}return 2}function $g(t,e){var n=t.alternate;return n===null?(n=xo(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function P2(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")aR(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Gd:return ku(n.children,r,s,e);case Sw:o=8,r|=8;break;case hG:return t=xo(12,n,e,r|2),t.elementType=hG,t.lanes=s,t;case CG:return t=xo(13,n,e,r),t.elementType=CG,t.lanes=s,t;case fG:return t=xo(19,n,e,r),t.elementType=fG,t.lanes=s,t;case _T:return ev(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case kT:o=10;break e;case HT:o=9;break e;case ww:o=11;break e;case Rw:o=14;break e;case Vg:o=16,i=null;break e}throw Error($e(130,t==null?t:typeof t,""))}return e=xo(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function ku(t,e,n,i){return t=xo(7,t,i,e),t.lanes=n,t}function ev(t,e,n,i){return t=xo(22,t,i,e),t.elementType=_T,t.lanes=n,t.stateNode={isHidden:!1},t}function c5(t,e,n){return t=xo(6,t,null,e),t.lanes=n,t}function u5(t,e,n){return e=xo(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function tO(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=U1(0),this.expirationTimes=U1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=U1(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function lR(t,e,n,i,r,s,o,a,l){return t=new tO(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=xo(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uw(s),t}function nO(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Bd,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function NV(t){if(!t)return cc;t=t._reactInternals;e:{if(hI(t)!==t||t.tag!==1)throw Error($e(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ss(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error($e(171))}if(t.tag===1){var n=t.type;if(Ss(n))return WF(t,n,e)}return e}function MV(t,e,n,i,r,s,o,a,l){return t=lR(n,i,!0,t,r,s,o,a,l),t.context=NV(null),n=t.current,i=ts(),r=qg(n),s=Dl(i,r),s.callback=e??null,Jg(n,s,r),t.current.lanes=r,c0(t,r,i),ws(t,i),t}function tv(t,e,n,i){var r=e.current,s=ts(),o=qg(r);return n=NV(n),e.context===null?e.context=n:e.pendingContext=n,e=Dl(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Jg(r,e,o),t!==null&&(ga(t,r,o,s),X2(t,r,o)),o}function K3(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function b6(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function gR(t,e){b6(t,e),(t=t.alternate)&&b6(t,e)}function iO(){return null}var TV=typeof reportError=="function"?reportError:function(t){console.error(t)};function cR(t){this._internalRoot=t}nv.prototype.render=cR.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error($e(409));tv(t,e,null,null)};nv.prototype.unmount=cR.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;qu(function(){tv(null,t,null,null)}),e[jl]=null}};function nv(t){this._internalRoot=t}nv.prototype.unstable_scheduleHydration=function(t){if(t){var e=cF();t={blockedOn:null,target:t,priority:e};for(var n=0;n<kg.length&&e!==0&&e<kg[n].priority;n++);kg.splice(n,0,t),n===0&&IF(t)}};function uR(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function iv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function v6(){}function rO(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var g=K3(o);s.call(g)}}var o=MV(e,i,t,0,null,!1,!1,"",v6);return t._reactRootContainer=o,t[jl]=o.current,tf(t.nodeType===8?t.parentNode:t),qu(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var g=K3(l);a.call(g)}}var l=lR(t,0,!1,null,null,!1,!1,"",v6);return t._reactRootContainer=l,t[jl]=l.current,tf(t.nodeType===8?t.parentNode:t),qu(function(){tv(e,l,n,i)}),l}function rv(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=K3(o);a.call(l)}}tv(e,o,t,r)}else o=rO(n,e,t,r,i);return K3(o)}lF=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=aC(e.pendingLanes);n!==0&&(Ew(e,n|1),ws(e,wi()),!(gn&6)&&(hA=wi()+500,Gc()))}break;case 13:qu(function(){var i=ql(t,1);if(i!==null){var r=ts();ga(i,t,1,r)}}),gR(t,1)}};Ww=function(t){if(t.tag===13){var e=ql(t,134217728);if(e!==null){var n=ts();ga(e,t,134217728,n)}gR(t,134217728)}};gF=function(t){if(t.tag===13){var e=qg(t),n=ql(t,e);if(n!==null){var i=ts();ga(n,t,e,i)}gR(t,e)}};cF=function(){return mn};uF=function(t,e){var n=mn;try{return mn=t,e()}finally{mn=n}};RG=function(t,e,n){switch(e){case"input":if(bG(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Ob(i);if(!r)throw Error($e(90));YT(i),bG(i,r)}}}break;case"textarea":zT(t,n);break;case"select":e=n.value,e!=null&&Dd(t,!!n.multiple,e,!1)}};jT=rR;qT=qu;var sO={usingClientEntryPoint:!1,Events:[I0,xd,Ob,QT,JT,rR]},Zh={findFiberByHostInstance:Su,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},oO={bundleType:Zh.bundleType,version:Zh.version,rendererPackageName:Zh.rendererPackageName,rendererConfig:Zh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:og.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=tF(t),t===null?null:t.stateNode},findFiberByHostInstance:Zh.findFiberByHostInstance||iO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lm.isDisabled&&lm.supportsFiber)try{zb=lm.inject(oO),Oa=lm}catch{}}oo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sO;oo.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!uR(e))throw Error($e(200));return nO(t,e,null,n)};oo.createRoot=function(t,e){if(!uR(t))throw Error($e(299));var n=!1,i="",r=TV;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=lR(t,1,!1,null,null,n,!1,i,r),t[jl]=e.current,tf(t.nodeType===8?t.parentNode:t),new cR(e)};oo.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error($e(188)):(t=Object.keys(t).join(","),Error($e(268,t)));return t=tF(e),t=t===null?null:t.stateNode,t};oo.flushSync=function(t){return qu(t)};oo.hydrate=function(t,e,n){if(!iv(e))throw Error($e(200));return rv(null,t,e,!0,n)};oo.hydrateRoot=function(t,e,n){if(!uR(t))throw Error($e(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=TV;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=MV(e,null,t,1,n??null,r,!1,s,o),t[jl]=e.current,tf(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new nv(e)};oo.render=function(t,e,n){if(!iv(e))throw Error($e(200));return rv(null,t,e,!1,n)};oo.unmountComponentAtNode=function(t){if(!iv(t))throw Error($e(40));return t._reactRootContainer?(qu(function(){rv(null,null,t,!1,function(){t._reactRootContainer=null,t[jl]=null})}),!0):!1};oo.unstable_batchedUpdates=rR;oo.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!iv(n))throw Error($e(200));if(t==null||t._reactInternals===void 0)throw Error($e(38));return rv(t,e,n,!1,i)};oo.version="18.2.0-next-9e3b772b8-20220608";function FV(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(FV)}catch(t){console.error(t)}}FV(),MT.exports=oo;var IR=MT.exports;const VV=l0(IR),aO=yT({__proto__:null,default:VV},[IR]);var LV,y6=IR;LV=dG.createRoot=y6.createRoot,dG.hydrateRoot=y6.hydrateRoot;/**
 * @remix-run/router v1.9.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uf(){return uf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},uf.apply(this,arguments)}var Yg;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Yg||(Yg={}));const B6="popstate";function lO(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return o9("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:kV(r)}return cO(e,n,null,t)}function Pi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function dR(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function gO(){return Math.random().toString(36).substr(2,8)}function G6(t,e){return{usr:t.state,key:t.key,idx:e}}function o9(t,e,n,i){return n===void 0&&(n=null),uf({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?FA(e):e,{state:n,key:e&&e.key||i||gO()})}function kV(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function FA(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function cO(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=Yg.Pop,l=null,g=c();g==null&&(g=0,o.replaceState(uf({},o.state,{idx:g}),""));function c(){return(o.state||{idx:null}).idx}function u(){a=Yg.Pop;let m=c(),f=m==null?null:m-g;g=m,l&&l({action:a,location:b.location,delta:f})}function I(m,f){a=Yg.Push;let p=o9(b.location,m,f);n&&n(p,m),g=c()+1;let v=G6(p,g),B=b.createHref(p);try{o.pushState(v,"",B)}catch(G){if(G instanceof DOMException&&G.name==="DataCloneError")throw G;r.location.assign(B)}s&&l&&l({action:a,location:b.location,delta:1})}function h(m,f){a=Yg.Replace;let p=o9(b.location,m,f);n&&n(p,m),g=c();let v=G6(p,g),B=b.createHref(p);o.replaceState(v,"",B),s&&l&&l({action:a,location:b.location,delta:0})}function C(m){let f=r.location.origin!=="null"?r.location.origin:r.location.href,p=typeof m=="string"?m:kV(m);return Pi(f,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,f)}let b={get action(){return a},get location(){return t(r,o)},listen(m){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(B6,u),l=m,()=>{r.removeEventListener(B6,u),l=null}},createHref(m){return e(r,m)},createURL:C,encodeLocation(m){let f=C(m);return{pathname:f.pathname,search:f.search,hash:f.hash}},push:I,replace:h,go(m){return o.go(m)}};return b}var S6;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(S6||(S6={}));function uO(t,e,n){n===void 0&&(n="/");let i=typeof e=="string"?FA(e):e,r=XV(i.pathname||"/",n);if(r==null)return null;let s=HV(t);IO(s);let o=null;for(let a=0;o==null&&a<s.length;++a)o=vO(s[a],GO(r));return o}function HV(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(Pi(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let g=Hu([i,l.relativePath]),c=n.concat(l);s.children&&s.children.length>0&&(Pi(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+g+'".')),HV(s.children,e,c,g)),!(s.path==null&&!s.index)&&e.push({path:g,score:mO(g,s.index),routesMeta:c})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let l of _V(s.path))r(s,o,l)}),e}function _V(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=_V(i.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function IO(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:bO(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const dO=/^:\w+$/,AO=3,hO=2,CO=1,fO=10,pO=-2,w6=t=>t==="*";function mO(t,e){let n=t.split("/"),i=n.length;return n.some(w6)&&(i+=pO),e&&(i+=hO),n.filter(r=>!w6(r)).reduce((r,s)=>r+(dO.test(s)?AO:s===""?CO:fO),i)}function bO(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function vO(t,e){let{routesMeta:n}=t,i={},r="/",s=[];for(let o=0;o<n.length;++o){let a=n[o],l=o===n.length-1,g=r==="/"?e:e.slice(r.length)||"/",c=yO({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},g);if(!c)return null;Object.assign(i,c.params);let u=a.route;s.push({params:i,pathname:Hu([r,c.pathname]),pathnameBase:EO(Hu([r,c.pathnameBase])),route:u}),c.pathnameBase!=="/"&&(r=Hu([r,c.pathnameBase]))}return s}function yO(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=BO(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((g,c,u)=>{if(c==="*"){let I=a[u]||"";o=s.slice(0,s.length-I.length).replace(/(.)\/+$/,"$1")}return g[c]=SO(a[u]||"",c),g},{}),pathname:s,pathnameBase:o,pattern:t}}function BO(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),dR(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(o,a)=>(i.push(a),"/([^\\/]+)"));return t.endsWith("*")?(i.push("*"),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function GO(t){try{return decodeURI(t)}catch(e){return dR(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function SO(t,e){try{return decodeURIComponent(t)}catch(n){return dR(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+n+").")),t}}function XV(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function wO(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?FA(t):t;return{pathname:n?n.startsWith("/")?n:RO(n,e):e,search:WO(i),hash:NO(r)}}function RO(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function I5(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function xO(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function ZO(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=FA(t):(r=uf({},t),Pi(!r.pathname||!r.pathname.includes("?"),I5("?","pathname","search",r)),Pi(!r.pathname||!r.pathname.includes("#"),I5("#","pathname","hash",r)),Pi(!r.search||!r.search.includes("#"),I5("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(i||o==null)a=n;else{let u=e.length-1;if(o.startsWith("..")){let I=o.split("/");for(;I[0]==="..";)I.shift(),u-=1;r.pathname=I.join("/")}a=u>=0?e[u]:"/"}let l=wO(r,a),g=o&&o!=="/"&&o.endsWith("/"),c=(s||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(g||c)&&(l.pathname+="/"),l}const Hu=t=>t.join("/").replace(/\/\/+/g,"/"),EO=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),WO=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,NO=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function MO(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const YV=["post","put","patch","delete"];new Set(YV);const TO=["get",...YV];new Set(TO);/**
 * React Router v6.16.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function z3(){return z3=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},z3.apply(this,arguments)}const AR=H.createContext(null),FO=H.createContext(null),sv=H.createContext(null),ov=H.createContext(null),CI=H.createContext({outlet:null,matches:[],isDataRoute:!1}),KV=H.createContext(null);function av(){return H.useContext(ov)!=null}function zV(){return av()||Pi(!1),H.useContext(ov).location}function UV(t){H.useContext(sv).static||H.useLayoutEffect(t)}function DV(){let{isDataRoute:t}=H.useContext(CI);return t?QO():VO()}function VO(){av()||Pi(!1);let t=H.useContext(AR),{basename:e,navigator:n}=H.useContext(sv),{matches:i}=H.useContext(CI),{pathname:r}=zV(),s=JSON.stringify(xO(i).map(l=>l.pathnameBase)),o=H.useRef(!1);return UV(()=>{o.current=!0}),H.useCallback(function(l,g){if(g===void 0&&(g={}),!o.current)return;if(typeof l=="number"){n.go(l);return}let c=ZO(l,JSON.parse(s),r,g.relative==="path");t==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:Hu([e,c.pathname])),(g.replace?n.replace:n.push)(c,g.state,g)},[e,n,s,r,t])}function LO(){let{matches:t}=H.useContext(CI),e=t[t.length-1];return e?e.params:{}}function kO(t,e){return HO(t,e)}function HO(t,e,n){av()||Pi(!1);let{navigator:i}=H.useContext(sv),{matches:r}=H.useContext(CI),s=r[r.length-1],o=s?s.params:{};s&&s.pathname;let a=s?s.pathnameBase:"/";s&&s.route;let l=zV(),g;if(e){var c;let b=typeof e=="string"?FA(e):e;a==="/"||(c=b.pathname)!=null&&c.startsWith(a)||Pi(!1),g=b}else g=l;let u=g.pathname||"/",I=a==="/"?u:u.slice(a.length)||"/",h=uO(t,{pathname:I}),C=zO(h&&h.map(b=>Object.assign({},b,{params:Object.assign({},o,b.params),pathname:Hu([a,i.encodeLocation?i.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?a:Hu([a,i.encodeLocation?i.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),r,n);return e&&C?H.createElement(ov.Provider,{value:{location:z3({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:Yg.Pop}},C):C}function _O(){let t=OO(),e=MO(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},e),n?H.createElement("pre",{style:r},n):null,s)}const XO=H.createElement(_O,null);class YO extends H.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error?H.createElement(CI.Provider,{value:this.props.routeContext},H.createElement(KV.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function KO(t){let{routeContext:e,match:n,children:i}=t,r=H.useContext(AR);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),H.createElement(CI.Provider,{value:e},i)}function zO(t,e,n){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),t==null){var r;if((r=n)!=null&&r.errors)t=n.matches;else return null}let s=t,o=(i=n)==null?void 0:i.errors;if(o!=null){let a=s.findIndex(l=>l.route.id&&(o==null?void 0:o[l.route.id]));a>=0||Pi(!1),s=s.slice(0,Math.min(s.length,a+1))}return s.reduceRight((a,l,g)=>{let c=l.route.id?o==null?void 0:o[l.route.id]:null,u=null;n&&(u=l.route.errorElement||XO);let I=e.concat(s.slice(0,g+1)),h=()=>{let C;return c?C=u:l.route.Component?C=H.createElement(l.route.Component,null):l.route.element?C=l.route.element:C=a,H.createElement(KO,{match:l,routeContext:{outlet:a,matches:I,isDataRoute:n!=null},children:C})};return n&&(l.route.ErrorBoundary||l.route.errorElement||g===0)?H.createElement(YO,{location:n.location,revalidation:n.revalidation,component:u,error:c,children:h(),routeContext:{outlet:null,matches:I,isDataRoute:!0}}):h()},null)}var PV=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(PV||{}),U3=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(U3||{});function UO(t){let e=H.useContext(AR);return e||Pi(!1),e}function DO(t){let e=H.useContext(FO);return e||Pi(!1),e}function PO(t){let e=H.useContext(CI);return e||Pi(!1),e}function OV(t){let e=PO(),n=e.matches[e.matches.length-1];return n.route.id||Pi(!1),n.route.id}function OO(){var t;let e=H.useContext(KV),n=DO(U3.UseRouteError),i=OV(U3.UseRouteError);return e||((t=n.errors)==null?void 0:t[i])}function QO(){let{router:t}=UO(PV.UseNavigateStable),e=OV(U3.UseNavigateStable),n=H.useRef(!1);return UV(()=>{n.current=!0}),H.useCallback(function(r,s){s===void 0&&(s={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,z3({fromRouteId:e},s)))},[t,e])}function O2(t){Pi(!1)}function JO(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Yg.Pop,navigator:s,static:o=!1}=t;av()&&Pi(!1);let a=e.replace(/^\/*/,"/"),l=H.useMemo(()=>({basename:a,navigator:s,static:o}),[a,s,o]);typeof i=="string"&&(i=FA(i));let{pathname:g="/",search:c="",hash:u="",state:I=null,key:h="default"}=i,C=H.useMemo(()=>{let b=XV(g,a);return b==null?null:{location:{pathname:b,search:c,hash:u,state:I,key:h},navigationType:r}},[a,g,c,u,I,h,r]);return C==null?null:H.createElement(sv.Provider,{value:l},H.createElement(ov.Provider,{children:n,value:C}))}function jO(t){let{children:e,location:n}=t;return kO(a9(e),n)}new Promise(()=>{});function a9(t,e){e===void 0&&(e=[]);let n=[];return H.Children.forEach(t,(i,r)=>{if(!H.isValidElement(i))return;let s=[...e,r];if(i.type===H.Fragment){n.push.apply(n,a9(i.props.children,s));return}i.type!==O2&&Pi(!1),!i.props.index||!i.props.children||Pi(!1);let o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=a9(i.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.16.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const qO="startTransition",R6=Kb[qO];function $O(t){let{basename:e,children:n,future:i,window:r}=t,s=H.useRef();s.current==null&&(s.current=lO({window:r,v5Compat:!0}));let o=s.current,[a,l]=H.useState({action:o.action,location:o.location}),{v7_startTransition:g}=i||{},c=H.useCallback(u=>{g&&R6?R6(()=>l(u)):l(u)},[l,g]);return H.useLayoutEffect(()=>o.listen(c),[o,c]),H.createElement(JO,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o})}var x6;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher"})(x6||(x6={}));var Z6;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Z6||(Z6={}));const fI=[{id:"A56",lastName:"OSTROW",firstName:"Warren",job:"Responsable",specialty:"Personnel Spatial",geneticCode:"BJOO",age:"29",gender:"M",helperMessage:`Test 
 d'affichage 
 informations diverses`,roles:"Base - Responsable personnel spatial",category:"Clef",logo:"Responsable",realGeneticCode:"BOOO",contaminated:"Oui"},{id:"M51",lastName:"HENDRY",firstName:"Patrick",job:"Responsable",specialty:"Personnel Terraformation",geneticCode:"JRRV",age:"28",gender:"M",helperMessage:"",roles:"Base - Responsable personnel terraformation",category:"Clef",logo:"Responsable",realGeneticCode:"JVRV",contaminated:"Oui"},{id:"D21",lastName:"AMBROSE",firstName:"Akio",job:"Responsable",specialty:"Passagers",geneticCode:"BJOV",age:"42",gender:"M",helperMessage:"",roles:"Base - Responsable passagers",category:"Clef",logo:"Responsable",realGeneticCode:"BOOV",contaminated:"Oui"},{id:"H78",lastName:"SKERRITT",firstName:"Haruko",job:"Personnel Spatial",specialty:"Responsable sécurité",geneticCode:"BJJV",age:"35",gender:"F",helperMessage:"",roles:"Base - Sécurité",category:"Clef",logo:"Sécurité",realGeneticCode:"BJOV",contaminated:"Oui"},{id:"S61",lastName:"BORMA",firstName:"Amberly",job:"Personnel Spatial",specialty:"Pilote navigateur",geneticCode:"BBRV",age:"28",gender:"F",helperMessage:"",roles:"Base - Entrainement - Pilote",category:"Clef",logo:"Navigateur",realGeneticCode:"BBVV",contaminated:"Oui"},{id:"C89",lastName:"BENDIX",firstName:"Chris",job:"Personnel Spatial",specialty:"Technicien spatial",geneticCode:"BORV",age:"29",gender:"M",helperMessage:"",roles:"Base - Technicien - Réparation",category:"Clef",logo:"Technicien",realGeneticCode:"BORV",contaminated:""},{id:"F34",lastName:"FURLAN",firstName:"Cirroc",job:"Terraformeur",specialty:"Technicien batiments",geneticCode:"BBOV",age:"24",gender:"M",helperMessage:"",roles:"Base - Technicien - Réparation",category:"",logo:"Technicien",realGeneticCode:"BBOV",contaminated:""},{id:"P33",lastName:"KOTTO",firstName:"Lukas",job:"Personnel Spatial",specialty:"Technicien de maintenance",geneticCode:"BORR",age:"28",gender:"M",helperMessage:"",roles:"Base - Technicien - Réparation",category:"Clef",logo:"Technicien",realGeneticCode:"BRRR",contaminated:"Oui"},{id:"D82",lastName:"DRAZIS",firstName:"Julie",job:"Personnel Spatial",specialty:"Support médical",geneticCode:"JORR",age:"30",gender:"F",helperMessage:"",roles:"Base - Médecin",category:"",logo:"Médical",realGeneticCode:"JORR",contaminated:""},{id:"N44",lastName:"CHAMBERLAIN",firstName:"Ardwight",job:"Terraformeur",specialty:"Médecin",geneticCode:"OORV",age:"30",gender:"M",helperMessage:"",roles:"Base - Médecin",category:"Clef",logo:"Médical",realGeneticCode:"OORV",contaminated:""},{id:"T41",lastName:"TORRENS",firstName:"Tania",job:"Terraformeur",specialty:"Biologiste",geneticCode:"BOVV",age:"26",gender:"F",helperMessage:"",roles:"Base - Médecin",category:"",logo:"Médical",realGeneticCode:"BOVV",contaminated:""},{id:"I72",lastName:"CORTAZAR",firstName:"Sabryn",job:"Passager",specialty:"Virologue",geneticCode:"JOOR",age:"36",gender:"F",helperMessage:"",roles:"Base",category:"Clef",logo:"Médical",realGeneticCode:"JOOR",contaminated:"Oui"},{id:"G39",lastName:"SANTFOORT",firstName:"Athena",job:"Passager",specialty:"Généticien",geneticCode:"BBJJ",age:"30",gender:"F",helperMessage:"",roles:"Base",category:"Clef",logo:"Médical",realGeneticCode:"BBOJ",contaminated:"Oui"},{id:"C57",lastName:"TOMITA",firstName:"Brock",job:"Passager",specialty:"Pontife",geneticCode:"ORRV",age:"32",gender:"M",helperMessage:"",roles:"Base",category:"",logo:"Religieux",realGeneticCode:"ORRV",contaminated:""},{id:"U67",lastName:"SIDDIG",firstName:"Armin",job:"Passager",specialty:"Aumonier",geneticCode:"BJJO",age:"62",gender:"M",helperMessage:"",roles:"Base",category:"",logo:"Religieux",realGeneticCode:"BJJO",contaminated:""},{id:"H17",lastName:"CHOQUET",firstName:"Janus",job:"Passager",specialty:"Politicien",geneticCode:"BJRR",age:"43",gender:"M",helperMessage:"",roles:"Base",category:"",logo:"Politicien",realGeneticCode:"BORR",contaminated:"Oui"},{id:"S93",lastName:"CHATHAM",firstName:"Samir",job:"Passager",specialty:"Politicien",geneticCode:"BOOV",age:"38",gender:"M",helperMessage:"",roles:"Base",category:"",logo:"Politicien",realGeneticCode:"BOOV",contaminated:""},{id:"Y49",lastName:"COLICOS",firstName:"Dominique",job:"Passager",specialty:"Journaliste",geneticCode:"BORV",age:"24",gender:"F",helperMessage:"",roles:"Base",category:"",logo:"Colon",realGeneticCode:"BORV",contaminated:""},{id:"H92",lastName:"KOSOVE",firstName:"Leah",job:"Passager",specialty:"Agent de sécurité",geneticCode:"JOVV",age:"30",gender:"F",helperMessage:"",roles:"Base",category:"",logo:"Sécurité",realGeneticCode:"JOVV",contaminated:""},{id:"J65",lastName:"SILVESTRI",firstName:"Mira",job:"Terraformeur",specialty:"Botaniste",geneticCode:"JORV",age:"27",gender:"F",helperMessage:"",roles:"Base",category:"",logo:"Colon",realGeneticCode:"JORV",contaminated:""},{id:"W46",lastName:"WIZAK",firstName:"Kim",job:"Terraformeur",specialty:"Spécialiste Hydroponie",geneticCode:"BJJV",age:"32",gender:"F",helperMessage:"",roles:"Base",category:"",logo:"Colon",realGeneticCode:"BJJV",contaminated:""},{id:"E25",lastName:"KUSANAGI",firstName:"Ellen",job:"Personnel Spatial",specialty:"Pilote véhicules orbitaux",geneticCode:"ORVV",age:"38",gender:"F",helperMessage:"",roles:"Base",category:"Eugéniste",logo:"Colon",realGeneticCode:"BJJR",contaminated:"non"},{id:"K62",lastName:"GORMAN",firstName:"Susan",job:"*",specialty:"*",geneticCode:"*",age:"*",gender:"F",helperMessage:"",roles:"",category:"Eugéniste leader",logo:"",realGeneticCode:"*",contaminated:"non"},{id:"K79",lastName:"KOBLENZ",firstName:"Kate",job:"Personnel Spatial",specialty:"Technicien",geneticCode:"JJOR",age:"24",gender:"F",helperMessage:"",roles:"Base - Technicien - Réparation",category:"Eugéniste",logo:"Technicien",realGeneticCode:"BORR",contaminated:"non"},{id:"M19",lastName:"BORG",firstName:"Maya",job:"*",specialty:"*",geneticCode:"*",age:"*",gender:"F",helperMessage:"",roles:"Pirate",category:"Eugéniste pirate",logo:"",realGeneticCode:"*",contaminated:"non"},{id:"L15",lastName:"DORVAL",firstName:"Alain",job:"Terraformeur",specialty:"Agronome",geneticCode:"BJOR",age:"29",gender:"M",helperMessage:"",roles:"Base",category:"Eugéniste",logo:"Colon",realGeneticCode:"OOVV",contaminated:"non"},{id:"T64",lastName:"DYKSTRA",firstName:"Tadeo",job:"*",specialty:"*",geneticCode:"*",age:"*",gender:"M",helperMessage:"",roles:"",category:"Eugéniste repenti",logo:"",realGeneticCode:"*",contaminated:"non"},{id:"",lastName:"X1",firstName:"",job:"",specialty:"Pilote amnésique",geneticCode:"",age:"",gender:"",helperMessage:"",roles:"",category:"Actif",logo:"",realGeneticCode:"BBRV",contaminated:""},{id:"",lastName:"X2",firstName:"",job:"",specialty:"Gestionnaire corrompu",geneticCode:"",age:"",gender:"",helperMessage:"",roles:"",category:"Actif",logo:"",realGeneticCode:"JOOV",contaminated:""},{id:"",lastName:"X3",firstName:"",job:"",specialty:"Porteur sain",geneticCode:"",age:"",gender:"",helperMessage:"",roles:"",category:"Actif",logo:"",realGeneticCode:"BBVV",contaminated:"porteur sain"},{id:"",lastName:"X4",firstName:"",job:"",specialty:"Eugéniste repenti",geneticCode:"",age:"",gender:"",helperMessage:"",roles:"",category:"Actif",logo:"",realGeneticCode:"OOVV",contaminated:""},{id:"B01",lastName:"HOLDEN",firstName:"James",job:"Personnel Spatial",specialty:"Equipage",geneticCode:"JJRV",age:"43",gender:"M",helperMessage:"Décédé",roles:"",category:"Décédé",logo:"",realGeneticCode:"JORV",contaminated:"Oui"},{id:"B54",lastName:"KAMAL",firstName:"Alex",job:"Personnel Spatial",specialty:"Equipage",geneticCode:"BBJR",age:"39",gender:"M",helperMessage:"Décédé",roles:"",category:"Décédé",logo:"",realGeneticCode:"BJJR",contaminated:"Oui"},{id:"O97",lastName:"NAGATA",firstName:"Naomi",job:"Personnel Spatial",specialty:"Equipage",geneticCode:"BBOR",age:"41",gender:"F",helperMessage:"Décédée",roles:"",category:"Décédé",logo:"",realGeneticCode:"BBRR",contaminated:"Oui"},{id:"O66",lastName:"DRAPER",firstName:"Bobbie",job:"Personnel Spatial",specialty:"Equipage",geneticCode:"OOVV",age:"27",gender:"F",helperMessage:"Décédée",roles:"",category:"Décédé",logo:"",realGeneticCode:"OOBV",contaminated:"Oui"}],eQ=({currentUser:t})=>{const{firstName:e,lastName:n,age:i,gender:r,job:s,specialty:o,helperMessage:a}=t;return ne.jsxs("div",{className:"roles-container",children:[ne.jsxs("div",{className:"roles-lines",children:[ne.jsxs("div",{className:"roles-content",children:["Nom : ",n]}),ne.jsxs("div",{className:"roles-content",children:["Prénom : ",e]})]}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsxs("div",{className:"roles-content",children:["Age : ",i!=""?i:"Inconnu"]}),ne.jsxs("div",{className:"roles-content",children:["Genre : ",r!=""?r:"Inconnu"]})]}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsxs("div",{className:"roles-content",children:["Fonction : ",s]}),ne.jsxs("div",{className:"roles-content",children:["Spécialité : ",o]})]}),ne.jsxs("div",{className:"roles-content",children:["Divers : ",a]})]})},d5=({fonction:t})=>{const e=()=>{let i=[];i.push(ne.jsx("div",{className:"roles-listParent",children:"Nom Prénom, Spécialisation"}));for(const r of fI)r.job==t&&i.push(ne.jsxs("div",{className:"roles-listItem",children:[r.lastName," ",r.firstName,", ",r.specialty]}));return i};let n="";switch(t){case"Personnel Spatial":n="Liste du Personnel Spatial";break;case"Passager":n="Liste des Passagers";break;case"Terraformeur":n="Liste du Personnel Terraformeur";break;default:n="Erreur !!!"}return ne.jsxs("div",{className:"roles-container",children:[ne.jsxs("div",{className:"roles-title",children:[n,": "]}),e()]})},hR=t=>ne.jsx("div",{className:"roles-lines",children:t.split("").map((e,n)=>{const i="square "+e;return ne.jsx("div",{className:i},n)})}),tQ=(t,e)=>ne.jsx("div",{className:"roles-lines",children:t.split("").map((n,i)=>{const r="square "+n;return ne.jsx("div",{className:r,onClick:()=>{e(i)}},i)})}),nQ=t=>{switch(t){case"B":return"R";case"R":return"O";case"O":return"V";case"V":return"J";case"J":default:return"B"}},iQ=({patient:t})=>{const[e,n]=H.useState(""),[i,r]=H.useState(!0),{id:s,firstName:o,lastName:a,geneticCode:l}=t;if(i){const c=window.localStorage.getItem(s);n(c??l),r(!1)}const g=c=>{let u=e.split("");u[c]=nQ(u[c]);const I=u.join("");n(I),window.localStorage.setItem(s,I)};return ne.jsxs("div",{children:[ne.jsxs("div",{children:["Nom : ",a]}),ne.jsxs("div",{children:["Prénom : ",o]}),ne.jsx("div",{children:"Code hyper-sommeil : "}),hR(l),ne.jsx("div",{children:"Code hyper-sommeil Hacké :"}),tQ(e,g)]})};function rQ(){const[t,e]=H.useState(""),n=s=>{e(s.target.value)},i=s=>{const{id:o,firstName:a,lastName:l,age:g,gender:c,geneticCode:u,helperMessage:I}=s,h=window.localStorage.getItem(o);return ne.jsxs("div",{children:[ne.jsxs("div",{children:["Nom : ",l]}),ne.jsxs("div",{children:["Prénom : ",a]}),ne.jsxs("div",{children:["Age : ",g]}),ne.jsxs("div",{children:["Genre : ",c]}),ne.jsx("div",{children:"Code hyper-sommeil :"}),hR(h||u),ne.jsx("div",{children:I})]})},r=()=>{const s=fI.find(o=>o.lastName.toLocaleLowerCase()==t.toLocaleLowerCase());return ne.jsx("div",{className:"roles-content",children:s?i(s):"Patient non trouvé..."})};return ne.jsxs("div",{className:"roles-container",children:[ne.jsx("div",{className:"roles-title",children:"Dossiers médicaux : "}),ne.jsx("h2",{className:"roles-content",children:"Saisissez le nom du patient :"}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"20",value:t,onChange:n,placeholder:"nom du patient"}),r()]})}const sQ="1449",QV="757654",JV="521749";function jV(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=jV(t[e]))&&(i&&(i+=" "),i+=n);else for(e in t)t[e]&&(i&&(i+=" "),i+=e);return i}function Kg(){for(var t,e,n=0,i="";n<arguments.length;)(t=arguments[n++])&&(e=jV(t))&&(i&&(i+=" "),i+=e);return i}const wC=t=>typeof t=="number"&&!isNaN(t),$u=t=>typeof t=="string",ys=t=>typeof t=="function",Q2=t=>$u(t)||ys(t)?t:null,A5=t=>H.isValidElement(t)||$u(t)||ys(t)||wC(t);function oQ(t,e,n){n===void 0&&(n=300);const{scrollHeight:i,style:r}=t;requestAnimationFrame(()=>{r.minHeight="initial",r.height=i+"px",r.transition=`all ${n}ms`,requestAnimationFrame(()=>{r.height="0",r.padding="0",r.margin="0",setTimeout(e,n)})})}function lv(t){let{enter:e,exit:n,appendPosition:i=!1,collapse:r=!0,collapseDuration:s=300}=t;return function(o){let{children:a,position:l,preventExitTransition:g,done:c,nodeRef:u,isIn:I}=o;const h=i?`${e}--${l}`:e,C=i?`${n}--${l}`:n,b=H.useRef(0);return H.useLayoutEffect(()=>{const m=u.current,f=h.split(" "),p=v=>{v.target===u.current&&(m.dispatchEvent(new Event("d")),m.removeEventListener("animationend",p),m.removeEventListener("animationcancel",p),b.current===0&&v.type!=="animationcancel"&&m.classList.remove(...f))};m.classList.add(...f),m.addEventListener("animationend",p),m.addEventListener("animationcancel",p)},[]),H.useEffect(()=>{const m=u.current,f=()=>{m.removeEventListener("animationend",f),r?oQ(m,c,s):c()};I||(g?f():(b.current=1,m.className+=` ${C}`,m.addEventListener("animationend",f)))},[I]),yt.createElement(yt.Fragment,null,a)}}function E6(t,e){return t!=null?{content:t.content,containerId:t.props.containerId,id:t.props.toastId,theme:t.props.theme,type:t.props.type,data:t.props.data||{},isLoading:t.props.isLoading,icon:t.props.icon,status:e}:{}}const So={list:new Map,emitQueue:new Map,on(t,e){return this.list.has(t)||this.list.set(t,[]),this.list.get(t).push(e),this},off(t,e){if(e){const n=this.list.get(t).filter(i=>i!==e);return this.list.set(t,n),this}return this.list.delete(t),this},cancelEmit(t){const e=this.emitQueue.get(t);return e&&(e.forEach(clearTimeout),this.emitQueue.delete(t)),this},emit(t){this.list.has(t)&&this.list.get(t).forEach(e=>{const n=setTimeout(()=>{e(...[].slice.call(arguments,1))},0);this.emitQueue.has(t)||this.emitQueue.set(t,[]),this.emitQueue.get(t).push(n)})}},gm=t=>{let{theme:e,type:n,...i}=t;return yt.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:e==="colored"?"currentColor":`var(--toastify-icon-color-${n})`,...i})},h5={info:function(t){return yt.createElement(gm,{...t},yt.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(t){return yt.createElement(gm,{...t},yt.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(t){return yt.createElement(gm,{...t},yt.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(t){return yt.createElement(gm,{...t},yt.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return yt.createElement("div",{className:"Toastify__spinner"})}};function aQ(t){const[,e]=H.useReducer(h=>h+1,0),[n,i]=H.useState([]),r=H.useRef(null),s=H.useRef(new Map).current,o=h=>n.indexOf(h)!==-1,a=H.useRef({toastKey:1,displayedToast:0,count:0,queue:[],props:t,containerId:null,isToastActive:o,getToast:h=>s.get(h)}).current;function l(h){let{containerId:C}=h;const{limit:b}=a.props;!b||C&&a.containerId!==C||(a.count-=a.queue.length,a.queue=[])}function g(h){i(C=>h==null?[]:C.filter(b=>b!==h))}function c(){const{toastContent:h,toastProps:C,staleId:b}=a.queue.shift();I(h,C,b)}function u(h,C){let{delay:b,staleId:m,...f}=C;if(!A5(h)||function(k){return!r.current||a.props.enableMultiContainer&&k.containerId!==a.props.containerId||s.has(k.toastId)&&k.updateId==null}(f))return;const{toastId:p,updateId:v,data:B}=f,{props:G}=a,R=()=>g(p),w=v==null;w&&a.count++;const E={...G,style:G.toastStyle,key:a.toastKey++,...Object.fromEntries(Object.entries(f).filter(k=>{let[_,U]=k;return U!=null})),toastId:p,updateId:v,data:B,closeToast:R,isIn:!1,className:Q2(f.className||G.toastClassName),bodyClassName:Q2(f.bodyClassName||G.bodyClassName),progressClassName:Q2(f.progressClassName||G.progressClassName),autoClose:!f.isLoading&&(x=f.autoClose,W=G.autoClose,x===!1||wC(x)&&x>0?x:W),deleteToast(){const k=E6(s.get(p),"removed");s.delete(p),So.emit(4,k);const _=a.queue.length;if(a.count=p==null?a.count-a.displayedToast:a.count-1,a.count<0&&(a.count=0),_>0){const U=p==null?a.props.limit:1;if(_===1||U===1)a.displayedToast++,c();else{const O=U>_?_:U;a.displayedToast=O;for(let Y=0;Y<O;Y++)c()}}else e()}};var x,W;E.iconOut=function(k){let{theme:_,type:U,isLoading:O,icon:Y}=k,z=null;const N={theme:_,type:U};return Y===!1||(ys(Y)?z=Y(N):H.isValidElement(Y)?z=H.cloneElement(Y,N):$u(Y)||wC(Y)?z=Y:O?z=h5.spinner():(L=>L in h5)(U)&&(z=h5[U](N))),z}(E),ys(f.onOpen)&&(E.onOpen=f.onOpen),ys(f.onClose)&&(E.onClose=f.onClose),E.closeButton=G.closeButton,f.closeButton===!1||A5(f.closeButton)?E.closeButton=f.closeButton:f.closeButton===!0&&(E.closeButton=!A5(G.closeButton)||G.closeButton);let T=h;H.isValidElement(h)&&!$u(h.type)?T=H.cloneElement(h,{closeToast:R,toastProps:E,data:B}):ys(h)&&(T=h({closeToast:R,toastProps:E,data:B})),G.limit&&G.limit>0&&a.count>G.limit&&w?a.queue.push({toastContent:T,toastProps:E,staleId:m}):wC(b)?setTimeout(()=>{I(T,E,m)},b):I(T,E,m)}function I(h,C,b){const{toastId:m}=C;b&&s.delete(b);const f={content:h,props:C};s.set(m,f),i(p=>[...p,m].filter(v=>v!==b)),So.emit(4,E6(f,f.props.updateId==null?"added":"updated"))}return H.useEffect(()=>(a.containerId=t.containerId,So.cancelEmit(3).on(0,u).on(1,h=>r.current&&g(h)).on(5,l).emit(2,a),()=>{s.clear(),So.emit(3,a)}),[]),H.useEffect(()=>{a.props=t,a.isToastActive=o,a.displayedToast=n.length}),{getToastToRender:function(h){const C=new Map,b=Array.from(s.values());return t.newestOnTop&&b.reverse(),b.forEach(m=>{const{position:f}=m.props;C.has(f)||C.set(f,[]),C.get(f).push(m)}),Array.from(C,m=>h(m[0],m[1]))},containerRef:r,isToastActive:o}}function W6(t){return t.targetTouches&&t.targetTouches.length>=1?t.targetTouches[0].clientX:t.clientX}function N6(t){return t.targetTouches&&t.targetTouches.length>=1?t.targetTouches[0].clientY:t.clientY}function lQ(t){const[e,n]=H.useState(!1),[i,r]=H.useState(!1),s=H.useRef(null),o=H.useRef({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,a=H.useRef(t),{autoClose:l,pauseOnHover:g,closeToast:c,onClick:u,closeOnClick:I}=t;function h(B){if(t.draggable){B.nativeEvent.type==="touchstart"&&B.nativeEvent.preventDefault(),o.didMove=!1,document.addEventListener("mousemove",f),document.addEventListener("mouseup",p),document.addEventListener("touchmove",f),document.addEventListener("touchend",p);const G=s.current;o.canCloseOnClick=!0,o.canDrag=!0,o.boundingRect=G.getBoundingClientRect(),G.style.transition="",o.x=W6(B.nativeEvent),o.y=N6(B.nativeEvent),t.draggableDirection==="x"?(o.start=o.x,o.removalDistance=G.offsetWidth*(t.draggablePercent/100)):(o.start=o.y,o.removalDistance=G.offsetHeight*(t.draggablePercent===80?1.5*t.draggablePercent:t.draggablePercent/100))}}function C(B){if(o.boundingRect){const{top:G,bottom:R,left:w,right:E}=o.boundingRect;B.nativeEvent.type!=="touchend"&&t.pauseOnHover&&o.x>=w&&o.x<=E&&o.y>=G&&o.y<=R?m():b()}}function b(){n(!0)}function m(){n(!1)}function f(B){const G=s.current;o.canDrag&&G&&(o.didMove=!0,e&&m(),o.x=W6(B),o.y=N6(B),o.delta=t.draggableDirection==="x"?o.x-o.start:o.y-o.start,o.start!==o.x&&(o.canCloseOnClick=!1),G.style.transform=`translate${t.draggableDirection}(${o.delta}px)`,G.style.opacity=""+(1-Math.abs(o.delta/o.removalDistance)))}function p(){document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",p),document.removeEventListener("touchmove",f),document.removeEventListener("touchend",p);const B=s.current;if(o.canDrag&&o.didMove&&B){if(o.canDrag=!1,Math.abs(o.delta)>o.removalDistance)return r(!0),void t.closeToast();B.style.transition="transform 0.2s, opacity 0.2s",B.style.transform=`translate${t.draggableDirection}(0)`,B.style.opacity="1"}}H.useEffect(()=>{a.current=t}),H.useEffect(()=>(s.current&&s.current.addEventListener("d",b,{once:!0}),ys(t.onOpen)&&t.onOpen(H.isValidElement(t.children)&&t.children.props),()=>{const B=a.current;ys(B.onClose)&&B.onClose(H.isValidElement(B.children)&&B.children.props)}),[]),H.useEffect(()=>(t.pauseOnFocusLoss&&(document.hasFocus()||m(),window.addEventListener("focus",b),window.addEventListener("blur",m)),()=>{t.pauseOnFocusLoss&&(window.removeEventListener("focus",b),window.removeEventListener("blur",m))}),[t.pauseOnFocusLoss]);const v={onMouseDown:h,onTouchStart:h,onMouseUp:C,onTouchEnd:C};return l&&g&&(v.onMouseEnter=m,v.onMouseLeave=b),I&&(v.onClick=B=>{u&&u(B),o.canCloseOnClick&&c()}),{playToast:b,pauseToast:m,isRunning:e,preventExitTransition:i,toastRef:s,eventHandlers:v}}function qV(t){let{closeToast:e,theme:n,ariaLabel:i="close"}=t;return yt.createElement("button",{className:`Toastify__close-button Toastify__close-button--${n}`,type:"button",onClick:r=>{r.stopPropagation(),e(r)},"aria-label":i},yt.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},yt.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function gQ(t){let{delay:e,isRunning:n,closeToast:i,type:r="default",hide:s,className:o,style:a,controlledProgress:l,progress:g,rtl:c,isIn:u,theme:I}=t;const h=s||l&&g===0,C={...a,animationDuration:`${e}ms`,animationPlayState:n?"running":"paused",opacity:h?0:1};l&&(C.transform=`scaleX(${g})`);const b=Kg("Toastify__progress-bar",l?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${I}`,`Toastify__progress-bar--${r}`,{"Toastify__progress-bar--rtl":c}),m=ys(o)?o({rtl:c,type:r,defaultClassName:b}):Kg(b,o);return yt.createElement("div",{role:"progressbar","aria-hidden":h?"true":"false","aria-label":"notification timer",className:m,style:C,[l&&g>=1?"onTransitionEnd":"onAnimationEnd"]:l&&g<1?null:()=>{u&&i()}})}const cQ=t=>{const{isRunning:e,preventExitTransition:n,toastRef:i,eventHandlers:r}=lQ(t),{closeButton:s,children:o,autoClose:a,onClick:l,type:g,hideProgressBar:c,closeToast:u,transition:I,position:h,className:C,style:b,bodyClassName:m,bodyStyle:f,progressClassName:p,progressStyle:v,updateId:B,role:G,progress:R,rtl:w,toastId:E,deleteToast:x,isIn:W,isLoading:T,iconOut:k,closeOnClick:_,theme:U}=t,O=Kg("Toastify__toast",`Toastify__toast-theme--${U}`,`Toastify__toast--${g}`,{"Toastify__toast--rtl":w},{"Toastify__toast--close-on-click":_}),Y=ys(C)?C({rtl:w,position:h,type:g,defaultClassName:O}):Kg(O,C),z=!!R||!a,N={closeToast:u,type:g,theme:U};let L=null;return s===!1||(L=ys(s)?s(N):H.isValidElement(s)?H.cloneElement(s,N):qV(N)),yt.createElement(I,{isIn:W,done:x,position:h,preventExitTransition:n,nodeRef:i},yt.createElement("div",{id:E,onClick:l,className:Y,...r,style:b,ref:i},yt.createElement("div",{...W&&{role:G},className:ys(m)?m({type:g}):Kg("Toastify__toast-body",m),style:f},k!=null&&yt.createElement("div",{className:Kg("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!T})},k),yt.createElement("div",null,o)),L,yt.createElement(gQ,{...B&&!z?{key:`pb-${B}`}:{},rtl:w,theme:U,delay:a,isRunning:e,isIn:W,closeToast:u,hide:c,type:g,style:v,className:p,controlledProgress:z,progress:R||0})))},gv=function(t,e){return e===void 0&&(e=!1),{enter:`Toastify--animate Toastify__${t}-enter`,exit:`Toastify--animate Toastify__${t}-exit`,appendPosition:e}},uQ=lv(gv("bounce",!0));lv(gv("slide",!0));lv(gv("zoom"));lv(gv("flip"));const l9=H.forwardRef((t,e)=>{const{getToastToRender:n,containerRef:i,isToastActive:r}=aQ(t),{className:s,style:o,rtl:a,containerId:l}=t;function g(c){const u=Kg("Toastify__toast-container",`Toastify__toast-container--${c}`,{"Toastify__toast-container--rtl":a});return ys(s)?s({position:c,rtl:a,defaultClassName:u}):Kg(u,Q2(s))}return H.useEffect(()=>{e&&(e.current=i.current)},[]),yt.createElement("div",{ref:i,className:"Toastify",id:l},n((c,u)=>{const I=u.length?{...o}:{...o,pointerEvents:"none"};return yt.createElement("div",{className:g(c),style:I,key:`container-${c}`},u.map((h,C)=>{let{content:b,props:m}=h;return yt.createElement(cQ,{...m,isIn:r(m.toastId),style:{...m.style,"--nth":C+1,"--len":u.length},key:`toast-${m.key}`},b)}))}))});l9.displayName="ToastContainer",l9.defaultProps={position:"top-right",transition:uQ,autoClose:5e3,closeButton:qV,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let C5,gu=new Map,gC=[],IQ=1;function $V(){return""+IQ++}function dQ(t){return t&&($u(t.toastId)||wC(t.toastId))?t.toastId:$V()}function RC(t,e){return gu.size>0?So.emit(0,t,e):gC.push({content:t,options:e}),e.toastId}function D3(t,e){return{...e,type:e&&e.type||t,toastId:dQ(e)}}function cm(t){return(e,n)=>RC(e,D3(t,n))}function zn(t,e){return RC(t,D3("default",e))}zn.loading=(t,e)=>RC(t,D3("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...e})),zn.promise=function(t,e,n){let i,{pending:r,error:s,success:o}=e;r&&(i=$u(r)?zn.loading(r,n):zn.loading(r.render,{...n,...r}));const a={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},l=(c,u,I)=>{if(u==null)return void zn.dismiss(i);const h={type:c,...a,...n,data:I},C=$u(u)?{render:u}:u;return i?zn.update(i,{...h,...C}):zn(C.render,{...h,...C}),I},g=ys(t)?t():t;return g.then(c=>l("success",o,c)).catch(c=>l("error",s,c)),g},zn.success=cm("success"),zn.info=cm("info"),zn.error=cm("error"),zn.warning=cm("warning"),zn.warn=zn.warning,zn.dark=(t,e)=>RC(t,D3("default",{theme:"dark",...e})),zn.dismiss=t=>{gu.size>0?So.emit(1,t):gC=gC.filter(e=>t!=null&&e.options.toastId!==t)},zn.clearWaitingQueue=function(t){return t===void 0&&(t={}),So.emit(5,t)},zn.isActive=t=>{let e=!1;return gu.forEach(n=>{n.isToastActive&&n.isToastActive(t)&&(e=!0)}),e},zn.update=function(t,e){e===void 0&&(e={}),setTimeout(()=>{const n=function(i,r){let{containerId:s}=r;const o=gu.get(s||C5);return o&&o.getToast(i)}(t,e);if(n){const{props:i,content:r}=n,s={delay:100,...i,...e,toastId:e.toastId||t,updateId:$V()};s.toastId!==t&&(s.staleId=t);const o=s.render||r;delete s.render,RC(o,s)}},0)},zn.done=t=>{zn.update(t,{progress:1})},zn.onChange=t=>(So.on(4,t),()=>{So.off(4,t)}),zn.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},zn.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},So.on(2,t=>{C5=t.containerId||t,gu.set(C5,t),gC.forEach(e=>{So.emit(0,e.content,e.options)}),gC=[]}).on(3,t=>{gu.delete(t.containerId||t),gu.size===0&&So.off(0).off(1).off(5)});const P3=t=>{zn.info(t)},ki=t=>{zn.error(t)},AQ=({isEnvCentral:t})=>{const[e,n]=H.useState(""),i=T=>{n(T.target.value.toLocaleUpperCase())},[r,s]=H.useState(""),o=T=>{s(T.target.value.toLocaleUpperCase())},[a,l]=H.useState(""),g=T=>{l(T.target.value.toLocaleUpperCase())},[c,u]=H.useState(""),[I,h]=H.useState(""),[C,b]=H.useState(""),[m,f]=H.useState(""),[p,v]=H.useState(""),[B,G]=H.useState(!0);B&&(u(window.localStorage.getItem("Ancrage1")),h(window.localStorage.getItem("Ancrage2")),b(window.localStorage.getItem("Ancrage3")),f(window.localStorage.getItem("Ancrage4")),v(window.localStorage.getItem("Direction")),G(!1));const R=(T,k)=>{const _=isNaN(T.target.value)?"":T.target.value;switch(k){case 1:u(_);break;case 2:h(_);break;case 3:b(_);break;case 4:f(_);break}window.localStorage.setItem("Ancrage"+k,_),!isNaN(_)&&Number(_)>13&&ki("Ancrage"+k+" : DEPASSEMENT RESERVE CARBURANT !")},w=T=>ne.jsxs("div",{className:"roles-lines",children:[ne.jsxs("div",{className:"roles-content",children:["Ancrage ",T,":"]}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"2",value:T==1?c:T==2?I:T==3?C:m,onChange:k=>{R(k,T)},placeholder:".."})]}),E=()=>a==QV?ne.jsxs("div",{className:"roles-centeredContent",children:[ne.jsx("div",{className:"roles-content",children:"Saisie des nouveaux paramètres de navigation pour mise en orbite optimate :"}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsx("div",{className:"roles-content",children:"Direction :"}),ne.jsxs("select",{className:"roles-inputBox",value:p,onChange:T=>{const k=T.target.value;v(k),window.localStorage.setItem("Direction",k)},children:[ne.jsx("option",{value:"---",children:"---"}),ne.jsx("option",{value:"A16",children:"A16"}),ne.jsx("option",{value:"P1",children:"P1"})]})]}),ne.jsx("div",{className:"roles-content",children:"Consommation carburant :"}),w(1),w(2),w(3),w(4)]}):ne.jsx("div",{className:"roles-content",children:"Suite au recalibrage des capteurs, le code de sécurité a changé. Merci de rentrer le nouveau code."}),x=()=>r==sQ?ne.jsxs("div",{className:"roles-centeredContent",children:[ne.jsx("div",{className:"roles-content",children:"Code déverrouillage navigation :"}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"6",value:a,onChange:g,placeholder:"......"}),E()]}):ne.jsx("div",{className:"roles-content",children:"code navigateur incorrect..."}),W=()=>e==JV?ne.jsxs("div",{className:"roles-centeredContent",children:[ne.jsx("div",{className:"roles-content",children:"Code vérification identité (4 chiffres) :"}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"4",value:r,onChange:o,placeholder:"...."}),x()]}):ne.jsx("div",{className:"roles-content",children:"code primaire incorrect..."});return ne.jsxs("div",{className:"roles-container",children:[ne.jsx("div",{className:"roles-title",children:"Navigation"}),t?ne.jsxs("div",{className:"roles-centeredContent",children:[ne.jsx("div",{className:"roles-content",children:"Code primaire d'accès :"}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"6",value:e,onChange:i,placeholder:"......"}),W()]}):ne.jsx("div",{className:"roles-content",children:"Navigation seulement disponible sur l'ordinateur central"})]})};function hQ({isEnvCentral:t}){const[e,n]=H.useState(""),i=s=>{n(s.target.value)},r=()=>{const s=fI.find(o=>o.lastName.toLocaleLowerCase()==e.toLocaleLowerCase());return ne.jsx("div",{className:"roles-content",children:s?ne.jsx(iQ,{patient:s}):"Passager non trouvé..."})};return ne.jsx("div",{className:"roles-container",children:t?ne.jsx("div",{className:"roles-title",children:"Tentative d'accès interdit !"}):ne.jsxs(ne.Fragment,{children:[ne.jsx("div",{className:"roles-title",children:"Piratage en cours : "}),ne.jsx("h2",{className:"roles-content",children:"Saisissez le nom du passager :"}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"20",value:e,onChange:i,placeholder:"nom du passager"}),r()]})})}function CQ(){const[t,e]=H.useState(""),n=s=>{e(s.target.value)},i=s=>{const{firstName:o,lastName:a,id:l}=s;return ne.jsxs("div",{children:[ne.jsxs("div",{children:["Nom : ",a]}),ne.jsxs("div",{children:["Prénom : ",o]}),ne.jsxs("div",{children:["Code d'accès :",l]})]})},r=()=>{const s=fI.find(o=>o.lastName.toLocaleLowerCase()==t.toLocaleLowerCase());return ne.jsx("div",{className:"roles-content",children:s?i(s):"Passager non trouvé..."})};return ne.jsxs("div",{className:"roles-container",children:[ne.jsx("div",{className:"roles-title",children:"Accès : "}),ne.jsx("h2",{className:"roles-content",children:"Saisissez le nom du passager :"}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"20",value:t,onChange:n,placeholder:"nom du passager"}),r()]})}const f5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAONJREFUeF7tzwENADAQA6Gff9OzQZrDAbfjTSiiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaIpoimiKaJZiky4+0xNmSUg7jfNAAAAAElFTkSuQmCC",fQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAAIpSURBVHhe7dQxCsNADABB2f//88XGThEwC2lczYA49WJvm5l1DPDgG8j58q5/PyY3et/a7wV4IBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAgCgbAds64V+DXzAegEBotG8CsHAAAAAElFTkSuQmCC",pQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAAksSURBVHhe7d1PqG1lGcfxc0WygWiKhYgDCQcOGjRo4CBIsoFDiwYOhCAIGgdFEDQKIggikIIIIgiMKAgCIRKjBCtoHAkKWvbH/liZ9te4Pd/z7FOr0znPXXv9e9fa+/uB33vWvZd7ztkv69lrve+71tpXTk5OrkYkXcICkS529brdhqQLWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBApIIFIhUsEKlggUgFC0QqWCBSwQKRChaIVLBAdAzuilwdkJMruw2+Slv1+sg9kbsj90feGbkxcmuEfxvMAtHWcDS4L/KuyL2RmyMUw0uRVyK3RN4YmYQForW7PfJA5MHI2/mL8NvIHZGbTv80IwtEa0NBcIR4T+QdEY4OL0T4+9kL4iKngxGpodsin4o8H/lr5NnI7yLsm62TjbSw6yOcNj0eoSh+GTm/c64h2UgLYWD9aOTPkZ9F/hQ5v1OuKdlIM2Kq9TMRBtfkN5HzO+Jak400gzdEPh/hKLHWU6hrJRtpQhTGFyKcRv0icn6n21KykSbAVOyXIhwx1l4YnOY9HWHm7KJ/P43rIJoCR4xHIu+OvByhUNaCFfbfR1hhZ9WdMRAr7t+LfD/yXIR1FvJapIvayEYa6JMRjhi/ivznnbdh+D04ejF1zM7/5ch7I2+J7Ivvl420p4cjTNP+OtLdQZcOC4rdBcbPRrgkhXWWsfj+2Ug9cTr1lQgD8O6OumQ4SpxNGbOmwrVao67avQQ/Kxuph49HeMduMWXLoJqfTXF8MTLklGlf/NxspAL3WTwVabHAxykcYxzGEm+NLImfn410CY4anE4teUnIi5FXI89EPhqZYjwxBL9LNtI5nNN/LcI0aXfnnTPMPlGMrKVw1GqN3ykbqYPz+59Elhpr8HMYX3C91hyD7aH43bKRdj4RWeqUivEFM1GspbQ6jarwO2ajo8ede9+MLHFKdXbEoBjXWBhn+F2z0VHjiSAMiOc+peL7c2Ra26nUZfids9HRel/kDxGuV+ruzFOG789pGwuMLDRuBb97NjpKH4xwiUZ3Z546jDGejCyxsDc1fv9sdHQ+FpmzOFjx5sjBz9kqXkc2Oio8QWTOWao/Rhjwb+l06iK8lmx0NLgFdq7xBkcNZqc+HDkEvKZsdPCYTmWQzGUc3Z16qjDWeCyy9aNGF68rGx08imOOezfOFhU5bTs0vL5sdNA4rZrjyMG6Bvd1b3GGqg9eYzY6WLyzzzHm4JTq2xFW4A8VrzMbHSSmWOeYrTpbDT90vNZsdHDmWgRkzPGhyDHg9Wajg8LlI1MXB9O3LPzxsIZjwevORgeDCw/Zkbs799iwvsFgfE3Pu1oCrz0bHQQGzFyVO+WgnJmqH0cOeTB+GV5/NjoIXN4x5SXrfK/vRtZ8z8ac6INstHncfDTlzU4UB9O4x1ocoB+y0aaxUMfsUncHHxOLI9EX2WizuDOPByxMtd5hcfwX/ZGNNotH80w17jj2Mcd59Ek22iQe6jbVuIOp3GOdrboM/ZKNNocHq0017mDdhHWOQ7pUfQr0TTbaHJ6VO9W4g1XyOyP6X/RNNtoUTq2mepA0R6H3R/T/6J9stBmcBvGO393Jh4bi2PJDFeZGH2WjzeDOwClmrbi7kE+i1eXop2y0CVxJO8XAnBmrxyOq0VfZaBP4TMDujj40nKI5Y3VtV6/bbWj9eAL663JzlL9EPhLh2VXqgXcUrRvv9lNM6TLuOIZbZadCn2WjVWNgzrihu7Pvm7Nn5Ko/+i0brRZ38fF5fd2dfUg4ArkYuB/6LRutFp/XN/bowaDc9Y790XfZaJWmGHtwauWU7jD0XzZaJRby+OTX7g6/bzy1Go7+y0arw9Fj7KIgs1afjmgY+jAbrQ7P0x179GBh0ZufhqMPs9GqcBvt2LEH//8DEQ1HP2ajVWExb8wFiVwK/62IxqEvs9GqMPPU3eH3DWMXB+bjeS3WCt27+zoUR56vR144/ZNG4x1H6/FoZMzdghw9vFJ3GvRnNloFZpzGTO1y9HgkomnQp9loFR6MjLnng5krH9szHfo0G60Cl4QMnd7l6MHaiaZDv2aj5m6LjPnQG8ce03MWa0X48H0e4DYEl5QwuPcuwRnw7qP2no+cPyr0DfeLHNunPy2Bvs1GTbFzDz294tOkHotoevRvNmrqocizke6O3zfcDPW2iKZH/2ajpvgIg6FPS3TFfD70bzZq6sVId6fvG6Z2eRyQ5kEfZ6NmxjyUgf/n1O58nOZdgQciQ06TXo48EXFqd2a8E6kdPrp5yOo5RUVxaT70czZqZujgnKLydtp5eYrV2F27r/uiqPgk2tdO/6TZWCBt3Rfh7sF9saj4udzU3Dhcqw2euTtk/MHsladX86Ovs1ETz0S6O36fUFAM7DU/xyCN3bz7ug9Oyb6am1oC70paHs++GnKBIv/HxcFleARp6J7IS7m5F67edXFwIRZIO3dHXsnN3pje/U5uagkWSDv3R27Jzd64rfYbuamlcF6r5T0dOT++uFb+EXH8sRzHIA0NeTyP44+FWSDt3Lr72hfjlR/lppZigbTDNO8+fh7xo9QWZoG0wUWK+54q3RT5YW5qKRZIO//afe3rTZGf5qaWYoG0wQD9n7nZG9dg7btuopEskDZ4zOjfc7M3brHVwiyQbeCSlB/kppZkgbTBx6P9LTd74bFADtAbsEDa4GYnVsb7uiHyXG5qSRZIG6yBcDVvX2+OcHOVFmaBtDHkSew+YrQBC2Q7nOJtwAJpgw+80QZYIG3sM4OlhiyQNnzg20Zciewz3SgdkZOTfwPetJyKUZ9QswAAAABJRU5ErkJggg==",mQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAAIySURBVHhe7doxCsMwEABBKf//s6LgpEhwFty4moFD14tFjeYYY+0B/hAInFuP9wKcEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAiEuWcdK/DLCwJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQC4fMX63Vyr6t/4NzR/ZYXBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIAgEgkAgCASCQCAIBIJAIMw961iBb2M8AYE7CYV3WXNOAAAAAElFTkSuQmCC",bQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAA7tSURBVHhe7Z1LyF1XFceT+qigJjZNfVEhSAYZOOiggwilFttBhhEdRCkIhYKgo0KrUnAggigFEUILRRBBTBFfIASLbeqjaoWOJYVWEo2PVm01Rk01EtfvW/fUndvvyz2P/Tzn/4P/ujst332cvffZe6219z67d+3addkkhNgBdZAycN2H6E6TyMvla1YFUT+vXb2KjKiDtMMbVq8iI+og7fD21avIiDpIGd60ehWVow5ShhtXr0P44+pVZEQdpAwHTb/2Yi9Omy56UeREHaQMB0wve7EX5KsueVHkRB2kDIdNb/NiL4hgnfOiyIk6SBnea9rnRVEz6iBl2LN67cu1pj97UeREHSQ/hHj3erE3rzNd8KLIiTpIfg6ZXvBib16zehWZUQfJDw76eS/25i2mM14UOVEHyc8dpnd5sTfKgRSEpdQiH38wrS9l36TfmUR+tNw9M0yVrvfiIOSgF0IdJC+3mIYm/P5kOuVFkRt1kLx80PRmL/bmJdPjXhQlYI4r8sDose5fbBL+x00mkR+uvxuRHPyPf5nCxt9H/I12E5ZBTnpGjpjGRKNw0BXmLYQ6SD6OmW7w4iD+tnoVhWAYF2nhRJJ/mNanT5tE5/i6SZRBU6xMEN79ixcH8XvTY14UpeBOJdLyTRP5jPURYpNY4s7uQ1EG6sCNSAbTK6ZKYcPvK+0BKYumWBlgceLfvTgIVvw+6UVRCnWQ9HzcNDR7Dhzz8z0vipIwlIs0kBwcE71C/J1OUyyLpliJ+aRpbB6DBKEOi6sA7lYiDWPWXiGccyJfoiwaQRJys2nsGipGne94UZSGO5aIz0kTycH10aGPWKAo/6M81IUbERUa91jnHJ01ifJoipWIz5qGnlzSwZ71R7woaoA7logHoV0Sg+ujQl8xvdpvEuXRCJKAz5vGZM6BUednJi0xqQjuWiIOHCs6dt0V+o3pqEnUAXXiRkThuIkl6mGjHyJGHj3Nth6oEzdiMlN9D87rPWES9UC9uBGT+aqJPedhox8i9otwbq+oB+rFjZgED+WcMnogOoioC0WxIvGQifDsWMh9aO95pXD3EuO52zQlcoX4e519VR/UjRsxCiJOhGbDxj5U+C2MQKI+qB83YhQPmNizETb4ocJ3IQIm6oP6cSMGg2M+dWrF6PGwSdQJdeRGDIbzqsYc5ROKDqbRo16oIzdiEPebWC8VNvahInJF7kTUC/XkRvQmxtQK6VCG+qGe3Ije/NQ0dWqlvEcbUFduRC++ZJoatULyPdqAunIjNnKXaco22k50MPaMiPqhvtyIq8LdfqpT3onEomgD6suNuCqEdMc833xdJAXvNIk2oM7ciB0hkRfD72AjlRzztqDe3IhtId8xdRl7J6ZocszbgnpzI14FTnmszsFuwc+YRFtQd27EFZAMjOWUE9L9uUm0B/XnRrwC06BnTC+ZwoY+VoxCB02iPag/N2ILju152hQjYoVeNGlq1S7UoRuxtfnpCdOUY3tC8T56hEHbUI9uFg6d41FTrM6B3/Erk7bRtg116WbBxO4cCL/jPSbRNtSlm4WSonPgd3zOJNqH+nSzQGL7HIj30pNp5wN16mZhdNGqmJ2Dp0k9a+K9xTygXt0sCHbxkeeIFcrtRN7kkEnMB+rVzUJgJS0NOVaWvBOnKn7UJOYFdetmAdxjirW2KhSd42MmMT+oXzczh62yMQ5aWBfvyYpfMU+oYzczBYeZMO7UQxa2E075F0xivlDPbmYIiTqc8ZiRqk7Pm3Se7vyhrt3MDO7sTH9S+BzsLtTOwGVAfbuZCSxVP2lKMaVCjBx0DpKMYv5Q525mwL0mwrex8xud8Dk0rVoW1LubhmHUYHnHX01hg44ppmtyyJcHde+mUQixkvhLNWog8hwK5S4T6t9NYxChinFG7iYpCbhsaANuGoHpFE4y0alYe8a3E/4G76/lI8uGtuCmctiZ12XDU+Q1QvH+rMrVwkNBe3BTKYRT2XxEdCp1x0BsdsLh15J1AbQJN5VBx+AEdHyMGMd+blKXVNROQBFC23BTCd1UKteIgfgcDljQHnKxDu3DTWE4WI3n9XEX58mvYQNOKaZUHM2j00fEdtBG3BSAadSnTDjEPJiGZRxh402pbkqlQ93E1aCtuMnITaavmWikOfyLdXGQNGfl6jhQsQnai5vEML//iomMN/4FjTRstDmEr8Fna9QQfaHduIkMc/ojphMmIlEo5XKQTWI6RYJRz+cQQ6DtuJkI/sQtpi+bnjOxROOsiTt22FBziykczwTUY8/EGGhDbgbClOlDJnyJMyY6BNGnkqNEKL4HPo6eJiumcHk3xsRrCCMCD5FBB0y3mt5nIsN8g4nGx1ql6037TLXAiLHH9F3TJ0wsgRdiLPSNK+6862KaxL7uEk71EDF60WnJpXAwnBAh3OS3azcb1Y0grUJkihGDYMB9Jo0Yy4SgEItLCd3fbnq/idkOs5tJSeBWOwg+xhtN3zB92qSOsRwYDW4z3WE6bNprojOwKuKC6ToTbkAUWuoghIo7X4mQLR3j4ta/xJxhykzK4KiJSCnQFt5pYvaQnFfmWxUKv4IwLXkMplHcMcS8oUMcM7FGjuVHLEPCD6YtbNdGUmvb/1ha+BaEjh8zcecgqibmy34Th2IQFKLeyaWVzqF12vY/5hYXI0wwcrG4aGK+cNPj5sdNkHrPtb1hqLb9j6nFcMmw2a3iZThlWFWIdv4wTWa6zLSZ6XOpqVMv5XLSz5u4Q3TRhSdNbG39gYnknpg3hFpZ1dAt+aHNRYs0pSR2ByG6QIa9i0ETduMO8ZSJofRHJpamiGXA4lA6xkdMzBbeYWqKGB2EUGsXgz5letzEJqjTJoVhlwkd44umD5uYPRCSbZatudYIkbARIgQfkuU+zBpybp0eI5ZP4QcTFNru/2+pG0G6BJwQY2DEOG76gIkRo6ZgC7MbDgIkw07WHTeA2c6PTT8xMeU/t9IlUwh9w40QI8HHYMSoaasDoxehYxo/WzLYmjHm1Brez40QAyEiRZi2xLkCocihhQlGNu2xJCVGcpn3dyNET8LzkcOGmlOMEkyVEDkV1mqlOLqJz3IjRA848II7domsN041n03n4ACQHAf98bluhLgK7LPgqKQSG+eYwuHj4EtwZFRO+Hw3QuwAowbTqZxLQrpVvOTTOFyw1GJVvosbIdZgTs8aOcKkYeNNKaJPdEZyKTUc7Md3ciNEAPN7DvTO5WvwOfgXHFyewtkeC9/NjRAreARErikV/gWRKHIpNe754Tu6EYuHBaassM4xpepGDDpjzZvh+K5uxKLhRBAc4tRTKt6fkam2qdRO8J3diMXCg0rZosB6pbAxxxTvz7SttfOR+e5uxCLhEdcs0Qgbc2zhY/DI7hyJvdjw/d2IxXG/KWXnIOPNyMHntAq/w41YFByKkTJKxUF+OPwtTae2g9/iRiyGh0yp/A1GDaJT95rmAL/JjZg9hFNxklM9CxJf46Sp9VEjhN/lRsweOkeKvRtdUpFp29zg97kRs4ZpVYqRg7wG+7pbjFD1gd/oRswW7uwpfA6mVI+ayMDPFX6nGzFLCLGmiFZ12fC5w291I2ZHqiQgPsc9piXA73UjZgXLR2J3DsK3JP6W9MRgfrcbMRtYeEhDDhv3VJHfwBlf2uHi/HY3YhbgMLMqN6ZTTqTqadOcnfGd4Pe7EbOA5R0xl6zzXk+Yat6zkRKugRvRPGw+irnZic5BGHepnQO4Dm5E05CoI7oUNvApUudwuBZuRLOwM48DFmLlO9Q5/g/Xw41oFo7mieV3LN3nWIdr4kY0CYe6xfI7COUuNVq1E1wXN6I5OFgtlt9B3oQ8x5yWqseAa+NGNAdn5cbyO8iS32gSV8K1cSOagqlVrIOkGYXuMolXw/VxI5qBaRB3/LCRjxWdo+VDFVLDNXIjmoGdgTGiVuwufNgkdobr5EY0AStpYzjmRKx4br24OlwrN6IJeCZg2NDHiimaIlabuXzNqiDqhxPQX+/FSfzTdJ+Js6tED7ijiLrhbh8jpIvfsYStsrHgmrkRVYNjjt8QNvah6s7IFf3hurkR1cIuPp7XFzb2MWIEUjJwGFw3N6JaeF7f1NEDp1z5juFw7dyIKonhezC1Ukh3HFw/N6JKSOTx5NewwQ+Vplbj4fq5EdXB6DE1KUjU6gGTGAfX0I2oDs7TnTp6kFjU5qfxcA3diKpgG+1U34O/v9skxsN1dCOqgmTelAWJLIX/vklMg2vpRlQFkaewwQ8Vvosc8+loLVaFHF69joWR51umc1v/EpPhjiPq4YRpym5BRg+t1I0D19ONqAIiTlNCu4wex00iDlxTN6IKjpqm7PkgcqVje+LBNXUjqoAlIWPDu4we5E5EPLiubkRx9pumPPRGvkd8FMWqCB6+zwFuY2BJCc69dgkmgLuPKM9Z0/qo0FfsF1na059ywLV1I4pC4x47veJpUidNIj5cXzeiKMdMz5nCht9XbIa62STiw/V1I4rCIwzGnpaojHk6uL5uRFGeN4WNvq8I7XIckEgD19iNKMaUQxn4O4V206EwbwUcMY2ZJp03nTIptJsY7kSiHDy6eUz2nE5F5xLp4Dq7EcUY65zTqbSdNi2aYhXmwOp1KHQqnkR7aetfIhnqIGW5zcTuwaGQVHzQiyI1DNeiDJy5O8b/IHql6VV6uNZuRBGeNYUNv4/oUDj2Ij3yQQqzd/U6BKZkj3hR5IC7ksgPZ1+NWaDI3yg5mAeNIAU5ZHrRi4Ng9a6Sg5lQBynHQdMFL/aG8O4PvShyoA5SjttN13mxN2yr/bYXRS6Y14r8PGNa9y826d8m+R/5kA9SkDHH88j/yIw6SDn2rV77gr/ySy+KXKiDlIMw7xB+a9Kj1DKjDlIGFikOnSrtMT3lRZELdZBy/Hf12pe3mk57UeRCHaQMOOj/8WJvWIM1NG8iJqIOUgaOGX3Zi71hi63IjDpIG7Ak5RdeFDlRBykDj0e76MVecCyQHPQCqIOUgc1OZMb7cq3pjBdFTtRBykAOhNW8fXm3ic1VIjPqIGUYcxK7jhgtgDpIOyjEWwB1kDLwwBvRAOogZRgSwRIFUQcpgw58a4TdpiHhRiEWxK5d/wOpOUTDOI7y3QAAAABJRU5ErkJggg==",vQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAAg+SURBVHhe7d1XiCRVGMXxWXPOGUUxYc4oJhTEB9EHRYyIigFM+CSCqE8q+mBEEQVFRBAV8cGA+iCiGBEMGDFnwZzXPJ7T1b3UzHZ/3bdD3a6p/w9O98zuzuhU1+kK91bNopmZmVkFQBedgvgZ1Up9Y+I1qt7sMu0PAHRBQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAXJY432M6YcBclj9/YzphwFyWO99jOmHAXJ46v2c4pF7WdUiILk8aWyuPhwif+UP5TfW5/N9aaycvEhqkRB8vhB+br4cAm/Fispq7Q+m2tNZfniQ1SJguTxq3K/Mtv6rL/nFG9dkMGgLxLGayPlXsW7VN69cvxadNLZ5XpQ2U5B9WZ94OcXgwPAannLvZqygeKVfwtlE2VDxX/u45M3lCeUdxQXhTey6lGQCniFP0TZS9lZ2UXZXOm1e/ut8n47Pjj37tVLyvyDekxe602Jd6bxW1s5S3lE8YrtZTxK/lSeVS5RdlN4Q6uGl33xgLHYQ7lN+U0pr+DjzmfK9cq+CmWZHC/r4gEjOVB5UimvxFXlI+UKZRsF4+XlWzxgKHsrjyvlFTZXfNbraeVUpdtYCtJ5uRYPSOKzT3co80/NTks8EHmDsqOC4XlZFg8YyLLKeYpXwPIKOc15SjlaWU5BGi+/4gF9ba88r5RXvjrlY+VCxWfYMBgvt+IBPfmd9yKlM1hX93iay43K1gpiXl7FA7raSnlBKa9gCyX/Kg8o+yvozsupeMBSTlF+Vsor1UKNByGPVJi8OpeXTfGAJXy9+D1KeQWaRDyY6AG/t5UPlG+U3GfFPO/rDGVFBVomzMWayyPhnmE7if3zL5SHFY+bvKp8onielmf1+lqPnxS/FhsrOykeJfcApE8OVM0XdF2n3Kr84j9oKL8exQNmzlXGfSDu/fyHlMOU8u6LL4C6UunM0/KWw//Wn3+q3KkcoPidfEvlfMUj9f438/8bk8z3ymVKU6+h9zIoHhpsVeVupbxijBqv8PcpOyjzraBcrfTbnfLfe8q7Jyd2eOvisryodPuaScW7g96ibKo0iX/24qGhtlVeV8orw6jxwFx0Wx/vUr2rdPvabvFxgYsxn6fOX6v40t1uXzeJeFaxJ2N6uTWBf+bioYGOUn5UyivAKPF++0lKv+O5dZQPlW7fo1duVnrxbtiJiovZ7WsnkX8UH6st9Pt7+Wdd6odvSsZ5xuh2ZS1lED4W8Tyubt+nV25SBuFdOpfJg4Hdvg9JTJPPe4/jzJ0PqH0AfrrirdEgXExfKZji7/ZzP28p5yg+VrhA8VR4jICBoeF5rGRX5bHWZ2kGXeE7PEkyhct6jeJrRI5RPIcMQ6Ag6Ty6frJygjLoVmM+H+ym8JmvYfi0sG8vtJ/icRV/7D/DgChImleUPZW7Wp8Nzwe5KcZx0zjPKfPWxHdRuUXhJhADoCCD88Gv34l9t5FRpRZknNdy+P//bMV3Vrlc8bUt6IGC9OczQscrnZH2cUj9PsPuYkU89+tSxUXxAb2nwmAeChLzREJfd+5z/uOUehwwiYJ0eK6VD+g9peVM5T0FbRSkNx/Q7qO4JOM26bNYw/hL8Si5J0d6i/ma0ngUZGkep7hYOVaZ1EzW1LNYVU4/99atM0p+hOI7OzZWkwvikdLOs9/RfeDs443jlKuUzt9PQo6zWKn88/vOkL7i8FDlZcWze1P/32utcz1IE/maDP9SGs9U9Qi086jiyYuTHis4WPH09UF5npW/JhevJ55DdrhymnKQ0gidgoxj2kUd+Of07oqvb1i//bHPKPmMzneKd32qeMPwoF3KrovHMPw1OXnZ+WpLX8zlm3F7PGhdxccuntLiEj+jfN7+s4WgtS40dQuSk8+MebkPGt/dfVp4t3x1ZTPF09599aV/bYO3xgttl93LvnhApXwRVLkA/eIRfFSv0bN5c0rdBfHvLkQGFCSPnFNNkICC5JG6BaEgmVCQPFJH0qscKEQJBcmDXayaoCB5pE41yTGSDqEgeaRuQdjFyoSC5JFakCpm86KLpk01mSZe7il4jarHQGFGqVuRSV40hR4oSD6cyaoBCpJPVbf+wQgoSD6pWxBO9WZAQfJJHU1nFysDCpLPNF+XjjYKkk/qZb1sQTKgIPkwo7cGKEg+XDRVAxQkH8ZBaoCC5ONfOZ2CgmRAQeqDXawMKEh9MKM3AwpSH4ykZ0BB6oOBwgwoSH1wkJ4BBakPdrEyoCD1wXT3DChIfbCLlQEFqQ+2IBlQkPrgGCQDClIf7GJlQEHqg3GQDChIfbCLlQEFqY/F7WdUiDsr5sOdFacfd1YEIhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECBAQYAABQECFAQIUBAgQEGAAAUBAhQECFAQIEBBgAAFAQIUBAhQECCwSJktPgQw18zM/7FvcYVLAW4eAAAAAElFTkSuQmCC",yQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAAJHSURBVHhe7dwxCsIwAEDR1PvfOVbsoFK/FLQu70Fohk4JnywhyxhjrgN4QyCwb162CbBDIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAmFZx9y+nOO23o8+rf3R//me6QSBIBAIAoEgEAgCgSAQCAKBIBAIAoEgEAiumvze61WRb7N3v+OqCRSBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFAEAgEgUAQCASBQBAIBIFA8OzP/xx9Dsgenc+zP1AEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEAQCQSAQBAJBIBAEAkEgEJZ1zPsUeDbGFbkhD4PmUQyiAAAAAElFTkSuQmCC",BQ=({content:t,changeItemTypeAndRotationInGrid:e})=>{const[n,i]=H.useState("");let{position:r,type:s,rotation:o,locked:a}=t;const l=()=>{a||e(r,-1,o)},c="grid-item"+(r[1]+(r[0]-1)*3).toString()+" grid-item",u=C=>{const b=C.target.value.toLocaleUpperCase();switch(b){case"CA1":case"CB1":case"CC1":s=1,o=1;break;case"CA2":case"CB2":case"CC2":s=1,o=0;break;case"CA3":case"CB3":case"CC3":s=1,o=3;break;case"CA4":case"CB4":case"CC4":s=1,o=2;break;case"LA1":case"LB1":case"LC1":s=0,o=0;break;case"LA3":case"LB3":case"LC3":s=0,o=2;break;case"LA2":case"LB2":case"LC2":s=0,o=1;break;case"LA4":case"LB4":case"LC4":s=0,o=3;break;case"TA1":case"TB1":case"TC1":s=2,o=3;break;case"TA2":case"TB2":case"TC2":s=2,o=2;break;case"TA3":case"TB3":case"TC3":s=2,o=1;break;case"TA4":case"TB4":case"TC4":s=2,o=0;break;case"FC1":s=5,o=2;break;case"FC2":s=5,o=1;break;case"FC3":s=5,o=0;break;case"FC4":s=5,o=3;break;case"JB1":case"JB2":case"JB3":case"JB4":s=4,o=0;break;case"JA1":s=3,o=0;break;case"JA3":s=3,o=2;break;case"JA2":s=3,o=1;break;case"JA4":s=3,o=3;break}i(b),s>=0&&(C.target.value="",i(""),e(r,s,o))};if(s<0)return ne.jsxs("div",{className:c,children:[ne.jsx("img",{className:"img",src:f5}),ne.jsx("input",{className:"input-code",type:"text",maxLength:"3",value:n,onChange:u,placeholder:"---"})]});let I="img rotate"+(o*90).toString(),h=ne.jsx("img",{className:I,src:f5});switch(s){case 0:h=ne.jsx("img",{className:I,src:fQ});break;case 1:h=ne.jsx("img",{className:I,src:pQ});break;case 2:h=ne.jsx("img",{className:I,src:mQ});break;case 3:h=ne.jsx("img",{className:I,src:bQ});break;case 4:h=ne.jsx("img",{className:I,src:vQ});break;case 5:h=ne.jsx("img",{className:I,src:yQ});break;default:h=ne.jsx("img",{className:I,src:f5})}return ne.jsx("div",{className:c,onDoubleClick:l,children:h})},GQ="/bellerophon/assets/Target-13c2f7b9.png",SQ=({type:t,position:e})=>{let n="target-item"+e.toString()+" target-item";switch(t){case 0:n+=" target-redItem";break;case 1:n+=" target-blueItem";break;default:n+=" target-none";break}let i=" target-item rotate"+(Math.floor((e-1)/3)*90).toString();return ne.jsx("div",{className:n,children:ne.jsx("img",{className:i,src:GQ})})},O3=({targets:t,centerTile:e,shortCircuit:n,onSuccess:i})=>{const[r,s]=H.useState([]),o=(f,p,v)=>{const B=[...r];B.forEach(G=>{G.position===f&&(G.type=p,G.rotation=v)}),s(B)},a=()=>{let f=[ne.jsx("div",{className:"target-itemtopleft target-item target-none"},4),ne.jsx("div",{className:"target-itembottomright target-item target-none"},5)];for(var p=0;p<4;p++){const v=t[p];f.push(ne.jsx(SQ,{position:v,type:p<2?0:1},p))}return f},l=[],g=f=>{for(let p=0;p<9;p++)p==4?f.push({position:[Math.floor(p/3)+1,p%3+1],type:e[0],rotation:e[1],locked:!0}):f.push({position:[Math.floor(p/3)+1,p%3+1],type:-1,rotation:0,locked:!1});s(f)};r.length===0&&g(l);const c=f=>f.map((p,v)=>ne.jsx(BQ,{content:p,changeItemTypeAndRotationInGrid:o},v)),u=f=>{f.preventDefault(),g(l)},I=(f,p)=>{switch(f.type){case 0:case 4:return[(p+2)%4];case 1:switch(f.rotation){case 0:return[3-p];case 1:return[5-p];case 2:return[3-p];case 3:default:return[1-p]}case 3:switch(f.rotation){case 0:case 2:return p==0?[3]:p==1?[2]:p==2?[1]:[0];case 1:case 3:default:return p<=1?[1-p]:[5-p]}case 2:return[0,1,2,3].filter(v=>v!=f.rotation&&v!=p);case 5:return[]}return[]},h=f=>{switch(f.type){case 0:switch(f.rotation){case 0:return[0,2];case 1:default:return[1,3]}case 1:switch(f.rotation){case 0:return[1,2];case 1:return[2,3];case 2:return[3,0];case 3:default:return[0,1]}case 2:switch(f.rotation){case 0:return[1,2,3];case 1:return[2,3,0];case 2:return[3,0,1];case 3:default:return[0,1,2]}case 3:return[0,1,2,3];case 4:return[0,1,2,3];case 5:switch(f.rotation){case 0:return[2];case 1:return[3];case 2:return[0];case 3:default:return[1]}}return[]},C=f=>{switch(f){case 0:return"Ligne droite";case 1:return"Courbe";case 2:return"Intersection en T";case 3:return"Double courbe";case 4:return"Croisement en X";case 5:default:return"Fin de cable"}},b=f=>f<=3?[f-1,0]:f<=6?[(f-3)*3-1,1]:f<=9?[15-f,2]:[(12-f)*3,3],m=f=>{f.preventDefault();const p=r.filter(T=>T.type==-1).length;if(p>0){ki("Il manque "+p+" connexion"+(p==1?" !":"s !"));return}for(let T=0;T<3;T++)if(r.filter(_=>_.type==T).length>3){ki("Trop de connexion de type "+C(T)+" utilisées (max 3) !");return}for(let T=3;T<6;T++)if(r.filter(_=>_.type==T).length>1){ki("Trop de connexion de type "+C(T)+" utilisées (max 1) !");return}const v=r.filter(T=>T.type==0&&T.rotation>=2).length,B=r.filter(T=>T.type==5&&T.rotation==1).length,G=r.filter(T=>T.type==3&&T.rotation<=1).length;if(v+B+G>0){ki("Au moins une des connections est défaillante...");return}let w=!1;for(let T=0;T<9;T++){const k=r[T];if(h(k).forEach(U=>{if(U==0&&T<=2&&!t.includes(T+1)){ki("La tuile "+(T+1)+" est connectée à un mur (vers le haut)."),w=!0;return}if(U==1&&(T+1)%3==0&&(t.includes(4+Math.floor(T/3))||(ki("La tuile "+(T+1)+" est connectée à un mur (vers la droite)."),w=!0)),U==2&&T>=6&&(t.includes(15-T)||(ki("La tuile "+(T+1)+" est connectée à un mur (vers le bas)."),w=!0)),U==3&&T%3==0&&(t.includes(12-T/3)||(ki("La tuile "+(T+1)+" est connectée à un mur (vers la gauche)."),w=!0)),U==0&&T>2){const O=r[T-3];if(!h(O).includes(2)){ki("La tuile "+(T+1)+" est connectée à du vide (vers le haut)."),w=!0;return}}if(U==2&&T<6){const O=r[T+3];if(!h(O).includes(0)){ki("La tuile "+(T+1)+" est connectée à du vide (vers le bas)."),w=!0;return}}if(U==1&&(T+1)%3!=0){const O=r[T+1];if(!h(O).includes(3)){ki("La tuile "+(T+1)+" est connectée à du vide (vers la droite)."),w=!0;return}}if(U==3&&T%3!=0){const O=r[T-1];if(!h(O).includes(1)){ki("La tuile "+(T+1)+" est connectée à du vide (vers la gauche)."),w=!0;return}}}),w)return}let E=[];const x=new Array(new Array,new Array,new Array,new Array);let W=0;if(t.forEach(T=>{if(!E.includes(T)){console.log("New computer : "+T),x[W].push(T),E.push(T);let k=new Array;const _=b(T);let U=new Array(_);for(;U.length>0;){const O=U.shift(),Y=O[0],z=O[1];if(!k.includes(Y)){const N=r[Y];N.type!=3&&N.type!=4&&k.push(Y),I(N,z).forEach(V=>{if(V==0&&Y<=2){const M=Y+1;E.push(M),x[W].push(M)}else if(V==2&&Y>=6){const M=15-Y;E.push(M),x[W].push(M)}else if(V==1&&(Y+1)%3==0){const M=4+Math.floor(Y/3);E.push(M),x[W].push(M)}else if(V==3&&Y%3==0){const M=12-Y/3;E.push(M),x[W].push(M)}else if(V==0&&Y>2){const M=Y-3;U.push([M,2])}else if(V==2&&Y<6){const M=Y+3;U.push([M,0])}else if(V==1&&(Y+1)%3!=0){const M=Y+1;U.push([M,3])}else if(V==3&&Y%3!=0){const M=Y-1;U.push([M,1])}})}}W++}}),console.log(x),x[0].length!=2||x[1].length!=2){ki("Les connections finales ne sont pas correctes. Les ordinateurs doivent être connectés entre eux deux par deux.");return}else if(n){if(!(x[0].includes(t[0])&&(x[0].includes(t[2])||x[0].includes(t[3])))){ki("Court circuit invalide...");return}if(!(x[1].includes(t[1])&&(x[1].includes(t[2])||x[1].includes(t[3])))){ki("Court circuit invalide...");return}}else{if(!x[0].includes(t[0])||!x[0].includes(t[1])){ki("Les ordinateurs rouges ne sont pas connectés entre eux...");return}if(!x[1].includes(t[2])||!x[1].includes(t[3])){ki("Les ordinateurs bleus ne sont pas connectés entre eux...");return}}P3(n?"court circuit effectué avec succès !":"connexions effectuées avec succès !"),i()};return ne.jsxs("div",{className:"container",children:[ne.jsxs("div",{className:"grid-container",children:[r.length>0&&c(r),a()]}),ne.jsx("button",{className:"submenu-button",onClick:u,children:"Remise à zéro"}),ne.jsx("button",{className:"submenu-button",onClick:m,children:"Valider les connections"})]})};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nt=function(t,e){if(!t)throw VA(e)},VA=function(t){return new Error("Firebase Database ("+eL.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tL=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},wQ=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},CR={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<t.length;r+=3){const s=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,g=l?t[r+2]:0,c=s>>2,u=(s&3)<<4|a>>4;let I=(a&15)<<2|g>>6,h=g&63;l||(h=64,o||(I=64)),i.push(n[c],n[u],n[I],n[h])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(tL(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):wQ(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<t.length;){const s=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const g=r<t.length?n[t.charAt(r)]:64;++r;const u=r<t.length?n[t.charAt(r)]:64;if(++r,s==null||a==null||g==null||u==null)throw new RQ;const I=s<<2|a>>4;if(i.push(I),g!==64){const h=a<<4&240|g>>2;if(i.push(h),u!==64){const C=g<<6&192|u;i.push(C)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class RQ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const nL=function(t){const e=tL(t);return CR.encodeByteArray(e,!0)},Q3=function(t){return nL(t).replace(/\./g,"")},g9=function(t){try{return CR.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xQ(t){return iL(void 0,t)}function iL(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!ZQ(n)||(t[n]=iL(t[n],e[n]));return t}function ZQ(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EQ(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WQ=()=>EQ().__FIREBASE_DEFAULTS__,NQ=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},MQ=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&g9(t[1]);return e&&JSON.parse(e)},rL=()=>{try{return WQ()||NQ()||MQ()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},TQ=t=>{var e,n;return(n=(e=rL())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},FQ=t=>{const e=TQ(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},sL=()=>{var t;return(t=rL())===null||t===void 0?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VQ(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[Q3(JSON.stringify(n)),Q3(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LQ(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function oL(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(LQ())}function kQ(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function aL(){return eL.NODE_ADMIN===!0}function HQ(){try{return typeof indexedDB=="object"}catch{return!1}}function _Q(){return new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XQ="FirebaseError";class A0 extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=XQ,Object.setPrototypeOf(this,A0.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lL.prototype.create)}}class lL{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?YQ(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new A0(r,a,i)}}function YQ(t,e){return t.replace(KQ,(n,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const KQ=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(t){return JSON.parse(t)}function Ki(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gL=function(t){let e={},n={},i={},r="";try{const s=t.split(".");e=If(g9(s[0])||""),n=If(g9(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:r}},zQ=function(t){const e=gL(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},UQ=function(t){const e=gL(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ag(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function CA(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function M6(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function J3(t,e,n){const i={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=e.call(n,t[r],r,t));return i}function c9(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const s=t[r],o=e[r];if(T6(s)&&T6(o)){if(!c9(s,o))return!1}else if(s!==o)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function T6(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DQ(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PQ{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const i=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)i[u]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let u=0;u<16;u++)i[u]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let u=16;u<80;u++){const I=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=(I<<1|I>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],g,c;for(let u=0;u<80;u++){u<40?u<20?(g=a^s&(o^a),c=1518500249):(g=s^o^a,c=1859775393):u<60?(g=s&o|a&(s|o),c=2400959708):(g=s^o^a,c=3395469782);const I=(r<<5|r>>>27)+g+l+c+i[u]&4294967295;l=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=I}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const i=n-this.blockSize;let r=0;const s=this.buf_;let o=this.inbuf_;for(;r<n;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<n;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<n;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}}function fR(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OQ=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);if(r>=55296&&r<=56319){const s=r-55296;i++,nt(i<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):r<65536?(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},uv=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LA(t){return t&&t._delegate?t._delegate:t}class df{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QQ=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new cv;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(jQ(e))try{this.getOrInitializeService({instanceIdentifier:cu})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=cu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=cu){return this.instances.has(e)}getOptions(e=cu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,n){var i;const r=this.normalizeInstanceIdentifier(n),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const r of i)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:JQ(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=cu){return this.component?this.component.multipleInstances?e:cu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function JQ(t){return t===cu?void 0:t}function jQ(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qQ{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new QQ(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ln;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ln||(Ln={}));const $Q={debug:Ln.DEBUG,verbose:Ln.VERBOSE,info:Ln.INFO,warn:Ln.WARN,error:Ln.ERROR,silent:Ln.SILENT},eJ=Ln.INFO,tJ={[Ln.DEBUG]:"log",[Ln.VERBOSE]:"log",[Ln.INFO]:"info",[Ln.WARN]:"warn",[Ln.ERROR]:"error"},nJ=(t,e,...n)=>{if(e<t.logLevel)return;const i=new Date().toISOString(),r=tJ[e];if(r)console[r](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class cL{constructor(e){this.name=e,this._logLevel=eJ,this._logHandler=nJ,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ln))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$Q[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ln.DEBUG,...e),this._logHandler(this,Ln.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ln.VERBOSE,...e),this._logHandler(this,Ln.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ln.INFO,...e),this._logHandler(this,Ln.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ln.WARN,...e),this._logHandler(this,Ln.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ln.ERROR,...e),this._logHandler(this,Ln.ERROR,...e)}}const iJ=(t,e)=>e.some(n=>t instanceof n);let F6,V6;function rJ(){return F6||(F6=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sJ(){return V6||(V6=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const uL=new WeakMap,u9=new WeakMap,IL=new WeakMap,p5=new WeakMap,pR=new WeakMap;function oJ(t){const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(ec(t.result)),r()},o=()=>{i(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&uL.set(n,t)}).catch(()=>{}),pR.set(e,t),e}function aJ(t){if(u9.has(t))return;const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),r()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});u9.set(t,e)}let I9={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return u9.get(t);if(e==="objectStoreNames")return t.objectStoreNames||IL.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ec(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function lJ(t){I9=t(I9)}function gJ(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=t.call(m5(this),e,...n);return IL.set(i,e.sort?e.sort():[e]),ec(i)}:sJ().includes(t)?function(...e){return t.apply(m5(this),e),ec(uL.get(this))}:function(...e){return ec(t.apply(m5(this),e))}}function cJ(t){return typeof t=="function"?gJ(t):(t instanceof IDBTransaction&&aJ(t),iJ(t,rJ())?new Proxy(t,I9):t)}function ec(t){if(t instanceof IDBRequest)return oJ(t);if(p5.has(t))return p5.get(t);const e=cJ(t);return e!==t&&(p5.set(t,e),pR.set(e,t)),e}const m5=t=>pR.get(t);function uJ(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=ec(o);return i&&o.addEventListener("upgradeneeded",l=>{i(ec(o.result),l.oldVersion,l.newVersion,ec(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",g=>r(g.oldVersion,g.newVersion,g))}).catch(()=>{}),a}const IJ=["get","getKey","getAll","getAllKeys","count"],dJ=["put","add","delete","clear"],b5=new Map;function L6(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(b5.get(e))return b5.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=dJ.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||IJ.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let g=l.store;return i&&(g=g.index(a.shift())),(await Promise.all([g[n](...a),r&&l.done]))[0]};return b5.set(e,s),s}lJ(t=>({...t,get:(e,n,i)=>L6(e,n)||t.get(e,n,i),has:(e,n)=>!!L6(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AJ{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(hJ(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function hJ(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const d9="@firebase/app",k6="0.9.22";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eI=new cL("@firebase/app"),CJ="@firebase/app-compat",fJ="@firebase/analytics-compat",pJ="@firebase/analytics",mJ="@firebase/app-check-compat",bJ="@firebase/app-check",vJ="@firebase/auth",yJ="@firebase/auth-compat",BJ="@firebase/database",GJ="@firebase/database-compat",SJ="@firebase/functions",wJ="@firebase/functions-compat",RJ="@firebase/installations",xJ="@firebase/installations-compat",ZJ="@firebase/messaging",EJ="@firebase/messaging-compat",WJ="@firebase/performance",NJ="@firebase/performance-compat",MJ="@firebase/remote-config",TJ="@firebase/remote-config-compat",FJ="@firebase/storage",VJ="@firebase/storage-compat",LJ="@firebase/firestore",kJ="@firebase/firestore-compat",HJ="firebase",_J="10.5.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A9="[DEFAULT]",XJ={[d9]:"fire-core",[CJ]:"fire-core-compat",[pJ]:"fire-analytics",[fJ]:"fire-analytics-compat",[bJ]:"fire-app-check",[mJ]:"fire-app-check-compat",[vJ]:"fire-auth",[yJ]:"fire-auth-compat",[BJ]:"fire-rtdb",[GJ]:"fire-rtdb-compat",[SJ]:"fire-fn",[wJ]:"fire-fn-compat",[RJ]:"fire-iid",[xJ]:"fire-iid-compat",[ZJ]:"fire-fcm",[EJ]:"fire-fcm-compat",[WJ]:"fire-perf",[NJ]:"fire-perf-compat",[MJ]:"fire-rc",[TJ]:"fire-rc-compat",[FJ]:"fire-gcs",[VJ]:"fire-gcs-compat",[LJ]:"fire-fst",[kJ]:"fire-fst-compat","fire-js":"fire-js",[HJ]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j3=new Map,h9=new Map;function YJ(t,e){try{t.container.addComponent(e)}catch(n){eI.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function q3(t){const e=t.name;if(h9.has(e))return eI.debug(`There were multiple attempts to register component ${e}.`),!1;h9.set(e,t);for(const n of j3.values())YJ(n,t);return!0}function KJ(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zJ={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},tc=new lL("app","Firebase",zJ);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UJ{constructor(e,n,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new df("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tc.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DJ=_J;function dL(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const i=Object.assign({name:A9,automaticDataCollectionEnabled:!1},e),r=i.name;if(typeof r!="string"||!r)throw tc.create("bad-app-name",{appName:String(r)});if(n||(n=sL()),!n)throw tc.create("no-options");const s=j3.get(r);if(s){if(c9(n,s.options)&&c9(i,s.config))return s;throw tc.create("duplicate-app",{appName:r})}const o=new qQ(r);for(const l of h9.values())o.addComponent(l);const a=new UJ(n,i,o);return j3.set(r,a),a}function PJ(t=A9){const e=j3.get(t);if(!e&&t===A9&&sL())return dL();if(!e)throw tc.create("no-app",{appName:t});return e}function qd(t,e,n){var i;let r=(i=XJ[t])!==null&&i!==void 0?i:t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),eI.warn(a.join(" "));return}q3(new df(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OJ="firebase-heartbeat-database",QJ=1,Af="firebase-heartbeat-store";let v5=null;function AL(){return v5||(v5=uJ(OJ,QJ,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Af)}}}).catch(t=>{throw tc.create("idb-open",{originalErrorMessage:t.message})})),v5}async function JJ(t){try{return await(await AL()).transaction(Af).objectStore(Af).get(hL(t))}catch(e){if(e instanceof A0)eI.warn(e.message);else{const n=tc.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});eI.warn(n.message)}}}async function H6(t,e){try{const i=(await AL()).transaction(Af,"readwrite");await i.objectStore(Af).put(e,hL(t)),await i.done}catch(n){if(n instanceof A0)eI.warn(n.message);else{const i=tc.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});eI.warn(i.message)}}}function hL(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jJ=1024,qJ=30*24*60*60*1e3;class $J{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new tj(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=_6();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(r=>r.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const s=new Date(r.date).valueOf();return Date.now()-s<=qJ}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=_6(),{heartbeatsToSend:n,unsentEntries:i}=ej(this._heartbeatsCache.heartbeats),r=Q3(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function _6(){return new Date().toISOString().substring(0,10)}function ej(t,e=jJ){const n=[];let i=t.slice();for(const r of t){const s=n.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),X6(n)>e){s.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),X6(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class tj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return HQ()?_Q().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await JJ(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return H6(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return H6(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function X6(t){return Q3(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nj(t){q3(new df("platform-logger",e=>new AJ(e),"PRIVATE")),q3(new df("heartbeat",e=>new $J(e),"PRIVATE")),qd(d9,k6,t),qd(d9,k6,"esm2017"),qd("fire-js","")}nj("");var ij="firebase",rj="10.5.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qd(ij,rj,"app");const Y6="@firebase/database",K6="1.0.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let CL="";function sj(t){CL=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oj{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ki(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:If(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return ag(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fL=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new oj(e)}}catch{}return new aj},xu=fL("localStorage"),C9=fL("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $d=new cL("@firebase/database"),lj=function(){let t=1;return function(){return t++}}(),pL=function(t){const e=OQ(t),n=new PQ;n.update(e);const i=n.digest();return CR.encodeByteArray(i)},h0=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=h0.apply(null,i):typeof i=="object"?e+=Ki(i):e+=i,e+=" "}return e};let _u=null,z6=!0;const gj=function(t,e){nt(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?($d.logLevel=Ln.VERBOSE,_u=$d.log.bind($d),e&&C9.set("logging_enabled",!0)):typeof t=="function"?_u=t:(_u=null,C9.remove("logging_enabled"))},Tr=function(...t){if(z6===!0&&(z6=!1,_u===null&&C9.get("logging_enabled")===!0&&gj(!0)),_u){const e=h0.apply(null,t);_u(e)}},C0=function(t){return function(...e){Tr(t,...e)}},f9=function(...t){const e="FIREBASE INTERNAL ERROR: "+h0(...t);$d.error(e)},eg=function(...t){const e=`FIREBASE FATAL ERROR: ${h0(...t)}`;throw $d.error(e),new Error(e)},Rs=function(...t){const e="FIREBASE WARNING: "+h0(...t);$d.warn(e)},cj=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Rs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},mL=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},uj=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},fA="[MIN_NAME]",tI="[MAX_NAME]",kA=function(t,e){if(t===e)return 0;if(t===fA||e===tI)return-1;if(e===fA||t===tI)return 1;{const n=U6(t),i=U6(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},Ij=function(t,e){return t===e?0:t<e?-1:1},Eh=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Ki(e))},mR=function(t){if(typeof t!="object"||t===null)return Ki(t);const e=[];for(const i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=Ki(e[i]),n+=":",n+=mR(t[e[i]]);return n+="}",n},bL=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let r=0;r<n;r+=e)r+e>n?i.push(t.substring(r,n)):i.push(t.substring(r,r+e));return i};function Zs(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const vL=function(t){nt(!mL(t),"Invalid JSON number");const e=11,n=52,i=(1<<e-1)-1;let r,s,o,a,l;t===0?(s=0,o=0,r=1/t===-1/0?1:0):(r=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),s=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(s=0,o=Math.round(t/Math.pow(2,1-i-n))));const g=[];for(l=n;l;l-=1)g.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)g.push(s%2?1:0),s=Math.floor(s/2);g.push(r?1:0),g.reverse();const c=g.join("");let u="";for(l=0;l<64;l+=8){let I=parseInt(c.substr(l,8),2).toString(16);I.length===1&&(I="0"+I),u=u+I}return u.toLowerCase()},dj=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Aj=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function hj(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}const Cj=new RegExp("^-?(0*)\\d{1,10}$"),fj=-2147483648,pj=2147483647,U6=function(t){if(Cj.test(t)){const e=Number(t);if(e>=fj&&e<=pj)return e}return null},HA=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Rs("Exception was thrown by user callback.",n),e},Math.floor(0))}},mj=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},xC=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){Rs(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vj{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Tr("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Rs(e)}}class eA{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}eA.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bR="5",yL="v",BL="s",GL="r",SL="f",wL=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,RL="ls",xL="p",p9="ac",ZL="websocket",EL="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WL{constructor(e,n,i,r,s=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xu.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&xu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function yj(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function NL(t,e,n){nt(typeof e=="string","typeof type must == string"),nt(typeof n=="object","typeof params must == object");let i;if(e===ZL)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===EL)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);yj(t)&&(n.ns=t.namespace);const r=[];return Zs(n,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bj{constructor(){this.counters_={}}incrementCounter(e,n=1){ag(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return xQ(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y5={},B5={};function vR(t){const e=t.toString();return y5[e]||(y5[e]=new Bj),y5[e]}function Gj(t,e){const n=t.toString();return B5[n]||(B5[n]=e()),B5[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sj{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&HA(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D6="start",wj="close",Rj="pLPCommand",xj="pRTLPCB",ML="id",TL="pw",FL="ser",Zj="cb",Ej="seg",Wj="ts",Nj="d",Mj="dframe",VL=1870,LL=30,Tj=VL-LL,Fj=25e3,Vj=3e4;class Fd{constructor(e,n,i,r,s,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=C0(e),this.stats_=vR(n),this.urlFn=l=>(this.appCheckToken&&(l[p9]=this.appCheckToken),NL(n,EL,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Sj(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Vj)),uj(()=>{if(this.isClosed_)return;this.scriptTagHolder=new yR((...s)=>{const[o,a,l,g,c]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===D6)this.id=a,this.password=l;else if(o===wj)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[D6]="t",i[FL]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Zj]=this.scriptTagHolder.uniqueCallbackIdentifier),i[yL]=bR,this.transportSessionId&&(i[BL]=this.transportSessionId),this.lastSessionId&&(i[RL]=this.lastSessionId),this.applicationId&&(i[xL]=this.applicationId),this.appCheckToken&&(i[p9]=this.appCheckToken),typeof location<"u"&&location.hostname&&wL.test(location.hostname)&&(i[GL]=SL);const r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Fd.forceAllow_=!0}static forceDisallow(){Fd.forceDisallow_=!0}static isAvailable(){return Fd.forceAllow_?!0:!Fd.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!dj()&&!Aj()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Ki(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=nL(n),r=bL(i,Tj);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const i={};i[Mj]="t",i[ML]=e,i[TL]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Ki(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class yR{constructor(e,n,i,r){this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=lj(),window[Rj+this.uniqueCallbackIdentifier]=e,window[xj+this.uniqueCallbackIdentifier]=n,this.myIFrame=yR.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Tr("frame writing exception"),a.stack&&Tr(a.stack),Tr(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Tr("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[ML]=this.myID,e[TL]=this.myPW,e[FL]=this.currentSerial;let n=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+LL+i.length<=VL;){const o=this.pendingSegs.shift();i=i+"&"+Ej+r+"="+o.seg+"&"+Wj+r+"="+o.ts+"&"+Nj+r+"="+o.d,r++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},r=setTimeout(i,Math.floor(Fj)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{Tr("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lj=16384,kj=45e3;let $3=null;typeof MozWebSocket<"u"?$3=MozWebSocket:typeof WebSocket<"u"&&($3=WebSocket);class sa{constructor(e,n,i,r,s,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=C0(this.connId),this.stats_=vR(n),this.connURL=sa.connectionURL_(n,o,a,r,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,i,r,s){const o={};return o[yL]=bR,typeof location<"u"&&location.hostname&&wL.test(location.hostname)&&(o[GL]=SL),n&&(o[BL]=n),i&&(o[RL]=i),r&&(o[p9]=r),s&&(o[xL]=s),NL(e,ZL,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xu.set("previous_websocket_failure",!0);try{let i;aL(),this.mySock=new $3(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){sa.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&$3!==null&&!sa.forceDisallow_}static previouslyFailed(){return xu.isInMemoryStorage||xu.get("previous_websocket_failure")===!0}markConnectionHealthy(){xu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const i=If(n);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(nt(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const n=Ki(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=bL(n,Lj);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(kj))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}sa.responsesRequiredToBeHealthy=2;sa.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Fd,sa]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const n=sa&&sa.isAvailable();let i=n&&!sa.previouslyFailed();if(e.webSocketOnly&&(n||Rs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[sa];else{const r=this.transports_=[];for(const s of hf.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);hf.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}hf.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hj=6e4,_j=5e3,Xj=10*1024,Yj=100*1024,G5="t",P6="d",Kj="s",O6="r",zj="e",Q6="o",J6="a",j6="n",q6="p",Uj="h";class Dj{constructor(e,n,i,r,s,o,a,l,g,c){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=g,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=C0("c:"+this.id+":"),this.transportManager_=new hf(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=xC(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Yj?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Xj?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(G5 in e){const n=e[G5];n===J6?this.upgradeIfSecondaryHealthy_():n===O6?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Q6&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Eh("t",e),i=Eh("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:q6,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:J6,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:j6,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Eh("t",e),i=Eh("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Eh(G5,e);if(P6 in e){const i=e[P6];if(n===Uj){const r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(n===j6){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Kj?this.onConnectionShutdown_(i):n===O6?this.onReset_(i):n===zj?f9("Server Error: "+i):n===Q6?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):f9("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),bR!==i&&Rs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),xC(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Hj))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xC(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(_j))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:q6,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{put(e,n,i,r){}merge(e,n,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let HL=class{constructor(e){this.allowedEvents_=e,this.listeners_={},nt(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});const r=this.getInitialEvent(e);r&&n.apply(i,r)}off(e,n,i){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===n&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){nt(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb extends HL{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!oL()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new eb}getInitialEvent(e){return nt(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $6=32,e8=768;let Nn=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};function Cn(){return new Nn("")}function rn(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function uc(t){return t.pieces_.length-t.pieceNum_}function kn(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Nn(t.pieces_,e)}function _L(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Pj(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function XL(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function YL(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Nn(e,0)}function zi(t,e){const n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof Nn)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{const i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new Nn(n,0)}function nn(t){return t.pieceNum_>=t.pieces_.length}function $r(t,e){const n=rn(t),i=rn(e);if(n===null)return e;if(n===i)return $r(kn(t),kn(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function KL(t,e){if(uc(t)!==uc(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function oa(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(uc(t)>uc(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class Oj{constructor(e,n){this.errorPrefix_=n,this.parts_=XL(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=uv(this.parts_[i]);zL(this)}}function Qj(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=uv(e),zL(t)}function Jj(t){const e=t.parts_.pop();t.byteLength_-=uv(e),t.parts_.length>0&&(t.byteLength_-=1)}function zL(t){if(t.byteLength_>e8)throw new Error(t.errorPrefix_+"has a key path longer than "+e8+" bytes ("+t.byteLength_+").");if(t.parts_.length>$6)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+$6+") or object contains a cycle "+uu(t))}function uu(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR extends HL{constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new BR}getInitialEvent(e){return nt(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=1e3,jj=60*5*1e3,t8=30*1e3,qj=1.3,$j=3e4,eq="server_kill",n8=3;class Pl extends kL{constructor(e,n,i,r,s,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Pl.nextPersistentConnectionId_++,this.log_=C0("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Wh,this.maxReconnectDelay_=jj,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!aL())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");BR.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&eb.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){const r=++this.requestNumber_,s={r,a:e,b:n};this.log_(Ki(s)),nt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),i&&(this.requestCBHash_[r]=i)}get(e){this.initConnection_();const n=new cv,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),n.promise}listen(e,n,i,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),nt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),nt(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:n,query:e,tag:i};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(e){const n=e.query,i=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+i+" for "+r);const s={p:i},o="q";e.tag&&(s.q=n._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const l=a.d,g=a.s;Pl.warnOnListenWarnings_(l,n),(this.listens.get(i)&&this.listens.get(i).get(r))===e&&(this.log_("listen response",a),g!=="ok"&&this.removeListen_(i,r),e.onComplete&&e.onComplete(g,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&ag(e,"w")){const i=CA(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',s=n._path.toString();Rs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||UQ(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=t8)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=zQ(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,r=>{const s=r.s,o=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,i=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(e,n){const i=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),nt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,e._queryObject,n)}sendUnlisten_(e,n,i,r){this.log_("Unlisten on "+e+" for "+n);const s={p:e},o="n";r&&(s.q=i,s.t=r),this.sendRequest(o,s)}onDisconnectPut(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:i})}onDisconnectMerge(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:i})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,i,r){const s={p:n,d:i};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,n,i,r){this.putInternal("p",e,n,i,r)}merge(e,n,i,r){this.putInternal("m",e,n,i,r)}putInternal(e,n,i,r,s){this.initConnection_();const o={p:n,d:i};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,i,s=>{this.log_(n+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){const s=i.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ki(e));const n=e.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):f9("Unrecognized action received from server: "+Ki(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){nt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Wh,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Wh,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>$j&&(this.reconnectDelay_=Wh),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*qj)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Pl.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,i())},g=function(u){nt(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:g};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[u,I]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);o?Tr("getToken() completed but was canceled"):(Tr("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=I&&I.token,a=new Dj(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,h=>{Rs(h+" ("+this.repoInfo_.toString()+")"),this.interrupt(eq)},s))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&Rs(u),l())}}}interrupt(e){Tr("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Tr("Resuming connection for reason: "+e),delete this.interruptReasons_[e],M6(this.interruptReasons_)&&(this.reconnectDelay_=Wh,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let i;n?i=n.map(s=>mR(s)).join("$"):i="default";const r=this.removeListen_(e,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,n){const i=new Nn(e).toString();let r;if(this.listens.has(i)){const s=this.listens.get(i);r=s.get(n),s.delete(n),s.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(e,n){Tr("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=n8&&(this.reconnectDelay_=t8,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Tr("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=n8&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+CL.replace(/\./g,"-")]=1,oL()?e["framework.cordova"]=1:kQ()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=eb.getInstance().currentlyOnline();return M6(this.interruptReasons_)&&e}}Pl.nextPersistentConnectionId_=0;Pl.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new $t(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const i=new $t(fA,e),r=new $t(fA,n);return this.compare(i,r)!==0}minPost(){return $t.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let um;class UL extends Iv{static get __EMPTY_NODE(){return um}static set __EMPTY_NODE(e){um=e}compare(e,n){return kA(e.name,n.name)}isDefinedOn(e){throw VA("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return $t.MIN}maxPost(){return new $t(tI,um)}makePost(e,n){return nt(typeof e=="string","KeyIndex indexValue must always be a string."),new $t(e,um)}toString(){return".key"}}const tA=new UL;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im{constructor(e,n,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class sr{constructor(e,n,i,r,s){this.key=e,this.value=n,this.color=i??sr.RED,this.left=r??Bs.EMPTY_NODE,this.right=s??Bs.EMPTY_NODE}copy(e,n,i,r,s){return new sr(e??this.key,n??this.value,i??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let r=this;const s=i(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,n,i),null):s===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,n,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Bs.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let i,r;if(i=this,n(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(e,i.key)===0){if(i.right.isEmpty())return Bs.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,sr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,sr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}sr.RED=!0;sr.BLACK=!1;class tq{copy(e,n,i,r,s){return this}insert(e,n,i){return new sr(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Bs{constructor(e,n=Bs.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Bs(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,sr.BLACK,null,null))}remove(e){return new Bs(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,sr.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,r=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Im(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Im(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Im(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Im(this.root_,null,this.comparator_,!0,e)}}Bs.EMPTY_NODE=new tq;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nq(t,e){return kA(t.name,e.name)}function GR(t,e){return kA(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m9;function iq(t){m9=t}const DL=function(t){return typeof t=="number"?"number:"+vL(t):"string:"+t},PL=function(t){if(t.isLeafNode()){const e=t.val();nt(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ag(e,".sv"),"Priority must be a string or number.")}else nt(t===m9||t.isEmpty(),"priority of unexpected type.");nt(t===m9||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let i8;class ir{constructor(e,n=ir.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,nt(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),PL(this.priorityNode_)}static set __childrenNodeConstructor(e){i8=e}static get __childrenNodeConstructor(){return i8}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ir(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ir.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return nn(e)?this:rn(e)===".priority"?this.priorityNode_:ir.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:ir.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const i=rn(e);return i===null?n:n.isEmpty()&&i!==".priority"?this:(nt(i!==".priority"||uc(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,ir.__childrenNodeConstructor.EMPTY_NODE.updateChild(kn(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+DL(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=vL(this.value_):e+=this.value_,this.lazyHash_=pL(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ir.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ir.__childrenNodeConstructor?-1:(nt(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,i=typeof this.value_,r=ir.VALUE_TYPE_ORDER.indexOf(n),s=ir.VALUE_TYPE_ORDER.indexOf(i);return nt(r>=0,"Unknown leaf type: "+n),nt(s>=0,"Unknown leaf type: "+i),r===s?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}ir.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let OL,QL;function rq(t){OL=t}function sq(t){QL=t}class oq extends Iv{compare(e,n){const i=e.node.getPriority(),r=n.node.getPriority(),s=i.compareTo(r);return s===0?kA(e.name,n.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return $t.MIN}maxPost(){return new $t(tI,new ir("[PRIORITY-POST]",QL))}makePost(e,n){const i=OL(e);return new $t(n,new ir("[PRIORITY-POST]",i))}toString(){return".priority"}}const mi=new oq;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aq=Math.log(2);class lq{constructor(e){const n=s=>parseInt(Math.log(s)/aq,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const tb=function(t,e,n,i){t.sort(e);const r=function(l,g){const c=g-l;let u,I;if(c===0)return null;if(c===1)return u=t[l],I=n?n(u):u,new sr(I,u.node,sr.BLACK,null,null);{const h=parseInt(c/2,10)+l,C=r(l,h),b=r(h+1,g);return u=t[h],I=n?n(u):u,new sr(I,u.node,sr.BLACK,C,b)}},s=function(l){let g=null,c=null,u=t.length;const I=function(C,b){const m=u-C,f=u;u-=C;const p=r(m+1,f),v=t[m],B=n?n(v):v;h(new sr(B,v.node,b,null,p))},h=function(C){g?(g.left=C,g=C):(c=C,g=C)};for(let C=0;C<l.count;++C){const b=l.nextBitIsOne(),m=Math.pow(2,l.count-(C+1));b?I(m,sr.BLACK):(I(m,sr.BLACK),I(m,sr.RED))}return c},o=new lq(t.length),a=s(o);return new Bs(i||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S5;const UI={};class Xl{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return nt(UI&&mi,"ChildrenNode.ts has not been loaded"),S5=S5||new Xl({".priority":UI},{".priority":mi}),S5}get(e){const n=CA(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Bs?n:null}hasIndex(e){return ag(this.indexSet_,e.toString())}addIndex(e,n){nt(e!==tA,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let r=!1;const s=n.getIterator($t.Wrap);let o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=tb(i,e.getCompare()):a=UI;const l=e.toString(),g=Object.assign({},this.indexSet_);g[l]=e;const c=Object.assign({},this.indexes_);return c[l]=a,new Xl(c,g)}addToIndexes(e,n){const i=J3(this.indexes_,(r,s)=>{const o=CA(this.indexSet_,s);if(nt(o,"Missing index implementation for "+s),r===UI)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator($t.Wrap);let g=l.getNext();for(;g;)g.name!==e.name&&a.push(g),g=l.getNext();return a.push(e),tb(a,o.getCompare())}else return UI;else{const a=n.get(e.name);let l=r;return a&&(l=l.remove(new $t(e.name,a))),l.insert(e,e.node)}});return new Xl(i,this.indexSet_)}removeFromIndexes(e,n){const i=J3(this.indexes_,r=>{if(r===UI)return r;{const s=n.get(e.name);return s?r.remove(new $t(e.name,s)):r}});return new Xl(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nh;class Wt{constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&PL(this.priorityNode_),this.children_.isEmpty()&&nt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Nh||(Nh=new Wt(new Bs(GR),null,Xl.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Nh}updatePriority(e){return this.children_.isEmpty()?this:new Wt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Nh:n}}getChild(e){const n=rn(e);return n===null?this:this.getImmediateChild(n).getChild(kn(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(nt(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const i=new $t(e,n);let r,s;n.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(i,this.children_));const o=r.isEmpty()?Nh:this.priorityNode_;return new Wt(r,o,s)}}updateChild(e,n){const i=rn(e);if(i===null)return n;{nt(rn(e)!==".priority"||uc(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(i).updateChild(kn(e),n);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let i=0,r=0,s=!0;if(this.forEachChild(mi,(o,a)=>{n[o]=a.val(e),i++,s&&Wt.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):s=!1}),!e&&s&&r<2*i){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+DL(this.getPriority().val())+":"),this.forEachChild(mi,(n,i)=>{const r=i.hash();r!==""&&(e+=":"+n+":"+r)}),this.lazyHash_=e===""?"":pL(e)}return this.lazyHash_}getPredecessorChildName(e,n,i){const r=this.resolveIndex_(i);if(r){const s=r.getPredecessorKey(new $t(e,n));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new $t(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new $t(n,this.children_.get(n)):null}forEachChild(e,n){const i=this.resolveIndex_(e);return i?i.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,$t.Wrap);let s=r.peek();for(;s!=null&&n.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,$t.Wrap);let s=r.peek();for(;s!=null&&n.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===f0?-1:0}withIndex(e){if(e===tA||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Wt(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===tA||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const i=this.getIterator(mi),r=n.getIterator(mi);let s=i.getNext(),o=r.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=i.getNext(),o=r.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===tA?null:this.indexMap_.get(e.toString())}}Wt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class gq extends Wt{constructor(){super(new Bs(GR),Wt.EMPTY_NODE,Xl.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Wt.EMPTY_NODE}isEmpty(){return!1}}const f0=new gq;Object.defineProperties($t,{MIN:{value:new $t(fA,Wt.EMPTY_NODE)},MAX:{value:new $t(tI,f0)}});UL.__EMPTY_NODE=Wt.EMPTY_NODE;ir.__childrenNodeConstructor=Wt;iq(f0);sq(f0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cq=!0;function or(t,e=null){if(t===null)return Wt.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),nt(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new ir(n,or(e))}if(!(t instanceof Array)&&cq){const n=[];let i=!1;if(Zs(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=or(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),n.push(new $t(o,l)))}}),n.length===0)return Wt.EMPTY_NODE;const s=tb(n,nq,o=>o.name,GR);if(i){const o=tb(n,mi.getCompare());return new Wt(s,or(e),new Xl({".priority":o},{".priority":mi}))}else return new Wt(s,or(e),Xl.Default)}else{let n=Wt.EMPTY_NODE;return Zs(t,(i,r)=>{if(ag(t,i)&&i.substring(0,1)!=="."){const s=or(r);(s.isLeafNode()||!s.isEmpty())&&(n=n.updateImmediateChild(i,s))}}),n.updatePriority(or(e))}}rq(or);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uq extends Iv{constructor(e){super(),this.indexPath_=e,nt(!nn(e)&&rn(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const i=this.extractChild(e.node),r=this.extractChild(n.node),s=i.compareTo(r);return s===0?kA(e.name,n.name):s}makePost(e,n){const i=or(e),r=Wt.EMPTY_NODE.updateChild(this.indexPath_,i);return new $t(n,r)}maxPost(){const e=Wt.EMPTY_NODE.updateChild(this.indexPath_,f0);return new $t(tI,e)}toString(){return XL(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iq extends Iv{compare(e,n){const i=e.node.compareTo(n.node);return i===0?kA(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return $t.MIN}maxPost(){return $t.MAX}makePost(e,n){const i=or(e);return new $t(n,i)}toString(){return".value"}}const dq=new Iq;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JL(t){return{type:"value",snapshotNode:t}}function pA(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Cf(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function ff(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Aq(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e){this.index_=e}updateChild(e,n,i,r,s,o){nt(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(Cf(n,a)):nt(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(pA(n,i)):o.trackChildChange(ff(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(mi,(r,s)=>{n.hasChild(r)||i.trackChildChange(Cf(r,s))}),n.isLeafNode()||n.forEachChild(mi,(r,s)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(ff(r,s,o))}else i.trackChildChange(pA(r,s))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Wt.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e){this.indexedFilter_=new SR(e.getIndex()),this.index_=e.getIndex(),this.startPost_=pf.getStartPost_(e),this.endPost_=pf.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,r,s,o){return this.matches(new $t(n,i))||(i=Wt.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,r,s,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=Wt.EMPTY_NODE);let r=n.withIndex(this.index_);r=r.updatePriority(Wt.EMPTY_NODE);const s=this;return n.forEachChild(mi,(o,a)=>{s.matches(new $t(o,a))||(r=r.updateImmediateChild(o,Wt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hq{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{const i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new pf(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,r,s,o){return this.rangedFilter_.matches(new $t(n,i))||(i=Wt.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,r,s,o):this.fullLimitUpdateChild_(e,n,i,s,o)}updateFullNode(e,n,i){let r;if(n.isLeafNode()||n.isEmpty())r=Wt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){r=Wt.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=n.withIndex(this.index_),r=r.updatePriority(Wt.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,Wt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,r,s){let o;if(this.reverse_){const u=this.index_.getCompare();o=(I,h)=>u(h,I)}else o=this.index_.getCompare();const a=e;nt(a.numChildren()===this.limit_,"");const l=new $t(n,i),g=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),c=this.rangedFilter_.matches(l);if(a.hasChild(n)){const u=a.getImmediateChild(n);let I=r.getChildAfterChild(this.index_,g,this.reverse_);for(;I!=null&&(I.name===n||a.hasChild(I.name));)I=r.getChildAfterChild(this.index_,I,this.reverse_);const h=I==null?1:o(I,l);if(c&&!i.isEmpty()&&h>=0)return s!=null&&s.trackChildChange(ff(n,i,u)),a.updateImmediateChild(n,i);{s!=null&&s.trackChildChange(Cf(n,u));const b=a.updateImmediateChild(n,Wt.EMPTY_NODE);return I!=null&&this.rangedFilter_.matches(I)?(s!=null&&s.trackChildChange(pA(I.name,I.node)),b.updateImmediateChild(I.name,I.node)):b}}else return i.isEmpty()?e:c&&o(g,l)>=0?(s!=null&&(s.trackChildChange(Cf(g.name,g.node)),s.trackChildChange(pA(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(g.name,Wt.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=mi}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return nt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return nt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fA}hasEnd(){return this.endSet_}getIndexEndValue(){return nt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return nt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:tI}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return nt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===mi}copy(){const e=new wR;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Cq(t){return t.loadsAllData()?new SR(t.getIndex()):t.hasLimit()?new hq(t):new pf(t)}function r8(t){const e={};if(t.isDefault())return e;let n;if(t.index_===mi?n="$priority":t.index_===dq?n="$value":t.index_===tA?n="$key":(nt(t.index_ instanceof uq,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Ki(n),t.startSet_){const i=t.startAfterSet_?"startAfter":"startAt";e[i]=Ki(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+Ki(t.indexStartName_))}if(t.endSet_){const i=t.endBeforeSet_?"endBefore":"endAt";e[i]=Ki(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+Ki(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function s8(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==mi&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb extends kL{constructor(e,n,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=C0("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(nt(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,i,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=nb.getListenId_(e,i),a={};this.listens_[o]=a;const l=r8(e._queryParams);this.restRequest_(s+".json",l,(g,c)=>{let u=c;if(g===404&&(u=null,g=null),g===null&&this.onDataUpdate_(s,u,!1,i),CA(this.listens_,o)===a){let I;g?g===401?I="permission_denied":I="rest_error:"+g:I="ok",r(I,null)}})}unlisten(e,n){const i=nb.getListenId_(e,n);delete this.listens_[i]}get(e){const n=r8(e._queryParams),i=e._path.toString(),r=new cv;return this.restRequest_(i+".json",n,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(n.auth=r.accessToken),s&&s.token&&(n.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+DQ(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=If(a.responseText)}catch{Rs("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&Rs("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fq{constructor(){this.rootNode_=Wt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ib(){return{value:null,children:new Map}}function jL(t,e,n){if(nn(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const i=rn(e);t.children.has(i)||t.children.set(i,ib());const r=t.children.get(i);e=kn(e),jL(r,e,n)}}function b9(t,e,n){t.value!==null?n(e,t.value):pq(t,(i,r)=>{const s=new Nn(e.toString()+"/"+i);b9(r,s,n)})}function pq(t,e){t.children.forEach((n,i)=>{e(i,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mq{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Zs(this.last_,(i,r)=>{n[i]=n[i]-r}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o8=10*1e3,bq=30*1e3,vq=5*60*1e3;class yq{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new mq(e);const i=o8+(bq-o8)*Math.random();xC(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),n={};let i=!1;Zs(e,(r,s)=>{s>0&&ag(this.statsToReport_,r)&&(n[r]=s,i=!0)}),i&&this.server_.reportStats(n),xC(this.reportStats_.bind(this),Math.floor(Math.random()*2*vq))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var aa;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(aa||(aa={}));function qL(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function RR(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function xR(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=aa.ACK_USER_WRITE,this.source=qL()}operationForChild(e){if(nn(this.path)){if(this.affectedTree.value!=null)return nt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Nn(e));return new rb(Cn(),n,this.revert)}}else return nt(rn(this.path)===e,"operationForChild called for unrelated child."),new rb(kn(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e,n){this.source=e,this.path=n,this.type=aa.LISTEN_COMPLETE}operationForChild(e){return nn(this.path)?new mf(this.source,Cn()):new mf(this.source,kn(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=aa.OVERWRITE}operationForChild(e){return nn(this.path)?new nI(this.source,Cn(),this.snap.getImmediateChild(e)):new nI(this.source,kn(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=aa.MERGE}operationForChild(e){if(nn(this.path)){const n=this.children.subtree(new Nn(e));return n.isEmpty()?null:n.value?new nI(this.source,Cn(),n.value):new bf(this.source,Cn(),n)}else return nt(rn(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new bf(this.source,kn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(nn(e))return this.isFullyInitialized()&&!this.filtered_;const n=rn(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bq{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Gq(t,e,n,i){const r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Aq(o.childName,o.snapshotNode))}),Mh(t,r,"child_removed",e,i,n),Mh(t,r,"child_added",e,i,n),Mh(t,r,"child_moved",s,i,n),Mh(t,r,"child_changed",e,i,n),Mh(t,r,"value",e,i,n),r}function Mh(t,e,n,i,r,s){const o=i.filter(a=>a.type===n);o.sort((a,l)=>wq(t,a,l)),o.forEach(a=>{const l=Sq(t,a,s);r.forEach(g=>{g.respondsTo(a.type)&&e.push(g.createEvent(l,t.query_))})})}function Sq(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function wq(t,e,n){if(e.childName==null||n.childName==null)throw VA("Should only compare child_ events.");const i=new $t(e.childName,e.snapshotNode),r=new $t(n.childName,n.snapshotNode);return t.index_.compare(i,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dv(t,e){return{eventCache:t,serverCache:e}}function ZC(t,e,n,i){return dv(new Ic(e,n,i),t.serverCache)}function $L(t,e,n,i){return dv(t.eventCache,new Ic(e,n,i))}function sb(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function iI(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let w5;const Rq=()=>(w5||(w5=new Bs(Ij)),w5);class Dn{constructor(e,n=Rq()){this.value=e,this.children=n}static fromObject(e){let n=new Dn(null);return Zs(e,(i,r)=>{n=n.set(new Nn(i),r)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Cn(),value:this.value};if(nn(e))return null;{const i=rn(e),r=this.children.get(i);if(r!==null){const s=r.findRootMostMatchingPathAndValue(kn(e),n);return s!=null?{path:zi(new Nn(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(nn(e))return this;{const n=rn(e),i=this.children.get(n);return i!==null?i.subtree(kn(e)):new Dn(null)}}set(e,n){if(nn(e))return new Dn(n,this.children);{const i=rn(e),s=(this.children.get(i)||new Dn(null)).set(kn(e),n),o=this.children.insert(i,s);return new Dn(this.value,o)}}remove(e){if(nn(e))return this.children.isEmpty()?new Dn(null):new Dn(null,this.children);{const n=rn(e),i=this.children.get(n);if(i){const r=i.remove(kn(e));let s;return r.isEmpty()?s=this.children.remove(n):s=this.children.insert(n,r),this.value===null&&s.isEmpty()?new Dn(null):new Dn(this.value,s)}else return this}}get(e){if(nn(e))return this.value;{const n=rn(e),i=this.children.get(n);return i?i.get(kn(e)):null}}setTree(e,n){if(nn(e))return n;{const i=rn(e),s=(this.children.get(i)||new Dn(null)).setTree(kn(e),n);let o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new Dn(this.value,o)}}fold(e){return this.fold_(Cn(),e)}fold_(e,n){const i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(zi(e,r),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,Cn(),n)}findOnPath_(e,n,i){const r=this.value?i(n,this.value):!1;if(r)return r;if(nn(e))return null;{const s=rn(e),o=this.children.get(s);return o?o.findOnPath_(kn(e),zi(n,s),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Cn(),n)}foreachOnPath_(e,n,i){if(nn(e))return this;{this.value&&i(n,this.value);const r=rn(e),s=this.children.get(r);return s?s.foreachOnPath_(kn(e),zi(n,r),i):new Dn(null)}}foreach(e){this.foreach_(Cn(),e)}foreach_(e,n){this.children.inorderTraversal((i,r)=>{r.foreach_(zi(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e){this.writeTree_=e}static empty(){return new ca(new Dn(null))}}function EC(t,e,n){if(nn(e))return new ca(new Dn(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){const r=i.path;let s=i.value;const o=$r(r,e);return s=s.updateChild(o,n),new ca(t.writeTree_.set(r,s))}else{const r=new Dn(n),s=t.writeTree_.setTree(e,r);return new ca(s)}}}function a8(t,e,n){let i=t;return Zs(n,(r,s)=>{i=EC(i,zi(e,r),s)}),i}function l8(t,e){if(nn(e))return ca.empty();{const n=t.writeTree_.setTree(e,new Dn(null));return new ca(n)}}function v9(t,e){return pI(t,e)!=null}function pI(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild($r(n.path,e)):null}function g8(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(mi,(i,r)=>{e.push(new $t(i,r))}):t.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new $t(i,r.value))}),e}function nc(t,e){if(nn(e))return t;{const n=pI(t,e);return n!=null?new ca(new Dn(n)):new ca(t.writeTree_.subtree(e))}}function y9(t){return t.writeTree_.isEmpty()}function mA(t,e){return ek(Cn(),t.writeTree_,e)}function ek(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(nt(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):n=ek(zi(t,r),s,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(zi(t,".priority"),i)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Av(t,e){return rk(e,t)}function xq(t,e,n,i,r){nt(i>t.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:r}),r&&(t.visibleWrites=EC(t.visibleWrites,e,n)),t.lastWriteId=i}function Zq(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}function Eq(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);nt(n>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[n];t.allWrites.splice(n,1);let r=i.visible,s=!1,o=t.allWrites.length-1;for(;r&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&Wq(a,i.path)?r=!1:oa(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return Nq(t),!0;if(i.snap)t.visibleWrites=l8(t.visibleWrites,i.path);else{const a=i.children;Zs(a,l=>{t.visibleWrites=l8(t.visibleWrites,zi(i.path,l))})}return!0}else return!1}function Wq(t,e){if(t.snap)return oa(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&oa(zi(t.path,n),e))return!0;return!1}function Nq(t){t.visibleWrites=tk(t.allWrites,Mq,Cn()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Mq(t){return t.visible}function tk(t,e,n){let i=ca.empty();for(let r=0;r<t.length;++r){const s=t[r];if(e(s)){const o=s.path;let a;if(s.snap)oa(n,o)?(a=$r(n,o),i=EC(i,a,s.snap)):oa(o,n)&&(a=$r(o,n),i=EC(i,Cn(),s.snap.getChild(a)));else if(s.children){if(oa(n,o))a=$r(n,o),i=a8(i,a,s.children);else if(oa(o,n))if(a=$r(o,n),nn(a))i=a8(i,Cn(),s.children);else{const l=CA(s.children,rn(a));if(l){const g=l.getChild(kn(a));i=EC(i,Cn(),g)}}}else throw VA("WriteRecord should have .snap or .children")}}return i}function nk(t,e,n,i,r){if(!i&&!r){const s=pI(t.visibleWrites,e);if(s!=null)return s;{const o=nc(t.visibleWrites,e);if(y9(o))return n;if(n==null&&!v9(o,Cn()))return null;{const a=n||Wt.EMPTY_NODE;return mA(o,a)}}}else{const s=nc(t.visibleWrites,e);if(!r&&y9(s))return n;if(!r&&n==null&&!v9(s,Cn()))return null;{const o=function(g){return(g.visible||r)&&(!i||!~i.indexOf(g.writeId))&&(oa(g.path,e)||oa(e,g.path))},a=tk(t.allWrites,o,e),l=n||Wt.EMPTY_NODE;return mA(a,l)}}}function Tq(t,e,n){let i=Wt.EMPTY_NODE;const r=pI(t.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(mi,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(n){const s=nc(t.visibleWrites,e);return n.forEachChild(mi,(o,a)=>{const l=mA(nc(s,new Nn(o)),a);i=i.updateImmediateChild(o,l)}),g8(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const s=nc(t.visibleWrites,e);return g8(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Fq(t,e,n,i,r){nt(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=zi(e,n);if(v9(t.visibleWrites,s))return null;{const o=nc(t.visibleWrites,s);return y9(o)?r.getChild(n):mA(o,r.getChild(n))}}function Vq(t,e,n,i){const r=zi(e,n),s=pI(t.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(n)){const o=nc(t.visibleWrites,r);return mA(o,i.getNode().getImmediateChild(n))}else return null}function Lq(t,e){return pI(t.visibleWrites,e)}function kq(t,e,n,i,r,s,o){let a;const l=nc(t.visibleWrites,e),g=pI(l,Cn());if(g!=null)a=g;else if(n!=null)a=mA(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const c=[],u=o.getCompare(),I=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let h=I.getNext();for(;h&&c.length<r;)u(h,i)!==0&&c.push(h),h=I.getNext();return c}else return[]}function Hq(){return{visibleWrites:ca.empty(),allWrites:[],lastWriteId:-1}}function ob(t,e,n,i){return nk(t.writeTree,t.treePath,e,n,i)}function ZR(t,e){return Tq(t.writeTree,t.treePath,e)}function c8(t,e,n,i){return Fq(t.writeTree,t.treePath,e,n,i)}function ab(t,e){return Lq(t.writeTree,zi(t.treePath,e))}function _q(t,e,n,i,r,s){return kq(t.writeTree,t.treePath,e,n,i,r,s)}function ER(t,e,n){return Vq(t.writeTree,t.treePath,e,n)}function ik(t,e){return rk(zi(t.treePath,e),t.writeTree)}function rk(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xq{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,i=e.childName;nt(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),nt(i!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(i);if(r){const s=r.type;if(n==="child_added"&&s==="child_removed")this.changeMap.set(i,ff(i,e.snapshotNode,r.snapshotNode));else if(n==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&s==="child_changed")this.changeMap.set(i,Cf(i,r.oldSnap));else if(n==="child_changed"&&s==="child_added")this.changeMap.set(i,pA(i,e.snapshotNode));else if(n==="child_changed"&&s==="child_changed")this.changeMap.set(i,ff(i,e.snapshotNode,r.oldSnap));else throw VA("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yq{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}}const sk=new Yq;class WR{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new Ic(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ER(this.writes_,e,i)}}getChildAfterChild(e,n,i){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:iI(this.viewCache_),s=_q(this.writes_,r,n,1,i,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kq(t){return{filter:t}}function zq(t,e){nt(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),nt(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function Uq(t,e,n,i,r){const s=new Xq;let o,a;if(n.type===aa.OVERWRITE){const g=n;g.source.fromUser?o=B9(t,e,g.path,g.snap,i,r,s):(nt(g.source.fromServer,"Unknown source."),a=g.source.tagged||e.serverCache.isFiltered()&&!nn(g.path),o=lb(t,e,g.path,g.snap,i,r,a,s))}else if(n.type===aa.MERGE){const g=n;g.source.fromUser?o=Pq(t,e,g.path,g.children,i,r,s):(nt(g.source.fromServer,"Unknown source."),a=g.source.tagged||e.serverCache.isFiltered(),o=G9(t,e,g.path,g.children,i,r,a,s))}else if(n.type===aa.ACK_USER_WRITE){const g=n;g.revert?o=Jq(t,e,g.path,i,r,s):o=Oq(t,e,g.path,g.affectedTree,i,r,s)}else if(n.type===aa.LISTEN_COMPLETE)o=Qq(t,e,n.path,i,s);else throw VA("Unknown operation type: "+n.type);const l=s.getChanges();return Dq(e,o,l),{viewCache:o,changes:l}}function Dq(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=sb(t);(n.length>0||!t.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(JL(sb(e)))}}function ok(t,e,n,i,r,s){const o=e.eventCache;if(ab(i,n)!=null)return e;{let a,l;if(nn(n))if(nt(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const g=iI(e),c=g instanceof Wt?g:Wt.EMPTY_NODE,u=ZR(i,c);a=t.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{const g=ob(i,iI(e));a=t.filter.updateFullNode(e.eventCache.getNode(),g,s)}else{const g=rn(n);if(g===".priority"){nt(uc(n)===1,"Can't have a priority with additional path components");const c=o.getNode();l=e.serverCache.getNode();const u=c8(i,n,c,l);u!=null?a=t.filter.updatePriority(c,u):a=o.getNode()}else{const c=kn(n);let u;if(o.isCompleteForChild(g)){l=e.serverCache.getNode();const I=c8(i,n,o.getNode(),l);I!=null?u=o.getNode().getImmediateChild(g).updateChild(c,I):u=o.getNode().getImmediateChild(g)}else u=ER(i,g,e.serverCache);u!=null?a=t.filter.updateChild(o.getNode(),g,u,c,r,s):a=o.getNode()}}return ZC(e,a,o.isFullyInitialized()||nn(n),t.filter.filtersNodes())}}function lb(t,e,n,i,r,s,o,a){const l=e.serverCache;let g;const c=o?t.filter:t.filter.getIndexedFilter();if(nn(n))g=c.updateFullNode(l.getNode(),i,null);else if(c.filtersNodes()&&!l.isFiltered()){const h=l.getNode().updateChild(n,i);g=c.updateFullNode(l.getNode(),h,null)}else{const h=rn(n);if(!l.isCompleteForPath(n)&&uc(n)>1)return e;const C=kn(n),m=l.getNode().getImmediateChild(h).updateChild(C,i);h===".priority"?g=c.updatePriority(l.getNode(),m):g=c.updateChild(l.getNode(),h,m,C,sk,null)}const u=$L(e,g,l.isFullyInitialized()||nn(n),c.filtersNodes()),I=new WR(r,u,s);return ok(t,u,n,r,I,a)}function B9(t,e,n,i,r,s,o){const a=e.eventCache;let l,g;const c=new WR(r,e,s);if(nn(n))g=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=ZC(e,g,!0,t.filter.filtersNodes());else{const u=rn(n);if(u===".priority")g=t.filter.updatePriority(e.eventCache.getNode(),i),l=ZC(e,g,a.isFullyInitialized(),a.isFiltered());else{const I=kn(n),h=a.getNode().getImmediateChild(u);let C;if(nn(I))C=i;else{const b=c.getCompleteChild(u);b!=null?_L(I)===".priority"&&b.getChild(YL(I)).isEmpty()?C=b:C=b.updateChild(I,i):C=Wt.EMPTY_NODE}if(h.equals(C))l=e;else{const b=t.filter.updateChild(a.getNode(),u,C,I,c,o);l=ZC(e,b,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function u8(t,e){return t.eventCache.isCompleteForChild(e)}function Pq(t,e,n,i,r,s,o){let a=e;return i.foreach((l,g)=>{const c=zi(n,l);u8(e,rn(c))&&(a=B9(t,a,c,g,r,s,o))}),i.foreach((l,g)=>{const c=zi(n,l);u8(e,rn(c))||(a=B9(t,a,c,g,r,s,o))}),a}function I8(t,e,n){return n.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function G9(t,e,n,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,g;nn(n)?g=i:g=new Dn(null).setTree(n,i);const c=e.serverCache.getNode();return g.children.inorderTraversal((u,I)=>{if(c.hasChild(u)){const h=e.serverCache.getNode().getImmediateChild(u),C=I8(t,h,I);l=lb(t,l,new Nn(u),C,r,s,o,a)}}),g.children.inorderTraversal((u,I)=>{const h=!e.serverCache.isCompleteForChild(u)&&I.value===null;if(!c.hasChild(u)&&!h){const C=e.serverCache.getNode().getImmediateChild(u),b=I8(t,C,I);l=lb(t,l,new Nn(u),b,r,s,o,a)}}),l}function Oq(t,e,n,i,r,s,o){if(ab(r,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(nn(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return lb(t,e,n,l.getNode().getChild(n),r,s,a,o);if(nn(n)){let g=new Dn(null);return l.getNode().forEachChild(tA,(c,u)=>{g=g.set(new Nn(c),u)}),G9(t,e,n,g,r,s,a,o)}else return e}else{let g=new Dn(null);return i.foreach((c,u)=>{const I=zi(n,c);l.isCompleteForPath(I)&&(g=g.set(c,l.getNode().getChild(I)))}),G9(t,e,n,g,r,s,a,o)}}function Qq(t,e,n,i,r){const s=e.serverCache,o=$L(e,s.getNode(),s.isFullyInitialized()||nn(n),s.isFiltered());return ok(t,o,n,i,sk,r)}function Jq(t,e,n,i,r,s){let o;if(ab(i,n)!=null)return e;{const a=new WR(i,e,r),l=e.eventCache.getNode();let g;if(nn(n)||rn(n)===".priority"){let c;if(e.serverCache.isFullyInitialized())c=ob(i,iI(e));else{const u=e.serverCache.getNode();nt(u instanceof Wt,"serverChildren would be complete if leaf node"),c=ZR(i,u)}c=c,g=t.filter.updateFullNode(l,c,s)}else{const c=rn(n);let u=ER(i,c,e.serverCache);u==null&&e.serverCache.isCompleteForChild(c)&&(u=l.getImmediateChild(c)),u!=null?g=t.filter.updateChild(l,c,u,kn(n),a,s):e.eventCache.getNode().hasChild(c)?g=t.filter.updateChild(l,c,Wt.EMPTY_NODE,kn(n),a,s):g=l,g.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ob(i,iI(e)),o.isLeafNode()&&(g=t.filter.updateFullNode(g,o,s)))}return o=e.serverCache.isFullyInitialized()||ab(i,Cn())!=null,ZC(e,g,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jq{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,r=new SR(i.getIndex()),s=Cq(i);this.processor_=Kq(s);const o=n.serverCache,a=n.eventCache,l=r.updateFullNode(Wt.EMPTY_NODE,o.getNode(),null),g=s.updateFullNode(Wt.EMPTY_NODE,a.getNode(),null),c=new Ic(l,o.isFullyInitialized(),r.filtersNodes()),u=new Ic(g,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=dv(u,c),this.eventGenerator_=new Bq(this.query_)}get query(){return this.query_}}function qq(t){return t.viewCache_.serverCache.getNode()}function $q(t){return sb(t.viewCache_)}function e$(t,e){const n=iI(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!nn(e)&&!n.getImmediateChild(rn(e)).isEmpty())?n.getChild(e):null}function d8(t){return t.eventRegistrations_.length===0}function t$(t,e){t.eventRegistrations_.push(e)}function A8(t,e,n){const i=[];if(n){nt(e==null,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(n,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<t.eventRegistrations_.length;++s){const o=t.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(t.eventRegistrations_.slice(s+1));break}}t.eventRegistrations_=r}else t.eventRegistrations_=[];return i}function h8(t,e,n,i){e.type===aa.MERGE&&e.source.queryId!==null&&(nt(iI(t.viewCache_),"We should always have a full cache before handling merges"),nt(sb(t.viewCache_),"Missing event cache, even though we have a server cache"));const r=t.viewCache_,s=Uq(t.processor_,r,e,n,i);return zq(t.processor_,s.viewCache),nt(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=s.viewCache,ak(t,s.changes,s.viewCache.eventCache.getNode(),null)}function n$(t,e){const n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(mi,(s,o)=>{i.push(pA(s,o))}),n.isFullyInitialized()&&i.push(JL(n.getNode())),ak(t,i,n.getNode(),e)}function ak(t,e,n,i){const r=i?[i]:t.eventRegistrations_;return Gq(t.eventGenerator_,e,n,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gb;class lk{constructor(){this.views=new Map}}function i$(t){nt(!gb,"__referenceConstructor has already been defined"),gb=t}function r$(){return nt(gb,"Reference.ts has not been loaded"),gb}function s$(t){return t.views.size===0}function NR(t,e,n,i){const r=e.source.queryId;if(r!==null){const s=t.views.get(r);return nt(s!=null,"SyncTree gave us an op for an invalid query."),h8(s,e,n,i)}else{let s=[];for(const o of t.views.values())s=s.concat(h8(o,e,n,i));return s}}function gk(t,e,n,i,r){const s=e._queryIdentifier,o=t.views.get(s);if(!o){let a=ob(n,r?i:null),l=!1;a?l=!0:i instanceof Wt?(a=ZR(n,i),l=!1):(a=Wt.EMPTY_NODE,l=!1);const g=dv(new Ic(a,l,!1),new Ic(i,r,!1));return new jq(e,g)}return o}function o$(t,e,n,i,r,s){const o=gk(t,e,i,r,s);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),t$(o,n),n$(o,n)}function a$(t,e,n,i){const r=e._queryIdentifier,s=[];let o=[];const a=dc(t);if(r==="default")for(const[l,g]of t.views.entries())o=o.concat(A8(g,n,i)),d8(g)&&(t.views.delete(l),g.query._queryParams.loadsAllData()||s.push(g.query));else{const l=t.views.get(r);l&&(o=o.concat(A8(l,n,i)),d8(l)&&(t.views.delete(r),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!dc(t)&&s.push(new(r$())(e._repo,e._path)),{removed:s,events:o}}function ck(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function ic(t,e){let n=null;for(const i of t.views.values())n=n||e$(i,e);return n}function uk(t,e){if(e._queryParams.loadsAllData())return hv(t);{const i=e._queryIdentifier;return t.views.get(i)}}function Ik(t,e){return uk(t,e)!=null}function dc(t){return hv(t)!=null}function hv(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cb;function l$(t){nt(!cb,"__referenceConstructor has already been defined"),cb=t}function g$(){return nt(cb,"Reference.ts has not been loaded"),cb}let c$=1;class C8{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Dn(null),this.pendingWriteTree_=Hq(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function dk(t,e,n,i,r){return xq(t.pendingWriteTree_,e,n,i,r),r?m0(t,new nI(qL(),e,n)):[]}function Zu(t,e,n=!1){const i=Zq(t.pendingWriteTree_,e);if(Eq(t.pendingWriteTree_,e)){let s=new Dn(null);return i.snap!=null?s=s.set(Cn(),!0):Zs(i.children,o=>{s=s.set(new Nn(o),!0)}),m0(t,new rb(i.path,s,n))}else return[]}function p0(t,e,n){return m0(t,new nI(RR(),e,n))}function u$(t,e,n){const i=Dn.fromObject(n);return m0(t,new bf(RR(),e,i))}function I$(t,e){return m0(t,new mf(RR(),e))}function d$(t,e,n){const i=TR(t,n);if(i){const r=FR(i),s=r.path,o=r.queryId,a=$r(s,e),l=new mf(xR(o),a);return VR(t,s,l)}else return[]}function Ak(t,e,n,i,r=!1){const s=e._path,o=t.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||Ik(o,e))){const l=a$(o,e,n,i);s$(o)&&(t.syncPointTree_=t.syncPointTree_.remove(s));const g=l.removed;if(a=l.events,!r){const c=g.findIndex(I=>I._queryParams.loadsAllData())!==-1,u=t.syncPointTree_.findOnPath(s,(I,h)=>dc(h));if(c&&!u){const I=t.syncPointTree_.subtree(s);if(!I.isEmpty()){const h=f$(I);for(let C=0;C<h.length;++C){const b=h[C],m=b.query,f=pk(t,b);t.listenProvider_.startListening(WC(m),vf(t,m),f.hashFn,f.onComplete)}}}!u&&g.length>0&&!i&&(c?t.listenProvider_.stopListening(WC(e),null):g.forEach(I=>{const h=t.queryToTagMap.get(Cv(I));t.listenProvider_.stopListening(WC(I),h)}))}p$(t,g)}return a}function hk(t,e,n,i){const r=TR(t,i);if(r!=null){const s=FR(r),o=s.path,a=s.queryId,l=$r(o,e),g=new nI(xR(a),l,n);return VR(t,o,g)}else return[]}function A$(t,e,n,i){const r=TR(t,i);if(r){const s=FR(r),o=s.path,a=s.queryId,l=$r(o,e),g=Dn.fromObject(n),c=new bf(xR(a),l,g);return VR(t,o,c)}else return[]}function h$(t,e,n,i=!1){const r=e._path;let s=null,o=!1;t.syncPointTree_.foreachOnPath(r,(I,h)=>{const C=$r(I,r);s=s||ic(h,C),o=o||dc(h)});let a=t.syncPointTree_.get(r);a?(o=o||dc(a),s=s||ic(a,Cn())):(a=new lk,t.syncPointTree_=t.syncPointTree_.set(r,a));let l;s!=null?l=!0:(l=!1,s=Wt.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild((h,C)=>{const b=ic(C,Cn());b&&(s=s.updateImmediateChild(h,b))}));const g=Ik(a,e);if(!g&&!e._queryParams.loadsAllData()){const I=Cv(e);nt(!t.queryToTagMap.has(I),"View does not exist, but we have a tag");const h=m$();t.queryToTagMap.set(I,h),t.tagToQueryMap.set(h,I)}const c=Av(t.pendingWriteTree_,r);let u=o$(a,e,n,c,s,l);if(!g&&!o&&!i){const I=uk(a,e);u=u.concat(b$(t,e,I))}return u}function MR(t,e,n){const r=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=$r(o,e),g=ic(a,l);if(g)return g});return nk(r,e,s,n,!0)}function C$(t,e){const n=e._path;let i=null;t.syncPointTree_.foreachOnPath(n,(g,c)=>{const u=$r(g,n);i=i||ic(c,u)});let r=t.syncPointTree_.get(n);r?i=i||ic(r,Cn()):(r=new lk,t.syncPointTree_=t.syncPointTree_.set(n,r));const s=i!=null,o=s?new Ic(i,!0,!1):null,a=Av(t.pendingWriteTree_,e._path),l=gk(r,e,a,s?o.getNode():Wt.EMPTY_NODE,s);return $q(l)}function m0(t,e){return Ck(e,t.syncPointTree_,null,Av(t.pendingWriteTree_,Cn()))}function Ck(t,e,n,i){if(nn(t.path))return fk(t,e,n,i);{const r=e.get(Cn());n==null&&r!=null&&(n=ic(r,Cn()));let s=[];const o=rn(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const g=n?n.getImmediateChild(o):null,c=ik(i,o);s=s.concat(Ck(a,l,g,c))}return r&&(s=s.concat(NR(r,t,i,n))),s}}function fk(t,e,n,i){const r=e.get(Cn());n==null&&r!=null&&(n=ic(r,Cn()));let s=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,g=ik(i,o),c=t.operationForChild(o);c&&(s=s.concat(fk(c,a,l,g)))}),r&&(s=s.concat(NR(r,t,i,n))),s}function pk(t,e){const n=e.query,i=vf(t,n);return{hashFn:()=>(qq(e)||Wt.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?d$(t,n._path,i):I$(t,n._path);{const s=hj(r,n);return Ak(t,n,null,s)}}}}function vf(t,e){const n=Cv(e);return t.queryToTagMap.get(n)}function Cv(t){return t._path.toString()+"$"+t._queryIdentifier}function TR(t,e){return t.tagToQueryMap.get(e)}function FR(t){const e=t.indexOf("$");return nt(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Nn(t.substr(0,e))}}function VR(t,e,n){const i=t.syncPointTree_.get(e);nt(i,"Missing sync point for query tag that we're tracking");const r=Av(t.pendingWriteTree_,e);return NR(i,n,r,null)}function f$(t){return t.fold((e,n,i)=>{if(n&&dc(n))return[hv(n)];{let r=[];return n&&(r=ck(n)),Zs(i,(s,o)=>{r=r.concat(o)}),r}})}function WC(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(g$())(t._repo,t._path):t}function p$(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const r=Cv(i),s=t.queryToTagMap.get(r);t.queryToTagMap.delete(r),t.tagToQueryMap.delete(s)}}}function m$(){return c$++}function b$(t,e,n){const i=e._path,r=vf(t,e),s=pk(t,n),o=t.listenProvider_.startListening(WC(e),r,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(i);if(r)nt(!dc(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((g,c,u)=>{if(!nn(g)&&c&&dc(c))return[hv(c).query];{let I=[];return c&&(I=I.concat(ck(c).map(h=>h.query))),Zs(u,(h,C)=>{I=I.concat(C)}),I}});for(let g=0;g<l.length;++g){const c=l[g];t.listenProvider_.stopListening(WC(c),vf(t,c))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new LR(n)}node(){return this.node_}}class kR{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=zi(this.path_,e);return new kR(this.syncTree_,n)}node(){return MR(this.syncTree_,this.path_)}}const v$=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},f8=function(t,e,n){if(!t||typeof t!="object")return t;if(nt(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return y$(t[".sv"],e,n);if(typeof t[".sv"]=="object")return B$(t[".sv"],e);nt(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},y$=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:nt(!1,"Unexpected server value: "+t)}},B$=function(t,e,n){t.hasOwnProperty("increment")||nt(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t.increment;typeof i!="number"&&nt(!1,"Unexpected increment value: "+i);const r=e.node();if(nt(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return typeof o!="number"?i:o+i},G$=function(t,e,n,i){return HR(e,new kR(n,t),i)},mk=function(t,e,n){return HR(t,new LR(e),n)};function HR(t,e,n){const i=t.getPriority().val(),r=f8(i,e.getImmediateChild(".priority"),n);let s;if(t.isLeafNode()){const o=t,a=f8(o.getValue(),e,n);return a!==o.getValue()||r!==o.getPriority().val()?new ir(a,or(r)):t}else{const o=t;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new ir(r))),o.forEachChild(mi,(a,l)=>{const g=HR(l,e.getImmediateChild(a),n);g!==l&&(s=s.updateImmediateChild(a,g))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _R=class{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}};function XR(t,e){let n=e instanceof Nn?e:new Nn(e),i=t,r=rn(n);for(;r!==null;){const s=CA(i.node.children,r)||{children:{},childCount:0};i=new _R(r,i,s),n=kn(n),r=rn(n)}return i}function _A(t){return t.node.value}function bk(t,e){t.node.value=e,S9(t)}function vk(t){return t.node.childCount>0}function S$(t){return _A(t)===void 0&&!vk(t)}function fv(t,e){Zs(t.node.children,(n,i)=>{e(new _R(n,t,i))})}function yk(t,e,n,i){n&&!i&&e(t),fv(t,r=>{yk(r,e,!0,i)}),n&&i&&e(t)}function w$(t,e,n){let i=n?t:t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function b0(t){return new Nn(t.parent===null?t.name:b0(t.parent)+"/"+t.name)}function S9(t){t.parent!==null&&R$(t.parent,t.name,t)}function R$(t,e,n){const i=S$(n),r=ag(t.node.children,e);i&&r?(delete t.node.children[e],t.node.childCount--,S9(t)):!i&&!r&&(t.node.children[e]=n.node,t.node.childCount++,S9(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x$=/[\[\].#$\/\u0000-\u001F\u007F]/,Z$=/[\[\].#$\u0000-\u001F\u007F]/,R5=10*1024*1024,Bk=function(t){return typeof t=="string"&&t.length!==0&&!x$.test(t)},Gk=function(t){return typeof t=="string"&&t.length!==0&&!Z$.test(t)},E$=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gk(t)},W$=function(t,e,n,i){i&&e===void 0||YR(fR(t,"value"),e,n)},YR=function(t,e,n){const i=n instanceof Nn?new Oj(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+uu(i));if(typeof e=="function")throw new Error(t+"contains a function "+uu(i)+" with contents = "+e.toString());if(mL(e))throw new Error(t+"contains "+e.toString()+" "+uu(i));if(typeof e=="string"&&e.length>R5/3&&uv(e)>R5)throw new Error(t+"contains a string greater than "+R5+" utf8 bytes "+uu(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(Zs(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Bk(o)))throw new Error(t+" contains an invalid key ("+o+") "+uu(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Qj(i,o),YR(t,a,i),Jj(i)}),r&&s)throw new Error(t+' contains ".value" child '+uu(i)+" in addition to actual children.")}},Sk=function(t,e,n,i){if(!(i&&n===void 0)&&!Gk(n))throw new Error(fR(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},N$=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Sk(t,e,n,i)},M$=function(t,e){if(rn(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},T$=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Bk(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!E$(n))throw new Error(fR(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F${constructor(){this.eventLists_=[],this.recursionDepth_=0}}function wk(t,e){let n=null;for(let i=0;i<e.length;i++){const r=e[i],s=r.getPath();n!==null&&!KL(s,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:s}),n.events.push(r)}n&&t.eventLists_.push(n)}function nl(t,e,n){wk(t,n),V$(t,i=>oa(i,e)||oa(e,i))}function V$(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const r=t.eventLists_[i];if(r){const s=r.path;e(s)?(L$(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function L$(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const i=n.getEventRunner();_u&&Tr("event: "+n.toString()),HA(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k$="repo_interrupt",H$=25;class _${constructor(e,n,i,r){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new F$,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ib(),this.transactionQueueTree_=new _R,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function X$(t,e,n){if(t.stats_=vR(t.repoInfo_),t.forceRestClient_||mj())t.server_=new nb(t.repoInfo_,(i,r,s,o)=>{p8(t,i,r,s,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>m8(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ki(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new Pl(t.repoInfo_,e,(i,r,s,o)=>{p8(t,i,r,s,o)},i=>{m8(t,i)},i=>{K$(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=Gj(t.repoInfo_,()=>new yq(t.stats_,t.server_)),t.infoData_=new fq,t.infoSyncTree_=new C8({startListening:(i,r,s,o)=>{let a=[];const l=t.infoData_.getNode(i._path);return l.isEmpty()||(a=p0(t.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),zR(t,"connected",!1),t.serverSyncTree_=new C8({startListening:(i,r,s,o)=>(t.server_.listen(i,s,r,(a,l)=>{const g=o(a,l);nl(t.eventQueue_,i._path,g)}),[]),stopListening:(i,r)=>{t.server_.unlisten(i,r)}})}function Y$(t){const n=t.infoData_.getNode(new Nn(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function KR(t){return v$({timestamp:Y$(t)})}function p8(t,e,n,i,r){t.dataUpdateCount++;const s=new Nn(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(r)if(i){const l=J3(n,g=>or(g));o=A$(t.serverSyncTree_,s,l,r)}else{const l=or(n);o=hk(t.serverSyncTree_,s,l,r)}else if(i){const l=J3(n,g=>or(g));o=u$(t.serverSyncTree_,s,l)}else{const l=or(n);o=p0(t.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=mv(t,s)),nl(t.eventQueue_,a,o)}function m8(t,e){zR(t,"connected",e),e===!1&&D$(t)}function K$(t,e){Zs(e,(n,i)=>{zR(t,n,i)})}function zR(t,e,n){const i=new Nn("/.info/"+e),r=or(n);t.infoData_.updateSnapshot(i,r);const s=p0(t.infoSyncTree_,i,r);nl(t.eventQueue_,i,s)}function Rk(t){return t.nextWriteId_++}function z$(t,e,n){const i=C$(t.serverSyncTree_,e);return i!=null?Promise.resolve(i):t.server_.get(e).then(r=>{const s=or(r).withIndex(e._queryParams.getIndex());h$(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=p0(t.serverSyncTree_,e._path,s);else{const a=vf(t.serverSyncTree_,e);o=hk(t.serverSyncTree_,e._path,s,a)}return nl(t.eventQueue_,e._path,o),Ak(t.serverSyncTree_,e,n,null,!0),s},r=>(pv(t,"get for query "+Ki(e)+" failed: "+r),Promise.reject(new Error(r))))}function U$(t,e,n,i,r){pv(t,"set",{path:e.toString(),value:n,priority:i});const s=KR(t),o=or(n,i),a=MR(t.serverSyncTree_,e),l=mk(o,a,s),g=Rk(t),c=dk(t.serverSyncTree_,e,l,g,!0);wk(t.eventQueue_,c),t.server_.put(e.toString(),o.val(!0),(I,h)=>{const C=I==="ok";C||Rs("set at "+e+" failed: "+I);const b=Zu(t.serverSyncTree_,g,!C);nl(t.eventQueue_,e,b),O$(t,r,I,h)});const u=Nk(t,e);mv(t,u),nl(t.eventQueue_,u,[])}function D$(t){pv(t,"onDisconnectEvents");const e=KR(t),n=ib();b9(t.onDisconnect_,Cn(),(r,s)=>{const o=G$(r,s,t.serverSyncTree_,e);jL(n,r,o)});let i=[];b9(n,Cn(),(r,s)=>{i=i.concat(p0(t.serverSyncTree_,r,s));const o=Nk(t,r);mv(t,o)}),t.onDisconnect_=ib(),nl(t.eventQueue_,Cn(),i)}function P$(t){t.persistentConnection_&&t.persistentConnection_.interrupt(k$)}function pv(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Tr(n,...e)}function O$(t,e,n,i){e&&HA(()=>{if(n==="ok")e(null);else{const r=(n||"error").toUpperCase();let s=r;i&&(s+=": "+i);const o=new Error(s);o.code=r,e(o)}})}function xk(t,e,n){return MR(t.serverSyncTree_,e,n)||Wt.EMPTY_NODE}function UR(t,e=t.transactionQueueTree_){if(e||bv(t,e),_A(e)){const n=Ek(t,e);nt(n.length>0,"Sending zero length transaction queue"),n.every(r=>r.status===0)&&Q$(t,b0(e),n)}else vk(e)&&fv(e,n=>{UR(t,n)})}function Q$(t,e,n){const i=n.map(g=>g.currentWriteId),r=xk(t,e,i);let s=r;const o=r.hash();for(let g=0;g<n.length;g++){const c=n[g];nt(c.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=1,c.retryCount++;const u=$r(e,c.path);s=s.updateChild(u,c.currentOutputSnapshotRaw)}const a=s.val(!0),l=e;t.server_.put(l.toString(),a,g=>{pv(t,"transaction put response",{path:l.toString(),status:g});let c=[];if(g==="ok"){const u=[];for(let I=0;I<n.length;I++)n[I].status=2,c=c.concat(Zu(t.serverSyncTree_,n[I].currentWriteId)),n[I].onComplete&&u.push(()=>n[I].onComplete(null,!0,n[I].currentOutputSnapshotResolved)),n[I].unwatcher();bv(t,XR(t.transactionQueueTree_,e)),UR(t,t.transactionQueueTree_),nl(t.eventQueue_,e,c);for(let I=0;I<u.length;I++)HA(u[I])}else{if(g==="datastale")for(let u=0;u<n.length;u++)n[u].status===3?n[u].status=4:n[u].status=0;else{Rs("transaction at "+l.toString()+" failed: "+g);for(let u=0;u<n.length;u++)n[u].status=4,n[u].abortReason=g}mv(t,e)}},o)}function mv(t,e){const n=Zk(t,e),i=b0(n),r=Ek(t,n);return J$(t,r,i),i}function J$(t,e,n){if(e.length===0)return;const i=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],g=$r(n,l.path);let c=!1,u;if(nt(g!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)c=!0,u=l.abortReason,r=r.concat(Zu(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=H$)c=!0,u="maxretry",r=r.concat(Zu(t.serverSyncTree_,l.currentWriteId,!0));else{const I=xk(t,l.path,o);l.currentInputSnapshot=I;const h=e[a].update(I.val());if(h!==void 0){YR("transaction failed: Data returned ",h,l.path);let C=or(h);typeof h=="object"&&h!=null&&ag(h,".priority")||(C=C.updatePriority(I.getPriority()));const m=l.currentWriteId,f=KR(t),p=mk(C,I,f);l.currentOutputSnapshotRaw=C,l.currentOutputSnapshotResolved=p,l.currentWriteId=Rk(t),o.splice(o.indexOf(m),1),r=r.concat(dk(t.serverSyncTree_,l.path,p,l.currentWriteId,l.applyLocally)),r=r.concat(Zu(t.serverSyncTree_,m,!0))}else c=!0,u="nodata",r=r.concat(Zu(t.serverSyncTree_,l.currentWriteId,!0))}nl(t.eventQueue_,n,r),r=[],c&&(e[a].status=2,function(I){setTimeout(I,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}bv(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)HA(i[a]);UR(t,t.transactionQueueTree_)}function Zk(t,e){let n,i=t.transactionQueueTree_;for(n=rn(e);n!==null&&_A(i)===void 0;)i=XR(i,n),e=kn(e),n=rn(e);return i}function Ek(t,e){const n=[];return Wk(t,e,n),n.sort((i,r)=>i.order-r.order),n}function Wk(t,e,n){const i=_A(e);if(i)for(let r=0;r<i.length;r++)n.push(i[r]);fv(e,r=>{Wk(t,r,n)})}function bv(t,e){const n=_A(e);if(n){let i=0;for(let r=0;r<n.length;r++)n[r].status!==2&&(n[i]=n[r],i++);n.length=i,bk(e,n.length>0?n:void 0)}fv(e,i=>{bv(t,i)})}function Nk(t,e){const n=b0(Zk(t,e)),i=XR(t.transactionQueueTree_,e);return w$(i,r=>{x5(t,r)}),x5(t,i),yk(i,r=>{x5(t,r)}),n}function x5(t,e){const n=_A(e);if(n){const i=[];let r=[],s=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(nt(s===o-1,"All SENT items should be at beginning of queue."),s=o,n[o].status=3,n[o].abortReason="set"):(nt(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),r=r.concat(Zu(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?bk(e,void 0):n.length=s+1,nl(t.eventQueue_,b0(e),r);for(let o=0;o<i.length;o++)HA(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j$(t){let e="";const n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let r=n[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function q$(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Rs(`Invalid query segment '${n}' in query '${t}'`)}return e}const b8=function(t,e){const n=$$(t),i=n.namespace;n.domain==="firebase.com"&&eg(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&eg("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||cj();const r=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new WL(n.host,n.secure,i,r,e,"",i!==n.subdomain),path:new Nn(n.pathString)}},$$=function(t){let e="",n="",i="",r="",s="",o=!0,a="https",l=443;if(typeof t=="string"){let g=t.indexOf("//");g>=0&&(a=t.substring(0,g-1),t=t.substring(g+2));let c=t.indexOf("/");c===-1&&(c=t.length);let u=t.indexOf("?");u===-1&&(u=t.length),e=t.substring(0,Math.min(c,u)),c<u&&(r=j$(t.substring(c,u)));const I=q$(t.substring(Math.min(t.length,u)));g=e.indexOf(":"),g>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(g+1),10)):g=e.length;const h=e.slice(0,g);if(h.toLowerCase()==="localhost")n="localhost";else if(h.split(".").length<=2)n=h;else{const C=e.indexOf(".");i=e.substring(0,C).toLowerCase(),n=e.substring(C+1),s=i}"ns"in I&&(s=I.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eee{constructor(e,n,i,r){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ki(this.snapshot.exportVal())}}class tee{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nee{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return nt(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DR{constructor(e,n,i,r){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=r}get key(){return nn(this._path)?null:_L(this._path)}get ref(){return new lg(this._repo,this._path)}get _queryIdentifier(){const e=s8(this._queryParams),n=mR(e);return n==="{}"?"default":n}get _queryObject(){return s8(this._queryParams)}isEqual(e){if(e=LA(e),!(e instanceof DR))return!1;const n=this._repo===e._repo,i=KL(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return n&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Pj(this._path)}}class lg extends DR{constructor(e,n){super(e,n,new wR,!1)}get parent(){const e=YL(this._path);return e===null?null:new lg(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class yf{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Nn(e),i=ub(this.ref,e);return new yf(this._node.getChild(n),i,mi)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new yf(r,ub(this.ref,i),mi)))}hasChild(e){const n=new Nn(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function PR(t,e){return t=LA(t),t._checkNotDeleted("ref"),e!==void 0?ub(t._root,e):t._root}function ub(t,e){return t=LA(t),rn(t._path)===null?N$("child","path",e,!1):Sk("child","path",e,!1),new lg(t._repo,zi(t._path,e))}function Mk(t,e){t=LA(t),M$("set",t._path),W$("set",e,t._path,!1);const n=new cv;return U$(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function iee(t){t=LA(t);const e=new nee(()=>{}),n=new OR(e);return z$(t._repo,t,n).then(i=>new yf(i,new lg(t._repo,t._path),t._queryParams.getIndex()))}class OR{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const i=n._queryParams.getIndex();return new eee("value",this,new yf(e.snapshotNode,new lg(n._repo,n._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new tee(this,e,n):null}matches(e){return e instanceof OR?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}i$(lg);l$(lg);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ree="FIREBASE_DATABASE_EMULATOR_HOST",w9={};let see=!1;function oee(t,e,n,i){t.repoInfo_=new WL(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),i&&(t.authTokenProvider_=i)}function aee(t,e,n,i,r){let s=i||t.options.databaseURL;s===void 0&&(t.options.projectId||eg("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Tr("Using default host for project ",t.options.projectId),s=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=b8(s,r),a=o.repoInfo,l,g;typeof process<"u"&&process.env&&(g=process.env[ree]),g?(l=!0,s=`http://${g}?ns=${a.namespace}`,o=b8(s,r),a=o.repoInfo):l=!o.repoInfo.secure;const c=r&&l?new eA(eA.OWNER):new vj(t.name,t.options,e);T$("Invalid Firebase Database URL",o),nn(o.path)||eg("Database URL must point to the root of a Firebase Database (not including a child path).");const u=gee(a,t,c,new bj(t.name,n));return new cee(u,t)}function lee(t,e){const n=w9[e];(!n||n[t.key]!==t)&&eg(`Database ${e}(${t.repoInfo_}) has already been deleted.`),P$(t),delete n[t.key]}function gee(t,e,n,i){let r=w9[e.name];r||(r={},w9[e.name]=r);let s=r[t.toURLString()];return s&&eg("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new _$(t,see,n,i),r[t.toURLString()]=s,s}class cee{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(X$(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new lg(this._repo,Cn())),this._rootInternal}_delete(){return this._rootInternal!==null&&(lee(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&eg("Cannot call "+e+" on a deleted database.")}}function uee(t=PJ(),e){const n=KJ(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const i=FQ("database");i&&Iee(n,...i)}return n}function Iee(t,e,n,i={}){t=LA(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&eg("Cannot call useEmulator() after instance has already been initialized.");const r=t._repoInternal;let s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&eg('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new eA(eA.OWNER);else if(i.mockUserToken){const o=typeof i.mockUserToken=="string"?i.mockUserToken:VQ(i.mockUserToken,t.app.options.projectId);s=new eA(o)}oee(r,e,n,s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dee(t){sj(DJ),q3(new df("database",(e,{instanceIdentifier:n})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return aee(i,r,s,n)},"PUBLIC").setMultipleInstances(!0)),qd(Y6,K6,t),qd(Y6,K6,"esm2017")}Pl.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Pl.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};dee();const Aee={apiKey:"AIzaSyCOLBM6ziaISi63oTVjmEMMLcyZWS0tAEQ",authDomain:"bellerophon-898f9.firebaseapp.com",projectId:"bellerophon-898f9",storageBucket:"bellerophon-898f9.appspot.com",messagingSenderId:"239009981867",appId:"1:239009981867:web:10c930c86add9ff3c01eee",databaseURL:"https://bellerophon-898f9-default-rtdb.europe-west1.firebasedatabase.app"},hee=dL(Aee),QR=uee(hee),dm=t=>{Mk(PR(QR,"puzzles/"+t+"/"),!1)},Ib=t=>{Mk(PR(QR,"puzzles/"+t+"/"),!0)},db=(t,e)=>{const n=PR(QR);iee(ub(n,"puzzles/"+t+"/")).then(i=>{i.exists()?e(i.val()):e(!1)}).catch(i=>{console.error(i)})},Cee=()=>{const[t,e]=H.useState(!1),[n,i]=H.useState(!1),[r,s]=H.useState(!0);r&&(db("PosteDeControle",C=>{e(C)}),db("MedicalBay",C=>{i(C)}),s(!1));const o=()=>{Ib("PosteDeControle"),e(!0)},a=()=>{Ib("MedicalBay"),i(!0)},[l,g]=H.useState(!1),[c,u]=H.useState(!1),I=()=>ne.jsxs("div",{children:[ne.jsx("div",{className:"roles-subtitle",children:"Poste de contrôle :"}),ne.jsx("div",{className:"roles-content",children:t?ne.jsx("div",{className:"roles-content",children:"Poste de contrôle accessible"}):ne.jsxs("div",{className:"roles-content",children:[ne.jsx("div",{className:"roles-content",children:"Le poste de controle est actuellement vérouillé."}),ne.jsx(O3,{targets:[1,2,3,5],centerTile:[0,1],shortCircuit:!0,onSuccess:o})]})})]}),h=()=>ne.jsxs("div",{children:[ne.jsx("div",{className:"roles-subtitle",children:"Bloc Médical :"}),ne.jsx("div",{className:"roles-content",children:n?ne.jsx("div",{className:"roles-content",children:"Bloc Médical accessible"}):ne.jsxs("div",{className:"roles-content",children:[ne.jsx("div",{className:"roles-content",children:"Le bloc médical est actuellement vérouillé."}),ne.jsx(O3,{targets:[1,6,7,12],centerTile:[2,0],shortCircuit:!0,onSuccess:a})]})})]});return ne.jsxs("div",{className:"roles-container",children:[ne.jsx("div",{className:"roles-title",children:"Sas d'accès"}),ne.jsx("button",{className:"submenu-button",onClick:()=>g(C=>!C),children:l?"Poste de Controle <<<":"Poste de Controle >>>"}),l&&I(),ne.jsx("button",{className:"submenu-button",onClick:()=>u(C=>!C),children:c?"Bloc Médical <<<":"Bloc Médical >>>"}),c&&h()]})},fee=({isEnvCentral:t})=>{const[e,n]=H.useState(!1),[i,r]=H.useState(!1),[s,o]=H.useState(!0);s&&(db("AlignCapteurs",T=>{n(T)}),db("ActivateNavigation",T=>{r(T)}),o(!1));const a=()=>{Ib("AlignCapteurs"),n(!0)},l=()=>{Ib("ActivateNavigation"),r(!0)},g=window.localStorage.getItem("Ancrage1"),c=window.localStorage.getItem("Ancrage2"),u=window.localStorage.getItem("Ancrage3"),I=window.localStorage.getItem("Ancrage4"),h=window.localStorage.getItem("Direction"),C=()=>(console.log(e),console.log(i),g!=null&&g!=""?ne.jsxs("div",{className:"roles-content",children:[ne.jsx("div",{className:"roles-content",children:"NAVIGATION OPERATIONNELLE"}),ne.jsx("div",{className:"roles-content",children:"Paramètres : "}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsx("div",{className:"roles-content",children:"Direction :"}),ne.jsx("div",{className:"roles-content",children:h})]}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsx("div",{className:"roles-content",children:"Ancrage 1 :"}),ne.jsx("div",{className:"roles-content",children:g})]}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsx("div",{className:"roles-content",children:"Ancrage 2 :"}),ne.jsx("div",{className:"roles-content",children:c})]}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsx("div",{className:"roles-content",children:"Ancrage 3 :"}),ne.jsx("div",{className:"roles-content",children:u})]}),ne.jsxs("div",{className:"roles-lines",children:[ne.jsx("div",{className:"roles-content",children:"Ancrage 4 :"}),ne.jsx("div",{className:"roles-content",children:I})]})]}):e?i?ne.jsxs("div",{className:"roles-content",children:[ne.jsx("div",{className:"roles-content",children:"CAPTEURS NOMINAUX"}),ne.jsxs("div",{className:"roles-content",children:["NAVIGATION ACTIVE (code : ",QV,")"," "]}),ne.jsx("div",{className:"roles-content",children:"VAISSEAU EN ATTENTE DE COORDONNEES DE NAVIGATION"})]}):ne.jsxs("div",{className:"roles-content",children:[ne.jsx("div",{className:"roles-content",children:"CAPTEURS NOMINAUX"}),ne.jsx("div",{className:"roles-content",children:"VAISSEAU HORS TRAJECTOIRE - ACTIVER LA NAVIGATION"}),ne.jsx("button",{className:"submenu-button",onClick:()=>W(T=>!T),children:x?"Activer la navigation <<<":"Activer la navigation >>>"}),x&&ne.jsx("div",{className:"roles-content",children:ne.jsx(O3,{targets:[2,7,6,11],centerTile:[5,2],shortCircuit:!1,onSuccess:l},1)})]}):ne.jsxs("div",{className:"roles-content",children:[ne.jsx("div",{className:"roles-content",children:"VAISSEAU HORS TRAJECTOIRE - CAPTEURS A REALIGNER"}),ne.jsx("button",{className:"submenu-button",onClick:()=>E(T=>!T),children:w?"Réalignement des capteurs <<<":"Réalignement des capteurs >>>"}),w&&ne.jsx("div",{className:"roles-content",children:ne.jsx(O3,{targets:[7,12,8,11],centerTile:[2,2],shortCircuit:!1,onSuccess:a},0)})]})),[b,m]=H.useState(!1),[f,p]=H.useState(!1),[v,B]=H.useState(!1),[G,R]=H.useState(!1),[w,E]=H.useState(!1),[x,W]=H.useState(!1);return ne.jsx("div",{className:"roles-container",children:t?ne.jsxs("div",{className:"roles-container",children:[ne.jsx("div",{className:"roles-title",children:"Contrôle des systèmes"}),ne.jsx("button",{className:"submenu-button",onClick:()=>m(T=>!T),children:b?"Propulsion <<<":"Propulsion >>>"}),b&&ne.jsx("div",{className:"roles-content",children:"SYSTEME NOMINAL - PROPULSION OPERATIONNELLE"}),ne.jsx("button",{className:"submenu-button",onClick:()=>p(T=>!T),children:f?"Systèmes de survie <<<":"Systèmes de survie >>>"}),f&&ne.jsx("div",{className:"roles-content",children:"SYSTEME NOMINAL - TOUTES LES FONCTIONS SONT OPERATIONNELLES"}),ne.jsx("button",{className:"submenu-button",onClick:()=>B(T=>!T),children:v?"Gestion des soutes <<<":"Gestion des soutes >>>"}),v&&ne.jsx("div",{className:"roles-content",children:"SYSTEME NOMINAL"}),ne.jsx("button",{className:"submenu-button",onClick:()=>R(T=>!T),children:G?"Capteurs <<<":"Capteurs >>>"}),G&&C()]}):ne.jsx("div",{className:"roles-content",children:"Accès interdit hors ordinateur central"})})};/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const gg="156",Iu={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},du={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Tk=0,R9=1,Fk=2,pee=3,Vk=0,vv=1,NC=2,ea=3,il=0,fr=1,Ps=2,mee=2,tn=0,Ja=1,Bf=2,x9=3,Z9=4,Gf=5,Os=100,Lk=101,kk=102,E9=103,W9=104,bA=200,Hk=201,_k=202,Xk=203,Sf=204,wf=205,yv=206,Yk=207,Bv=208,Kk=209,zk=210,Uk=0,Dk=1,Pk=2,Ab=3,Ok=4,Qk=5,Jk=6,jk=7,v0=0,qk=1,$k=2,Wo=0,eH=1,tH=2,nH=3,JR=4,iH=5,Gv=300,tg=301,Ac=302,Rf=303,xf=304,XA=306,ng=1e3,Ci=1001,Zf=1002,Vt=1003,hb=1004,bee=1004,MC=1005,vee=1005,xn=1006,jR=1007,yee=1007,rl=1008,Bee=1008,Yi=1009,rH=1010,sH=1011,mI=1012,qR=1013,Yl=1014,es=1015,Ri=1016,$R=1017,ex=1018,Ol=1020,oH=1021,fi=1023,tx=1024,aH=1025,rc=1026,hc=1027,Eu=1028,nx=1029,Vd=1030,ix=1031,rx=1033,nA=33776,J2=33777,j2=33778,iA=33779,Ef=35840,N9=35841,Wf=35842,M9=35843,Sv=36196,Nf=37492,Mf=37496,Tf=37808,T9=37809,F9=37810,V9=37811,L9=37812,k9=37813,H9=37814,_9=37815,X9=37816,Y9=37817,K9=37818,z9=37819,U9=37820,D9=37821,rA=36492,P9=36494,O9=36495,lH=36283,Q9=36284,J9=36285,j9=36286,gH=2200,cH=2201,uH=2202,Ff=2300,Vf=2301,q2=2302,Wu=2400,Nu=2401,Lf=2402,wv=2500,sx=2501,Gee=0,See=1,wee=2,ox=3e3,sc=3001,IH=3200,Rv=3201,Sc=0,dH=1,oc="",Hn="srgb",Ca="srgb-linear",y0="display-p3",Ree="display-p3-linear",xee=0,$2=7680,Zee=7681,Eee=7682,Wee=7683,Nee=34055,Mee=34056,Tee=5386,Fee=512,Vee=513,Lee=514,kee=515,Hee=516,_ee=517,Xee=518,AH=519,hH=512,CH=513,fH=514,pH=515,mH=516,bH=517,vH=518,yH=519,kf=35044,e3=35048,Yee=35040,Kee=35045,zee=35049,Uee=35041,Dee=35046,Pee=35050,Oee=35042,Qee="100",q9="300 es",Cb=1035,Da=2e3,Hf=2001;class sl{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Zr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let v8=1234567;const Xu=Math.PI/180,vA=180/Math.PI;function $s(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Zr[t&255]+Zr[t>>8&255]+Zr[t>>16&255]+Zr[t>>24&255]+"-"+Zr[e&255]+Zr[e>>8&255]+"-"+Zr[e>>16&15|64]+Zr[e>>24&255]+"-"+Zr[n&63|128]+Zr[n>>8&255]+"-"+Zr[n>>16&255]+Zr[n>>24&255]+Zr[i&255]+Zr[i>>8&255]+Zr[i>>16&255]+Zr[i>>24&255]).toLowerCase()}function Ai(t,e,n){return Math.max(e,Math.min(n,t))}function ax(t,e){return(t%e+e)%e}function Jee(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)}function jee(t,e,n){return t!==e?(n-t)/(e-t):0}function TC(t,e,n){return(1-n)*t+n*e}function qee(t,e,n,i){return TC(t,e,1-Math.exp(-n*i))}function $ee(t,e=1){return e-Math.abs(ax(t,e*2)-e)}function ete(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function tte(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function nte(t,e){return t+Math.floor(Math.random()*(e-t+1))}function ite(t,e){return t+Math.random()*(e-t)}function rte(t){return t*(.5-Math.random())}function ste(t){t!==void 0&&(v8=t);let e=v8+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function ote(t){return t*Xu}function ate(t){return t*vA}function $9(t){return(t&t-1)===0&&t!==0}function BH(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function fb(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function lte(t,e,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),g=s((e+i)/2),c=o((e+i)/2),u=s((e-i)/2),I=o((e-i)/2),h=s((i-e)/2),C=o((i-e)/2);switch(r){case"XYX":t.set(a*c,l*u,l*I,a*g);break;case"YZY":t.set(l*I,a*c,l*u,a*g);break;case"ZXZ":t.set(l*u,l*I,a*c,a*g);break;case"XZX":t.set(a*c,l*C,l*h,a*g);break;case"YXY":t.set(l*h,a*c,l*C,a*g);break;case"ZYZ":t.set(l*C,l*h,a*c,a*g);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function bs(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Ot(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const ac={DEG2RAD:Xu,RAD2DEG:vA,generateUUID:$s,clamp:Ai,euclideanModulo:ax,mapLinear:Jee,inverseLerp:jee,lerp:TC,damp:qee,pingpong:$ee,smoothstep:ete,smootherstep:tte,randInt:nte,randFloat:ite,randFloatSpread:rte,seededRandom:ste,degToRad:ote,radToDeg:ate,isPowerOfTwo:$9,ceilPowerOfTwo:BH,floorPowerOfTwo:fb,setQuaternionFromProperEuler:lte,normalize:Ot,denormalize:bs};class xe{constructor(e=0,n=0){xe.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,i=this.y,r=e.elements;return this.x=r[0]*n+r[3]*i+r[6],this.y=r[1]*n+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(Ai(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const i=Math.cos(n),r=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Pt{constructor(e,n,i,r,s,o,a,l,g){Pt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,o,a,l,g)}set(e,n,i,r,s,o,a,l,g){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=n,c[4]=s,c[5]=l,c[6]=i,c[7]=o,c[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,o=i[0],a=i[3],l=i[6],g=i[1],c=i[4],u=i[7],I=i[2],h=i[5],C=i[8],b=r[0],m=r[3],f=r[6],p=r[1],v=r[4],B=r[7],G=r[2],R=r[5],w=r[8];return s[0]=o*b+a*p+l*G,s[3]=o*m+a*v+l*R,s[6]=o*f+a*B+l*w,s[1]=g*b+c*p+u*G,s[4]=g*m+c*v+u*R,s[7]=g*f+c*B+u*w,s[2]=I*b+h*p+C*G,s[5]=I*m+h*v+C*R,s[8]=I*f+h*B+C*w,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],g=e[7],c=e[8];return n*o*c-n*a*g-i*s*c+i*a*l+r*s*g-r*o*l}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],g=e[7],c=e[8],u=c*o-a*g,I=a*l-c*s,h=g*s-o*l,C=n*u+i*I+r*h;if(C===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/C;return e[0]=u*b,e[1]=(r*g-c*i)*b,e[2]=(a*i-r*o)*b,e[3]=I*b,e[4]=(c*n-r*l)*b,e[5]=(r*s-a*n)*b,e[6]=h*b,e[7]=(i*l-g*n)*b,e[8]=(o*n-i*s)*b,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,r,s,o,a){const l=Math.cos(s),g=Math.sin(s);return this.set(i*l,i*g,-i*(l*o+g*a)+o+e,-r*g,r*l,-r*(-g*o+l*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(Z5.makeScale(e,n)),this}rotate(e){return this.premultiply(Z5.makeRotation(-e)),this}translate(e,n){return this.premultiply(Z5.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<9;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Z5=new Pt;function GH(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const gte={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ld(t,e){return new gte[t](e)}function _f(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function SH(){const t=_f("canvas");return t.style.display="block",t}const y8={};function FC(t){t in y8||(y8[t]=!0,console.warn(t))}function sA(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function E5(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const cte=new Pt().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),ute=new Pt().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function Ite(t){return t.convertSRGBToLinear().applyMatrix3(ute)}function dte(t){return t.applyMatrix3(cte).convertLinearToSRGB()}const Ate={[Ca]:t=>t,[Hn]:t=>t.convertSRGBToLinear(),[y0]:Ite},hte={[Ca]:t=>t,[Hn]:t=>t.convertLinearToSRGB(),[y0]:dte},yo={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(t){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!t},get workingColorSpace(){return Ca},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,n){if(this.enabled===!1||e===n||!e||!n)return t;const i=Ate[e],r=hte[n];if(i===void 0||r===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${n}".`);return r(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}};let DI;class lx{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{DI===void 0&&(DI=_f("canvas")),DI.width=e.width,DI.height=e.height;const i=DI.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=DI}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=_f("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=sA(s[o]/255)*255;return i.putImageData(r,0,0),n}else if(e.data){const n=e.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(sA(n[i]/255)*255):n[i]=sA(n[i]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Cte=0;class Mu{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Cte++}),this.uuid=$s(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(W5(r[o].image)):s.push(W5(r[o]))}else s=W5(r);i.url=s}return n||(e.images[this.uuid]=i),i}}function W5(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?lx.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let fte=0;class ei extends sl{constructor(e=ei.DEFAULT_IMAGE,n=ei.DEFAULT_MAPPING,i=Ci,r=Ci,s=xn,o=rl,a=fi,l=Yi,g=ei.DEFAULT_ANISOTROPY,c=oc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:fte++}),this.uuid=$s(),this.name="",this.source=new Mu(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=g,this.format=a,this.internalFormat=null,this.type=l,this.offset=new xe(0,0),this.repeat=new xe(1,1),this.center=new xe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof c=="string"?this.colorSpace=c:(FC("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===sc?Hn:oc),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Gv)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ng:e.x=e.x-Math.floor(e.x);break;case Ci:e.x=e.x<0?0:1;break;case Zf:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ng:e.y=e.y-Math.floor(e.y);break;case Ci:e.y=e.y<0?0:1;break;case Zf:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return FC("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Hn?sc:ox}set encoding(e){FC("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===sc?Hn:oc}}ei.DEFAULT_IMAGE=null;ei.DEFAULT_MAPPING=Gv;ei.DEFAULT_ANISOTROPY=1;class en{constructor(e=0,n=0,i=0,r=1){en.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,i,r){return this.x=e,this.y=n,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*n+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*n+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*n+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*n+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,i,r,s;const l=e.elements,g=l[0],c=l[4],u=l[8],I=l[1],h=l[5],C=l[9],b=l[2],m=l[6],f=l[10];if(Math.abs(c-I)<.01&&Math.abs(u-b)<.01&&Math.abs(C-m)<.01){if(Math.abs(c+I)<.1&&Math.abs(u+b)<.1&&Math.abs(C+m)<.1&&Math.abs(g+h+f-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const v=(g+1)/2,B=(h+1)/2,G=(f+1)/2,R=(c+I)/4,w=(u+b)/4,E=(C+m)/4;return v>B&&v>G?v<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(v),r=R/i,s=w/i):B>G?B<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(B),i=R/r,s=E/r):G<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(G),i=w/s,r=E/s),this.set(i,r,s,n),this}let p=Math.sqrt((m-C)*(m-C)+(u-b)*(u-b)+(I-c)*(I-c));return Math.abs(p)<.001&&(p=1),this.x=(m-C)/p,this.y=(u-b)/p,this.z=(I-c)/p,this.w=Math.acos((g+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this.w=e.w+(n.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class wH extends sl{constructor(e=1,n=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new en(0,0,e,n),this.scissorTest=!1,this.viewport=new en(0,0,e,n);const r={width:e,height:n,depth:1};i.encoding!==void 0&&(FC("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===sc?Hn:oc),this.texture=new ei(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:xn,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,n,i=1){(this.width!==e||this.height!==n||this.depth!==i)&&(this.width=e,this.height=n,this.depth=i,this.texture.image.width=e,this.texture.image.height=n,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new Mu(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class En extends wH{constructor(e=1,n=1,i={}){super(e,n,i),this.isWebGLRenderTarget=!0}}class xv extends ei{constructor(e=null,n=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=Vt,this.minFilter=Vt,this.wrapR=Ci,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class pte extends En{constructor(e=1,n=1,i=1){super(e,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new xv(null,e,n,i),this.texture.isRenderTargetTexture=!0}}let gx=class extends ei{constructor(e=null,n=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=Vt,this.minFilter=Vt,this.wrapR=Ci,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class mte extends En{constructor(e=1,n=1,i=1){super(e,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new gx(null,e,n,i),this.texture.isRenderTargetTexture=!0}}class bte extends En{constructor(e=1,n=1,i=1,r={}){super(e,n,r),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,n,i=1){if(this.width!==e||this.height!==n||this.depth!==i){this.width=e,this.height=n,this.depth=i;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=n,this.texture[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let n=0,i=e.texture.length;n<i;n++)this.texture[n]=e.texture[n].clone(),this.texture[n].isRenderTargetTexture=!0;return this}}let gr=class{constructor(e=0,n=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}static slerpFlat(e,n,i,r,s,o,a){let l=i[r+0],g=i[r+1],c=i[r+2],u=i[r+3];const I=s[o+0],h=s[o+1],C=s[o+2],b=s[o+3];if(a===0){e[n+0]=l,e[n+1]=g,e[n+2]=c,e[n+3]=u;return}if(a===1){e[n+0]=I,e[n+1]=h,e[n+2]=C,e[n+3]=b;return}if(u!==b||l!==I||g!==h||c!==C){let m=1-a;const f=l*I+g*h+c*C+u*b,p=f>=0?1:-1,v=1-f*f;if(v>Number.EPSILON){const G=Math.sqrt(v),R=Math.atan2(G,f*p);m=Math.sin(m*R)/G,a=Math.sin(a*R)/G}const B=a*p;if(l=l*m+I*B,g=g*m+h*B,c=c*m+C*B,u=u*m+b*B,m===1-a){const G=1/Math.sqrt(l*l+g*g+c*c+u*u);l*=G,g*=G,c*=G,u*=G}}e[n]=l,e[n+1]=g,e[n+2]=c,e[n+3]=u}static multiplyQuaternionsFlat(e,n,i,r,s,o){const a=i[r],l=i[r+1],g=i[r+2],c=i[r+3],u=s[o],I=s[o+1],h=s[o+2],C=s[o+3];return e[n]=a*C+c*u+l*h-g*I,e[n+1]=l*C+c*I+g*u-a*h,e[n+2]=g*C+c*h+a*I-l*u,e[n+3]=c*C-a*u-l*I-g*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,r){return this._x=e,this._y=n,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,g=a(i/2),c=a(r/2),u=a(s/2),I=l(i/2),h=l(r/2),C=l(s/2);switch(o){case"XYZ":this._x=I*c*u+g*h*C,this._y=g*h*u-I*c*C,this._z=g*c*C+I*h*u,this._w=g*c*u-I*h*C;break;case"YXZ":this._x=I*c*u+g*h*C,this._y=g*h*u-I*c*C,this._z=g*c*C-I*h*u,this._w=g*c*u+I*h*C;break;case"ZXY":this._x=I*c*u-g*h*C,this._y=g*h*u+I*c*C,this._z=g*c*C+I*h*u,this._w=g*c*u-I*h*C;break;case"ZYX":this._x=I*c*u-g*h*C,this._y=g*h*u+I*c*C,this._z=g*c*C-I*h*u,this._w=g*c*u+I*h*C;break;case"YZX":this._x=I*c*u+g*h*C,this._y=g*h*u+I*c*C,this._z=g*c*C-I*h*u,this._w=g*c*u-I*h*C;break;case"XZY":this._x=I*c*u-g*h*C,this._y=g*h*u-I*c*C,this._z=g*c*C+I*h*u,this._w=g*c*u+I*h*C;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const i=n/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,i=n[0],r=n[4],s=n[8],o=n[1],a=n[5],l=n[9],g=n[2],c=n[6],u=n[10],I=i+a+u;if(I>0){const h=.5/Math.sqrt(I+1);this._w=.25/h,this._x=(c-l)*h,this._y=(s-g)*h,this._z=(o-r)*h}else if(i>a&&i>u){const h=2*Math.sqrt(1+i-a-u);this._w=(c-l)/h,this._x=.25*h,this._y=(r+o)/h,this._z=(s+g)/h}else if(a>u){const h=2*Math.sqrt(1+a-i-u);this._w=(s-g)/h,this._x=(r+o)/h,this._y=.25*h,this._z=(l+c)/h}else{const h=2*Math.sqrt(1+u-i-a);this._w=(o-r)/h,this._x=(s+g)/h,this._y=(l+c)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ai(this.dot(e),-1,1)))}rotateTowards(e,n){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,n/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const i=e._x,r=e._y,s=e._z,o=e._w,a=n._x,l=n._y,g=n._z,c=n._w;return this._x=i*c+o*a+r*g-s*l,this._y=r*c+o*l+s*a-i*g,this._z=s*c+o*g+i*l-r*a,this._w=o*c-i*a-r*l-s*g,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-n;return this._w=h*o+n*this._w,this._x=h*i+n*this._x,this._y=h*r+n*this._y,this._z=h*s+n*this._z,this.normalize(),this._onChangeCallback(),this}const g=Math.sqrt(l),c=Math.atan2(g,a),u=Math.sin((1-n)*c)/g,I=Math.sin(n*c)/g;return this._w=o*u+this._w*I,this._x=i*u+this._x*I,this._y=r*u+this._y*I,this._z=s*u+this._z*I,this._onChangeCallback(),this}slerpQuaternions(e,n,i){return this.copy(e).slerp(n,i)}random(){const e=Math.random(),n=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(n*Math.cos(r),i*Math.sin(s),i*Math.cos(s),n*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class P{constructor(e=0,n=0,i=0){P.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(B8.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(B8.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[3]*i+s[6]*r,this.y=s[1]*n+s[4]*i+s[7]*r,this.z=s[2]*n+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*n+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*n+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*n+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*n+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const n=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,g=l*n+o*r-a*i,c=l*i+a*n-s*r,u=l*r+s*i-o*n,I=-s*n-o*i-a*r;return this.x=g*l+I*-s+c*-a-u*-o,this.y=c*l+I*-o+u*-s-g*-a,this.z=u*l+I*-a+g*-o-c*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[4]*i+s[8]*r,this.y=s[1]*n+s[5]*i+s[9]*r,this.z=s[2]*n+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const i=e.x,r=e.y,s=e.z,o=n.x,a=n.y,l=n.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return N5.copy(this).projectOnVector(e),this.sub(N5)}reflect(e){return this.sub(N5.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(Ai(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return n*n+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){const r=Math.sin(n)*e;return this.x=r*Math.sin(i),this.y=Math.cos(n)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=r,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,n=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(n),this.y=i*Math.sin(n),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const N5=new P,B8=new gr;class va{constructor(e=new P(1/0,1/0,1/0),n=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n+=3)this.expandByPoint(wl.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,i=e.count;n<i;n++)this.expandByPoint(wl.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=wl.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),PI.copy(e.boundingBox),PI.applyMatrix4(e.matrixWorld),this.union(PI);else{const r=e.geometry;if(r!==void 0)if(n&&r.attributes!==void 0&&r.attributes.position!==void 0){const s=r.attributes.position;for(let o=0,a=s.count;o<a;o++)wl.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(wl)}else r.boundingBox===null&&r.computeBoundingBox(),PI.copy(r.boundingBox),PI.applyMatrix4(e.matrixWorld),this.union(PI)}const i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],n);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,wl),wl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,i;return e.normal.x>0?(n=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),n<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Th),Am.subVectors(this.max,Th),OI.subVectors(e.a,Th),QI.subVectors(e.b,Th),JI.subVectors(e.c,Th),wg.subVectors(QI,OI),Rg.subVectors(JI,QI),Jc.subVectors(OI,JI);let n=[0,-wg.z,wg.y,0,-Rg.z,Rg.y,0,-Jc.z,Jc.y,wg.z,0,-wg.x,Rg.z,0,-Rg.x,Jc.z,0,-Jc.x,-wg.y,wg.x,0,-Rg.y,Rg.x,0,-Jc.y,Jc.x,0];return!M5(n,OI,QI,JI,Am)||(n=[1,0,0,0,1,0,0,0,1],!M5(n,OI,QI,JI,Am))?!1:(hm.crossVectors(wg,Rg),n=[hm.x,hm.y,hm.z],M5(n,OI,QI,JI,Am))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,wl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(wl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Sl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Sl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Sl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Sl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Sl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Sl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Sl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Sl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Sl),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Sl=[new P,new P,new P,new P,new P,new P,new P,new P],wl=new P,PI=new va,OI=new P,QI=new P,JI=new P,wg=new P,Rg=new P,Jc=new P,Th=new P,Am=new P,hm=new P,jc=new P;function M5(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){jc.fromArray(t,s);const a=r.x*Math.abs(jc.x)+r.y*Math.abs(jc.y)+r.z*Math.abs(jc.z),l=e.dot(jc),g=n.dot(jc),c=i.dot(jc);if(Math.max(-Math.max(l,g,c),Math.min(l,g,c))>a)return!1}return!0}const vte=new va,Fh=new P,T5=new P;class Ho{constructor(e=new P,n=-1){this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const i=this.center;n!==void 0?i.copy(n):vte.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const i=this.center.distanceToSquared(e);return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Fh.subVectors(e,this.center);const n=Fh.lengthSq();if(n>this.radius*this.radius){const i=Math.sqrt(n),r=(i-this.radius)*.5;this.center.addScaledVector(Fh,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(T5.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Fh.copy(e.center).add(T5)),this.expandByPoint(Fh.copy(e.center).sub(T5))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Rl=new P,F5=new P,Cm=new P,xg=new P,V5=new P,fm=new P,L5=new P;let bI=class{constructor(e=new P,n=new P(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Rl)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Rl.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Rl.copy(this.origin).addScaledVector(this.direction,n),Rl.distanceToSquared(e))}distanceSqToSegment(e,n,i,r){F5.copy(e).add(n).multiplyScalar(.5),Cm.copy(n).sub(e).normalize(),xg.copy(this.origin).sub(F5);const s=e.distanceTo(n)*.5,o=-this.direction.dot(Cm),a=xg.dot(this.direction),l=-xg.dot(Cm),g=xg.lengthSq(),c=Math.abs(1-o*o);let u,I,h,C;if(c>0)if(u=o*l-a,I=o*a-l,C=s*c,u>=0)if(I>=-C)if(I<=C){const b=1/c;u*=b,I*=b,h=u*(u+o*I+2*a)+I*(o*u+I+2*l)+g}else I=s,u=Math.max(0,-(o*I+a)),h=-u*u+I*(I+2*l)+g;else I=-s,u=Math.max(0,-(o*I+a)),h=-u*u+I*(I+2*l)+g;else I<=-C?(u=Math.max(0,-(-o*s+a)),I=u>0?-s:Math.min(Math.max(-s,-l),s),h=-u*u+I*(I+2*l)+g):I<=C?(u=0,I=Math.min(Math.max(-s,-l),s),h=I*(I+2*l)+g):(u=Math.max(0,-(o*s+a)),I=u>0?s:Math.min(Math.max(-s,-l),s),h=-u*u+I*(I+2*l)+g);else I=o>0?-s:s,u=Math.max(0,-(o*I+a)),h=-u*u+I*(I+2*l)+g;return i&&i.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(F5).addScaledVector(Cm,I),h}intersectSphere(e,n){Rl.subVectors(e.center,this.origin);const i=Rl.dot(this.direction),r=Rl.dot(Rl)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/n;return i>=0?i:null}intersectPlane(e,n){const i=this.distanceToPlane(e);return i===null?null:this.at(i,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let i,r,s,o,a,l;const g=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,I=this.origin;return g>=0?(i=(e.min.x-I.x)*g,r=(e.max.x-I.x)*g):(i=(e.max.x-I.x)*g,r=(e.min.x-I.x)*g),c>=0?(s=(e.min.y-I.y)*c,o=(e.max.y-I.y)*c):(s=(e.max.y-I.y)*c,o=(e.min.y-I.y)*c),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),u>=0?(a=(e.min.z-I.z)*u,l=(e.max.z-I.z)*u):(a=(e.max.z-I.z)*u,l=(e.min.z-I.z)*u),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,n)}intersectsBox(e){return this.intersectBox(e,Rl)!==null}intersectTriangle(e,n,i,r,s){V5.subVectors(n,e),fm.subVectors(i,e),L5.crossVectors(V5,fm);let o=this.direction.dot(L5),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;xg.subVectors(this.origin,e);const l=a*this.direction.dot(fm.crossVectors(xg,fm));if(l<0)return null;const g=a*this.direction.dot(V5.cross(xg));if(g<0||l+g>o)return null;const c=-a*xg.dot(L5);return c<0?null:this.at(c/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class dt{constructor(e,n,i,r,s,o,a,l,g,c,u,I,h,C,b,m){dt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,o,a,l,g,c,u,I,h,C,b,m)}set(e,n,i,r,s,o,a,l,g,c,u,I,h,C,b,m){const f=this.elements;return f[0]=e,f[4]=n,f[8]=i,f[12]=r,f[1]=s,f[5]=o,f[9]=a,f[13]=l,f[2]=g,f[6]=c,f[10]=u,f[14]=I,f[3]=h,f[7]=C,f[11]=b,f[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new dt().fromArray(this.elements)}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){const n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,i=e.elements,r=1/jI.setFromMatrixColumn(e,0).length(),s=1/jI.setFromMatrixColumn(e,1).length(),o=1/jI.setFromMatrixColumn(e,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=0,n[4]=i[4]*s,n[5]=i[5]*s,n[6]=i[6]*s,n[7]=0,n[8]=i[8]*o,n[9]=i[9]*o,n[10]=i[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),g=Math.sin(r),c=Math.cos(s),u=Math.sin(s);if(e.order==="XYZ"){const I=o*c,h=o*u,C=a*c,b=a*u;n[0]=l*c,n[4]=-l*u,n[8]=g,n[1]=h+C*g,n[5]=I-b*g,n[9]=-a*l,n[2]=b-I*g,n[6]=C+h*g,n[10]=o*l}else if(e.order==="YXZ"){const I=l*c,h=l*u,C=g*c,b=g*u;n[0]=I+b*a,n[4]=C*a-h,n[8]=o*g,n[1]=o*u,n[5]=o*c,n[9]=-a,n[2]=h*a-C,n[6]=b+I*a,n[10]=o*l}else if(e.order==="ZXY"){const I=l*c,h=l*u,C=g*c,b=g*u;n[0]=I-b*a,n[4]=-o*u,n[8]=C+h*a,n[1]=h+C*a,n[5]=o*c,n[9]=b-I*a,n[2]=-o*g,n[6]=a,n[10]=o*l}else if(e.order==="ZYX"){const I=o*c,h=o*u,C=a*c,b=a*u;n[0]=l*c,n[4]=C*g-h,n[8]=I*g+b,n[1]=l*u,n[5]=b*g+I,n[9]=h*g-C,n[2]=-g,n[6]=a*l,n[10]=o*l}else if(e.order==="YZX"){const I=o*l,h=o*g,C=a*l,b=a*g;n[0]=l*c,n[4]=b-I*u,n[8]=C*u+h,n[1]=u,n[5]=o*c,n[9]=-a*c,n[2]=-g*c,n[6]=h*u+C,n[10]=I-b*u}else if(e.order==="XZY"){const I=o*l,h=o*g,C=a*l,b=a*g;n[0]=l*c,n[4]=-u,n[8]=g*c,n[1]=I*u+b,n[5]=o*c,n[9]=h*u-C,n[2]=C*u-h,n[6]=a*c,n[10]=b*u+I}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(yte,e,Bte)}lookAt(e,n,i){const r=this.elements;return Xs.subVectors(e,n),Xs.lengthSq()===0&&(Xs.z=1),Xs.normalize(),Zg.crossVectors(i,Xs),Zg.lengthSq()===0&&(Math.abs(i.z)===1?Xs.x+=1e-4:Xs.z+=1e-4,Xs.normalize(),Zg.crossVectors(i,Xs)),Zg.normalize(),pm.crossVectors(Xs,Zg),r[0]=Zg.x,r[4]=pm.x,r[8]=Xs.x,r[1]=Zg.y,r[5]=pm.y,r[9]=Xs.y,r[2]=Zg.z,r[6]=pm.z,r[10]=Xs.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,o=i[0],a=i[4],l=i[8],g=i[12],c=i[1],u=i[5],I=i[9],h=i[13],C=i[2],b=i[6],m=i[10],f=i[14],p=i[3],v=i[7],B=i[11],G=i[15],R=r[0],w=r[4],E=r[8],x=r[12],W=r[1],T=r[5],k=r[9],_=r[13],U=r[2],O=r[6],Y=r[10],z=r[14],N=r[3],L=r[7],V=r[11],M=r[15];return s[0]=o*R+a*W+l*U+g*N,s[4]=o*w+a*T+l*O+g*L,s[8]=o*E+a*k+l*Y+g*V,s[12]=o*x+a*_+l*z+g*M,s[1]=c*R+u*W+I*U+h*N,s[5]=c*w+u*T+I*O+h*L,s[9]=c*E+u*k+I*Y+h*V,s[13]=c*x+u*_+I*z+h*M,s[2]=C*R+b*W+m*U+f*N,s[6]=C*w+b*T+m*O+f*L,s[10]=C*E+b*k+m*Y+f*V,s[14]=C*x+b*_+m*z+f*M,s[3]=p*R+v*W+B*U+G*N,s[7]=p*w+v*T+B*O+G*L,s[11]=p*E+v*k+B*Y+G*V,s[15]=p*x+v*_+B*z+G*M,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],g=e[13],c=e[2],u=e[6],I=e[10],h=e[14],C=e[3],b=e[7],m=e[11],f=e[15];return C*(+s*l*u-r*g*u-s*a*I+i*g*I+r*a*h-i*l*h)+b*(+n*l*h-n*g*I+s*o*I-r*o*h+r*g*c-s*l*c)+m*(+n*g*u-n*a*h-s*o*u+i*o*h+s*a*c-i*g*c)+f*(-r*a*c-n*l*u+n*a*I+r*o*u-i*o*I+i*l*c)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=n,r[14]=i),this}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],g=e[7],c=e[8],u=e[9],I=e[10],h=e[11],C=e[12],b=e[13],m=e[14],f=e[15],p=u*m*g-b*I*g+b*l*h-a*m*h-u*l*f+a*I*f,v=C*I*g-c*m*g-C*l*h+o*m*h+c*l*f-o*I*f,B=c*b*g-C*u*g+C*a*h-o*b*h-c*a*f+o*u*f,G=C*u*l-c*b*l-C*a*I+o*b*I+c*a*m-o*u*m,R=n*p+i*v+r*B+s*G;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/R;return e[0]=p*w,e[1]=(b*I*s-u*m*s-b*r*h+i*m*h+u*r*f-i*I*f)*w,e[2]=(a*m*s-b*l*s+b*r*g-i*m*g-a*r*f+i*l*f)*w,e[3]=(u*l*s-a*I*s-u*r*g+i*I*g+a*r*h-i*l*h)*w,e[4]=v*w,e[5]=(c*m*s-C*I*s+C*r*h-n*m*h-c*r*f+n*I*f)*w,e[6]=(C*l*s-o*m*s-C*r*g+n*m*g+o*r*f-n*l*f)*w,e[7]=(o*I*s-c*l*s+c*r*g-n*I*g-o*r*h+n*l*h)*w,e[8]=B*w,e[9]=(C*u*s-c*b*s-C*i*h+n*b*h+c*i*f-n*u*f)*w,e[10]=(o*b*s-C*a*s+C*i*g-n*b*g-o*i*f+n*a*f)*w,e[11]=(c*a*s-o*u*s-c*i*g+n*u*g+o*i*h-n*a*h)*w,e[12]=G*w,e[13]=(c*b*r-C*u*r+C*i*I-n*b*I-c*i*m+n*u*m)*w,e[14]=(C*a*r-o*b*r-C*i*l+n*b*l+o*i*m-n*a*m)*w,e[15]=(o*u*r-c*a*r+c*i*l-n*u*l-o*i*I+n*a*I)*w,this}scale(e){const n=this.elements,i=e.x,r=e.y,s=e.z;return n[0]*=i,n[4]*=r,n[8]*=s,n[1]*=i,n[5]*=r,n[9]*=s,n[2]*=i,n[6]*=r,n[10]*=s,n[3]*=i,n[7]*=r,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,r))}makeTranslation(e,n,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const i=Math.cos(n),r=Math.sin(n),s=1-i,o=e.x,a=e.y,l=e.z,g=s*o,c=s*a;return this.set(g*o+i,g*a-r*l,g*l+r*a,0,g*a+r*l,c*a+i,c*l-r*o,0,g*l-r*a,c*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,n,r,1,0,0,0,0,1),this}compose(e,n,i){const r=this.elements,s=n._x,o=n._y,a=n._z,l=n._w,g=s+s,c=o+o,u=a+a,I=s*g,h=s*c,C=s*u,b=o*c,m=o*u,f=a*u,p=l*g,v=l*c,B=l*u,G=i.x,R=i.y,w=i.z;return r[0]=(1-(b+f))*G,r[1]=(h+B)*G,r[2]=(C-v)*G,r[3]=0,r[4]=(h-B)*R,r[5]=(1-(I+f))*R,r[6]=(m+p)*R,r[7]=0,r[8]=(C+v)*w,r[9]=(m-p)*w,r[10]=(1-(I+b))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,n,i){const r=this.elements;let s=jI.set(r[0],r[1],r[2]).length();const o=jI.set(r[4],r[5],r[6]).length(),a=jI.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Po.copy(this);const g=1/s,c=1/o,u=1/a;return Po.elements[0]*=g,Po.elements[1]*=g,Po.elements[2]*=g,Po.elements[4]*=c,Po.elements[5]*=c,Po.elements[6]*=c,Po.elements[8]*=u,Po.elements[9]*=u,Po.elements[10]*=u,n.setFromRotationMatrix(Po),i.x=s,i.y=o,i.z=a,this}makePerspective(e,n,i,r,s,o,a=Da){const l=this.elements,g=2*s/(n-e),c=2*s/(i-r),u=(n+e)/(n-e),I=(i+r)/(i-r);let h,C;if(a===Da)h=-(o+s)/(o-s),C=-2*o*s/(o-s);else if(a===Hf)h=-o/(o-s),C=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=g,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=c,l[9]=I,l[13]=0,l[2]=0,l[6]=0,l[10]=h,l[14]=C,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,n,i,r,s,o,a=Da){const l=this.elements,g=1/(n-e),c=1/(i-r),u=1/(o-s),I=(n+e)*g,h=(i+r)*c;let C,b;if(a===Da)C=(o+s)*u,b=-2*u;else if(a===Hf)C=s*u,b=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*g,l[4]=0,l[8]=0,l[12]=-I,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-h,l[2]=0,l[6]=0,l[10]=b,l[14]=-C,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<16;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}const jI=new P,Po=new dt,yte=new P(0,0,0),Bte=new P(1,1,1),Zg=new P,pm=new P,Xs=new P,G8=new dt,S8=new gr;class YA{constructor(e=0,n=0,i=0,r=YA.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,r=this._order){return this._x=e,this._y=n,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],g=r[5],c=r[9],u=r[2],I=r[6],h=r[10];switch(n){case"XYZ":this._y=Math.asin(Ai(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(I,g),this._z=0);break;case"YXZ":this._x=Math.asin(-Ai(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,g)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ai(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-o,g)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Ai(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(I,h),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,g));break;case"YZX":this._z=Math.asin(Ai(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,g),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Ai(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(I,g),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return G8.makeRotationFromQuaternion(e),this.setFromRotationMatrix(G8,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return S8.setFromEuler(this),this.setFromQuaternion(S8,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}YA.DEFAULT_ORDER="XYZ";class Yu{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Gte=0;const w8=new P,qI=new gr,xl=new dt,mm=new P,Vh=new P,Ste=new P,wte=new gr,R8=new P(1,0,0),x8=new P(0,1,0),Z8=new P(0,0,1),Rte={type:"added"},xte={type:"removed"};class cn extends sl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Gte++}),this.uuid=$s(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cn.DEFAULT_UP.clone();const e=new P,n=new YA,i=new gr,r=new P(1,1,1);function s(){i.setFromEuler(n,!1)}function o(){n.setFromQuaternion(i,void 0,!1)}n._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new dt},normalMatrix:{value:new Pt}}),this.matrix=new dt,this.matrixWorld=new dt,this.matrixAutoUpdate=cn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=cn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Yu,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return qI.setFromAxisAngle(e,n),this.quaternion.multiply(qI),this}rotateOnWorldAxis(e,n){return qI.setFromAxisAngle(e,n),this.quaternion.premultiply(qI),this}rotateX(e){return this.rotateOnAxis(R8,e)}rotateY(e){return this.rotateOnAxis(x8,e)}rotateZ(e){return this.rotateOnAxis(Z8,e)}translateOnAxis(e,n){return w8.copy(e).applyQuaternion(this.quaternion),this.position.add(w8.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(R8,e)}translateY(e){return this.translateOnAxis(x8,e)}translateZ(e){return this.translateOnAxis(Z8,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(xl.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?mm.copy(e):mm.set(e,n,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Vh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xl.lookAt(Vh,mm,this.up):xl.lookAt(mm,Vh,this.up),this.quaternion.setFromRotationMatrix(xl),r&&(xl.extractRotation(r.matrixWorld),qI.setFromRotationMatrix(xl),this.quaternion.premultiply(qI.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Rte)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(xte)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),xl.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),xl.multiply(e.parent.matrixWorld)),e.applyMatrix4(xl),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,n);if(o!==void 0)return o}}getObjectsByProperty(e,n){let i=[];this[e]===n&&i.push(this);for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectsByProperty(e,n);o.length>0&&(i=i.concat(o))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vh,e,Ste),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vh,wte,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let i=0,r=n.length;i<r;i++){const s=n[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,n){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let g=0,c=l.length;g<c;g++){const u=l[g];s(e.shapes,u)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,g=this.material.length;l<g;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(n){const a=o(e.geometries),l=o(e.materials),g=o(e.textures),c=o(e.images),u=o(e.shapes),I=o(e.skeletons),h=o(e.animations),C=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),g.length>0&&(i.textures=g),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),I.length>0&&(i.skeletons=I),h.length>0&&(i.animations=h),C.length>0&&(i.nodes=C)}return i.object=r,i;function o(a){const l=[];for(const g in a){const c=a[g];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}cn.DEFAULT_UP=new P(0,1,0);cn.DEFAULT_MATRIX_AUTO_UPDATE=!0;cn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Oo=new P,Zl=new P,k5=new P,El=new P,$I=new P,ed=new P,E8=new P,H5=new P,_5=new P,X5=new P;let bm=!1;class ms{constructor(e=new P,n=new P,i=new P){this.a=e,this.b=n,this.c=i}static getNormal(e,n,i,r){r.subVectors(i,n),Oo.subVectors(e,n),r.cross(Oo);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,n,i,r,s){Oo.subVectors(r,n),Zl.subVectors(i,n),k5.subVectors(e,n);const o=Oo.dot(Oo),a=Oo.dot(Zl),l=Oo.dot(k5),g=Zl.dot(Zl),c=Zl.dot(k5),u=o*g-a*a;if(u===0)return s.set(-2,-1,-1);const I=1/u,h=(g*l-a*c)*I,C=(o*c-a*l)*I;return s.set(1-h-C,C,h)}static containsPoint(e,n,i,r){return this.getBarycoord(e,n,i,r,El),El.x>=0&&El.y>=0&&El.x+El.y<=1}static getUV(e,n,i,r,s,o,a,l){return bm===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),bm=!0),this.getInterpolation(e,n,i,r,s,o,a,l)}static getInterpolation(e,n,i,r,s,o,a,l){return this.getBarycoord(e,n,i,r,El),l.setScalar(0),l.addScaledVector(s,El.x),l.addScaledVector(o,El.y),l.addScaledVector(a,El.z),l}static isFrontFacing(e,n,i,r){return Oo.subVectors(i,n),Zl.subVectors(e,n),Oo.cross(Zl).dot(r)<0}set(e,n,i){return this.a.copy(e),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(e,n,i,r){return this.a.copy(e[n]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,n,i,r){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Oo.subVectors(this.c,this.b),Zl.subVectors(this.a,this.b),Oo.cross(Zl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ms.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return ms.getBarycoord(e,this.a,this.b,this.c,n)}getUV(e,n,i,r,s){return bm===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),bm=!0),ms.getInterpolation(e,this.a,this.b,this.c,n,i,r,s)}getInterpolation(e,n,i,r,s){return ms.getInterpolation(e,this.a,this.b,this.c,n,i,r,s)}containsPoint(e){return ms.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ms.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const i=this.a,r=this.b,s=this.c;let o,a;$I.subVectors(r,i),ed.subVectors(s,i),H5.subVectors(e,i);const l=$I.dot(H5),g=ed.dot(H5);if(l<=0&&g<=0)return n.copy(i);_5.subVectors(e,r);const c=$I.dot(_5),u=ed.dot(_5);if(c>=0&&u<=c)return n.copy(r);const I=l*u-c*g;if(I<=0&&l>=0&&c<=0)return o=l/(l-c),n.copy(i).addScaledVector($I,o);X5.subVectors(e,s);const h=$I.dot(X5),C=ed.dot(X5);if(C>=0&&h<=C)return n.copy(s);const b=h*g-l*C;if(b<=0&&g>=0&&C<=0)return a=g/(g-C),n.copy(i).addScaledVector(ed,a);const m=c*C-h*u;if(m<=0&&u-c>=0&&h-C>=0)return E8.subVectors(s,r),a=(u-c)/(u-c+(h-C)),n.copy(r).addScaledVector(E8,a);const f=1/(m+b+I);return o=b*f,a=I*f,n.copy(i).addScaledVector($I,o).addScaledVector(ed,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Zte=0;class br extends sl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Zte++}),this.uuid=$s(),this.name="",this.type="Material",this.blending=Ja,this.side=il,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Sf,this.blendDst=wf,this.blendEquation=Os,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ab,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AH,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=$2,this.stencilZFail=$2,this.stencilZPass=$2,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const i=e[n];if(i===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const r=this[n];if(r===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ja&&(i.blending=this.blending),this.side!==il&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=this.alphaHash),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(n){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let i=null;if(n!==null){const r=n.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=n[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const RH={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qo={h:0,s:0,l:0},vm={h:0,s:0,l:0};function Y5(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class et{constructor(e,n,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,i)}set(e,n,i){if(n===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,n,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Hn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,yo.toWorkingColorSpace(this,n),this}setRGB(e,n,i,r=yo.workingColorSpace){return this.r=e,this.g=n,this.b=i,yo.toWorkingColorSpace(this,r),this}setHSL(e,n,i,r=yo.workingColorSpace){if(e=ax(e,1),n=Ai(n,0,1),i=Ai(i,0,1),n===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+n):i+n-i*n,o=2*i-s;this.r=Y5(o,s,e+1/3),this.g=Y5(o,s,e),this.b=Y5(o,s,e-1/3)}return yo.toWorkingColorSpace(this,r),this}setStyle(e,n=Hn){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Hn){const i=RH[e.toLowerCase()];return i!==void 0?this.setHex(i,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=sA(e.r),this.g=sA(e.g),this.b=sA(e.b),this}copyLinearToSRGB(e){return this.r=E5(e.r),this.g=E5(e.g),this.b=E5(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Hn){return yo.fromWorkingColorSpace(Er.copy(this),e),Math.round(Ai(Er.r*255,0,255))*65536+Math.round(Ai(Er.g*255,0,255))*256+Math.round(Ai(Er.b*255,0,255))}getHexString(e=Hn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=yo.workingColorSpace){yo.fromWorkingColorSpace(Er.copy(this),n);const i=Er.r,r=Er.g,s=Er.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,g;const c=(a+o)/2;if(a===o)l=0,g=0;else{const u=o-a;switch(g=c<=.5?u/(o+a):u/(2-o-a),o){case i:l=(r-s)/u+(r<s?6:0);break;case r:l=(s-i)/u+2;break;case s:l=(i-r)/u+4;break}l/=6}return e.h=l,e.s=g,e.l=c,e}getRGB(e,n=yo.workingColorSpace){return yo.fromWorkingColorSpace(Er.copy(this),n),e.r=Er.r,e.g=Er.g,e.b=Er.b,e}getStyle(e=Hn){yo.fromWorkingColorSpace(Er.copy(this),e);const n=Er.r,i=Er.g,r=Er.b;return e!==Hn?`color(${e} ${n.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,n,i){return this.getHSL(Qo),Qo.h+=e,Qo.s+=n,Qo.l+=i,this.setHSL(Qo.h,Qo.s,Qo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,i){return this.r=e.r+(n.r-e.r)*i,this.g=e.g+(n.g-e.g)*i,this.b=e.b+(n.b-e.b)*i,this}lerpHSL(e,n){this.getHSL(Qo),e.getHSL(vm);const i=TC(Qo.h,vm.h,n),r=TC(Qo.s,vm.s,n),s=TC(Qo.l,vm.l,n);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*n+s[3]*i+s[6]*r,this.g=s[1]*n+s[4]*i+s[7]*r,this.b=s[2]*n+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Er=new et;et.NAMES=RH;class to extends br{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=v0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const kl=Ete();function Ete(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const g=l-127;g<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):g<-14?(i[l]=1024>>-g-14,i[l|256]=1024>>-g-14|32768,r[l]=-g-1,r[l|256]=-g-1):g<=15?(i[l]=g+15<<10,i[l|256]=g+15<<10|32768,r[l]=13,r[l|256]=13):g<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let g=l<<13,c=0;for(;!(g&8388608);)g<<=1,c-=8388608;g&=-8388609,c+=947912704,s[l]=g|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function hs(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Ai(t,-65504,65504),kl.floatView[0]=t;const e=kl.uint32View[0],n=e>>23&511;return kl.baseTable[n]+((e&8388607)>>kl.shiftTable[n])}function cC(t){const e=t>>10;return kl.uint32View[0]=kl.mantissaTable[kl.offsetTable[e]+(t&1023)]+kl.exponentTable[e],kl.floatView[0]}const Wte={toHalfFloat:hs,fromHalfFloat:cC},Wi=new P,ym=new xe;class Wn{constructor(e,n,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=i,this.usage=kf,this.updateRange={offset:0,count:-1},this.gpuType=es,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,i){e*=this.itemSize,i*=n.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=n.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)ym.fromBufferAttribute(this,n),ym.applyMatrix3(e),this.setXY(n,ym.x,ym.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)Wi.fromBufferAttribute(this,n),Wi.applyMatrix3(e),this.setXYZ(n,Wi.x,Wi.y,Wi.z);return this}applyMatrix4(e){for(let n=0,i=this.count;n<i;n++)Wi.fromBufferAttribute(this,n),Wi.applyMatrix4(e),this.setXYZ(n,Wi.x,Wi.y,Wi.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)Wi.fromBufferAttribute(this,n),Wi.applyNormalMatrix(e),this.setXYZ(n,Wi.x,Wi.y,Wi.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)Wi.fromBufferAttribute(this,n),Wi.transformDirection(e),this.setXYZ(n,Wi.x,Wi.y,Wi.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let i=this.array[e*this.itemSize+n];return this.normalized&&(i=bs(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=Ot(i,this.array)),this.array[e*this.itemSize+n]=i,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=bs(n,this.array)),n}setX(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=bs(n,this.array)),n}setY(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=bs(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=bs(n,this.array)),n}setW(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array)),this.array[e+0]=n,this.array[e+1]=i,this}setXYZ(e,n,i,r){return e*=this.itemSize,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array),r=Ot(r,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,n,i,r,s){return e*=this.itemSize,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array),r=Ot(r,this.array),s=Ot(s,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==kf&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class Nte extends Wn{constructor(e,n,i){super(new Int8Array(e),n,i)}}class Mte extends Wn{constructor(e,n,i){super(new Uint8Array(e),n,i)}}class Tte extends Wn{constructor(e,n,i){super(new Uint8ClampedArray(e),n,i)}}class Fte extends Wn{constructor(e,n,i){super(new Int16Array(e),n,i)}}class cx extends Wn{constructor(e,n,i){super(new Uint16Array(e),n,i)}}class Vte extends Wn{constructor(e,n,i){super(new Int32Array(e),n,i)}}class Zv extends Wn{constructor(e,n,i){super(new Uint32Array(e),n,i)}}class Lte extends Wn{constructor(e,n,i){super(new Uint16Array(e),n,i),this.isFloat16BufferAttribute=!0}getX(e){let n=cC(this.array[e*this.itemSize]);return this.normalized&&(n=bs(n,this.array)),n}setX(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize]=hs(n),this}getY(e){let n=cC(this.array[e*this.itemSize+1]);return this.normalized&&(n=bs(n,this.array)),n}setY(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize+1]=hs(n),this}getZ(e){let n=cC(this.array[e*this.itemSize+2]);return this.normalized&&(n=bs(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize+2]=hs(n),this}getW(e){let n=cC(this.array[e*this.itemSize+3]);return this.normalized&&(n=bs(n,this.array)),n}setW(e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[e*this.itemSize+3]=hs(n),this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array)),this.array[e+0]=hs(n),this.array[e+1]=hs(i),this}setXYZ(e,n,i,r){return e*=this.itemSize,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array),r=Ot(r,this.array)),this.array[e+0]=hs(n),this.array[e+1]=hs(i),this.array[e+2]=hs(r),this}setXYZW(e,n,i,r,s){return e*=this.itemSize,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array),r=Ot(r,this.array),s=Ot(s,this.array)),this.array[e+0]=hs(n),this.array[e+1]=hs(i),this.array[e+2]=hs(r),this.array[e+3]=hs(s),this}}class ut extends Wn{constructor(e,n,i){super(new Float32Array(e),n,i)}}class kte extends Wn{constructor(e,n,i){super(new Float64Array(e),n,i)}}let Hte=0;const vo=new dt,K5=new cn,td=new P,Ys=new va,Lh=new va,nr=new P;class Lt extends sl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Hte++}),this.uuid=$s(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(GH(e)?Zv:cx)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,i=0){this.groups.push({start:e,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Pt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return vo.makeRotationFromQuaternion(e),this.applyMatrix4(vo),this}rotateX(e){return vo.makeRotationX(e),this.applyMatrix4(vo),this}rotateY(e){return vo.makeRotationY(e),this.applyMatrix4(vo),this}rotateZ(e){return vo.makeRotationZ(e),this.applyMatrix4(vo),this}translate(e,n,i){return vo.makeTranslation(e,n,i),this.applyMatrix4(vo),this}scale(e,n,i){return vo.makeScale(e,n,i),this.applyMatrix4(vo),this}lookAt(e){return K5.lookAt(e),K5.updateMatrix(),this.applyMatrix4(K5.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(td).negate(),this.translate(td.x,td.y,td.z),this}setFromPoints(e){const n=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];n.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ut(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new va);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let i=0,r=n.length;i<r;i++){const s=n[i];Ys.setFromBufferAttribute(s),this.morphTargetsRelative?(nr.addVectors(this.boundingBox.min,Ys.min),this.boundingBox.expandByPoint(nr),nr.addVectors(this.boundingBox.max,Ys.max),this.boundingBox.expandByPoint(nr)):(this.boundingBox.expandByPoint(Ys.min),this.boundingBox.expandByPoint(Ys.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ho);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new P,1/0);return}if(e){const i=this.boundingSphere.center;if(Ys.setFromBufferAttribute(e),n)for(let s=0,o=n.length;s<o;s++){const a=n[s];Lh.setFromBufferAttribute(a),this.morphTargetsRelative?(nr.addVectors(Ys.min,Lh.min),Ys.expandByPoint(nr),nr.addVectors(Ys.max,Lh.max),Ys.expandByPoint(nr)):(Ys.expandByPoint(Lh.min),Ys.expandByPoint(Lh.max))}Ys.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)nr.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(nr));if(n)for(let s=0,o=n.length;s<o;s++){const a=n[s],l=this.morphTargetsRelative;for(let g=0,c=a.count;g<c;g++)nr.fromBufferAttribute(a,g),l&&(td.fromBufferAttribute(e,g),nr.add(td)),r=Math.max(r,i.distanceToSquared(nr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,r=n.position.array,s=n.normal.array,o=n.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Wn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,g=[],c=[];for(let W=0;W<a;W++)g[W]=new P,c[W]=new P;const u=new P,I=new P,h=new P,C=new xe,b=new xe,m=new xe,f=new P,p=new P;function v(W,T,k){u.fromArray(r,W*3),I.fromArray(r,T*3),h.fromArray(r,k*3),C.fromArray(o,W*2),b.fromArray(o,T*2),m.fromArray(o,k*2),I.sub(u),h.sub(u),b.sub(C),m.sub(C);const _=1/(b.x*m.y-m.x*b.y);isFinite(_)&&(f.copy(I).multiplyScalar(m.y).addScaledVector(h,-b.y).multiplyScalar(_),p.copy(h).multiplyScalar(b.x).addScaledVector(I,-m.x).multiplyScalar(_),g[W].add(f),g[T].add(f),g[k].add(f),c[W].add(p),c[T].add(p),c[k].add(p))}let B=this.groups;B.length===0&&(B=[{start:0,count:i.length}]);for(let W=0,T=B.length;W<T;++W){const k=B[W],_=k.start,U=k.count;for(let O=_,Y=_+U;O<Y;O+=3)v(i[O+0],i[O+1],i[O+2])}const G=new P,R=new P,w=new P,E=new P;function x(W){w.fromArray(s,W*3),E.copy(w);const T=g[W];G.copy(T),G.sub(w.multiplyScalar(w.dot(T))).normalize(),R.crossVectors(E,T);const _=R.dot(c[W])<0?-1:1;l[W*4]=G.x,l[W*4+1]=G.y,l[W*4+2]=G.z,l[W*4+3]=_}for(let W=0,T=B.length;W<T;++W){const k=B[W],_=k.start,U=k.count;for(let O=_,Y=_+U;O<Y;O+=3)x(i[O+0]),x(i[O+1]),x(i[O+2])}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Wn(new Float32Array(n.count*3),3),this.setAttribute("normal",i);else for(let I=0,h=i.count;I<h;I++)i.setXYZ(I,0,0,0);const r=new P,s=new P,o=new P,a=new P,l=new P,g=new P,c=new P,u=new P;if(e)for(let I=0,h=e.count;I<h;I+=3){const C=e.getX(I+0),b=e.getX(I+1),m=e.getX(I+2);r.fromBufferAttribute(n,C),s.fromBufferAttribute(n,b),o.fromBufferAttribute(n,m),c.subVectors(o,s),u.subVectors(r,s),c.cross(u),a.fromBufferAttribute(i,C),l.fromBufferAttribute(i,b),g.fromBufferAttribute(i,m),a.add(c),l.add(c),g.add(c),i.setXYZ(C,a.x,a.y,a.z),i.setXYZ(b,l.x,l.y,l.z),i.setXYZ(m,g.x,g.y,g.z)}else for(let I=0,h=n.count;I<h;I+=3)r.fromBufferAttribute(n,I+0),s.fromBufferAttribute(n,I+1),o.fromBufferAttribute(n,I+2),c.subVectors(o,s),u.subVectors(r,s),c.cross(u),i.setXYZ(I+0,c.x,c.y,c.z),i.setXYZ(I+1,c.x,c.y,c.z),i.setXYZ(I+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,i=e.count;n<i;n++)nr.fromBufferAttribute(e,n),nr.normalize(),e.setXYZ(n,nr.x,nr.y,nr.z)}toNonIndexed(){function e(a,l){const g=a.array,c=a.itemSize,u=a.normalized,I=new g.constructor(l.length*c);let h=0,C=0;for(let b=0,m=l.length;b<m;b++){a.isInterleavedBufferAttribute?h=l[b]*a.data.stride+a.offset:h=l[b]*c;for(let f=0;f<c;f++)I[C++]=g[h++]}return new Wn(I,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Lt,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],g=e(l,i);n.setAttribute(a,g)}const s=this.morphAttributes;for(const a in s){const l=[],g=s[a];for(let c=0,u=g.length;c<u;c++){const I=g[c],h=e(I,i);l.push(h)}n.morphAttributes[a]=l}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const g=o[a];n.addGroup(g.start,g.count,g.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const g in l)l[g]!==void 0&&(e[g]=l[g]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const l in i){const g=i[l];e.data.attributes[l]=g.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const g=this.morphAttributes[l],c=[];for(let u=0,I=g.length;u<I;u++){const h=g[u];c.push(h.toJSON(e.data))}c.length>0&&(r[l]=c,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(n));const r=e.attributes;for(const g in r){const c=r[g];this.setAttribute(g,c.clone(n))}const s=e.morphAttributes;for(const g in s){const c=[],u=s[g];for(let I=0,h=u.length;I<h;I++)c.push(u[I].clone(n));this.morphAttributes[g]=c}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let g=0,c=o.length;g<c;g++){const u=o[g];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const W8=new dt,qc=new bI,Bm=new Ho,N8=new P,nd=new P,id=new P,rd=new P,z5=new P,Gm=new P,Sm=new xe,wm=new xe,Rm=new xe,M8=new P,T8=new P,F8=new P,xm=new P,Zm=new P;class pn extends cn{constructor(e=new Lt,n=new to){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,n){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;n.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){Gm.set(0,0,0);for(let l=0,g=s.length;l<g;l++){const c=a[l],u=s[l];c!==0&&(z5.fromBufferAttribute(u,e),o?Gm.addScaledVector(z5,c):Gm.addScaledVector(z5.sub(n),c))}n.add(Gm)}return n}raycast(e,n){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Bm.copy(i.boundingSphere),Bm.applyMatrix4(s),qc.copy(e.ray).recast(e.near),!(Bm.containsPoint(qc.origin)===!1&&(qc.intersectSphere(Bm,N8)===null||qc.origin.distanceToSquared(N8)>(e.far-e.near)**2))&&(W8.copy(s).invert(),qc.copy(e.ray).applyMatrix4(W8),!(i.boundingBox!==null&&qc.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,n,qc)))}_computeIntersections(e,n,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,g=s.attributes.uv,c=s.attributes.uv1,u=s.attributes.normal,I=s.groups,h=s.drawRange;if(a!==null)if(Array.isArray(o))for(let C=0,b=I.length;C<b;C++){const m=I[C],f=o[m.materialIndex],p=Math.max(m.start,h.start),v=Math.min(a.count,Math.min(m.start+m.count,h.start+h.count));for(let B=p,G=v;B<G;B+=3){const R=a.getX(B),w=a.getX(B+1),E=a.getX(B+2);r=Em(this,f,e,i,g,c,u,R,w,E),r&&(r.faceIndex=Math.floor(B/3),r.face.materialIndex=m.materialIndex,n.push(r))}}else{const C=Math.max(0,h.start),b=Math.min(a.count,h.start+h.count);for(let m=C,f=b;m<f;m+=3){const p=a.getX(m),v=a.getX(m+1),B=a.getX(m+2);r=Em(this,o,e,i,g,c,u,p,v,B),r&&(r.faceIndex=Math.floor(m/3),n.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let C=0,b=I.length;C<b;C++){const m=I[C],f=o[m.materialIndex],p=Math.max(m.start,h.start),v=Math.min(l.count,Math.min(m.start+m.count,h.start+h.count));for(let B=p,G=v;B<G;B+=3){const R=B,w=B+1,E=B+2;r=Em(this,f,e,i,g,c,u,R,w,E),r&&(r.faceIndex=Math.floor(B/3),r.face.materialIndex=m.materialIndex,n.push(r))}}else{const C=Math.max(0,h.start),b=Math.min(l.count,h.start+h.count);for(let m=C,f=b;m<f;m+=3){const p=m,v=m+1,B=m+2;r=Em(this,o,e,i,g,c,u,p,v,B),r&&(r.faceIndex=Math.floor(m/3),n.push(r))}}}}function _te(t,e,n,i,r,s,o,a){let l;if(e.side===fr?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===il,a),l===null)return null;Zm.copy(a),Zm.applyMatrix4(t.matrixWorld);const g=n.ray.origin.distanceTo(Zm);return g<n.near||g>n.far?null:{distance:g,point:Zm.clone(),object:t}}function Em(t,e,n,i,r,s,o,a,l,g){t.getVertexPosition(a,nd),t.getVertexPosition(l,id),t.getVertexPosition(g,rd);const c=_te(t,e,n,i,nd,id,rd,xm);if(c){r&&(Sm.fromBufferAttribute(r,a),wm.fromBufferAttribute(r,l),Rm.fromBufferAttribute(r,g),c.uv=ms.getInterpolation(xm,nd,id,rd,Sm,wm,Rm,new xe)),s&&(Sm.fromBufferAttribute(s,a),wm.fromBufferAttribute(s,l),Rm.fromBufferAttribute(s,g),c.uv1=ms.getInterpolation(xm,nd,id,rd,Sm,wm,Rm,new xe),c.uv2=c.uv1),o&&(M8.fromBufferAttribute(o,a),T8.fromBufferAttribute(o,l),F8.fromBufferAttribute(o,g),c.normal=ms.getInterpolation(xm,nd,id,rd,M8,T8,F8,new P),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const u={a,b:l,c:g,normal:new P,materialIndex:0};ms.getNormal(nd,id,rd,u.normal),c.face=u}return c}class wc extends Lt{constructor(e=1,n=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],g=[],c=[],u=[];let I=0,h=0;C("z","y","x",-1,-1,i,n,e,o,s,0),C("z","y","x",1,-1,i,n,-e,o,s,1),C("x","z","y",1,1,e,i,n,r,o,2),C("x","z","y",1,-1,e,i,-n,r,o,3),C("x","y","z",1,-1,e,n,i,r,s,4),C("x","y","z",-1,-1,e,n,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new ut(g,3)),this.setAttribute("normal",new ut(c,3)),this.setAttribute("uv",new ut(u,2));function C(b,m,f,p,v,B,G,R,w,E,x){const W=B/w,T=G/E,k=B/2,_=G/2,U=R/2,O=w+1,Y=E+1;let z=0,N=0;const L=new P;for(let V=0;V<Y;V++){const M=V*T-_;for(let X=0;X<O;X++){const J=X*W-k;L[b]=J*p,L[m]=M*v,L[f]=U,g.push(L.x,L.y,L.z),L[b]=0,L[m]=0,L[f]=R>0?1:-1,c.push(L.x,L.y,L.z),u.push(X/w),u.push(1-V/E),z+=1}}for(let V=0;V<E;V++)for(let M=0;M<w;M++){const X=I+M+O*V,J=I+M+O*(V+1),re=I+(M+1)+O*(V+1),se=I+(M+1)+O*V;l.push(X,J,se),l.push(J,re,se),N+=6}a.addGroup(h,N,x),h+=N,I+=z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function yA(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Qr(t){const e={};for(let n=0;n<t.length;n++){const i=yA(t[n]);for(const r in i)e[r]=i[r]}return e}function Xte(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function xH(t){return t.getRenderTarget()===null?t.outputColorSpace:Ca}const Pn={clone:yA,merge:Qr};var Yte=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Kte=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class an extends br{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Yte,this.fragmentShader=Kte,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=yA(e.uniforms),this.uniformsGroups=Xte(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?n.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?n.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[r]={type:"m4",value:o.toArray()}:n.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}class B0 extends cn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new dt,this.projectionMatrix=new dt,this.projectionMatrixInverse=new dt,this.coordinateSystem=Da}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(-n[8],-n[9],-n[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Zn extends B0{constructor(e=50,n=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=vA*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Xu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return vA*2*Math.atan(Math.tan(Xu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,n,i,r,s,o){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(Xu*.5*this.fov)/this.zoom,i=2*n,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,g=o.fullHeight;s+=o.offsetX*r/l,n-=o.offsetY*i/g,r*=o.width/l,i*=o.height/g}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,n,n-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const sd=-90,od=1;class ZH extends cn{constructor(e,n,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const r=new Zn(sd,od,e,n);r.layers=this.layers,this.add(r);const s=new Zn(sd,od,e,n);s.layers=this.layers,this.add(s);const o=new Zn(sd,od,e,n);o.layers=this.layers,this.add(o);const a=new Zn(sd,od,e,n);a.layers=this.layers,this.add(a);const l=new Zn(sd,od,e,n);l.layers=this.layers,this.add(l);const g=new Zn(sd,od,e,n);g.layers=this.layers,this.add(g)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[i,r,s,o,a,l]=n;for(const g of n)this.remove(g);if(e===Da)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Hf)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const g of n)this.add(g),g.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,o,a,l,g]=this.children,c=e.getRenderTarget(),u=e.xr.enabled;e.xr.enabled=!1;const I=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(n,r),e.setRenderTarget(i,1),e.render(n,s),e.setRenderTarget(i,2),e.render(n,o),e.setRenderTarget(i,3),e.render(n,a),e.setRenderTarget(i,4),e.render(n,l),i.texture.generateMipmaps=I,e.setRenderTarget(i,5),e.render(n,g),e.setRenderTarget(c),e.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class G0 extends ei{constructor(e,n,i,r,s,o,a,l,g,c){e=e!==void 0?e:[],n=n!==void 0?n:tg,super(e,n,i,r,s,o,a,l,g,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class EH extends En{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];n.encoding!==void 0&&(FC("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===sc?Hn:oc),this.texture=new G0(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:xn}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new wc(5,5,5),s=new an({name:"CubemapFromEquirect",uniforms:yA(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:fr,blending:tn});s.uniforms.tEquirect.value=n;const o=new pn(r,s),a=n.minFilter;return n.minFilter===rl&&(n.minFilter=xn),new ZH(1,10,this).update(e,o),n.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,n,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(n,i,r);e.setRenderTarget(s)}}const U5=new P,zte=new P,Ute=new Pt;class Ds{constructor(e=new P(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,i,r){return this.normal.set(e,n,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,i){const r=U5.subVectors(i,n).cross(zte.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const i=e.delta(U5),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:n.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return n<0&&i>0||i<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const i=n||Ute.getNormalMatrix(e),r=this.coplanarPoint(U5).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const $c=new Ho,Wm=new P;class Ev{constructor(e=new Ds,n=new Ds,i=new Ds,r=new Ds,s=new Ds,o=new Ds){this.planes=[e,n,i,r,s,o]}set(e,n,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,n=Da){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],g=r[4],c=r[5],u=r[6],I=r[7],h=r[8],C=r[9],b=r[10],m=r[11],f=r[12],p=r[13],v=r[14],B=r[15];if(i[0].setComponents(l-s,I-g,m-h,B-f).normalize(),i[1].setComponents(l+s,I+g,m+h,B+f).normalize(),i[2].setComponents(l+o,I+c,m+C,B+p).normalize(),i[3].setComponents(l-o,I-c,m-C,B-p).normalize(),i[4].setComponents(l-a,I-u,m-b,B-v).normalize(),n===Da)i[5].setComponents(l+a,I+u,m+b,B+v).normalize();else if(n===Hf)i[5].setComponents(a,u,b,v).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),$c.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),$c.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere($c)}intersectsSprite(e){return $c.center.set(0,0,0),$c.radius=.7071067811865476,$c.applyMatrix4(e.matrixWorld),this.intersectsSphere($c)}intersectsSphere(e){const n=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const n=this.planes;for(let i=0;i<6;i++){const r=n[i];if(Wm.x=r.normal.x>0?e.max.x:e.min.x,Wm.y=r.normal.y>0?e.max.y:e.min.y,Wm.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Wm)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WH(){let t=null,e=!1,n=null,i=null;function r(s,o){n(s,o),i=t.requestAnimationFrame(r)}return{start:function(){e!==!0&&n!==null&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function Dte(t,e){const n=e.isWebGL2,i=new WeakMap;function r(g,c){const u=g.array,I=g.usage,h=t.createBuffer();t.bindBuffer(c,h),t.bufferData(c,u,I),g.onUploadCallback();let C;if(u instanceof Float32Array)C=t.FLOAT;else if(u instanceof Uint16Array)if(g.isFloat16BufferAttribute)if(n)C=t.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else C=t.UNSIGNED_SHORT;else if(u instanceof Int16Array)C=t.SHORT;else if(u instanceof Uint32Array)C=t.UNSIGNED_INT;else if(u instanceof Int32Array)C=t.INT;else if(u instanceof Int8Array)C=t.BYTE;else if(u instanceof Uint8Array)C=t.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)C=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:h,type:C,bytesPerElement:u.BYTES_PER_ELEMENT,version:g.version}}function s(g,c,u){const I=c.array,h=c.updateRange;t.bindBuffer(u,g),h.count===-1?t.bufferSubData(u,0,I):(n?t.bufferSubData(u,h.offset*I.BYTES_PER_ELEMENT,I,h.offset,h.count):t.bufferSubData(u,h.offset*I.BYTES_PER_ELEMENT,I.subarray(h.offset,h.offset+h.count)),h.count=-1),c.onUploadCallback()}function o(g){return g.isInterleavedBufferAttribute&&(g=g.data),i.get(g)}function a(g){g.isInterleavedBufferAttribute&&(g=g.data);const c=i.get(g);c&&(t.deleteBuffer(c.buffer),i.delete(g))}function l(g,c){if(g.isGLBufferAttribute){const I=i.get(g);(!I||I.version<g.version)&&i.set(g,{buffer:g.buffer,type:g.type,bytesPerElement:g.elementSize,version:g.version});return}g.isInterleavedBufferAttribute&&(g=g.data);const u=i.get(g);u===void 0?i.set(g,r(g,c)):u.version<g.version&&(s(u.buffer,g,c),u.version=g.version)}return{get:o,remove:a,update:l}}class cg extends Lt{constructor(e=1,n=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:i,heightSegments:r};const s=e/2,o=n/2,a=Math.floor(i),l=Math.floor(r),g=a+1,c=l+1,u=e/a,I=n/l,h=[],C=[],b=[],m=[];for(let f=0;f<c;f++){const p=f*I-o;for(let v=0;v<g;v++){const B=v*u-s;C.push(B,-p,0),b.push(0,0,1),m.push(v/a),m.push(1-f/l)}}for(let f=0;f<l;f++)for(let p=0;p<a;p++){const v=p+g*f,B=p+g*(f+1),G=p+1+g*(f+1),R=p+1+g*f;h.push(v,B,R),h.push(B,G,R)}this.setIndex(h),this.setAttribute("position",new ut(C,3)),this.setAttribute("normal",new ut(b,3)),this.setAttribute("uv",new ut(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cg(e.width,e.height,e.widthSegments,e.heightSegments)}}var Pte=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Ote=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Qte=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Jte=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,jte=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,qte=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,$te=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ene=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,tne=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,nne=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ine=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,rne=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,sne=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,one=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,ane=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,lne=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,gne=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,cne=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,une=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Ine=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,dne=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Ane=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,hne=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Cne=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,fne=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,pne=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,mne=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,bne=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,vne="gl_FragColor = linearToOutputTexel( gl_FragColor );",yne=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Bne=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Gne=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Sne=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,wne=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Rne=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,xne=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Zne=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ene=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Wne=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Nne=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Mne=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Tne=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Fne=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Vne=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Lne=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,kne=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Hne=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,_ne=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Xne=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Yne=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Kne=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,zne=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Une=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Dne=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Pne=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,One=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Qne=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Jne=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,jne=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,qne=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,$ne=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,eie=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,tie=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,nie=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,iie=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,rie=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,sie=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,oie=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,aie=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,lie=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,gie=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,cie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Iie=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,die=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Aie=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,hie=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Cie=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,fie=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,pie=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,mie=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,bie=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,vie=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,yie=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Bie=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Gie=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Sie=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,wie=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Rie=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,xie=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Zie=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Eie=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Wie=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Nie=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Mie=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Tie=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Fie=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Vie=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Lie=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,kie=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Hie=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,_ie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Xie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Yie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Kie=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const zie=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Uie=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Die=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Pie=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Oie=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Qie=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Jie=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,jie=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,qie=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,$ie=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ere=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,tre=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nre=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ire=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rre=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,sre=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ore=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,are=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lre=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,gre=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cre=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,ure=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Ire=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dre=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Are=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,hre=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cre=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fre=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pre=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,mre=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bre=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vre=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,yre=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Bre=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ut={alphahash_fragment:Pte,alphahash_pars_fragment:Ote,alphamap_fragment:Qte,alphamap_pars_fragment:Jte,alphatest_fragment:jte,alphatest_pars_fragment:qte,aomap_fragment:$te,aomap_pars_fragment:ene,begin_vertex:tne,beginnormal_vertex:nne,bsdfs:ine,iridescence_fragment:rne,bumpmap_pars_fragment:sne,clipping_planes_fragment:one,clipping_planes_pars_fragment:ane,clipping_planes_pars_vertex:lne,clipping_planes_vertex:gne,color_fragment:cne,color_pars_fragment:une,color_pars_vertex:Ine,color_vertex:dne,common:Ane,cube_uv_reflection_fragment:hne,defaultnormal_vertex:Cne,displacementmap_pars_vertex:fne,displacementmap_vertex:pne,emissivemap_fragment:mne,emissivemap_pars_fragment:bne,colorspace_fragment:vne,colorspace_pars_fragment:yne,envmap_fragment:Bne,envmap_common_pars_fragment:Gne,envmap_pars_fragment:Sne,envmap_pars_vertex:wne,envmap_physical_pars_fragment:kne,envmap_vertex:Rne,fog_vertex:xne,fog_pars_vertex:Zne,fog_fragment:Ene,fog_pars_fragment:Wne,gradientmap_pars_fragment:Nne,lightmap_fragment:Mne,lightmap_pars_fragment:Tne,lights_lambert_fragment:Fne,lights_lambert_pars_fragment:Vne,lights_pars_begin:Lne,lights_toon_fragment:Hne,lights_toon_pars_fragment:_ne,lights_phong_fragment:Xne,lights_phong_pars_fragment:Yne,lights_physical_fragment:Kne,lights_physical_pars_fragment:zne,lights_fragment_begin:Une,lights_fragment_maps:Dne,lights_fragment_end:Pne,logdepthbuf_fragment:One,logdepthbuf_pars_fragment:Qne,logdepthbuf_pars_vertex:Jne,logdepthbuf_vertex:jne,map_fragment:qne,map_pars_fragment:$ne,map_particle_fragment:eie,map_particle_pars_fragment:tie,metalnessmap_fragment:nie,metalnessmap_pars_fragment:iie,morphcolor_vertex:rie,morphnormal_vertex:sie,morphtarget_pars_vertex:oie,morphtarget_vertex:aie,normal_fragment_begin:lie,normal_fragment_maps:gie,normal_pars_fragment:cie,normal_pars_vertex:uie,normal_vertex:Iie,normalmap_pars_fragment:die,clearcoat_normal_fragment_begin:Aie,clearcoat_normal_fragment_maps:hie,clearcoat_pars_fragment:Cie,iridescence_pars_fragment:fie,opaque_fragment:pie,packing:mie,premultiplied_alpha_fragment:bie,project_vertex:vie,dithering_fragment:yie,dithering_pars_fragment:Bie,roughnessmap_fragment:Gie,roughnessmap_pars_fragment:Sie,shadowmap_pars_fragment:wie,shadowmap_pars_vertex:Rie,shadowmap_vertex:xie,shadowmask_pars_fragment:Zie,skinbase_vertex:Eie,skinning_pars_vertex:Wie,skinning_vertex:Nie,skinnormal_vertex:Mie,specularmap_fragment:Tie,specularmap_pars_fragment:Fie,tonemapping_fragment:Vie,tonemapping_pars_fragment:Lie,transmission_fragment:kie,transmission_pars_fragment:Hie,uv_pars_fragment:_ie,uv_pars_vertex:Xie,uv_vertex:Yie,worldpos_vertex:Kie,background_vert:zie,background_frag:Uie,backgroundCube_vert:Die,backgroundCube_frag:Pie,cube_vert:Oie,cube_frag:Qie,depth_vert:Jie,depth_frag:jie,distanceRGBA_vert:qie,distanceRGBA_frag:$ie,equirect_vert:ere,equirect_frag:tre,linedashed_vert:nre,linedashed_frag:ire,meshbasic_vert:rre,meshbasic_frag:sre,meshlambert_vert:ore,meshlambert_frag:are,meshmatcap_vert:lre,meshmatcap_frag:gre,meshnormal_vert:cre,meshnormal_frag:ure,meshphong_vert:Ire,meshphong_frag:dre,meshphysical_vert:Are,meshphysical_frag:hre,meshtoon_vert:Cre,meshtoon_frag:fre,points_vert:pre,points_frag:mre,shadow_vert:bre,shadow_frag:vre,sprite_vert:yre,sprite_frag:Bre},it={common:{diffuse:{value:new et(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Pt},alphaMap:{value:null},alphaMapTransform:{value:new Pt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Pt}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Pt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Pt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Pt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Pt},normalScale:{value:new xe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Pt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Pt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Pt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Pt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new et(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new et(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Pt},alphaTest:{value:0},uvTransform:{value:new Pt}},sprite:{diffuse:{value:new et(16777215)},opacity:{value:1},center:{value:new xe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Pt},alphaMap:{value:null},alphaMapTransform:{value:new Pt},alphaTest:{value:0}}},ra={basic:{uniforms:Qr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.fog]),vertexShader:Ut.meshbasic_vert,fragmentShader:Ut.meshbasic_frag},lambert:{uniforms:Qr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.fog,it.lights,{emissive:{value:new et(0)}}]),vertexShader:Ut.meshlambert_vert,fragmentShader:Ut.meshlambert_frag},phong:{uniforms:Qr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.fog,it.lights,{emissive:{value:new et(0)},specular:{value:new et(1118481)},shininess:{value:30}}]),vertexShader:Ut.meshphong_vert,fragmentShader:Ut.meshphong_frag},standard:{uniforms:Qr([it.common,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.roughnessmap,it.metalnessmap,it.fog,it.lights,{emissive:{value:new et(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ut.meshphysical_vert,fragmentShader:Ut.meshphysical_frag},toon:{uniforms:Qr([it.common,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.gradientmap,it.fog,it.lights,{emissive:{value:new et(0)}}]),vertexShader:Ut.meshtoon_vert,fragmentShader:Ut.meshtoon_frag},matcap:{uniforms:Qr([it.common,it.bumpmap,it.normalmap,it.displacementmap,it.fog,{matcap:{value:null}}]),vertexShader:Ut.meshmatcap_vert,fragmentShader:Ut.meshmatcap_frag},points:{uniforms:Qr([it.points,it.fog]),vertexShader:Ut.points_vert,fragmentShader:Ut.points_frag},dashed:{uniforms:Qr([it.common,it.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ut.linedashed_vert,fragmentShader:Ut.linedashed_frag},depth:{uniforms:Qr([it.common,it.displacementmap]),vertexShader:Ut.depth_vert,fragmentShader:Ut.depth_frag},normal:{uniforms:Qr([it.common,it.bumpmap,it.normalmap,it.displacementmap,{opacity:{value:1}}]),vertexShader:Ut.meshnormal_vert,fragmentShader:Ut.meshnormal_frag},sprite:{uniforms:Qr([it.sprite,it.fog]),vertexShader:Ut.sprite_vert,fragmentShader:Ut.sprite_frag},background:{uniforms:{uvTransform:{value:new Pt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ut.background_vert,fragmentShader:Ut.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ut.backgroundCube_vert,fragmentShader:Ut.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ut.cube_vert,fragmentShader:Ut.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ut.equirect_vert,fragmentShader:Ut.equirect_frag},distanceRGBA:{uniforms:Qr([it.common,it.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ut.distanceRGBA_vert,fragmentShader:Ut.distanceRGBA_frag},shadow:{uniforms:Qr([it.lights,it.fog,{color:{value:new et(0)},opacity:{value:1}}]),vertexShader:Ut.shadow_vert,fragmentShader:Ut.shadow_frag}};ra.physical={uniforms:Qr([ra.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Pt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Pt},clearcoatNormalScale:{value:new xe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Pt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Pt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Pt},sheen:{value:0},sheenColor:{value:new et(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Pt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Pt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Pt},transmissionSamplerSize:{value:new xe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Pt},attenuationDistance:{value:0},attenuationColor:{value:new et(0)},specularColor:{value:new et(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Pt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Pt},anisotropyVector:{value:new xe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Pt}}]),vertexShader:Ut.meshphysical_vert,fragmentShader:Ut.meshphysical_frag};const Nm={r:0,b:0,g:0};function Gre(t,e,n,i,r,s,o){const a=new et(0);let l=s===!0?0:1,g,c,u=null,I=0,h=null;function C(m,f){let p=!1,v=f.isScene===!0?f.background:null;v&&v.isTexture&&(v=(f.backgroundBlurriness>0?n:e).get(v)),v===null?b(a,l):v&&v.isColor&&(b(v,1),p=!0);const B=t.xr.getEnvironmentBlendMode();B==="additive"?i.buffers.color.setClear(0,0,0,1,o):B==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.mapping===XA)?(c===void 0&&(c=new pn(new wc(1,1,1),new an({name:"BackgroundCubeMaterial",uniforms:yA(ra.backgroundCube.uniforms),vertexShader:ra.backgroundCube.vertexShader,fragmentShader:ra.backgroundCube.fragmentShader,side:fr,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(G,R,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,c.material.toneMapped=v.colorSpace!==Hn,(u!==v||I!==v.version||h!==t.toneMapping)&&(c.material.needsUpdate=!0,u=v,I=v.version,h=t.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(g===void 0&&(g=new pn(new cg(2,2),new an({name:"BackgroundMaterial",uniforms:yA(ra.background.uniforms),vertexShader:ra.background.vertexShader,fragmentShader:ra.background.fragmentShader,side:il,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),Object.defineProperty(g.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(g)),g.material.uniforms.t2D.value=v,g.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,g.material.toneMapped=v.colorSpace!==Hn,v.matrixAutoUpdate===!0&&v.updateMatrix(),g.material.uniforms.uvTransform.value.copy(v.matrix),(u!==v||I!==v.version||h!==t.toneMapping)&&(g.material.needsUpdate=!0,u=v,I=v.version,h=t.toneMapping),g.layers.enableAll(),m.unshift(g,g.geometry,g.material,0,0,null))}function b(m,f){m.getRGB(Nm,xH(t)),i.buffers.color.setClear(Nm.r,Nm.g,Nm.b,f,o)}return{getClearColor:function(){return a},setClearColor:function(m,f=1){a.set(m),l=f,b(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,b(a,l)},render:C}}function Sre(t,e,n,i){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||s!==null,a={},l=m(null);let g=l,c=!1;function u(U,O,Y,z,N){let L=!1;if(o){const V=b(z,Y,O);g!==V&&(g=V,h(g.object)),L=f(U,z,Y,N),L&&p(U,z,Y,N)}else{const V=O.wireframe===!0;(g.geometry!==z.id||g.program!==Y.id||g.wireframe!==V)&&(g.geometry=z.id,g.program=Y.id,g.wireframe=V,L=!0)}N!==null&&n.update(N,t.ELEMENT_ARRAY_BUFFER),(L||c)&&(c=!1,E(U,O,Y,z),N!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.get(N).buffer))}function I(){return i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}function h(U){return i.isWebGL2?t.bindVertexArray(U):s.bindVertexArrayOES(U)}function C(U){return i.isWebGL2?t.deleteVertexArray(U):s.deleteVertexArrayOES(U)}function b(U,O,Y){const z=Y.wireframe===!0;let N=a[U.id];N===void 0&&(N={},a[U.id]=N);let L=N[O.id];L===void 0&&(L={},N[O.id]=L);let V=L[z];return V===void 0&&(V=m(I()),L[z]=V),V}function m(U){const O=[],Y=[],z=[];for(let N=0;N<r;N++)O[N]=0,Y[N]=0,z[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:Y,attributeDivisors:z,object:U,attributes:{},index:null}}function f(U,O,Y,z){const N=g.attributes,L=O.attributes;let V=0;const M=Y.getAttributes();for(const X in M)if(M[X].location>=0){const re=N[X];let se=L[X];if(se===void 0&&(X==="instanceMatrix"&&U.instanceMatrix&&(se=U.instanceMatrix),X==="instanceColor"&&U.instanceColor&&(se=U.instanceColor)),re===void 0||re.attribute!==se||se&&re.data!==se.data)return!0;V++}return g.attributesNum!==V||g.index!==z}function p(U,O,Y,z){const N={},L=O.attributes;let V=0;const M=Y.getAttributes();for(const X in M)if(M[X].location>=0){let re=L[X];re===void 0&&(X==="instanceMatrix"&&U.instanceMatrix&&(re=U.instanceMatrix),X==="instanceColor"&&U.instanceColor&&(re=U.instanceColor));const se={};se.attribute=re,re&&re.data&&(se.data=re.data),N[X]=se,V++}g.attributes=N,g.attributesNum=V,g.index=z}function v(){const U=g.newAttributes;for(let O=0,Y=U.length;O<Y;O++)U[O]=0}function B(U){G(U,0)}function G(U,O){const Y=g.newAttributes,z=g.enabledAttributes,N=g.attributeDivisors;Y[U]=1,z[U]===0&&(t.enableVertexAttribArray(U),z[U]=1),N[U]!==O&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](U,O),N[U]=O)}function R(){const U=g.newAttributes,O=g.enabledAttributes;for(let Y=0,z=O.length;Y<z;Y++)O[Y]!==U[Y]&&(t.disableVertexAttribArray(Y),O[Y]=0)}function w(U,O,Y,z,N,L,V){V===!0?t.vertexAttribIPointer(U,O,Y,N,L):t.vertexAttribPointer(U,O,Y,z,N,L)}function E(U,O,Y,z){if(i.isWebGL2===!1&&(U.isInstancedMesh||z.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;v();const N=z.attributes,L=Y.getAttributes(),V=O.defaultAttributeValues;for(const M in L){const X=L[M];if(X.location>=0){let J=N[M];if(J===void 0&&(M==="instanceMatrix"&&U.instanceMatrix&&(J=U.instanceMatrix),M==="instanceColor"&&U.instanceColor&&(J=U.instanceColor)),J!==void 0){const re=J.normalized,se=J.itemSize,le=n.get(J);if(le===void 0)continue;const ae=le.buffer,ce=le.type,Ee=le.bytesPerElement,Fe=i.isWebGL2===!0&&(ce===t.INT||ce===t.UNSIGNED_INT||J.gpuType===qR);if(J.isInterleavedBufferAttribute){const oe=J.data,D=oe.stride,fe=J.offset;if(oe.isInstancedInterleavedBuffer){for(let Ce=0;Ce<X.locationSize;Ce++)G(X.location+Ce,oe.meshPerAttribute);U.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let Ce=0;Ce<X.locationSize;Ce++)B(X.location+Ce);t.bindBuffer(t.ARRAY_BUFFER,ae);for(let Ce=0;Ce<X.locationSize;Ce++)w(X.location+Ce,se/X.locationSize,ce,re,D*Ee,(fe+se/X.locationSize*Ce)*Ee,Fe)}else{if(J.isInstancedBufferAttribute){for(let oe=0;oe<X.locationSize;oe++)G(X.location+oe,J.meshPerAttribute);U.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let oe=0;oe<X.locationSize;oe++)B(X.location+oe);t.bindBuffer(t.ARRAY_BUFFER,ae);for(let oe=0;oe<X.locationSize;oe++)w(X.location+oe,se/X.locationSize,ce,re,se*Ee,se/X.locationSize*oe*Ee,Fe)}}else if(V!==void 0){const re=V[M];if(re!==void 0)switch(re.length){case 2:t.vertexAttrib2fv(X.location,re);break;case 3:t.vertexAttrib3fv(X.location,re);break;case 4:t.vertexAttrib4fv(X.location,re);break;default:t.vertexAttrib1fv(X.location,re)}}}}R()}function x(){k();for(const U in a){const O=a[U];for(const Y in O){const z=O[Y];for(const N in z)C(z[N].object),delete z[N];delete O[Y]}delete a[U]}}function W(U){if(a[U.id]===void 0)return;const O=a[U.id];for(const Y in O){const z=O[Y];for(const N in z)C(z[N].object),delete z[N];delete O[Y]}delete a[U.id]}function T(U){for(const O in a){const Y=a[O];if(Y[U.id]===void 0)continue;const z=Y[U.id];for(const N in z)C(z[N].object),delete z[N];delete Y[U.id]}}function k(){_(),c=!0,g!==l&&(g=l,h(g.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:k,resetDefaultState:_,dispose:x,releaseStatesOfGeometry:W,releaseStatesOfProgram:T,initAttributes:v,enableAttribute:B,disableUnusedAttributes:R}}function wre(t,e,n,i){const r=i.isWebGL2;let s;function o(g){s=g}function a(g,c){t.drawArrays(s,g,c),n.update(c,s,1)}function l(g,c,u){if(u===0)return;let I,h;if(r)I=t,h="drawArraysInstanced";else if(I=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",I===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}I[h](s,g,c,u),n.update(c,s,u)}this.setMode=o,this.render=a,this.renderInstances=l}function Rre(t,e,n){let i;function r(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const w=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(w){if(w==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";w="mediump"}return w==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&t.constructor.name==="WebGL2RenderingContext";let a=n.precision!==void 0?n.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const g=o||e.has("WEBGL_draw_buffers"),c=n.logarithmicDepthBuffer===!0,u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),I=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_TEXTURE_SIZE),C=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),b=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),f=t.getParameter(t.MAX_VARYING_VECTORS),p=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=I>0,B=o||e.has("OES_texture_float"),G=v&&B,R=o?t.getParameter(t.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:g,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:I,maxTextureSize:h,maxCubemapSize:C,maxAttributes:b,maxVertexUniforms:m,maxVaryings:f,maxFragmentUniforms:p,vertexTextures:v,floatFragmentTextures:B,floatVertexTextures:G,maxSamples:R}}function xre(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new Ds,a=new Pt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,I){const h=u.length!==0||I||i!==0||r;return r=I,i=u.length,h},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,I){n=c(u,I,0)},this.setState=function(u,I,h){const C=u.clippingPlanes,b=u.clipIntersection,m=u.clipShadows,f=t.get(u);if(!r||C===null||C.length===0||s&&!m)s?c(null):g();else{const p=s?0:i,v=p*4;let B=f.clippingState||null;l.value=B,B=c(C,I,v,h);for(let G=0;G!==v;++G)B[G]=n[G];f.clippingState=B,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=p}};function g(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(u,I,h,C){const b=u!==null?u.length:0;let m=null;if(b!==0){if(m=l.value,C!==!0||m===null){const f=h+b*4,p=I.matrixWorldInverse;a.getNormalMatrix(p),(m===null||m.length<f)&&(m=new Float32Array(f));for(let v=0,B=h;v!==b;++v,B+=4)o.copy(u[v]).applyMatrix4(p,a),o.normal.toArray(m,B),m[B+3]=o.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,m}}function Zre(t){let e=new WeakMap;function n(o,a){return a===Rf?o.mapping=tg:a===xf&&(o.mapping=Ac),o}function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===Rf||a===xf)if(e.has(o)){const l=e.get(o).texture;return n(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const g=new EH(l.height/2);return g.fromEquirectangularTexture(t,o),e.set(o,g),o.addEventListener("dispose",r),n(g.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class Zo extends B0{constructor(e=-1,n=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+n,l=r-n;if(this.view!==null&&this.view.enabled){const g=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=g*this.view.offsetX,o=s+g*this.view.width,a-=c*this.view.offsetY,l=a-c*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const kd=4,V8=[.125,.215,.35,.446,.526,.582],bu=20,D5=new Zo,L8=new et;let P5=null;const Au=(1+Math.sqrt(5))/2,ad=1/Au,k8=[new P(1,1,1),new P(-1,1,1),new P(1,1,-1),new P(-1,1,-1),new P(0,Au,ad),new P(0,Au,-ad),new P(ad,0,Au),new P(-ad,0,Au),new P(Au,ad,0),new P(-Au,ad,0)];class eS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,i=.1,r=100){P5=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),n>0&&this._blur(s,0,0,n),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=X8(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_8(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(P5),e.scissorTest=!1,Mm(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===tg||e.mapping===Ac?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),P5=this._renderer.getRenderTarget();const i=n||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,i={magFilter:xn,minFilter:xn,generateMipmaps:!1,type:Ri,format:fi,colorSpace:Ca,depthBuffer:!1},r=H8(e,n,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=H8(e,n,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Ere(s)),this._blurMaterial=Wre(s,e,n)}return r}_compileMaterial(e){const n=new pn(this._lodPlanes[0],e);this._renderer.compile(n,D5)}_sceneToCubeUV(e,n,i,r){const a=new Zn(90,1,n,i),l=[1,-1,1,1,1,1],g=[1,1,1,-1,-1,-1],c=this._renderer,u=c.autoClear,I=c.toneMapping;c.getClearColor(L8),c.toneMapping=Wo,c.autoClear=!1;const h=new to({name:"PMREM.Background",side:fr,depthWrite:!1,depthTest:!1}),C=new pn(new wc,h);let b=!1;const m=e.background;m?m.isColor&&(h.color.copy(m),e.background=null,b=!0):(h.color.copy(L8),b=!0);for(let f=0;f<6;f++){const p=f%3;p===0?(a.up.set(0,l[f],0),a.lookAt(g[f],0,0)):p===1?(a.up.set(0,0,l[f]),a.lookAt(0,g[f],0)):(a.up.set(0,l[f],0),a.lookAt(0,0,g[f]));const v=this._cubeSize;Mm(r,p*v,f>2?v:0,v,v),c.setRenderTarget(r),b&&c.render(C,a),c.render(e,a)}C.geometry.dispose(),C.material.dispose(),c.toneMapping=I,c.autoClear=u,e.background=m}_textureToCubeUV(e,n){const i=this._renderer,r=e.mapping===tg||e.mapping===Ac;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=X8()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_8());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new pn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Mm(n,0,0,3*l,2*l),i.setRenderTarget(n),i.render(o,D5)}_applyPMREM(e){const n=this._renderer,i=n.autoClear;n.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=k8[(r-1)%k8.length];this._blur(e,r-1,r,s,o)}n.autoClear=i}_blur(e,n,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,n,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,n,i,r,s,o,a){const l=this._renderer,g=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,u=new pn(this._lodPlanes[r],g),I=g.uniforms,h=this._sizeLods[i]-1,C=isFinite(s)?Math.PI/(2*h):2*Math.PI/(2*bu-1),b=s/C,m=isFinite(s)?1+Math.floor(c*b):bu;m>bu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${bu}`);const f=[];let p=0;for(let w=0;w<bu;++w){const E=w/b,x=Math.exp(-E*E/2);f.push(x),w===0?p+=x:w<m&&(p+=2*x)}for(let w=0;w<f.length;w++)f[w]=f[w]/p;I.envMap.value=e.texture,I.samples.value=m,I.weights.value=f,I.latitudinal.value=o==="latitudinal",a&&(I.poleAxis.value=a);const{_lodMax:v}=this;I.dTheta.value=C,I.mipInt.value=v-i;const B=this._sizeLods[r],G=3*B*(r>v-kd?r-v+kd:0),R=4*(this._cubeSize-B);Mm(n,G,R,3*B,2*B),l.setRenderTarget(n),l.render(u,D5)}}function Ere(t){const e=[],n=[],i=[];let r=t;const s=t-kd+1+V8.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);n.push(a);let l=1/a;o>t-kd?l=V8[o-t+kd-1]:o===0&&(l=0),i.push(l);const g=1/(a-2),c=-g,u=1+g,I=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,C=6,b=3,m=2,f=1,p=new Float32Array(b*C*h),v=new Float32Array(m*C*h),B=new Float32Array(f*C*h);for(let R=0;R<h;R++){const w=R%3*2/3-1,E=R>2?0:-1,x=[w,E,0,w+2/3,E,0,w+2/3,E+1,0,w,E,0,w+2/3,E+1,0,w,E+1,0];p.set(x,b*C*R),v.set(I,m*C*R);const W=[R,R,R,R,R,R];B.set(W,f*C*R)}const G=new Lt;G.setAttribute("position",new Wn(p,b)),G.setAttribute("uv",new Wn(v,m)),G.setAttribute("faceIndex",new Wn(B,f)),e.push(G),r>kd&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}function H8(t,e,n){const i=new En(t,e,n);return i.texture.mapping=XA,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Mm(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Wre(t,e,n){const i=new Float32Array(bu),r=new P(0,1,0);return new an({name:"SphericalGaussianBlur",defines:{n:bu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:ux(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:tn,depthTest:!1,depthWrite:!1})}function _8(){return new an({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ux(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:tn,depthTest:!1,depthWrite:!1})}function X8(){return new an({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ux(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:tn,depthTest:!1,depthWrite:!1})}function ux(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Nre(t){let e=new WeakMap,n=null;function i(a){if(a&&a.isTexture){const l=a.mapping,g=l===Rf||l===xf,c=l===tg||l===Ac;if(g||c)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let u=e.get(a);return n===null&&(n=new eS(t)),u=g?n.fromEquirectangular(a,u):n.fromCubemap(a,u),e.set(a,u),u.texture}else{if(e.has(a))return e.get(a).texture;{const u=a.image;if(g&&u&&u.height>0||c&&u&&r(u)){n===null&&(n=new eS(t));const I=g?n.fromEquirectangular(a):n.fromCubemap(a);return e.set(a,I),a.addEventListener("dispose",s),I.texture}else return null}}}return a}function r(a){let l=0;const g=6;for(let c=0;c<g;c++)a[c]!==void 0&&l++;return l===g}function s(a){const l=a.target;l.removeEventListener("dispose",s);const g=e.get(l);g!==void 0&&(e.delete(l),g.dispose())}function o(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:i,dispose:o}}function Mre(t){const e={};function n(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(i)}return e[i]=r,r}return{has:function(i){return n(i)!==null},init:function(i){i.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(i){const r=n(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function Tre(t,e,n,i){const r={},s=new WeakMap;function o(u){const I=u.target;I.index!==null&&e.remove(I.index);for(const C in I.attributes)e.remove(I.attributes[C]);for(const C in I.morphAttributes){const b=I.morphAttributes[C];for(let m=0,f=b.length;m<f;m++)e.remove(b[m])}I.removeEventListener("dispose",o),delete r[I.id];const h=s.get(I);h&&(e.remove(h),s.delete(I)),i.releaseStatesOfGeometry(I),I.isInstancedBufferGeometry===!0&&delete I._maxInstanceCount,n.memory.geometries--}function a(u,I){return r[I.id]===!0||(I.addEventListener("dispose",o),r[I.id]=!0,n.memory.geometries++),I}function l(u){const I=u.attributes;for(const C in I)e.update(I[C],t.ARRAY_BUFFER);const h=u.morphAttributes;for(const C in h){const b=h[C];for(let m=0,f=b.length;m<f;m++)e.update(b[m],t.ARRAY_BUFFER)}}function g(u){const I=[],h=u.index,C=u.attributes.position;let b=0;if(h!==null){const p=h.array;b=h.version;for(let v=0,B=p.length;v<B;v+=3){const G=p[v+0],R=p[v+1],w=p[v+2];I.push(G,R,R,w,w,G)}}else if(C!==void 0){const p=C.array;b=C.version;for(let v=0,B=p.length/3-1;v<B;v+=3){const G=v+0,R=v+1,w=v+2;I.push(G,R,R,w,w,G)}}else return;const m=new(GH(I)?Zv:cx)(I,1);m.version=b;const f=s.get(u);f&&e.remove(f),s.set(u,m)}function c(u){const I=s.get(u);if(I){const h=u.index;h!==null&&I.version<h.version&&g(u)}else g(u);return s.get(u)}return{get:a,update:l,getWireframeAttribute:c}}function Fre(t,e,n,i){const r=i.isWebGL2;let s;function o(I){s=I}let a,l;function g(I){a=I.type,l=I.bytesPerElement}function c(I,h){t.drawElements(s,h,a,I*l),n.update(h,s,1)}function u(I,h,C){if(C===0)return;let b,m;if(r)b=t,m="drawElementsInstanced";else if(b=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",b===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[m](s,h,a,I*l,C),n.update(h,s,C)}this.setMode=o,this.setIndex=g,this.render=c,this.renderInstances=u}function Vre(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(n.calls++,o){case t.TRIANGLES:n.triangles+=a*(s/3);break;case t.LINES:n.lines+=a*(s/2);break;case t.LINE_STRIP:n.lines+=a*(s-1);break;case t.LINE_LOOP:n.lines+=a*s;break;case t.POINTS:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:r,update:i}}function Lre(t,e){return t[0]-e[0]}function kre(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Hre(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new en,a=[];for(let g=0;g<8;g++)a[g]=[g,0];function l(g,c,u){const I=g.morphTargetInfluences;if(e.isWebGL2===!0){const C=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,b=C!==void 0?C.length:0;let m=s.get(c);if(m===void 0||m.count!==b){let O=function(){_.dispose(),s.delete(c),c.removeEventListener("dispose",O)};var h=O;m!==void 0&&m.texture.dispose();const v=c.morphAttributes.position!==void 0,B=c.morphAttributes.normal!==void 0,G=c.morphAttributes.color!==void 0,R=c.morphAttributes.position||[],w=c.morphAttributes.normal||[],E=c.morphAttributes.color||[];let x=0;v===!0&&(x=1),B===!0&&(x=2),G===!0&&(x=3);let W=c.attributes.position.count*x,T=1;W>e.maxTextureSize&&(T=Math.ceil(W/e.maxTextureSize),W=e.maxTextureSize);const k=new Float32Array(W*T*4*b),_=new xv(k,W,T,b);_.type=es,_.needsUpdate=!0;const U=x*4;for(let Y=0;Y<b;Y++){const z=R[Y],N=w[Y],L=E[Y],V=W*T*4*Y;for(let M=0;M<z.count;M++){const X=M*U;v===!0&&(o.fromBufferAttribute(z,M),k[V+X+0]=o.x,k[V+X+1]=o.y,k[V+X+2]=o.z,k[V+X+3]=0),B===!0&&(o.fromBufferAttribute(N,M),k[V+X+4]=o.x,k[V+X+5]=o.y,k[V+X+6]=o.z,k[V+X+7]=0),G===!0&&(o.fromBufferAttribute(L,M),k[V+X+8]=o.x,k[V+X+9]=o.y,k[V+X+10]=o.z,k[V+X+11]=L.itemSize===4?o.w:1)}}m={count:b,texture:_,size:new xe(W,T)},s.set(c,m),c.addEventListener("dispose",O)}let f=0;for(let v=0;v<I.length;v++)f+=I[v];const p=c.morphTargetsRelative?1:1-f;u.getUniforms().setValue(t,"morphTargetBaseInfluence",p),u.getUniforms().setValue(t,"morphTargetInfluences",I),u.getUniforms().setValue(t,"morphTargetsTexture",m.texture,n),u.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const C=I===void 0?0:I.length;let b=i[c.id];if(b===void 0||b.length!==C){b=[];for(let B=0;B<C;B++)b[B]=[B,0];i[c.id]=b}for(let B=0;B<C;B++){const G=b[B];G[0]=B,G[1]=I[B]}b.sort(kre);for(let B=0;B<8;B++)B<C&&b[B][1]?(a[B][0]=b[B][0],a[B][1]=b[B][1]):(a[B][0]=Number.MAX_SAFE_INTEGER,a[B][1]=0);a.sort(Lre);const m=c.morphAttributes.position,f=c.morphAttributes.normal;let p=0;for(let B=0;B<8;B++){const G=a[B],R=G[0],w=G[1];R!==Number.MAX_SAFE_INTEGER&&w?(m&&c.getAttribute("morphTarget"+B)!==m[R]&&c.setAttribute("morphTarget"+B,m[R]),f&&c.getAttribute("morphNormal"+B)!==f[R]&&c.setAttribute("morphNormal"+B,f[R]),r[B]=w,p+=w):(m&&c.hasAttribute("morphTarget"+B)===!0&&c.deleteAttribute("morphTarget"+B),f&&c.hasAttribute("morphNormal"+B)===!0&&c.deleteAttribute("morphNormal"+B),r[B]=0)}const v=c.morphTargetsRelative?1:1-p;u.getUniforms().setValue(t,"morphTargetBaseInfluence",v),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}return{update:l}}function _re(t,e,n,i){let r=new WeakMap;function s(l){const g=i.render.frame,c=l.geometry,u=e.get(l,c);if(r.get(u)!==g&&(e.update(u),r.set(u,g)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==g&&(n.update(l.instanceMatrix,t.ARRAY_BUFFER),l.instanceColor!==null&&n.update(l.instanceColor,t.ARRAY_BUFFER),r.set(l,g))),l.isSkinnedMesh){const I=l.skeleton;r.get(I)!==g&&(I.update(),r.set(I,g))}return u}function o(){r=new WeakMap}function a(l){const g=l.target;g.removeEventListener("dispose",a),n.remove(g.instanceMatrix),g.instanceColor!==null&&n.remove(g.instanceColor)}return{update:s,dispose:o}}const NH=new ei,MH=new xv,TH=new gx,FH=new G0,Y8=[],K8=[],z8=new Float32Array(16),U8=new Float32Array(9),D8=new Float32Array(4);function KA(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=Y8[r];if(s===void 0&&(s=new Float32Array(r),Y8[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function Oi(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Qi(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Wv(t,e){let n=K8[e];n===void 0&&(n=new Int32Array(e),K8[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Xre(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Yre(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Oi(n,e))return;t.uniform2fv(this.addr,e),Qi(n,e)}}function Kre(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Oi(n,e))return;t.uniform3fv(this.addr,e),Qi(n,e)}}function zre(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Oi(n,e))return;t.uniform4fv(this.addr,e),Qi(n,e)}}function Ure(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Oi(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Qi(n,e)}else{if(Oi(n,i))return;D8.set(i),t.uniformMatrix2fv(this.addr,!1,D8),Qi(n,i)}}function Dre(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Oi(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Qi(n,e)}else{if(Oi(n,i))return;U8.set(i),t.uniformMatrix3fv(this.addr,!1,U8),Qi(n,i)}}function Pre(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Oi(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Qi(n,e)}else{if(Oi(n,i))return;z8.set(i),t.uniformMatrix4fv(this.addr,!1,z8),Qi(n,i)}}function Ore(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Qre(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Oi(n,e))return;t.uniform2iv(this.addr,e),Qi(n,e)}}function Jre(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Oi(n,e))return;t.uniform3iv(this.addr,e),Qi(n,e)}}function jre(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Oi(n,e))return;t.uniform4iv(this.addr,e),Qi(n,e)}}function qre(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function $re(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Oi(n,e))return;t.uniform2uiv(this.addr,e),Qi(n,e)}}function ese(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Oi(n,e))return;t.uniform3uiv(this.addr,e),Qi(n,e)}}function tse(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Oi(n,e))return;t.uniform4uiv(this.addr,e),Qi(n,e)}}function nse(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(e||NH,r)}function ise(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||TH,r)}function rse(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||FH,r)}function sse(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||MH,r)}function ose(t){switch(t){case 5126:return Xre;case 35664:return Yre;case 35665:return Kre;case 35666:return zre;case 35674:return Ure;case 35675:return Dre;case 35676:return Pre;case 5124:case 35670:return Ore;case 35667:case 35671:return Qre;case 35668:case 35672:return Jre;case 35669:case 35673:return jre;case 5125:return qre;case 36294:return $re;case 36295:return ese;case 36296:return tse;case 35678:case 36198:case 36298:case 36306:case 35682:return nse;case 35679:case 36299:case 36307:return ise;case 35680:case 36300:case 36308:case 36293:return rse;case 36289:case 36303:case 36311:case 36292:return sse}}function ase(t,e){t.uniform1fv(this.addr,e)}function lse(t,e){const n=KA(e,this.size,2);t.uniform2fv(this.addr,n)}function gse(t,e){const n=KA(e,this.size,3);t.uniform3fv(this.addr,n)}function cse(t,e){const n=KA(e,this.size,4);t.uniform4fv(this.addr,n)}function use(t,e){const n=KA(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Ise(t,e){const n=KA(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function dse(t,e){const n=KA(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Ase(t,e){t.uniform1iv(this.addr,e)}function hse(t,e){t.uniform2iv(this.addr,e)}function Cse(t,e){t.uniform3iv(this.addr,e)}function fse(t,e){t.uniform4iv(this.addr,e)}function pse(t,e){t.uniform1uiv(this.addr,e)}function mse(t,e){t.uniform2uiv(this.addr,e)}function bse(t,e){t.uniform3uiv(this.addr,e)}function vse(t,e){t.uniform4uiv(this.addr,e)}function yse(t,e,n){const i=this.cache,r=e.length,s=Wv(n,r);Oi(i,s)||(t.uniform1iv(this.addr,s),Qi(i,s));for(let o=0;o!==r;++o)n.setTexture2D(e[o]||NH,s[o])}function Bse(t,e,n){const i=this.cache,r=e.length,s=Wv(n,r);Oi(i,s)||(t.uniform1iv(this.addr,s),Qi(i,s));for(let o=0;o!==r;++o)n.setTexture3D(e[o]||TH,s[o])}function Gse(t,e,n){const i=this.cache,r=e.length,s=Wv(n,r);Oi(i,s)||(t.uniform1iv(this.addr,s),Qi(i,s));for(let o=0;o!==r;++o)n.setTextureCube(e[o]||FH,s[o])}function Sse(t,e,n){const i=this.cache,r=e.length,s=Wv(n,r);Oi(i,s)||(t.uniform1iv(this.addr,s),Qi(i,s));for(let o=0;o!==r;++o)n.setTexture2DArray(e[o]||MH,s[o])}function wse(t){switch(t){case 5126:return ase;case 35664:return lse;case 35665:return gse;case 35666:return cse;case 35674:return use;case 35675:return Ise;case 35676:return dse;case 5124:case 35670:return Ase;case 35667:case 35671:return hse;case 35668:case 35672:return Cse;case 35669:case 35673:return fse;case 5125:return pse;case 36294:return mse;case 36295:return bse;case 36296:return vse;case 35678:case 36198:case 36298:case 36306:case 35682:return yse;case 35679:case 36299:case 36307:return Bse;case 35680:case 36300:case 36308:case 36293:return Gse;case 36289:case 36303:case 36311:case 36292:return Sse}}class Rse{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.setValue=ose(n.type)}}class xse{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.size=n.size,this.setValue=wse(n.type)}}class Zse{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,n[a.id],i)}}}const O5=/(\w+)(\])?(\[|\.)?/g;function P8(t,e){t.seq.push(e),t.map[e.id]=e}function Ese(t,e,n){const i=t.name,r=i.length;for(O5.lastIndex=0;;){const s=O5.exec(i),o=O5.lastIndex;let a=s[1];const l=s[2]==="]",g=s[3];if(l&&(a=a|0),g===void 0||g==="["&&o+2===r){P8(n,g===void 0?new Rse(a,t,e):new xse(a,t,e));break}else{let u=n.map[a];u===void 0&&(u=new Zse(a),P8(n,u)),n=u}}}class t3{constructor(e,n){this.seq=[],this.map={};const i=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(n,r),o=e.getUniformLocation(n,s.name);Ese(s,o,this)}}setValue(e,n,i,r){const s=this.map[n];s!==void 0&&s.setValue(e,i,r)}setOptional(e,n,i){const r=n[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,n,i,r){for(let s=0,o=n.length;s!==o;++s){const a=n[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,n){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in n&&i.push(o)}return i}}function O8(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let Wse=0;function Nse(t,e){const n=t.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${n[o]}`)}return i.join(`
`)}function Mse(t){switch(t){case Ca:return["Linear","( value )"];case Hn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),["Linear","( value )"]}}function Q8(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+r+`

`+Nse(t.getShaderSource(e),o)}else return r}function Tse(t,e){const n=Mse(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Fse(t,e){let n;switch(e){case eH:n="Linear";break;case tH:n="Reinhard";break;case nH:n="OptimizedCineon";break;case JR:n="ACESFilmic";break;case iH:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Vse(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(uC).join(`
`)}function Lse(t){const e=[];for(const n in t){const i=t[n];i!==!1&&e.push("#define "+n+" "+i)}return e.join(`
`)}function kse(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=t.getActiveAttrib(e,r),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),n[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}function uC(t){return t!==""}function J8(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function j8(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Hse=/^[ \t]*#include +<([\w\d./]+)>/gm;function tS(t){return t.replace(Hse,Xse)}const _se=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Xse(t,e){let n=Ut[e];if(n===void 0){const i=_se.get(e);if(i!==void 0)n=Ut[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return tS(n)}const Yse=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function q8(t){return t.replace(Yse,Kse)}function Kse(t,e,n,i){let r="";for(let s=parseInt(e);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function $8(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function zse(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===vv?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===NC?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===ea&&(e="SHADOWMAP_TYPE_VSM"),e}function Use(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case tg:case Ac:e="ENVMAP_TYPE_CUBE";break;case XA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Dse(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Ac:e="ENVMAP_MODE_REFRACTION";break}return e}function Pse(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case v0:e="ENVMAP_BLENDING_MULTIPLY";break;case qk:e="ENVMAP_BLENDING_MIX";break;case $k:e="ENVMAP_BLENDING_ADD";break}return e}function Ose(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:i,maxMip:n}}function Qse(t,e,n,i){const r=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=zse(n),g=Use(n),c=Dse(n),u=Pse(n),I=Ose(n),h=n.isWebGL2?"":Vse(n),C=Lse(s),b=r.createProgram();let m,f,p=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(m=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,C].filter(uC).join(`
`),m.length>0&&(m+=`
`),f=[h,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,C].filter(uC).join(`
`),f.length>0&&(f+=`
`)):(m=[$8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,C,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(uC).join(`
`),f=[h,$8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,C,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",I?"#define CUBEUV_TEXEL_WIDTH "+I.texelWidth:"",I?"#define CUBEUV_TEXEL_HEIGHT "+I.texelHeight:"",I?"#define CUBEUV_MAX_MIP "+I.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Wo?"#define TONE_MAPPING":"",n.toneMapping!==Wo?Ut.tonemapping_pars_fragment:"",n.toneMapping!==Wo?Fse("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ut.colorspace_pars_fragment,Tse("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(uC).join(`
`)),o=tS(o),o=J8(o,n),o=j8(o,n),a=tS(a),a=J8(a,n),a=j8(a,n),o=q8(o),a=q8(a),n.isWebGL2&&n.isRawShaderMaterial!==!0&&(p=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,f=["#define varying in",n.glslVersion===q9?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===q9?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+f);const v=p+m+o,B=p+f+a,G=O8(r,r.VERTEX_SHADER,v),R=O8(r,r.FRAGMENT_SHADER,B);if(r.attachShader(b,G),r.attachShader(b,R),n.index0AttributeName!==void 0?r.bindAttribLocation(b,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(b,0,"position"),r.linkProgram(b),t.debug.checkShaderErrors){const x=r.getProgramInfoLog(b).trim(),W=r.getShaderInfoLog(G).trim(),T=r.getShaderInfoLog(R).trim();let k=!0,_=!0;if(r.getProgramParameter(b,r.LINK_STATUS)===!1)if(k=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(r,b,G,R);else{const U=Q8(r,G,"vertex"),O=Q8(r,R,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(b,r.VALIDATE_STATUS)+`

Program Info Log: `+x+`
`+U+`
`+O)}else x!==""?console.warn("THREE.WebGLProgram: Program Info Log:",x):(W===""||T==="")&&(_=!1);_&&(this.diagnostics={runnable:k,programLog:x,vertexShader:{log:W,prefix:m},fragmentShader:{log:T,prefix:f}})}r.deleteShader(G),r.deleteShader(R);let w;this.getUniforms=function(){return w===void 0&&(w=new t3(r,b)),w};let E;return this.getAttributes=function(){return E===void 0&&(E=kse(r,b)),E},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(b),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Wse++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=G,this.fragmentShader=R,this}let Jse=0;class jse{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(n),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const i of n)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let i=n.get(e);return i===void 0&&(i=new Set,n.set(e,i)),i}_getShaderStage(e){const n=this.shaderCache;let i=n.get(e);return i===void 0&&(i=new qse(e),n.set(e,i)),i}}class qse{constructor(e){this.id=Jse++,this.code=e,this.usedTimes=0}}function $se(t,e,n,i,r,s,o){const a=new Yu,l=new jse,g=[],c=r.isWebGL2,u=r.logarithmicDepthBuffer,I=r.vertexTextures;let h=r.precision;const C={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(x){return x===0?"uv":`uv${x}`}function m(x,W,T,k,_){const U=k.fog,O=_.geometry,Y=x.isMeshStandardMaterial?k.environment:null,z=(x.isMeshStandardMaterial?n:e).get(x.envMap||Y),N=z&&z.mapping===XA?z.image.height:null,L=C[x.type];x.precision!==null&&(h=r.getMaxPrecision(x.precision),h!==x.precision&&console.warn("THREE.WebGLProgram.getParameters:",x.precision,"not supported, using",h,"instead."));const V=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,M=V!==void 0?V.length:0;let X=0;O.morphAttributes.position!==void 0&&(X=1),O.morphAttributes.normal!==void 0&&(X=2),O.morphAttributes.color!==void 0&&(X=3);let J,re,se,le;if(L){const zt=ra[L];J=zt.vertexShader,re=zt.fragmentShader}else J=x.vertexShader,re=x.fragmentShader,l.update(x),se=l.getVertexShaderID(x),le=l.getFragmentShaderID(x);const ae=t.getRenderTarget(),ce=_.isInstancedMesh===!0,Ee=!!x.map,Fe=!!x.matcap,oe=!!z,D=!!x.aoMap,fe=!!x.lightMap,Ce=!!x.bumpMap,pe=!!x.normalMap,be=!!x.displacementMap,Ue=!!x.emissiveMap,me=!!x.metalnessMap,we=!!x.roughnessMap,Be=x.anisotropy>0,Ae=x.clearcoat>0,De=x.iridescence>0,Q=x.sheen>0,K=x.transmission>0,ge=Be&&!!x.anisotropyMap,Le=Ae&&!!x.clearcoatMap,Re=Ae&&!!x.clearcoatNormalMap,Ze=Ae&&!!x.clearcoatRoughnessMap,Je=De&&!!x.iridescenceMap,Ye=De&&!!x.iridescenceThicknessMap,de=Q&&!!x.sheenColorMap,ze=Q&&!!x.sheenRoughnessMap,je=!!x.specularMap,Pe=!!x.specularColorMap,ke=!!x.specularIntensityMap,$=K&&!!x.transmissionMap,Se=K&&!!x.thicknessMap,Ke=!!x.gradientMap,q=!!x.alphaMap,He=x.alphaTest>0,ue=!!x.alphaHash,_e=!!x.extensions,qe=!!O.attributes.uv1,At=!!O.attributes.uv2,vt=!!O.attributes.uv3;let Et=Wo;return x.toneMapped&&(ae===null||ae.isXRRenderTarget===!0)&&(Et=t.toneMapping),{isWebGL2:c,shaderID:L,shaderType:x.type,shaderName:x.name,vertexShader:J,fragmentShader:re,defines:x.defines,customVertexShaderID:se,customFragmentShaderID:le,isRawShaderMaterial:x.isRawShaderMaterial===!0,glslVersion:x.glslVersion,precision:h,instancing:ce,instancingColor:ce&&_.instanceColor!==null,supportsVertexTextures:I,outputColorSpace:ae===null?t.outputColorSpace:ae.isXRRenderTarget===!0?ae.texture.colorSpace:Ca,map:Ee,matcap:Fe,envMap:oe,envMapMode:oe&&z.mapping,envMapCubeUVHeight:N,aoMap:D,lightMap:fe,bumpMap:Ce,normalMap:pe,displacementMap:I&&be,emissiveMap:Ue,normalMapObjectSpace:pe&&x.normalMapType===dH,normalMapTangentSpace:pe&&x.normalMapType===Sc,metalnessMap:me,roughnessMap:we,anisotropy:Be,anisotropyMap:ge,clearcoat:Ae,clearcoatMap:Le,clearcoatNormalMap:Re,clearcoatRoughnessMap:Ze,iridescence:De,iridescenceMap:Je,iridescenceThicknessMap:Ye,sheen:Q,sheenColorMap:de,sheenRoughnessMap:ze,specularMap:je,specularColorMap:Pe,specularIntensityMap:ke,transmission:K,transmissionMap:$,thicknessMap:Se,gradientMap:Ke,opaque:x.transparent===!1&&x.blending===Ja,alphaMap:q,alphaTest:He,alphaHash:ue,combine:x.combine,mapUv:Ee&&b(x.map.channel),aoMapUv:D&&b(x.aoMap.channel),lightMapUv:fe&&b(x.lightMap.channel),bumpMapUv:Ce&&b(x.bumpMap.channel),normalMapUv:pe&&b(x.normalMap.channel),displacementMapUv:be&&b(x.displacementMap.channel),emissiveMapUv:Ue&&b(x.emissiveMap.channel),metalnessMapUv:me&&b(x.metalnessMap.channel),roughnessMapUv:we&&b(x.roughnessMap.channel),anisotropyMapUv:ge&&b(x.anisotropyMap.channel),clearcoatMapUv:Le&&b(x.clearcoatMap.channel),clearcoatNormalMapUv:Re&&b(x.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ze&&b(x.clearcoatRoughnessMap.channel),iridescenceMapUv:Je&&b(x.iridescenceMap.channel),iridescenceThicknessMapUv:Ye&&b(x.iridescenceThicknessMap.channel),sheenColorMapUv:de&&b(x.sheenColorMap.channel),sheenRoughnessMapUv:ze&&b(x.sheenRoughnessMap.channel),specularMapUv:je&&b(x.specularMap.channel),specularColorMapUv:Pe&&b(x.specularColorMap.channel),specularIntensityMapUv:ke&&b(x.specularIntensityMap.channel),transmissionMapUv:$&&b(x.transmissionMap.channel),thicknessMapUv:Se&&b(x.thicknessMap.channel),alphaMapUv:q&&b(x.alphaMap.channel),vertexTangents:!!O.attributes.tangent&&(pe||Be),vertexColors:x.vertexColors,vertexAlphas:x.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,vertexUv1s:qe,vertexUv2s:At,vertexUv3s:vt,pointsUvs:_.isPoints===!0&&!!O.attributes.uv&&(Ee||q),fog:!!U,useFog:x.fog===!0,fogExp2:U&&U.isFogExp2,flatShading:x.flatShading===!0,sizeAttenuation:x.sizeAttenuation===!0,logarithmicDepthBuffer:u,skinning:_.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:M,morphTextureStride:X,numDirLights:W.directional.length,numPointLights:W.point.length,numSpotLights:W.spot.length,numSpotLightMaps:W.spotLightMap.length,numRectAreaLights:W.rectArea.length,numHemiLights:W.hemi.length,numDirLightShadows:W.directionalShadowMap.length,numPointLightShadows:W.pointShadowMap.length,numSpotLightShadows:W.spotShadowMap.length,numSpotLightShadowsWithMaps:W.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:x.dithering,shadowMapEnabled:t.shadowMap.enabled&&T.length>0,shadowMapType:t.shadowMap.type,toneMapping:Et,useLegacyLights:t._useLegacyLights,decodeVideoTexture:Ee&&x.map.isVideoTexture===!0&&x.map.colorSpace===Hn,premultipliedAlpha:x.premultipliedAlpha,doubleSided:x.side===Ps,flipSided:x.side===fr,useDepthPacking:x.depthPacking>=0,depthPacking:x.depthPacking||0,index0AttributeName:x.index0AttributeName,extensionDerivatives:_e&&x.extensions.derivatives===!0,extensionFragDepth:_e&&x.extensions.fragDepth===!0,extensionDrawBuffers:_e&&x.extensions.drawBuffers===!0,extensionShaderTextureLOD:_e&&x.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:x.customProgramCacheKey()}}function f(x){const W=[];if(x.shaderID?W.push(x.shaderID):(W.push(x.customVertexShaderID),W.push(x.customFragmentShaderID)),x.defines!==void 0)for(const T in x.defines)W.push(T),W.push(x.defines[T]);return x.isRawShaderMaterial===!1&&(p(W,x),v(W,x),W.push(t.outputColorSpace)),W.push(x.customProgramCacheKey),W.join()}function p(x,W){x.push(W.precision),x.push(W.outputColorSpace),x.push(W.envMapMode),x.push(W.envMapCubeUVHeight),x.push(W.mapUv),x.push(W.alphaMapUv),x.push(W.lightMapUv),x.push(W.aoMapUv),x.push(W.bumpMapUv),x.push(W.normalMapUv),x.push(W.displacementMapUv),x.push(W.emissiveMapUv),x.push(W.metalnessMapUv),x.push(W.roughnessMapUv),x.push(W.anisotropyMapUv),x.push(W.clearcoatMapUv),x.push(W.clearcoatNormalMapUv),x.push(W.clearcoatRoughnessMapUv),x.push(W.iridescenceMapUv),x.push(W.iridescenceThicknessMapUv),x.push(W.sheenColorMapUv),x.push(W.sheenRoughnessMapUv),x.push(W.specularMapUv),x.push(W.specularColorMapUv),x.push(W.specularIntensityMapUv),x.push(W.transmissionMapUv),x.push(W.thicknessMapUv),x.push(W.combine),x.push(W.fogExp2),x.push(W.sizeAttenuation),x.push(W.morphTargetsCount),x.push(W.morphAttributeCount),x.push(W.numDirLights),x.push(W.numPointLights),x.push(W.numSpotLights),x.push(W.numSpotLightMaps),x.push(W.numHemiLights),x.push(W.numRectAreaLights),x.push(W.numDirLightShadows),x.push(W.numPointLightShadows),x.push(W.numSpotLightShadows),x.push(W.numSpotLightShadowsWithMaps),x.push(W.shadowMapType),x.push(W.toneMapping),x.push(W.numClippingPlanes),x.push(W.numClipIntersection),x.push(W.depthPacking)}function v(x,W){a.disableAll(),W.isWebGL2&&a.enable(0),W.supportsVertexTextures&&a.enable(1),W.instancing&&a.enable(2),W.instancingColor&&a.enable(3),W.matcap&&a.enable(4),W.envMap&&a.enable(5),W.normalMapObjectSpace&&a.enable(6),W.normalMapTangentSpace&&a.enable(7),W.clearcoat&&a.enable(8),W.iridescence&&a.enable(9),W.alphaTest&&a.enable(10),W.vertexColors&&a.enable(11),W.vertexAlphas&&a.enable(12),W.vertexUv1s&&a.enable(13),W.vertexUv2s&&a.enable(14),W.vertexUv3s&&a.enable(15),W.vertexTangents&&a.enable(16),W.anisotropy&&a.enable(17),x.push(a.mask),a.disableAll(),W.fog&&a.enable(0),W.useFog&&a.enable(1),W.flatShading&&a.enable(2),W.logarithmicDepthBuffer&&a.enable(3),W.skinning&&a.enable(4),W.morphTargets&&a.enable(5),W.morphNormals&&a.enable(6),W.morphColors&&a.enable(7),W.premultipliedAlpha&&a.enable(8),W.shadowMapEnabled&&a.enable(9),W.useLegacyLights&&a.enable(10),W.doubleSided&&a.enable(11),W.flipSided&&a.enable(12),W.useDepthPacking&&a.enable(13),W.dithering&&a.enable(14),W.transmission&&a.enable(15),W.sheen&&a.enable(16),W.opaque&&a.enable(17),W.pointsUvs&&a.enable(18),W.decodeVideoTexture&&a.enable(19),x.push(a.mask)}function B(x){const W=C[x.type];let T;if(W){const k=ra[W];T=Pn.clone(k.uniforms)}else T=x.uniforms;return T}function G(x,W){let T;for(let k=0,_=g.length;k<_;k++){const U=g[k];if(U.cacheKey===W){T=U,++T.usedTimes;break}}return T===void 0&&(T=new Qse(t,W,x,s),g.push(T)),T}function R(x){if(--x.usedTimes===0){const W=g.indexOf(x);g[W]=g[g.length-1],g.pop(),x.destroy()}}function w(x){l.remove(x)}function E(){l.dispose()}return{getParameters:m,getProgramCacheKey:f,getUniforms:B,acquireProgram:G,releaseProgram:R,releaseShaderCache:w,programs:g,dispose:E}}function eoe(){let t=new WeakMap;function e(s){let o=t.get(s);return o===void 0&&(o={},t.set(s,o)),o}function n(s){t.delete(s)}function i(s,o,a){t.get(s)[o]=a}function r(){t=new WeakMap}return{get:e,remove:n,update:i,dispose:r}}function toe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function eW(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function tW(){const t=[];let e=0;const n=[],i=[],r=[];function s(){e=0,n.length=0,i.length=0,r.length=0}function o(u,I,h,C,b,m){let f=t[e];return f===void 0?(f={id:u.id,object:u,geometry:I,material:h,groupOrder:C,renderOrder:u.renderOrder,z:b,group:m},t[e]=f):(f.id=u.id,f.object=u,f.geometry=I,f.material=h,f.groupOrder=C,f.renderOrder=u.renderOrder,f.z=b,f.group=m),e++,f}function a(u,I,h,C,b,m){const f=o(u,I,h,C,b,m);h.transmission>0?i.push(f):h.transparent===!0?r.push(f):n.push(f)}function l(u,I,h,C,b,m){const f=o(u,I,h,C,b,m);h.transmission>0?i.unshift(f):h.transparent===!0?r.unshift(f):n.unshift(f)}function g(u,I){n.length>1&&n.sort(u||toe),i.length>1&&i.sort(I||eW),r.length>1&&r.sort(I||eW)}function c(){for(let u=e,I=t.length;u<I;u++){const h=t[u];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:n,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:c,sort:g}}function noe(){let t=new WeakMap;function e(i,r){const s=t.get(i);let o;return s===void 0?(o=new tW,t.set(i,[o])):r>=s.length?(o=new tW,s.push(o)):o=s[r],o}function n(){t=new WeakMap}return{get:e,dispose:n}}function ioe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new P,color:new et};break;case"SpotLight":n={position:new P,direction:new P,color:new et,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new P,color:new et,distance:0,decay:0};break;case"HemisphereLight":n={direction:new P,skyColor:new et,groundColor:new et};break;case"RectAreaLight":n={color:new et,position:new P,halfWidth:new P,halfHeight:new P};break}return t[e.id]=n,n}}}function roe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let soe=0;function ooe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function aoe(t,e){const n=new ioe,i=roe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)r.probe.push(new P);const s=new P,o=new dt,a=new dt;function l(c,u){let I=0,h=0,C=0;for(let T=0;T<9;T++)r.probe[T].set(0,0,0);let b=0,m=0,f=0,p=0,v=0,B=0,G=0,R=0,w=0,E=0;c.sort(ooe);const x=u===!0?Math.PI:1;for(let T=0,k=c.length;T<k;T++){const _=c[T],U=_.color,O=_.intensity,Y=_.distance,z=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)I+=U.r*O*x,h+=U.g*O*x,C+=U.b*O*x;else if(_.isLightProbe)for(let N=0;N<9;N++)r.probe[N].addScaledVector(_.sh.coefficients[N],O);else if(_.isDirectionalLight){const N=n.get(_);if(N.color.copy(_.color).multiplyScalar(_.intensity*x),_.castShadow){const L=_.shadow,V=i.get(_);V.shadowBias=L.bias,V.shadowNormalBias=L.normalBias,V.shadowRadius=L.radius,V.shadowMapSize=L.mapSize,r.directionalShadow[b]=V,r.directionalShadowMap[b]=z,r.directionalShadowMatrix[b]=_.shadow.matrix,B++}r.directional[b]=N,b++}else if(_.isSpotLight){const N=n.get(_);N.position.setFromMatrixPosition(_.matrixWorld),N.color.copy(U).multiplyScalar(O*x),N.distance=Y,N.coneCos=Math.cos(_.angle),N.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),N.decay=_.decay,r.spot[f]=N;const L=_.shadow;if(_.map&&(r.spotLightMap[w]=_.map,w++,L.updateMatrices(_),_.castShadow&&E++),r.spotLightMatrix[f]=L.matrix,_.castShadow){const V=i.get(_);V.shadowBias=L.bias,V.shadowNormalBias=L.normalBias,V.shadowRadius=L.radius,V.shadowMapSize=L.mapSize,r.spotShadow[f]=V,r.spotShadowMap[f]=z,R++}f++}else if(_.isRectAreaLight){const N=n.get(_);N.color.copy(U).multiplyScalar(O),N.halfWidth.set(_.width*.5,0,0),N.halfHeight.set(0,_.height*.5,0),r.rectArea[p]=N,p++}else if(_.isPointLight){const N=n.get(_);if(N.color.copy(_.color).multiplyScalar(_.intensity*x),N.distance=_.distance,N.decay=_.decay,_.castShadow){const L=_.shadow,V=i.get(_);V.shadowBias=L.bias,V.shadowNormalBias=L.normalBias,V.shadowRadius=L.radius,V.shadowMapSize=L.mapSize,V.shadowCameraNear=L.camera.near,V.shadowCameraFar=L.camera.far,r.pointShadow[m]=V,r.pointShadowMap[m]=z,r.pointShadowMatrix[m]=_.shadow.matrix,G++}r.point[m]=N,m++}else if(_.isHemisphereLight){const N=n.get(_);N.skyColor.copy(_.color).multiplyScalar(O*x),N.groundColor.copy(_.groundColor).multiplyScalar(O*x),r.hemi[v]=N,v++}}p>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=it.LTC_FLOAT_1,r.rectAreaLTC2=it.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=it.LTC_HALF_1,r.rectAreaLTC2=it.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=I,r.ambient[1]=h,r.ambient[2]=C;const W=r.hash;(W.directionalLength!==b||W.pointLength!==m||W.spotLength!==f||W.rectAreaLength!==p||W.hemiLength!==v||W.numDirectionalShadows!==B||W.numPointShadows!==G||W.numSpotShadows!==R||W.numSpotMaps!==w)&&(r.directional.length=b,r.spot.length=f,r.rectArea.length=p,r.point.length=m,r.hemi.length=v,r.directionalShadow.length=B,r.directionalShadowMap.length=B,r.pointShadow.length=G,r.pointShadowMap.length=G,r.spotShadow.length=R,r.spotShadowMap.length=R,r.directionalShadowMatrix.length=B,r.pointShadowMatrix.length=G,r.spotLightMatrix.length=R+w-E,r.spotLightMap.length=w,r.numSpotLightShadowsWithMaps=E,W.directionalLength=b,W.pointLength=m,W.spotLength=f,W.rectAreaLength=p,W.hemiLength=v,W.numDirectionalShadows=B,W.numPointShadows=G,W.numSpotShadows=R,W.numSpotMaps=w,r.version=soe++)}function g(c,u){let I=0,h=0,C=0,b=0,m=0;const f=u.matrixWorldInverse;for(let p=0,v=c.length;p<v;p++){const B=c[p];if(B.isDirectionalLight){const G=r.directional[I];G.direction.setFromMatrixPosition(B.matrixWorld),s.setFromMatrixPosition(B.target.matrixWorld),G.direction.sub(s),G.direction.transformDirection(f),I++}else if(B.isSpotLight){const G=r.spot[C];G.position.setFromMatrixPosition(B.matrixWorld),G.position.applyMatrix4(f),G.direction.setFromMatrixPosition(B.matrixWorld),s.setFromMatrixPosition(B.target.matrixWorld),G.direction.sub(s),G.direction.transformDirection(f),C++}else if(B.isRectAreaLight){const G=r.rectArea[b];G.position.setFromMatrixPosition(B.matrixWorld),G.position.applyMatrix4(f),a.identity(),o.copy(B.matrixWorld),o.premultiply(f),a.extractRotation(o),G.halfWidth.set(B.width*.5,0,0),G.halfHeight.set(0,B.height*.5,0),G.halfWidth.applyMatrix4(a),G.halfHeight.applyMatrix4(a),b++}else if(B.isPointLight){const G=r.point[h];G.position.setFromMatrixPosition(B.matrixWorld),G.position.applyMatrix4(f),h++}else if(B.isHemisphereLight){const G=r.hemi[m];G.direction.setFromMatrixPosition(B.matrixWorld),G.direction.transformDirection(f),m++}}}return{setup:l,setupView:g,state:r}}function nW(t,e){const n=new aoe(t,e),i=[],r=[];function s(){i.length=0,r.length=0}function o(u){i.push(u)}function a(u){r.push(u)}function l(u){n.setup(i,u)}function g(u){n.setupView(i,u)}return{init:s,state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:l,setupLightsView:g,pushLight:o,pushShadow:a}}function loe(t,e){let n=new WeakMap;function i(s,o=0){const a=n.get(s);let l;return a===void 0?(l=new nW(t,e),n.set(s,[l])):o>=a.length?(l=new nW(t,e),a.push(l)):l=a[o],l}function r(){n=new WeakMap}return{get:i,dispose:r}}class S0 extends br{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=IH,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Nv extends br{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const goe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,coe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function uoe(t,e,n){let i=new Ev;const r=new xe,s=new xe,o=new en,a=new S0({depthPacking:Rv}),l=new Nv,g={},c=n.maxTextureSize,u={[il]:fr,[fr]:il,[Ps]:Ps},I=new an({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new xe},radius:{value:4}},vertexShader:goe,fragmentShader:coe}),h=I.clone();h.defines.HORIZONTAL_PASS=1;const C=new Lt;C.setAttribute("position",new Wn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new pn(C,I),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=vv;let f=this.type;this.render=function(G,R,w){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||G.length===0)return;const E=t.getRenderTarget(),x=t.getActiveCubeFace(),W=t.getActiveMipmapLevel(),T=t.state;T.setBlending(tn),T.buffers.color.setClear(1,1,1,1),T.buffers.depth.setTest(!0),T.setScissorTest(!1);const k=f!==ea&&this.type===ea,_=f===ea&&this.type!==ea;for(let U=0,O=G.length;U<O;U++){const Y=G[U],z=Y.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",Y,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;r.copy(z.mapSize);const N=z.getFrameExtents();if(r.multiply(N),s.copy(z.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/N.x),r.x=s.x*N.x,z.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/N.y),r.y=s.y*N.y,z.mapSize.y=s.y)),z.map===null||k===!0||_===!0){const V=this.type!==ea?{minFilter:Vt,magFilter:Vt}:{};z.map!==null&&z.map.dispose(),z.map=new En(r.x,r.y,V),z.map.texture.name=Y.name+".shadowMap",z.camera.updateProjectionMatrix()}t.setRenderTarget(z.map),t.clear();const L=z.getViewportCount();for(let V=0;V<L;V++){const M=z.getViewport(V);o.set(s.x*M.x,s.y*M.y,s.x*M.z,s.y*M.w),T.viewport(o),z.updateMatrices(Y,V),i=z.getFrustum(),B(R,w,z.camera,Y,this.type)}z.isPointLightShadow!==!0&&this.type===ea&&p(z,w),z.needsUpdate=!1}f=this.type,m.needsUpdate=!1,t.setRenderTarget(E,x,W)};function p(G,R){const w=e.update(b);I.defines.VSM_SAMPLES!==G.blurSamples&&(I.defines.VSM_SAMPLES=G.blurSamples,h.defines.VSM_SAMPLES=G.blurSamples,I.needsUpdate=!0,h.needsUpdate=!0),G.mapPass===null&&(G.mapPass=new En(r.x,r.y)),I.uniforms.shadow_pass.value=G.map.texture,I.uniforms.resolution.value=G.mapSize,I.uniforms.radius.value=G.radius,t.setRenderTarget(G.mapPass),t.clear(),t.renderBufferDirect(R,null,w,I,b,null),h.uniforms.shadow_pass.value=G.mapPass.texture,h.uniforms.resolution.value=G.mapSize,h.uniforms.radius.value=G.radius,t.setRenderTarget(G.map),t.clear(),t.renderBufferDirect(R,null,w,h,b,null)}function v(G,R,w,E){let x=null;const W=w.isPointLight===!0?G.customDistanceMaterial:G.customDepthMaterial;if(W!==void 0)x=W;else if(x=w.isPointLight===!0?l:a,t.localClippingEnabled&&R.clipShadows===!0&&Array.isArray(R.clippingPlanes)&&R.clippingPlanes.length!==0||R.displacementMap&&R.displacementScale!==0||R.alphaMap&&R.alphaTest>0||R.map&&R.alphaTest>0){const T=x.uuid,k=R.uuid;let _=g[T];_===void 0&&(_={},g[T]=_);let U=_[k];U===void 0&&(U=x.clone(),_[k]=U),x=U}if(x.visible=R.visible,x.wireframe=R.wireframe,E===ea?x.side=R.shadowSide!==null?R.shadowSide:R.side:x.side=R.shadowSide!==null?R.shadowSide:u[R.side],x.alphaMap=R.alphaMap,x.alphaTest=R.alphaTest,x.map=R.map,x.clipShadows=R.clipShadows,x.clippingPlanes=R.clippingPlanes,x.clipIntersection=R.clipIntersection,x.displacementMap=R.displacementMap,x.displacementScale=R.displacementScale,x.displacementBias=R.displacementBias,x.wireframeLinewidth=R.wireframeLinewidth,x.linewidth=R.linewidth,w.isPointLight===!0&&x.isMeshDistanceMaterial===!0){const T=t.properties.get(x);T.light=w}return x}function B(G,R,w,E,x){if(G.visible===!1)return;if(G.layers.test(R.layers)&&(G.isMesh||G.isLine||G.isPoints)&&(G.castShadow||G.receiveShadow&&x===ea)&&(!G.frustumCulled||i.intersectsObject(G))){G.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,G.matrixWorld);const k=e.update(G),_=G.material;if(Array.isArray(_)){const U=k.groups;for(let O=0,Y=U.length;O<Y;O++){const z=U[O],N=_[z.materialIndex];if(N&&N.visible){const L=v(G,N,E,x);t.renderBufferDirect(w,null,k,L,G,z)}}}else if(_.visible){const U=v(G,_,E,x);t.renderBufferDirect(w,null,k,U,G,null)}}const T=G.children;for(let k=0,_=T.length;k<_;k++)B(T[k],R,w,E,x)}}function Ioe(t,e,n){const i=n.isWebGL2;function r(){let q=!1;const He=new en;let ue=null;const _e=new en(0,0,0,0);return{setMask:function(qe){ue!==qe&&!q&&(t.colorMask(qe,qe,qe,qe),ue=qe)},setLocked:function(qe){q=qe},setClear:function(qe,At,vt,Et,Kt){Kt===!0&&(qe*=Et,At*=Et,vt*=Et),He.set(qe,At,vt,Et),_e.equals(He)===!1&&(t.clearColor(qe,At,vt,Et),_e.copy(He))},reset:function(){q=!1,ue=null,_e.set(-1,0,0,0)}}}function s(){let q=!1,He=null,ue=null,_e=null;return{setTest:function(qe){qe?ae(t.DEPTH_TEST):ce(t.DEPTH_TEST)},setMask:function(qe){He!==qe&&!q&&(t.depthMask(qe),He=qe)},setFunc:function(qe){if(ue!==qe){switch(qe){case Uk:t.depthFunc(t.NEVER);break;case Dk:t.depthFunc(t.ALWAYS);break;case Pk:t.depthFunc(t.LESS);break;case Ab:t.depthFunc(t.LEQUAL);break;case Ok:t.depthFunc(t.EQUAL);break;case Qk:t.depthFunc(t.GEQUAL);break;case Jk:t.depthFunc(t.GREATER);break;case jk:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}ue=qe}},setLocked:function(qe){q=qe},setClear:function(qe){_e!==qe&&(t.clearDepth(qe),_e=qe)},reset:function(){q=!1,He=null,ue=null,_e=null}}}function o(){let q=!1,He=null,ue=null,_e=null,qe=null,At=null,vt=null,Et=null,Kt=null;return{setTest:function(zt){q||(zt?ae(t.STENCIL_TEST):ce(t.STENCIL_TEST))},setMask:function(zt){He!==zt&&!q&&(t.stencilMask(zt),He=zt)},setFunc:function(zt,Ht,Tt){(ue!==zt||_e!==Ht||qe!==Tt)&&(t.stencilFunc(zt,Ht,Tt),ue=zt,_e=Ht,qe=Tt)},setOp:function(zt,Ht,Tt){(At!==zt||vt!==Ht||Et!==Tt)&&(t.stencilOp(zt,Ht,Tt),At=zt,vt=Ht,Et=Tt)},setLocked:function(zt){q=zt},setClear:function(zt){Kt!==zt&&(t.clearStencil(zt),Kt=zt)},reset:function(){q=!1,He=null,ue=null,_e=null,qe=null,At=null,vt=null,Et=null,Kt=null}}}const a=new r,l=new s,g=new o,c=new WeakMap,u=new WeakMap;let I={},h={},C=new WeakMap,b=[],m=null,f=!1,p=null,v=null,B=null,G=null,R=null,w=null,E=null,x=!1,W=null,T=null,k=null,_=null,U=null;const O=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Y=!1,z=0;const N=t.getParameter(t.VERSION);N.indexOf("WebGL")!==-1?(z=parseFloat(/^WebGL (\d)/.exec(N)[1]),Y=z>=1):N.indexOf("OpenGL ES")!==-1&&(z=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),Y=z>=2);let L=null,V={};const M=t.getParameter(t.SCISSOR_BOX),X=t.getParameter(t.VIEWPORT),J=new en().fromArray(M),re=new en().fromArray(X);function se(q,He,ue,_e){const qe=new Uint8Array(4),At=t.createTexture();t.bindTexture(q,At),t.texParameteri(q,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(q,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let vt=0;vt<ue;vt++)i&&(q===t.TEXTURE_3D||q===t.TEXTURE_2D_ARRAY)?t.texImage3D(He,0,t.RGBA,1,1,_e,0,t.RGBA,t.UNSIGNED_BYTE,qe):t.texImage2D(He+vt,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,qe);return At}const le={};le[t.TEXTURE_2D]=se(t.TEXTURE_2D,t.TEXTURE_2D,1),le[t.TEXTURE_CUBE_MAP]=se(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(le[t.TEXTURE_2D_ARRAY]=se(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),le[t.TEXTURE_3D]=se(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),g.setClear(0),ae(t.DEPTH_TEST),l.setFunc(Ab),be(!1),Ue(R9),ae(t.CULL_FACE),Ce(tn);function ae(q){I[q]!==!0&&(t.enable(q),I[q]=!0)}function ce(q){I[q]!==!1&&(t.disable(q),I[q]=!1)}function Ee(q,He){return h[q]!==He?(t.bindFramebuffer(q,He),h[q]=He,i&&(q===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=He),q===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=He)),!0):!1}function Fe(q,He){let ue=b,_e=!1;if(q)if(ue=C.get(He),ue===void 0&&(ue=[],C.set(He,ue)),q.isWebGLMultipleRenderTargets){const qe=q.texture;if(ue.length!==qe.length||ue[0]!==t.COLOR_ATTACHMENT0){for(let At=0,vt=qe.length;At<vt;At++)ue[At]=t.COLOR_ATTACHMENT0+At;ue.length=qe.length,_e=!0}}else ue[0]!==t.COLOR_ATTACHMENT0&&(ue[0]=t.COLOR_ATTACHMENT0,_e=!0);else ue[0]!==t.BACK&&(ue[0]=t.BACK,_e=!0);_e&&(n.isWebGL2?t.drawBuffers(ue):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ue))}function oe(q){return m!==q?(t.useProgram(q),m=q,!0):!1}const D={[Os]:t.FUNC_ADD,[Lk]:t.FUNC_SUBTRACT,[kk]:t.FUNC_REVERSE_SUBTRACT};if(i)D[E9]=t.MIN,D[W9]=t.MAX;else{const q=e.get("EXT_blend_minmax");q!==null&&(D[E9]=q.MIN_EXT,D[W9]=q.MAX_EXT)}const fe={[bA]:t.ZERO,[Hk]:t.ONE,[_k]:t.SRC_COLOR,[Sf]:t.SRC_ALPHA,[zk]:t.SRC_ALPHA_SATURATE,[Bv]:t.DST_COLOR,[yv]:t.DST_ALPHA,[Xk]:t.ONE_MINUS_SRC_COLOR,[wf]:t.ONE_MINUS_SRC_ALPHA,[Kk]:t.ONE_MINUS_DST_COLOR,[Yk]:t.ONE_MINUS_DST_ALPHA};function Ce(q,He,ue,_e,qe,At,vt,Et){if(q===tn){f===!0&&(ce(t.BLEND),f=!1);return}if(f===!1&&(ae(t.BLEND),f=!0),q!==Gf){if(q!==p||Et!==x){if((v!==Os||R!==Os)&&(t.blendEquation(t.FUNC_ADD),v=Os,R=Os),Et)switch(q){case Ja:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Bf:t.blendFunc(t.ONE,t.ONE);break;case x9:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Z9:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case Ja:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Bf:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case x9:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Z9:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}B=null,G=null,w=null,E=null,p=q,x=Et}return}qe=qe||He,At=At||ue,vt=vt||_e,(He!==v||qe!==R)&&(t.blendEquationSeparate(D[He],D[qe]),v=He,R=qe),(ue!==B||_e!==G||At!==w||vt!==E)&&(t.blendFuncSeparate(fe[ue],fe[_e],fe[At],fe[vt]),B=ue,G=_e,w=At,E=vt),p=q,x=!1}function pe(q,He){q.side===Ps?ce(t.CULL_FACE):ae(t.CULL_FACE);let ue=q.side===fr;He&&(ue=!ue),be(ue),q.blending===Ja&&q.transparent===!1?Ce(tn):Ce(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.premultipliedAlpha),l.setFunc(q.depthFunc),l.setTest(q.depthTest),l.setMask(q.depthWrite),a.setMask(q.colorWrite);const _e=q.stencilWrite;g.setTest(_e),_e&&(g.setMask(q.stencilWriteMask),g.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),g.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),we(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?ae(t.SAMPLE_ALPHA_TO_COVERAGE):ce(t.SAMPLE_ALPHA_TO_COVERAGE)}function be(q){W!==q&&(q?t.frontFace(t.CW):t.frontFace(t.CCW),W=q)}function Ue(q){q!==Tk?(ae(t.CULL_FACE),q!==T&&(q===R9?t.cullFace(t.BACK):q===Fk?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):ce(t.CULL_FACE),T=q}function me(q){q!==k&&(Y&&t.lineWidth(q),k=q)}function we(q,He,ue){q?(ae(t.POLYGON_OFFSET_FILL),(_!==He||U!==ue)&&(t.polygonOffset(He,ue),_=He,U=ue)):ce(t.POLYGON_OFFSET_FILL)}function Be(q){q?ae(t.SCISSOR_TEST):ce(t.SCISSOR_TEST)}function Ae(q){q===void 0&&(q=t.TEXTURE0+O-1),L!==q&&(t.activeTexture(q),L=q)}function De(q,He,ue){ue===void 0&&(L===null?ue=t.TEXTURE0+O-1:ue=L);let _e=V[ue];_e===void 0&&(_e={type:void 0,texture:void 0},V[ue]=_e),(_e.type!==q||_e.texture!==He)&&(L!==ue&&(t.activeTexture(ue),L=ue),t.bindTexture(q,He||le[q]),_e.type=q,_e.texture=He)}function Q(){const q=V[L];q!==void 0&&q.type!==void 0&&(t.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function K(){try{t.compressedTexImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ge(){try{t.compressedTexImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Le(){try{t.texSubImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Re(){try{t.texSubImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ze(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Je(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ye(){try{t.texStorage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function de(){try{t.texStorage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ze(){try{t.texImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function je(){try{t.texImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Pe(q){J.equals(q)===!1&&(t.scissor(q.x,q.y,q.z,q.w),J.copy(q))}function ke(q){re.equals(q)===!1&&(t.viewport(q.x,q.y,q.z,q.w),re.copy(q))}function $(q,He){let ue=u.get(He);ue===void 0&&(ue=new WeakMap,u.set(He,ue));let _e=ue.get(q);_e===void 0&&(_e=t.getUniformBlockIndex(He,q.name),ue.set(q,_e))}function Se(q,He){const _e=u.get(He).get(q);c.get(He)!==_e&&(t.uniformBlockBinding(He,_e,q.__bindingPointIndex),c.set(He,_e))}function Ke(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),i===!0&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),I={},L=null,V={},h={},C=new WeakMap,b=[],m=null,f=!1,p=null,v=null,B=null,G=null,R=null,w=null,E=null,x=!1,W=null,T=null,k=null,_=null,U=null,J.set(0,0,t.canvas.width,t.canvas.height),re.set(0,0,t.canvas.width,t.canvas.height),a.reset(),l.reset(),g.reset()}return{buffers:{color:a,depth:l,stencil:g},enable:ae,disable:ce,bindFramebuffer:Ee,drawBuffers:Fe,useProgram:oe,setBlending:Ce,setMaterial:pe,setFlipSided:be,setCullFace:Ue,setLineWidth:me,setPolygonOffset:we,setScissorTest:Be,activeTexture:Ae,bindTexture:De,unbindTexture:Q,compressedTexImage2D:K,compressedTexImage3D:ge,texImage2D:ze,texImage3D:je,updateUBOMapping:$,uniformBlockBinding:Se,texStorage2D:Ye,texStorage3D:de,texSubImage2D:Le,texSubImage3D:Re,compressedTexSubImage2D:Ze,compressedTexSubImage3D:Je,scissor:Pe,viewport:ke,reset:Ke}}function doe(t,e,n,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,g=r.maxCubemapSize,c=r.maxTextureSize,u=r.maxSamples,I=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),C=new WeakMap;let b;const m=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(Q,K){return f?new OffscreenCanvas(Q,K):_f("canvas")}function v(Q,K,ge,Le){let Re=1;if((Q.width>Le||Q.height>Le)&&(Re=Le/Math.max(Q.width,Q.height)),Re<1||K===!0)if(typeof HTMLImageElement<"u"&&Q instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Q instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Q instanceof ImageBitmap){const Ze=K?fb:Math.floor,Je=Ze(Re*Q.width),Ye=Ze(Re*Q.height);b===void 0&&(b=p(Je,Ye));const de=ge?p(Je,Ye):b;return de.width=Je,de.height=Ye,de.getContext("2d").drawImage(Q,0,0,Je,Ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Q.width+"x"+Q.height+") to ("+Je+"x"+Ye+")."),de}else return"data"in Q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Q.width+"x"+Q.height+")."),Q;return Q}function B(Q){return $9(Q.width)&&$9(Q.height)}function G(Q){return a?!1:Q.wrapS!==Ci||Q.wrapT!==Ci||Q.minFilter!==Vt&&Q.minFilter!==xn}function R(Q,K){return Q.generateMipmaps&&K&&Q.minFilter!==Vt&&Q.minFilter!==xn}function w(Q){t.generateMipmap(Q)}function E(Q,K,ge,Le,Re=!1){if(a===!1)return K;if(Q!==null){if(t[Q]!==void 0)return t[Q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Q+"'")}let Ze=K;return K===t.RED&&(ge===t.FLOAT&&(Ze=t.R32F),ge===t.HALF_FLOAT&&(Ze=t.R16F),ge===t.UNSIGNED_BYTE&&(Ze=t.R8)),K===t.RED_INTEGER&&(ge===t.UNSIGNED_BYTE&&(Ze=t.R8UI),ge===t.UNSIGNED_SHORT&&(Ze=t.R16UI),ge===t.UNSIGNED_INT&&(Ze=t.R32UI),ge===t.BYTE&&(Ze=t.R8I),ge===t.SHORT&&(Ze=t.R16I),ge===t.INT&&(Ze=t.R32I)),K===t.RG&&(ge===t.FLOAT&&(Ze=t.RG32F),ge===t.HALF_FLOAT&&(Ze=t.RG16F),ge===t.UNSIGNED_BYTE&&(Ze=t.RG8)),K===t.RGBA&&(ge===t.FLOAT&&(Ze=t.RGBA32F),ge===t.HALF_FLOAT&&(Ze=t.RGBA16F),ge===t.UNSIGNED_BYTE&&(Ze=Le===Hn&&Re===!1?t.SRGB8_ALPHA8:t.RGBA8),ge===t.UNSIGNED_SHORT_4_4_4_4&&(Ze=t.RGBA4),ge===t.UNSIGNED_SHORT_5_5_5_1&&(Ze=t.RGB5_A1)),(Ze===t.R16F||Ze===t.R32F||Ze===t.RG16F||Ze===t.RG32F||Ze===t.RGBA16F||Ze===t.RGBA32F)&&e.get("EXT_color_buffer_float"),Ze}function x(Q,K,ge){return R(Q,ge)===!0||Q.isFramebufferTexture&&Q.minFilter!==Vt&&Q.minFilter!==xn?Math.log2(Math.max(K.width,K.height))+1:Q.mipmaps!==void 0&&Q.mipmaps.length>0?Q.mipmaps.length:Q.isCompressedTexture&&Array.isArray(Q.image)?K.mipmaps.length:1}function W(Q){return Q===Vt||Q===hb||Q===MC?t.NEAREST:t.LINEAR}function T(Q){const K=Q.target;K.removeEventListener("dispose",T),_(K),K.isVideoTexture&&C.delete(K)}function k(Q){const K=Q.target;K.removeEventListener("dispose",k),O(K)}function _(Q){const K=i.get(Q);if(K.__webglInit===void 0)return;const ge=Q.source,Le=m.get(ge);if(Le){const Re=Le[K.__cacheKey];Re.usedTimes--,Re.usedTimes===0&&U(Q),Object.keys(Le).length===0&&m.delete(ge)}i.remove(Q)}function U(Q){const K=i.get(Q);t.deleteTexture(K.__webglTexture);const ge=Q.source,Le=m.get(ge);delete Le[K.__cacheKey],o.memory.textures--}function O(Q){const K=Q.texture,ge=i.get(Q),Le=i.get(K);if(Le.__webglTexture!==void 0&&(t.deleteTexture(Le.__webglTexture),o.memory.textures--),Q.depthTexture&&Q.depthTexture.dispose(),Q.isWebGLCubeRenderTarget)for(let Re=0;Re<6;Re++){if(Array.isArray(ge.__webglFramebuffer[Re]))for(let Ze=0;Ze<ge.__webglFramebuffer[Re].length;Ze++)t.deleteFramebuffer(ge.__webglFramebuffer[Re][Ze]);else t.deleteFramebuffer(ge.__webglFramebuffer[Re]);ge.__webglDepthbuffer&&t.deleteRenderbuffer(ge.__webglDepthbuffer[Re])}else{if(Array.isArray(ge.__webglFramebuffer))for(let Re=0;Re<ge.__webglFramebuffer.length;Re++)t.deleteFramebuffer(ge.__webglFramebuffer[Re]);else t.deleteFramebuffer(ge.__webglFramebuffer);if(ge.__webglDepthbuffer&&t.deleteRenderbuffer(ge.__webglDepthbuffer),ge.__webglMultisampledFramebuffer&&t.deleteFramebuffer(ge.__webglMultisampledFramebuffer),ge.__webglColorRenderbuffer)for(let Re=0;Re<ge.__webglColorRenderbuffer.length;Re++)ge.__webglColorRenderbuffer[Re]&&t.deleteRenderbuffer(ge.__webglColorRenderbuffer[Re]);ge.__webglDepthRenderbuffer&&t.deleteRenderbuffer(ge.__webglDepthRenderbuffer)}if(Q.isWebGLMultipleRenderTargets)for(let Re=0,Ze=K.length;Re<Ze;Re++){const Je=i.get(K[Re]);Je.__webglTexture&&(t.deleteTexture(Je.__webglTexture),o.memory.textures--),i.remove(K[Re])}i.remove(K),i.remove(Q)}let Y=0;function z(){Y=0}function N(){const Q=Y;return Q>=l&&console.warn("THREE.WebGLTextures: Trying to use "+Q+" texture units while this GPU supports only "+l),Y+=1,Q}function L(Q){const K=[];return K.push(Q.wrapS),K.push(Q.wrapT),K.push(Q.wrapR||0),K.push(Q.magFilter),K.push(Q.minFilter),K.push(Q.anisotropy),K.push(Q.internalFormat),K.push(Q.format),K.push(Q.type),K.push(Q.generateMipmaps),K.push(Q.premultiplyAlpha),K.push(Q.flipY),K.push(Q.unpackAlignment),K.push(Q.colorSpace),K.join()}function V(Q,K){const ge=i.get(Q);if(Q.isVideoTexture&&Ae(Q),Q.isRenderTargetTexture===!1&&Q.version>0&&ge.__version!==Q.version){const Le=Q.image;if(Le===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ee(ge,Q,K);return}}n.bindTexture(t.TEXTURE_2D,ge.__webglTexture,t.TEXTURE0+K)}function M(Q,K){const ge=i.get(Q);if(Q.version>0&&ge.__version!==Q.version){Ee(ge,Q,K);return}n.bindTexture(t.TEXTURE_2D_ARRAY,ge.__webglTexture,t.TEXTURE0+K)}function X(Q,K){const ge=i.get(Q);if(Q.version>0&&ge.__version!==Q.version){Ee(ge,Q,K);return}n.bindTexture(t.TEXTURE_3D,ge.__webglTexture,t.TEXTURE0+K)}function J(Q,K){const ge=i.get(Q);if(Q.version>0&&ge.__version!==Q.version){Fe(ge,Q,K);return}n.bindTexture(t.TEXTURE_CUBE_MAP,ge.__webglTexture,t.TEXTURE0+K)}const re={[ng]:t.REPEAT,[Ci]:t.CLAMP_TO_EDGE,[Zf]:t.MIRRORED_REPEAT},se={[Vt]:t.NEAREST,[hb]:t.NEAREST_MIPMAP_NEAREST,[MC]:t.NEAREST_MIPMAP_LINEAR,[xn]:t.LINEAR,[jR]:t.LINEAR_MIPMAP_NEAREST,[rl]:t.LINEAR_MIPMAP_LINEAR},le={[hH]:t.NEVER,[yH]:t.ALWAYS,[CH]:t.LESS,[pH]:t.LEQUAL,[fH]:t.EQUAL,[vH]:t.GEQUAL,[mH]:t.GREATER,[bH]:t.NOTEQUAL};function ae(Q,K,ge){if(ge?(t.texParameteri(Q,t.TEXTURE_WRAP_S,re[K.wrapS]),t.texParameteri(Q,t.TEXTURE_WRAP_T,re[K.wrapT]),(Q===t.TEXTURE_3D||Q===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Q,t.TEXTURE_WRAP_R,re[K.wrapR]),t.texParameteri(Q,t.TEXTURE_MAG_FILTER,se[K.magFilter]),t.texParameteri(Q,t.TEXTURE_MIN_FILTER,se[K.minFilter])):(t.texParameteri(Q,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(Q,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(Q===t.TEXTURE_3D||Q===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Q,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),(K.wrapS!==Ci||K.wrapT!==Ci)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(Q,t.TEXTURE_MAG_FILTER,W(K.magFilter)),t.texParameteri(Q,t.TEXTURE_MIN_FILTER,W(K.minFilter)),K.minFilter!==Vt&&K.minFilter!==xn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),K.compareFunction&&(t.texParameteri(Q,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(Q,t.TEXTURE_COMPARE_FUNC,le[K.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Le=e.get("EXT_texture_filter_anisotropic");if(K.magFilter===Vt||K.minFilter!==MC&&K.minFilter!==rl||K.type===es&&e.has("OES_texture_float_linear")===!1||a===!1&&K.type===Ri&&e.has("OES_texture_half_float_linear")===!1)return;(K.anisotropy>1||i.get(K).__currentAnisotropy)&&(t.texParameterf(Q,Le.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(K.anisotropy,r.getMaxAnisotropy())),i.get(K).__currentAnisotropy=K.anisotropy)}}function ce(Q,K){let ge=!1;Q.__webglInit===void 0&&(Q.__webglInit=!0,K.addEventListener("dispose",T));const Le=K.source;let Re=m.get(Le);Re===void 0&&(Re={},m.set(Le,Re));const Ze=L(K);if(Ze!==Q.__cacheKey){Re[Ze]===void 0&&(Re[Ze]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,ge=!0),Re[Ze].usedTimes++;const Je=Re[Q.__cacheKey];Je!==void 0&&(Re[Q.__cacheKey].usedTimes--,Je.usedTimes===0&&U(K)),Q.__cacheKey=Ze,Q.__webglTexture=Re[Ze].texture}return ge}function Ee(Q,K,ge){let Le=t.TEXTURE_2D;(K.isDataArrayTexture||K.isCompressedArrayTexture)&&(Le=t.TEXTURE_2D_ARRAY),K.isData3DTexture&&(Le=t.TEXTURE_3D);const Re=ce(Q,K),Ze=K.source;n.bindTexture(Le,Q.__webglTexture,t.TEXTURE0+ge);const Je=i.get(Ze);if(Ze.version!==Je.__version||Re===!0){n.activeTexture(t.TEXTURE0+ge),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,K.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,K.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const Ye=G(K)&&B(K.image)===!1;let de=v(K.image,Ye,!1,c);de=De(K,de);const ze=B(de)||a,je=s.convert(K.format,K.colorSpace);let Pe=s.convert(K.type),ke=E(K.internalFormat,je,Pe,K.colorSpace,K.isVideoTexture);ae(Le,K,ze);let $;const Se=K.mipmaps,Ke=a&&K.isVideoTexture!==!0,q=Je.__version===void 0||Re===!0,He=x(K,de,ze);if(K.isDepthTexture)ke=t.DEPTH_COMPONENT,a?K.type===es?ke=t.DEPTH_COMPONENT32F:K.type===Yl?ke=t.DEPTH_COMPONENT24:K.type===Ol?ke=t.DEPTH24_STENCIL8:ke=t.DEPTH_COMPONENT16:K.type===es&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),K.format===rc&&ke===t.DEPTH_COMPONENT&&K.type!==mI&&K.type!==Yl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),K.type=Yl,Pe=s.convert(K.type)),K.format===hc&&ke===t.DEPTH_COMPONENT&&(ke=t.DEPTH_STENCIL,K.type!==Ol&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),K.type=Ol,Pe=s.convert(K.type))),q&&(Ke?n.texStorage2D(t.TEXTURE_2D,1,ke,de.width,de.height):n.texImage2D(t.TEXTURE_2D,0,ke,de.width,de.height,0,je,Pe,null));else if(K.isDataTexture)if(Se.length>0&&ze){Ke&&q&&n.texStorage2D(t.TEXTURE_2D,He,ke,Se[0].width,Se[0].height);for(let ue=0,_e=Se.length;ue<_e;ue++)$=Se[ue],Ke?n.texSubImage2D(t.TEXTURE_2D,ue,0,0,$.width,$.height,je,Pe,$.data):n.texImage2D(t.TEXTURE_2D,ue,ke,$.width,$.height,0,je,Pe,$.data);K.generateMipmaps=!1}else Ke?(q&&n.texStorage2D(t.TEXTURE_2D,He,ke,de.width,de.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,de.width,de.height,je,Pe,de.data)):n.texImage2D(t.TEXTURE_2D,0,ke,de.width,de.height,0,je,Pe,de.data);else if(K.isCompressedTexture)if(K.isCompressedArrayTexture){Ke&&q&&n.texStorage3D(t.TEXTURE_2D_ARRAY,He,ke,Se[0].width,Se[0].height,de.depth);for(let ue=0,_e=Se.length;ue<_e;ue++)$=Se[ue],K.format!==fi?je!==null?Ke?n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ue,0,0,0,$.width,$.height,de.depth,je,$.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,ue,ke,$.width,$.height,de.depth,0,$.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ke?n.texSubImage3D(t.TEXTURE_2D_ARRAY,ue,0,0,0,$.width,$.height,de.depth,je,Pe,$.data):n.texImage3D(t.TEXTURE_2D_ARRAY,ue,ke,$.width,$.height,de.depth,0,je,Pe,$.data)}else{Ke&&q&&n.texStorage2D(t.TEXTURE_2D,He,ke,Se[0].width,Se[0].height);for(let ue=0,_e=Se.length;ue<_e;ue++)$=Se[ue],K.format!==fi?je!==null?Ke?n.compressedTexSubImage2D(t.TEXTURE_2D,ue,0,0,$.width,$.height,je,$.data):n.compressedTexImage2D(t.TEXTURE_2D,ue,ke,$.width,$.height,0,$.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ke?n.texSubImage2D(t.TEXTURE_2D,ue,0,0,$.width,$.height,je,Pe,$.data):n.texImage2D(t.TEXTURE_2D,ue,ke,$.width,$.height,0,je,Pe,$.data)}else if(K.isDataArrayTexture)Ke?(q&&n.texStorage3D(t.TEXTURE_2D_ARRAY,He,ke,de.width,de.height,de.depth),n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,de.width,de.height,de.depth,je,Pe,de.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,ke,de.width,de.height,de.depth,0,je,Pe,de.data);else if(K.isData3DTexture)Ke?(q&&n.texStorage3D(t.TEXTURE_3D,He,ke,de.width,de.height,de.depth),n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,de.width,de.height,de.depth,je,Pe,de.data)):n.texImage3D(t.TEXTURE_3D,0,ke,de.width,de.height,de.depth,0,je,Pe,de.data);else if(K.isFramebufferTexture){if(q)if(Ke)n.texStorage2D(t.TEXTURE_2D,He,ke,de.width,de.height);else{let ue=de.width,_e=de.height;for(let qe=0;qe<He;qe++)n.texImage2D(t.TEXTURE_2D,qe,ke,ue,_e,0,je,Pe,null),ue>>=1,_e>>=1}}else if(Se.length>0&&ze){Ke&&q&&n.texStorage2D(t.TEXTURE_2D,He,ke,Se[0].width,Se[0].height);for(let ue=0,_e=Se.length;ue<_e;ue++)$=Se[ue],Ke?n.texSubImage2D(t.TEXTURE_2D,ue,0,0,je,Pe,$):n.texImage2D(t.TEXTURE_2D,ue,ke,je,Pe,$);K.generateMipmaps=!1}else Ke?(q&&n.texStorage2D(t.TEXTURE_2D,He,ke,de.width,de.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,je,Pe,de)):n.texImage2D(t.TEXTURE_2D,0,ke,je,Pe,de);R(K,ze)&&w(Le),Je.__version=Ze.version,K.onUpdate&&K.onUpdate(K)}Q.__version=K.version}function Fe(Q,K,ge){if(K.image.length!==6)return;const Le=ce(Q,K),Re=K.source;n.bindTexture(t.TEXTURE_CUBE_MAP,Q.__webglTexture,t.TEXTURE0+ge);const Ze=i.get(Re);if(Re.version!==Ze.__version||Le===!0){n.activeTexture(t.TEXTURE0+ge),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,K.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,K.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const Je=K.isCompressedTexture||K.image[0].isCompressedTexture,Ye=K.image[0]&&K.image[0].isDataTexture,de=[];for(let ue=0;ue<6;ue++)!Je&&!Ye?de[ue]=v(K.image[ue],!1,!0,g):de[ue]=Ye?K.image[ue].image:K.image[ue],de[ue]=De(K,de[ue]);const ze=de[0],je=B(ze)||a,Pe=s.convert(K.format,K.colorSpace),ke=s.convert(K.type),$=E(K.internalFormat,Pe,ke,K.colorSpace),Se=a&&K.isVideoTexture!==!0,Ke=Ze.__version===void 0||Le===!0;let q=x(K,ze,je);ae(t.TEXTURE_CUBE_MAP,K,je);let He;if(Je){Se&&Ke&&n.texStorage2D(t.TEXTURE_CUBE_MAP,q,$,ze.width,ze.height);for(let ue=0;ue<6;ue++){He=de[ue].mipmaps;for(let _e=0;_e<He.length;_e++){const qe=He[_e];K.format!==fi?Pe!==null?Se?n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e,0,0,qe.width,qe.height,Pe,qe.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e,$,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Se?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e,0,0,qe.width,qe.height,Pe,ke,qe.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e,$,qe.width,qe.height,0,Pe,ke,qe.data)}}}else{He=K.mipmaps,Se&&Ke&&(He.length>0&&q++,n.texStorage2D(t.TEXTURE_CUBE_MAP,q,$,de[0].width,de[0].height));for(let ue=0;ue<6;ue++)if(Ye){Se?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,0,0,de[ue].width,de[ue].height,Pe,ke,de[ue].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,$,de[ue].width,de[ue].height,0,Pe,ke,de[ue].data);for(let _e=0;_e<He.length;_e++){const At=He[_e].image[ue].image;Se?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e+1,0,0,At.width,At.height,Pe,ke,At.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e+1,$,At.width,At.height,0,Pe,ke,At.data)}}else{Se?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,0,0,Pe,ke,de[ue]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,$,Pe,ke,de[ue]);for(let _e=0;_e<He.length;_e++){const qe=He[_e];Se?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e+1,0,0,Pe,ke,qe.image[ue]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ue,_e+1,$,Pe,ke,qe.image[ue])}}}R(K,je)&&w(t.TEXTURE_CUBE_MAP),Ze.__version=Re.version,K.onUpdate&&K.onUpdate(K)}Q.__version=K.version}function oe(Q,K,ge,Le,Re,Ze){const Je=s.convert(ge.format,ge.colorSpace),Ye=s.convert(ge.type),de=E(ge.internalFormat,Je,Ye,ge.colorSpace);if(!i.get(K).__hasExternalTextures){const je=Math.max(1,K.width>>Ze),Pe=Math.max(1,K.height>>Ze);Re===t.TEXTURE_3D||Re===t.TEXTURE_2D_ARRAY?n.texImage3D(Re,Ze,de,je,Pe,K.depth,0,Je,Ye,null):n.texImage2D(Re,Ze,de,je,Pe,0,Je,Ye,null)}n.bindFramebuffer(t.FRAMEBUFFER,Q),Be(K)?I.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Le,Re,i.get(ge).__webglTexture,0,we(K)):(Re===t.TEXTURE_2D||Re>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Re<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,Le,Re,i.get(ge).__webglTexture,Ze),n.bindFramebuffer(t.FRAMEBUFFER,null)}function D(Q,K,ge){if(t.bindRenderbuffer(t.RENDERBUFFER,Q),K.depthBuffer&&!K.stencilBuffer){let Le=t.DEPTH_COMPONENT16;if(ge||Be(K)){const Re=K.depthTexture;Re&&Re.isDepthTexture&&(Re.type===es?Le=t.DEPTH_COMPONENT32F:Re.type===Yl&&(Le=t.DEPTH_COMPONENT24));const Ze=we(K);Be(K)?I.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ze,Le,K.width,K.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,Ze,Le,K.width,K.height)}else t.renderbufferStorage(t.RENDERBUFFER,Le,K.width,K.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,Q)}else if(K.depthBuffer&&K.stencilBuffer){const Le=we(K);ge&&Be(K)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Le,t.DEPTH24_STENCIL8,K.width,K.height):Be(K)?I.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Le,t.DEPTH24_STENCIL8,K.width,K.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,K.width,K.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,Q)}else{const Le=K.isWebGLMultipleRenderTargets===!0?K.texture:[K.texture];for(let Re=0;Re<Le.length;Re++){const Ze=Le[Re],Je=s.convert(Ze.format,Ze.colorSpace),Ye=s.convert(Ze.type),de=E(Ze.internalFormat,Je,Ye,Ze.colorSpace),ze=we(K);ge&&Be(K)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ze,de,K.width,K.height):Be(K)?I.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ze,de,K.width,K.height):t.renderbufferStorage(t.RENDERBUFFER,de,K.width,K.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function fe(Q,K){if(K&&K.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,Q),!(K.depthTexture&&K.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(K.depthTexture).__webglTexture||K.depthTexture.image.width!==K.width||K.depthTexture.image.height!==K.height)&&(K.depthTexture.image.width=K.width,K.depthTexture.image.height=K.height,K.depthTexture.needsUpdate=!0),V(K.depthTexture,0);const Le=i.get(K.depthTexture).__webglTexture,Re=we(K);if(K.depthTexture.format===rc)Be(K)?I.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Le,0,Re):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Le,0);else if(K.depthTexture.format===hc)Be(K)?I.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Le,0,Re):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Le,0);else throw new Error("Unknown depthTexture format")}function Ce(Q){const K=i.get(Q),ge=Q.isWebGLCubeRenderTarget===!0;if(Q.depthTexture&&!K.__autoAllocateDepthBuffer){if(ge)throw new Error("target.depthTexture not supported in Cube render targets");fe(K.__webglFramebuffer,Q)}else if(ge){K.__webglDepthbuffer=[];for(let Le=0;Le<6;Le++)n.bindFramebuffer(t.FRAMEBUFFER,K.__webglFramebuffer[Le]),K.__webglDepthbuffer[Le]=t.createRenderbuffer(),D(K.__webglDepthbuffer[Le],Q,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,K.__webglFramebuffer),K.__webglDepthbuffer=t.createRenderbuffer(),D(K.__webglDepthbuffer,Q,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function pe(Q,K,ge){const Le=i.get(Q);K!==void 0&&oe(Le.__webglFramebuffer,Q,Q.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),ge!==void 0&&Ce(Q)}function be(Q){const K=Q.texture,ge=i.get(Q),Le=i.get(K);Q.addEventListener("dispose",k),Q.isWebGLMultipleRenderTargets!==!0&&(Le.__webglTexture===void 0&&(Le.__webglTexture=t.createTexture()),Le.__version=K.version,o.memory.textures++);const Re=Q.isWebGLCubeRenderTarget===!0,Ze=Q.isWebGLMultipleRenderTargets===!0,Je=B(Q)||a;if(Re){ge.__webglFramebuffer=[];for(let Ye=0;Ye<6;Ye++)if(a&&K.mipmaps&&K.mipmaps.length>0){ge.__webglFramebuffer[Ye]=[];for(let de=0;de<K.mipmaps.length;de++)ge.__webglFramebuffer[Ye][de]=t.createFramebuffer()}else ge.__webglFramebuffer[Ye]=t.createFramebuffer()}else{if(a&&K.mipmaps&&K.mipmaps.length>0){ge.__webglFramebuffer=[];for(let Ye=0;Ye<K.mipmaps.length;Ye++)ge.__webglFramebuffer[Ye]=t.createFramebuffer()}else ge.__webglFramebuffer=t.createFramebuffer();if(Ze)if(r.drawBuffers){const Ye=Q.texture;for(let de=0,ze=Ye.length;de<ze;de++){const je=i.get(Ye[de]);je.__webglTexture===void 0&&(je.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&Q.samples>0&&Be(Q)===!1){const Ye=Ze?K:[K];ge.__webglMultisampledFramebuffer=t.createFramebuffer(),ge.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,ge.__webglMultisampledFramebuffer);for(let de=0;de<Ye.length;de++){const ze=Ye[de];ge.__webglColorRenderbuffer[de]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,ge.__webglColorRenderbuffer[de]);const je=s.convert(ze.format,ze.colorSpace),Pe=s.convert(ze.type),ke=E(ze.internalFormat,je,Pe,ze.colorSpace,Q.isXRRenderTarget===!0),$=we(Q);t.renderbufferStorageMultisample(t.RENDERBUFFER,$,ke,Q.width,Q.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+de,t.RENDERBUFFER,ge.__webglColorRenderbuffer[de])}t.bindRenderbuffer(t.RENDERBUFFER,null),Q.depthBuffer&&(ge.__webglDepthRenderbuffer=t.createRenderbuffer(),D(ge.__webglDepthRenderbuffer,Q,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(Re){n.bindTexture(t.TEXTURE_CUBE_MAP,Le.__webglTexture),ae(t.TEXTURE_CUBE_MAP,K,Je);for(let Ye=0;Ye<6;Ye++)if(a&&K.mipmaps&&K.mipmaps.length>0)for(let de=0;de<K.mipmaps.length;de++)oe(ge.__webglFramebuffer[Ye][de],Q,K,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,de);else oe(ge.__webglFramebuffer[Ye],Q,K,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0);R(K,Je)&&w(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Ze){const Ye=Q.texture;for(let de=0,ze=Ye.length;de<ze;de++){const je=Ye[de],Pe=i.get(je);n.bindTexture(t.TEXTURE_2D,Pe.__webglTexture),ae(t.TEXTURE_2D,je,Je),oe(ge.__webglFramebuffer,Q,je,t.COLOR_ATTACHMENT0+de,t.TEXTURE_2D,0),R(je,Je)&&w(t.TEXTURE_2D)}n.unbindTexture()}else{let Ye=t.TEXTURE_2D;if((Q.isWebGL3DRenderTarget||Q.isWebGLArrayRenderTarget)&&(a?Ye=Q.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(Ye,Le.__webglTexture),ae(Ye,K,Je),a&&K.mipmaps&&K.mipmaps.length>0)for(let de=0;de<K.mipmaps.length;de++)oe(ge.__webglFramebuffer[de],Q,K,t.COLOR_ATTACHMENT0,Ye,de);else oe(ge.__webglFramebuffer,Q,K,t.COLOR_ATTACHMENT0,Ye,0);R(K,Je)&&w(Ye),n.unbindTexture()}Q.depthBuffer&&Ce(Q)}function Ue(Q){const K=B(Q)||a,ge=Q.isWebGLMultipleRenderTargets===!0?Q.texture:[Q.texture];for(let Le=0,Re=ge.length;Le<Re;Le++){const Ze=ge[Le];if(R(Ze,K)){const Je=Q.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,Ye=i.get(Ze).__webglTexture;n.bindTexture(Je,Ye),w(Je),n.unbindTexture()}}}function me(Q){if(a&&Q.samples>0&&Be(Q)===!1){const K=Q.isWebGLMultipleRenderTargets?Q.texture:[Q.texture],ge=Q.width,Le=Q.height;let Re=t.COLOR_BUFFER_BIT;const Ze=[],Je=Q.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Ye=i.get(Q),de=Q.isWebGLMultipleRenderTargets===!0;if(de)for(let ze=0;ze<K.length;ze++)n.bindFramebuffer(t.FRAMEBUFFER,Ye.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ze,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Ye.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ze,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Ye.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ye.__webglFramebuffer);for(let ze=0;ze<K.length;ze++){Ze.push(t.COLOR_ATTACHMENT0+ze),Q.depthBuffer&&Ze.push(Je);const je=Ye.__ignoreDepthValues!==void 0?Ye.__ignoreDepthValues:!1;if(je===!1&&(Q.depthBuffer&&(Re|=t.DEPTH_BUFFER_BIT),Q.stencilBuffer&&(Re|=t.STENCIL_BUFFER_BIT)),de&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Ye.__webglColorRenderbuffer[ze]),je===!0&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[Je]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[Je])),de){const Pe=i.get(K[ze]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Pe,0)}t.blitFramebuffer(0,0,ge,Le,0,0,ge,Le,Re,t.NEAREST),h&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Ze)}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),de)for(let ze=0;ze<K.length;ze++){n.bindFramebuffer(t.FRAMEBUFFER,Ye.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ze,t.RENDERBUFFER,Ye.__webglColorRenderbuffer[ze]);const je=i.get(K[ze]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Ye.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ze,t.TEXTURE_2D,je,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ye.__webglMultisampledFramebuffer)}}function we(Q){return Math.min(u,Q.samples)}function Be(Q){const K=i.get(Q);return a&&Q.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&K.__useRenderToTexture!==!1}function Ae(Q){const K=o.render.frame;C.get(Q)!==K&&(C.set(Q,K),Q.update())}function De(Q,K){const ge=Q.colorSpace,Le=Q.format,Re=Q.type;return Q.isCompressedTexture===!0||Q.isVideoTexture===!0||Q.format===Cb||ge!==Ca&&ge!==oc&&(ge===Hn||ge===y0?a===!1?e.has("EXT_sRGB")===!0&&Le===fi?(Q.format=Cb,Q.minFilter=xn,Q.generateMipmaps=!1):K=lx.sRGBToLinear(K):(Le!==fi||Re!==Yi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ge)),K}this.allocateTextureUnit=N,this.resetTextureUnits=z,this.setTexture2D=V,this.setTexture2DArray=M,this.setTexture3D=X,this.setTextureCube=J,this.rebindTextures=pe,this.setupRenderTarget=be,this.updateRenderTargetMipmap=Ue,this.updateMultisampleRenderTarget=me,this.setupDepthRenderbuffer=Ce,this.setupFrameBufferTexture=oe,this.useMultisampledRTT=Be}const Aoe=0,Li=1;function VH(t,e,n){const i=n.isWebGL2;function r(s,o=oc){let a;const l=o===Hn||o===y0?Li:Aoe;if(s===Yi)return t.UNSIGNED_BYTE;if(s===$R)return t.UNSIGNED_SHORT_4_4_4_4;if(s===ex)return t.UNSIGNED_SHORT_5_5_5_1;if(s===rH)return t.BYTE;if(s===sH)return t.SHORT;if(s===mI)return t.UNSIGNED_SHORT;if(s===qR)return t.INT;if(s===Yl)return t.UNSIGNED_INT;if(s===es)return t.FLOAT;if(s===Ri)return i?t.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===oH)return t.ALPHA;if(s===fi)return t.RGBA;if(s===tx)return t.LUMINANCE;if(s===aH)return t.LUMINANCE_ALPHA;if(s===rc)return t.DEPTH_COMPONENT;if(s===hc)return t.DEPTH_STENCIL;if(s===Cb)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===Eu)return t.RED;if(s===nx)return t.RED_INTEGER;if(s===Vd)return t.RG;if(s===ix)return t.RG_INTEGER;if(s===rx)return t.RGBA_INTEGER;if(s===nA||s===J2||s===j2||s===iA)if(l===Li)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===nA)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===J2)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===j2)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===iA)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===nA)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===J2)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===j2)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===iA)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Ef||s===N9||s===Wf||s===M9)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===Ef)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===N9)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Wf)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===M9)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Sv)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===Nf||s===Mf)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===Nf)return l===Li?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===Mf)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===Tf||s===T9||s===F9||s===V9||s===L9||s===k9||s===H9||s===_9||s===X9||s===Y9||s===K9||s===z9||s===U9||s===D9)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===Tf)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===T9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===F9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===V9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===L9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===k9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===H9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===_9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===X9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===Y9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===K9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===z9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===U9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===D9)return l===Li?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===rA||s===P9||s===O9)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===rA)return l===Li?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===P9)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===O9)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===lH||s===Q9||s===J9||s===j9)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===rA)return a.COMPRESSED_RED_RGTC1_EXT;if(s===Q9)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===J9)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===j9)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Ol?i?t.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):t[s]!==void 0?t[s]:null}return{convert:r}}class LH extends Zn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Hd=class extends cn{constructor(){super(),this.isGroup=!0,this.type="Group"}};const hoe={type:"move"};class Q5{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Hd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Hd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Hd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const i of e.hand.values())this._getHandJoint(n,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,g=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(g&&e.hand){o=!0;for(const b of e.hand.values()){const m=n.getJointPose(b,i),f=this._getHandJoint(g,b);m!==null&&(f.matrix.fromArray(m.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,f.jointRadius=m.radius),f.visible=m!==null}const c=g.joints["index-finger-tip"],u=g.joints["thumb-tip"],I=c.position.distanceTo(u.position),h=.02,C=.005;g.inputState.pinching&&I>h+C?(g.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!g.inputState.pinching&&I<=h-C&&(g.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=n.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(hoe)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),g!==null&&(g.visible=o!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const i=new Hd;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[n.jointName]=i,e.add(i)}return e.joints[n.jointName]}}class zA extends ei{constructor(e,n,i,r,s,o,a,l,g,c){if(c=c!==void 0?c:rc,c!==rc&&c!==hc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===rc&&(i=Yl),i===void 0&&c===hc&&(i=Ol),super(null,r,s,o,a,l,c,i,g),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=a!==void 0?a:Vt,this.minFilter=l!==void 0?l:Vt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class Coe extends sl{constructor(e,n){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,g=null,c=null,u=null,I=null,h=null,C=null;const b=n.getContextAttributes();let m=null,f=null;const p=[],v=[],B=new Zn;B.layers.enable(1),B.viewport=new en;const G=new Zn;G.layers.enable(2),G.viewport=new en;const R=[B,G],w=new LH;w.layers.enable(1),w.layers.enable(2);let E=null,x=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(M){let X=p[M];return X===void 0&&(X=new Q5,p[M]=X),X.getTargetRaySpace()},this.getControllerGrip=function(M){let X=p[M];return X===void 0&&(X=new Q5,p[M]=X),X.getGripSpace()},this.getHand=function(M){let X=p[M];return X===void 0&&(X=new Q5,p[M]=X),X.getHandSpace()};function W(M){const X=v.indexOf(M.inputSource);if(X===-1)return;const J=p[X];J!==void 0&&(J.update(M.inputSource,M.frame,g||o),J.dispatchEvent({type:M.type,data:M.inputSource}))}function T(){r.removeEventListener("select",W),r.removeEventListener("selectstart",W),r.removeEventListener("selectend",W),r.removeEventListener("squeeze",W),r.removeEventListener("squeezestart",W),r.removeEventListener("squeezeend",W),r.removeEventListener("end",T),r.removeEventListener("inputsourceschange",k);for(let M=0;M<p.length;M++){const X=v[M];X!==null&&(v[M]=null,p[M].disconnect(X))}E=null,x=null,e.setRenderTarget(m),h=null,I=null,u=null,r=null,f=null,V.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(M){s=M,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(M){a=M,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return g||o},this.setReferenceSpace=function(M){g=M},this.getBaseLayer=function(){return I!==null?I:h},this.getBinding=function(){return u},this.getFrame=function(){return C},this.getSession=function(){return r},this.setSession=async function(M){if(r=M,r!==null){if(m=e.getRenderTarget(),r.addEventListener("select",W),r.addEventListener("selectstart",W),r.addEventListener("selectend",W),r.addEventListener("squeeze",W),r.addEventListener("squeezestart",W),r.addEventListener("squeezeend",W),r.addEventListener("end",T),r.addEventListener("inputsourceschange",k),b.xrCompatible!==!0&&await n.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const X={antialias:r.renderState.layers===void 0?b.antialias:!0,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s};h=new XRWebGLLayer(r,n,X),r.updateRenderState({baseLayer:h}),f=new En(h.framebufferWidth,h.framebufferHeight,{format:fi,type:Yi,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil})}else{let X=null,J=null,re=null;b.depth&&(re=b.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,X=b.stencil?hc:rc,J=b.stencil?Ol:Yl);const se={colorFormat:n.RGBA8,depthFormat:re,scaleFactor:s};u=new XRWebGLBinding(r,n),I=u.createProjectionLayer(se),r.updateRenderState({layers:[I]}),f=new En(I.textureWidth,I.textureHeight,{format:fi,type:Yi,depthTexture:new zA(I.textureWidth,I.textureHeight,J,void 0,void 0,void 0,void 0,void 0,void 0,X),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0});const le=e.properties.get(f);le.__ignoreDepthValues=I.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(l),g=null,o=await r.requestReferenceSpace(a),V.setContext(r),V.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function k(M){for(let X=0;X<M.removed.length;X++){const J=M.removed[X],re=v.indexOf(J);re>=0&&(v[re]=null,p[re].disconnect(J))}for(let X=0;X<M.added.length;X++){const J=M.added[X];let re=v.indexOf(J);if(re===-1){for(let le=0;le<p.length;le++)if(le>=v.length){v.push(J),re=le;break}else if(v[le]===null){v[le]=J,re=le;break}if(re===-1)break}const se=p[re];se&&se.connect(J)}}const _=new P,U=new P;function O(M,X,J){_.setFromMatrixPosition(X.matrixWorld),U.setFromMatrixPosition(J.matrixWorld);const re=_.distanceTo(U),se=X.projectionMatrix.elements,le=J.projectionMatrix.elements,ae=se[14]/(se[10]-1),ce=se[14]/(se[10]+1),Ee=(se[9]+1)/se[5],Fe=(se[9]-1)/se[5],oe=(se[8]-1)/se[0],D=(le[8]+1)/le[0],fe=ae*oe,Ce=ae*D,pe=re/(-oe+D),be=pe*-oe;X.matrixWorld.decompose(M.position,M.quaternion,M.scale),M.translateX(be),M.translateZ(pe),M.matrixWorld.compose(M.position,M.quaternion,M.scale),M.matrixWorldInverse.copy(M.matrixWorld).invert();const Ue=ae+pe,me=ce+pe,we=fe-be,Be=Ce+(re-be),Ae=Ee*ce/me*Ue,De=Fe*ce/me*Ue;M.projectionMatrix.makePerspective(we,Be,Ae,De,Ue,me),M.projectionMatrixInverse.copy(M.projectionMatrix).invert()}function Y(M,X){X===null?M.matrixWorld.copy(M.matrix):M.matrixWorld.multiplyMatrices(X.matrixWorld,M.matrix),M.matrixWorldInverse.copy(M.matrixWorld).invert()}this.updateCamera=function(M){if(r===null)return;w.near=G.near=B.near=M.near,w.far=G.far=B.far=M.far,(E!==w.near||x!==w.far)&&(r.updateRenderState({depthNear:w.near,depthFar:w.far}),E=w.near,x=w.far);const X=M.parent,J=w.cameras;Y(w,X);for(let re=0;re<J.length;re++)Y(J[re],X);J.length===2?O(w,B,G):w.projectionMatrix.copy(B.projectionMatrix),z(M,w,X)};function z(M,X,J){J===null?M.matrix.copy(X.matrixWorld):(M.matrix.copy(J.matrixWorld),M.matrix.invert(),M.matrix.multiply(X.matrixWorld)),M.matrix.decompose(M.position,M.quaternion,M.scale),M.updateMatrixWorld(!0),M.projectionMatrix.copy(X.projectionMatrix),M.projectionMatrixInverse.copy(X.projectionMatrixInverse),M.isPerspectiveCamera&&(M.fov=vA*2*Math.atan(1/M.projectionMatrix.elements[5]),M.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(I===null&&h===null))return l},this.setFoveation=function(M){l=M,I!==null&&(I.fixedFoveation=M),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=M)};let N=null;function L(M,X){if(c=X.getViewerPose(g||o),C=X,c!==null){const J=c.views;h!==null&&(e.setRenderTargetFramebuffer(f,h.framebuffer),e.setRenderTarget(f));let re=!1;J.length!==w.cameras.length&&(w.cameras.length=0,re=!0);for(let se=0;se<J.length;se++){const le=J[se];let ae=null;if(h!==null)ae=h.getViewport(le);else{const Ee=u.getViewSubImage(I,le);ae=Ee.viewport,se===0&&(e.setRenderTargetTextures(f,Ee.colorTexture,I.ignoreDepthValues?void 0:Ee.depthStencilTexture),e.setRenderTarget(f))}let ce=R[se];ce===void 0&&(ce=new Zn,ce.layers.enable(se),ce.viewport=new en,R[se]=ce),ce.matrix.fromArray(le.transform.matrix),ce.matrix.decompose(ce.position,ce.quaternion,ce.scale),ce.projectionMatrix.fromArray(le.projectionMatrix),ce.projectionMatrixInverse.copy(ce.projectionMatrix).invert(),ce.viewport.set(ae.x,ae.y,ae.width,ae.height),se===0&&(w.matrix.copy(ce.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),re===!0&&w.cameras.push(ce)}}for(let J=0;J<p.length;J++){const re=v[J],se=p[J];re!==null&&se!==void 0&&se.update(re,X,g||o)}N&&N(M,X),X.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:X}),C=null}const V=new WH;V.setAnimationLoop(L),this.setAnimationLoop=function(M){N=M},this.dispose=function(){}}}function foe(t,e){function n(m,f){m.matrixAutoUpdate===!0&&m.updateMatrix(),f.value.copy(m.matrix)}function i(m,f){f.color.getRGB(m.fogColor.value,xH(t)),f.isFog?(m.fogNear.value=f.near,m.fogFar.value=f.far):f.isFogExp2&&(m.fogDensity.value=f.density)}function r(m,f,p,v,B){f.isMeshBasicMaterial||f.isMeshLambertMaterial?s(m,f):f.isMeshToonMaterial?(s(m,f),u(m,f)):f.isMeshPhongMaterial?(s(m,f),c(m,f)):f.isMeshStandardMaterial?(s(m,f),I(m,f),f.isMeshPhysicalMaterial&&h(m,f,B)):f.isMeshMatcapMaterial?(s(m,f),C(m,f)):f.isMeshDepthMaterial?s(m,f):f.isMeshDistanceMaterial?(s(m,f),b(m,f)):f.isMeshNormalMaterial?s(m,f):f.isLineBasicMaterial?(o(m,f),f.isLineDashedMaterial&&a(m,f)):f.isPointsMaterial?l(m,f,p,v):f.isSpriteMaterial?g(m,f):f.isShadowMaterial?(m.color.value.copy(f.color),m.opacity.value=f.opacity):f.isShaderMaterial&&(f.uniformsNeedUpdate=!1)}function s(m,f){m.opacity.value=f.opacity,f.color&&m.diffuse.value.copy(f.color),f.emissive&&m.emissive.value.copy(f.emissive).multiplyScalar(f.emissiveIntensity),f.map&&(m.map.value=f.map,n(f.map,m.mapTransform)),f.alphaMap&&(m.alphaMap.value=f.alphaMap,n(f.alphaMap,m.alphaMapTransform)),f.bumpMap&&(m.bumpMap.value=f.bumpMap,n(f.bumpMap,m.bumpMapTransform),m.bumpScale.value=f.bumpScale,f.side===fr&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,n(f.normalMap,m.normalMapTransform),m.normalScale.value.copy(f.normalScale),f.side===fr&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,n(f.displacementMap,m.displacementMapTransform),m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap,n(f.emissiveMap,m.emissiveMapTransform)),f.specularMap&&(m.specularMap.value=f.specularMap,n(f.specularMap,m.specularMapTransform)),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);const p=e.get(f).envMap;if(p&&(m.envMap.value=p,m.flipEnvMap.value=p.isCubeTexture&&p.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=f.reflectivity,m.ior.value=f.ior,m.refractionRatio.value=f.refractionRatio),f.lightMap){m.lightMap.value=f.lightMap;const v=t._useLegacyLights===!0?Math.PI:1;m.lightMapIntensity.value=f.lightMapIntensity*v,n(f.lightMap,m.lightMapTransform)}f.aoMap&&(m.aoMap.value=f.aoMap,m.aoMapIntensity.value=f.aoMapIntensity,n(f.aoMap,m.aoMapTransform))}function o(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,f.map&&(m.map.value=f.map,n(f.map,m.mapTransform))}function a(m,f){m.dashSize.value=f.dashSize,m.totalSize.value=f.dashSize+f.gapSize,m.scale.value=f.scale}function l(m,f,p,v){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.size.value=f.size*p,m.scale.value=v*.5,f.map&&(m.map.value=f.map,n(f.map,m.uvTransform)),f.alphaMap&&(m.alphaMap.value=f.alphaMap,n(f.alphaMap,m.alphaMapTransform)),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest)}function g(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.rotation.value=f.rotation,f.map&&(m.map.value=f.map,n(f.map,m.mapTransform)),f.alphaMap&&(m.alphaMap.value=f.alphaMap,n(f.alphaMap,m.alphaMapTransform)),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest)}function c(m,f){m.specular.value.copy(f.specular),m.shininess.value=Math.max(f.shininess,1e-4)}function u(m,f){f.gradientMap&&(m.gradientMap.value=f.gradientMap)}function I(m,f){m.metalness.value=f.metalness,f.metalnessMap&&(m.metalnessMap.value=f.metalnessMap,n(f.metalnessMap,m.metalnessMapTransform)),m.roughness.value=f.roughness,f.roughnessMap&&(m.roughnessMap.value=f.roughnessMap,n(f.roughnessMap,m.roughnessMapTransform)),e.get(f).envMap&&(m.envMapIntensity.value=f.envMapIntensity)}function h(m,f,p){m.ior.value=f.ior,f.sheen>0&&(m.sheenColor.value.copy(f.sheenColor).multiplyScalar(f.sheen),m.sheenRoughness.value=f.sheenRoughness,f.sheenColorMap&&(m.sheenColorMap.value=f.sheenColorMap,n(f.sheenColorMap,m.sheenColorMapTransform)),f.sheenRoughnessMap&&(m.sheenRoughnessMap.value=f.sheenRoughnessMap,n(f.sheenRoughnessMap,m.sheenRoughnessMapTransform))),f.clearcoat>0&&(m.clearcoat.value=f.clearcoat,m.clearcoatRoughness.value=f.clearcoatRoughness,f.clearcoatMap&&(m.clearcoatMap.value=f.clearcoatMap,n(f.clearcoatMap,m.clearcoatMapTransform)),f.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=f.clearcoatRoughnessMap,n(f.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),f.clearcoatNormalMap&&(m.clearcoatNormalMap.value=f.clearcoatNormalMap,n(f.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(f.clearcoatNormalScale),f.side===fr&&m.clearcoatNormalScale.value.negate())),f.iridescence>0&&(m.iridescence.value=f.iridescence,m.iridescenceIOR.value=f.iridescenceIOR,m.iridescenceThicknessMinimum.value=f.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=f.iridescenceThicknessRange[1],f.iridescenceMap&&(m.iridescenceMap.value=f.iridescenceMap,n(f.iridescenceMap,m.iridescenceMapTransform)),f.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=f.iridescenceThicknessMap,n(f.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),f.transmission>0&&(m.transmission.value=f.transmission,m.transmissionSamplerMap.value=p.texture,m.transmissionSamplerSize.value.set(p.width,p.height),f.transmissionMap&&(m.transmissionMap.value=f.transmissionMap,n(f.transmissionMap,m.transmissionMapTransform)),m.thickness.value=f.thickness,f.thicknessMap&&(m.thicknessMap.value=f.thicknessMap,n(f.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=f.attenuationDistance,m.attenuationColor.value.copy(f.attenuationColor)),f.anisotropy>0&&(m.anisotropyVector.value.set(f.anisotropy*Math.cos(f.anisotropyRotation),f.anisotropy*Math.sin(f.anisotropyRotation)),f.anisotropyMap&&(m.anisotropyMap.value=f.anisotropyMap,n(f.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=f.specularIntensity,m.specularColor.value.copy(f.specularColor),f.specularColorMap&&(m.specularColorMap.value=f.specularColorMap,n(f.specularColorMap,m.specularColorMapTransform)),f.specularIntensityMap&&(m.specularIntensityMap.value=f.specularIntensityMap,n(f.specularIntensityMap,m.specularIntensityMapTransform))}function C(m,f){f.matcap&&(m.matcap.value=f.matcap)}function b(m,f){const p=e.get(f).light;m.referencePosition.value.setFromMatrixPosition(p.matrixWorld),m.nearDistance.value=p.shadow.camera.near,m.farDistance.value=p.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function poe(t,e,n,i){let r={},s={},o=[];const a=n.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(p,v){const B=v.program;i.uniformBlockBinding(p,B)}function g(p,v){let B=r[p.id];B===void 0&&(C(p),B=c(p),r[p.id]=B,p.addEventListener("dispose",m));const G=v.program;i.updateUBOMapping(p,G);const R=e.render.frame;s[p.id]!==R&&(I(p),s[p.id]=R)}function c(p){const v=u();p.__bindingPointIndex=v;const B=t.createBuffer(),G=p.__size,R=p.usage;return t.bindBuffer(t.UNIFORM_BUFFER,B),t.bufferData(t.UNIFORM_BUFFER,G,R),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,v,B),B}function u(){for(let p=0;p<a;p++)if(o.indexOf(p)===-1)return o.push(p),p;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function I(p){const v=r[p.id],B=p.uniforms,G=p.__cache;t.bindBuffer(t.UNIFORM_BUFFER,v);for(let R=0,w=B.length;R<w;R++){const E=B[R];if(h(E,R,G)===!0){const x=E.__offset,W=Array.isArray(E.value)?E.value:[E.value];let T=0;for(let k=0;k<W.length;k++){const _=W[k],U=b(_);typeof _=="number"?(E.__data[0]=_,t.bufferSubData(t.UNIFORM_BUFFER,x+T,E.__data)):_.isMatrix3?(E.__data[0]=_.elements[0],E.__data[1]=_.elements[1],E.__data[2]=_.elements[2],E.__data[3]=_.elements[0],E.__data[4]=_.elements[3],E.__data[5]=_.elements[4],E.__data[6]=_.elements[5],E.__data[7]=_.elements[0],E.__data[8]=_.elements[6],E.__data[9]=_.elements[7],E.__data[10]=_.elements[8],E.__data[11]=_.elements[0]):(_.toArray(E.__data,T),T+=U.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,x,E.__data)}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function h(p,v,B){const G=p.value;if(B[v]===void 0){if(typeof G=="number")B[v]=G;else{const R=Array.isArray(G)?G:[G],w=[];for(let E=0;E<R.length;E++)w.push(R[E].clone());B[v]=w}return!0}else if(typeof G=="number"){if(B[v]!==G)return B[v]=G,!0}else{const R=Array.isArray(B[v])?B[v]:[B[v]],w=Array.isArray(G)?G:[G];for(let E=0;E<R.length;E++){const x=R[E];if(x.equals(w[E])===!1)return x.copy(w[E]),!0}}return!1}function C(p){const v=p.uniforms;let B=0;const G=16;let R=0;for(let w=0,E=v.length;w<E;w++){const x=v[w],W={boundary:0,storage:0},T=Array.isArray(x.value)?x.value:[x.value];for(let k=0,_=T.length;k<_;k++){const U=T[k],O=b(U);W.boundary+=O.boundary,W.storage+=O.storage}if(x.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),x.__offset=B,w>0){R=B%G;const k=G-R;R!==0&&k-W.boundary<0&&(B+=G-R,x.__offset=B)}B+=W.storage}return R=B%G,R>0&&(B+=G-R),p.__size=B,p.__cache={},this}function b(p){const v={boundary:0,storage:0};return typeof p=="number"?(v.boundary=4,v.storage=4):p.isVector2?(v.boundary=8,v.storage=8):p.isVector3||p.isColor?(v.boundary=16,v.storage=12):p.isVector4?(v.boundary=16,v.storage=16):p.isMatrix3?(v.boundary=48,v.storage=48):p.isMatrix4?(v.boundary=64,v.storage=64):p.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",p),v}function m(p){const v=p.target;v.removeEventListener("dispose",m);const B=o.indexOf(v.__bindingPointIndex);o.splice(B,1),t.deleteBuffer(r[v.id]),delete r[v.id],delete s[v.id]}function f(){for(const p in r)t.deleteBuffer(r[p]);o=[],r={},s={}}return{bind:l,update:g,dispose:f}}class Ix{constructor(e={}){const{canvas:n=SH(),context:i=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:g=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;this.isWebGLRenderer=!0;let I;i!==null?I=i.getContextAttributes().alpha:I=o;const h=new Uint32Array(4),C=new Int32Array(4);let b=null,m=null;const f=[],p=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Hn,this._useLegacyLights=!1,this.toneMapping=Wo,this.toneMappingExposure=1;const v=this;let B=!1,G=0,R=0,w=null,E=-1,x=null;const W=new en,T=new en;let k=null;const _=new et(0);let U=0,O=n.width,Y=n.height,z=1,N=null,L=null;const V=new en(0,0,O,Y),M=new en(0,0,O,Y);let X=!1;const J=new Ev;let re=!1,se=!1,le=null;const ae=new dt,ce=new xe,Ee=new P,Fe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function oe(){return w===null?z:1}let D=i;function fe(j,ve){for(let Te=0;Te<j.length;Te++){const ye=j[Te],Me=n.getContext(ye,ve);if(Me!==null)return Me}return null}try{const j={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:g,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${gg}`),n.addEventListener("webglcontextlost",He,!1),n.addEventListener("webglcontextrestored",ue,!1),n.addEventListener("webglcontextcreationerror",_e,!1),D===null){const ve=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&ve.shift(),D=fe(ve,j),D===null)throw fe(ve)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&D instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),D.getShaderPrecisionFormat===void 0&&(D.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(j){throw console.error("THREE.WebGLRenderer: "+j.message),j}let Ce,pe,be,Ue,me,we,Be,Ae,De,Q,K,ge,Le,Re,Ze,Je,Ye,de,ze,je,Pe,ke,$,Se;function Ke(){Ce=new Mre(D),pe=new Rre(D,Ce,e),Ce.init(pe),ke=new VH(D,Ce,pe),be=new Ioe(D,Ce,pe),Ue=new Vre(D),me=new eoe,we=new doe(D,Ce,be,me,pe,ke,Ue),Be=new Zre(v),Ae=new Nre(v),De=new Dte(D,pe),$=new Sre(D,Ce,De,pe),Q=new Tre(D,De,Ue,$),K=new _re(D,Q,De,Ue),ze=new Hre(D,pe,we),Je=new xre(me),ge=new $se(v,Be,Ae,Ce,pe,$,Je),Le=new foe(v,me),Re=new noe,Ze=new loe(Ce,pe),de=new Gre(v,Be,Ae,be,K,I,l),Ye=new uoe(v,K,pe),Se=new poe(D,Ue,pe,be),je=new wre(D,Ce,Ue,pe),Pe=new Fre(D,Ce,Ue,pe),Ue.programs=ge.programs,v.capabilities=pe,v.extensions=Ce,v.properties=me,v.renderLists=Re,v.shadowMap=Ye,v.state=be,v.info=Ue}Ke();const q=new Coe(v,D);this.xr=q,this.getContext=function(){return D},this.getContextAttributes=function(){return D.getContextAttributes()},this.forceContextLoss=function(){const j=Ce.get("WEBGL_lose_context");j&&j.loseContext()},this.forceContextRestore=function(){const j=Ce.get("WEBGL_lose_context");j&&j.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(j){j!==void 0&&(z=j,this.setSize(O,Y,!1))},this.getSize=function(j){return j.set(O,Y)},this.setSize=function(j,ve,Te=!0){if(q.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}O=j,Y=ve,n.width=Math.floor(j*z),n.height=Math.floor(ve*z),Te===!0&&(n.style.width=j+"px",n.style.height=ve+"px"),this.setViewport(0,0,j,ve)},this.getDrawingBufferSize=function(j){return j.set(O*z,Y*z).floor()},this.setDrawingBufferSize=function(j,ve,Te){O=j,Y=ve,z=Te,n.width=Math.floor(j*Te),n.height=Math.floor(ve*Te),this.setViewport(0,0,j,ve)},this.getCurrentViewport=function(j){return j.copy(W)},this.getViewport=function(j){return j.copy(V)},this.setViewport=function(j,ve,Te,ye){j.isVector4?V.set(j.x,j.y,j.z,j.w):V.set(j,ve,Te,ye),be.viewport(W.copy(V).multiplyScalar(z).floor())},this.getScissor=function(j){return j.copy(M)},this.setScissor=function(j,ve,Te,ye){j.isVector4?M.set(j.x,j.y,j.z,j.w):M.set(j,ve,Te,ye),be.scissor(T.copy(M).multiplyScalar(z).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(j){be.setScissorTest(X=j)},this.setOpaqueSort=function(j){N=j},this.setTransparentSort=function(j){L=j},this.getClearColor=function(j){return j.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(j=!0,ve=!0,Te=!0){let ye=0;if(j){let Me=!1;if(w!==null){const at=w.texture.format;Me=at===rx||at===ix||at===nx}if(Me){const at=w.texture.type,bt=at===Yi||at===Yl||at===mI||at===Ol||at===$R||at===ex,Bt=de.getClearColor(),wt=de.getClearAlpha(),_t=Bt.r,Qe=Bt.g,Gt=Bt.b;bt?(h[0]=_t,h[1]=Qe,h[2]=Gt,h[3]=wt,D.clearBufferuiv(D.COLOR,0,h)):(C[0]=_t,C[1]=Qe,C[2]=Gt,C[3]=wt,D.clearBufferiv(D.COLOR,0,C))}else ye|=D.COLOR_BUFFER_BIT}ve&&(ye|=D.DEPTH_BUFFER_BIT),Te&&(ye|=D.STENCIL_BUFFER_BIT),D.clear(ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",He,!1),n.removeEventListener("webglcontextrestored",ue,!1),n.removeEventListener("webglcontextcreationerror",_e,!1),Re.dispose(),Ze.dispose(),me.dispose(),Be.dispose(),Ae.dispose(),K.dispose(),$.dispose(),Se.dispose(),ge.dispose(),q.dispose(),q.removeEventListener("sessionstart",zt),q.removeEventListener("sessionend",Ht),le&&(le.dispose(),le=null),Tt.stop()};function He(j){j.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),B=!0}function ue(){console.log("THREE.WebGLRenderer: Context Restored."),B=!1;const j=Ue.autoReset,ve=Ye.enabled,Te=Ye.autoUpdate,ye=Ye.needsUpdate,Me=Ye.type;Ke(),Ue.autoReset=j,Ye.enabled=ve,Ye.autoUpdate=Te,Ye.needsUpdate=ye,Ye.type=Me}function _e(j){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",j.statusMessage)}function qe(j){const ve=j.target;ve.removeEventListener("dispose",qe),At(ve)}function At(j){vt(j),me.remove(j)}function vt(j){const ve=me.get(j).programs;ve!==void 0&&(ve.forEach(function(Te){ge.releaseProgram(Te)}),j.isShaderMaterial&&ge.releaseShaderCache(j))}this.renderBufferDirect=function(j,ve,Te,ye,Me,at){ve===null&&(ve=Fe);const bt=Me.isMesh&&Me.matrixWorld.determinant()<0,Bt=Ti(j,ve,Te,ye,Me);be.setMaterial(ye,bt);let wt=Te.index,_t=1;if(ye.wireframe===!0){if(wt=Q.getWireframeAttribute(Te),wt===void 0)return;_t=2}const Qe=Te.drawRange,Gt=Te.attributes.position;let vn=Qe.start*_t,dn=(Qe.start+Qe.count)*_t;at!==null&&(vn=Math.max(vn,at.start*_t),dn=Math.min(dn,(at.start+at.count)*_t)),wt!==null?(vn=Math.max(vn,0),dn=Math.min(dn,wt.count)):Gt!=null&&(vn=Math.max(vn,0),dn=Math.min(dn,Gt.count));const Fi=dn-vn;if(Fi<0||Fi===1/0)return;$.setup(Me,ye,Bt,Te,wt);let vr,fn=je;if(wt!==null&&(vr=De.get(wt),fn=Pe,fn.setIndex(vr)),Me.isMesh)ye.wireframe===!0?(be.setLineWidth(ye.wireframeLinewidth*oe()),fn.setMode(D.LINES)):fn.setMode(D.TRIANGLES);else if(Me.isLine){let xt=ye.linewidth;xt===void 0&&(xt=1),be.setLineWidth(xt*oe()),Me.isLineSegments?fn.setMode(D.LINES):Me.isLineLoop?fn.setMode(D.LINE_LOOP):fn.setMode(D.LINE_STRIP)}else Me.isPoints?fn.setMode(D.POINTS):Me.isSprite&&fn.setMode(D.TRIANGLES);if(Me.isInstancedMesh)fn.renderInstances(vn,Fi,Me.count);else if(Te.isInstancedBufferGeometry){const xt=Te._maxInstanceCount!==void 0?Te._maxInstanceCount:1/0,on=Math.min(Te.instanceCount,xt);fn.renderInstances(vn,Fi,on)}else fn.render(vn,Fi)},this.compile=function(j,ve){function Te(ye,Me,at){ye.transparent===!0&&ye.side===Ps&&ye.forceSinglePass===!1?(ye.side=fr,ye.needsUpdate=!0,wn(ye,Me,at),ye.side=il,ye.needsUpdate=!0,wn(ye,Me,at),ye.side=Ps):wn(ye,Me,at)}m=Ze.get(j),m.init(),p.push(m),j.traverseVisible(function(ye){ye.isLight&&ye.layers.test(ve.layers)&&(m.pushLight(ye),ye.castShadow&&m.pushShadow(ye))}),m.setupLights(v._useLegacyLights),j.traverse(function(ye){const Me=ye.material;if(Me)if(Array.isArray(Me))for(let at=0;at<Me.length;at++){const bt=Me[at];Te(bt,j,ye)}else Te(Me,j,ye)}),p.pop(),m=null};let Et=null;function Kt(j){Et&&Et(j)}function zt(){Tt.stop()}function Ht(){Tt.start()}const Tt=new WH;Tt.setAnimationLoop(Kt),typeof self<"u"&&Tt.setContext(self),this.setAnimationLoop=function(j){Et=j,q.setAnimationLoop(j),j===null?Tt.stop():Tt.start()},q.addEventListener("sessionstart",zt),q.addEventListener("sessionend",Ht),this.render=function(j,ve){if(ve!==void 0&&ve.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(B===!0)return;j.matrixWorldAutoUpdate===!0&&j.updateMatrixWorld(),ve.parent===null&&ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),q.enabled===!0&&q.isPresenting===!0&&(q.cameraAutoUpdate===!0&&q.updateCamera(ve),ve=q.getCamera()),j.isScene===!0&&j.onBeforeRender(v,j,ve,w),m=Ze.get(j,p.length),m.init(),p.push(m),ae.multiplyMatrices(ve.projectionMatrix,ve.matrixWorldInverse),J.setFromProjectionMatrix(ae),se=this.localClippingEnabled,re=Je.init(this.clippingPlanes,se),b=Re.get(j,f.length),b.init(),f.push(b),Mn(j,ve,0,v.sortObjects),b.finish(),v.sortObjects===!0&&b.sort(N,L),this.info.render.frame++,re===!0&&Je.beginShadows();const Te=m.state.shadowsArray;if(Ye.render(Te,j,ve),re===!0&&Je.endShadows(),this.info.autoReset===!0&&this.info.reset(),de.render(b,j),m.setupLights(v._useLegacyLights),ve.isArrayCamera){const ye=ve.cameras;for(let Me=0,at=ye.length;Me<at;Me++){const bt=ye[Me];ji(b,j,bt,bt.viewport)}}else ji(b,j,ve);w!==null&&(we.updateMultisampleRenderTarget(w),we.updateRenderTargetMipmap(w)),j.isScene===!0&&j.onAfterRender(v,j,ve),$.resetDefaultState(),E=-1,x=null,p.pop(),p.length>0?m=p[p.length-1]:m=null,f.pop(),f.length>0?b=f[f.length-1]:b=null};function Mn(j,ve,Te,ye){if(j.visible===!1)return;if(j.layers.test(ve.layers)){if(j.isGroup)Te=j.renderOrder;else if(j.isLOD)j.autoUpdate===!0&&j.update(ve);else if(j.isLight)m.pushLight(j),j.castShadow&&m.pushShadow(j);else if(j.isSprite){if(!j.frustumCulled||J.intersectsSprite(j)){ye&&Ee.setFromMatrixPosition(j.matrixWorld).applyMatrix4(ae);const bt=K.update(j),Bt=j.material;Bt.visible&&b.push(j,bt,Bt,Te,Ee.z,null)}}else if((j.isMesh||j.isLine||j.isPoints)&&(!j.frustumCulled||J.intersectsObject(j))){const bt=K.update(j),Bt=j.material;if(ye&&(j.boundingSphere!==void 0?(j.boundingSphere===null&&j.computeBoundingSphere(),Ee.copy(j.boundingSphere.center)):(bt.boundingSphere===null&&bt.computeBoundingSphere(),Ee.copy(bt.boundingSphere.center)),Ee.applyMatrix4(j.matrixWorld).applyMatrix4(ae)),Array.isArray(Bt)){const wt=bt.groups;for(let _t=0,Qe=wt.length;_t<Qe;_t++){const Gt=wt[_t],vn=Bt[Gt.materialIndex];vn&&vn.visible&&b.push(j,bt,vn,Te,Ee.z,Gt)}}else Bt.visible&&b.push(j,bt,Bt,Te,Ee.z,null)}}const at=j.children;for(let bt=0,Bt=at.length;bt<Bt;bt++)Mn(at[bt],ve,Te,ye)}function ji(j,ve,Te,ye){const Me=j.opaque,at=j.transmissive,bt=j.transparent;m.setupLightsView(Te),re===!0&&Je.setGlobalState(v.clippingPlanes,Te),at.length>0&&In(Me,at,ve,Te),ye&&be.viewport(W.copy(ye)),Me.length>0&&Tn(Me,ve,Te),at.length>0&&Tn(at,ve,Te),bt.length>0&&Tn(bt,ve,Te),be.buffers.depth.setTest(!0),be.buffers.depth.setMask(!0),be.buffers.color.setMask(!0),be.setPolygonOffset(!1)}function In(j,ve,Te,ye){const Me=pe.isWebGL2;le===null&&(le=new En(1,1,{generateMipmaps:!0,type:Ce.has("EXT_color_buffer_half_float")?Ri:Yi,minFilter:rl,samples:Me?4:0})),v.getDrawingBufferSize(ce),Me?le.setSize(ce.x,ce.y):le.setSize(fb(ce.x),fb(ce.y));const at=v.getRenderTarget();v.setRenderTarget(le),v.getClearColor(_),U=v.getClearAlpha(),U<1&&v.setClearColor(16777215,.5),v.clear();const bt=v.toneMapping;v.toneMapping=Wo,Tn(j,Te,ye),we.updateMultisampleRenderTarget(le),we.updateRenderTargetMipmap(le);let Bt=!1;for(let wt=0,_t=ve.length;wt<_t;wt++){const Qe=ve[wt],Gt=Qe.object,vn=Qe.geometry,dn=Qe.material,Fi=Qe.group;if(dn.side===Ps&&Gt.layers.test(ye.layers)){const vr=dn.side;dn.side=fr,dn.needsUpdate=!0,ur(Gt,Te,ye,vn,dn,Fi),dn.side=vr,dn.needsUpdate=!0,Bt=!0}}Bt===!0&&(we.updateMultisampleRenderTarget(le),we.updateRenderTargetMipmap(le)),v.setRenderTarget(at),v.setClearColor(_,U),v.toneMapping=bt}function Tn(j,ve,Te){const ye=ve.isScene===!0?ve.overrideMaterial:null;for(let Me=0,at=j.length;Me<at;Me++){const bt=j[Me],Bt=bt.object,wt=bt.geometry,_t=ye===null?bt.material:ye,Qe=bt.group;Bt.layers.test(Te.layers)&&ur(Bt,ve,Te,wt,_t,Qe)}}function ur(j,ve,Te,ye,Me,at){j.onBeforeRender(v,ve,Te,ye,Me,at),j.modelViewMatrix.multiplyMatrices(Te.matrixWorldInverse,j.matrixWorld),j.normalMatrix.getNormalMatrix(j.modelViewMatrix),Me.onBeforeRender(v,ve,Te,ye,j,at),Me.transparent===!0&&Me.side===Ps&&Me.forceSinglePass===!1?(Me.side=fr,Me.needsUpdate=!0,v.renderBufferDirect(Te,ve,ye,Me,j,at),Me.side=il,Me.needsUpdate=!0,v.renderBufferDirect(Te,ve,ye,Me,j,at),Me.side=Ps):v.renderBufferDirect(Te,ve,ye,Me,j,at),j.onAfterRender(v,ve,Te,ye,Me,at)}function wn(j,ve,Te){ve.isScene!==!0&&(ve=Fe);const ye=me.get(j),Me=m.state.lights,at=m.state.shadowsArray,bt=Me.state.version,Bt=ge.getParameters(j,Me.state,at,ve,Te),wt=ge.getProgramCacheKey(Bt);let _t=ye.programs;ye.environment=j.isMeshStandardMaterial?ve.environment:null,ye.fog=ve.fog,ye.envMap=(j.isMeshStandardMaterial?Ae:Be).get(j.envMap||ye.environment),_t===void 0&&(j.addEventListener("dispose",qe),_t=new Map,ye.programs=_t);let Qe=_t.get(wt);if(Qe!==void 0){if(ye.currentProgram===Qe&&ye.lightsStateVersion===bt)return ti(j,Bt),Qe}else Bt.uniforms=ge.getUniforms(j),j.onBuild(Te,Bt,v),j.onBeforeCompile(Bt,v),Qe=ge.acquireProgram(Bt,wt),_t.set(wt,Qe),ye.uniforms=Bt.uniforms;const Gt=ye.uniforms;(!j.isShaderMaterial&&!j.isRawShaderMaterial||j.clipping===!0)&&(Gt.clippingPlanes=Je.uniform),ti(j,Bt),ye.needsLights=kr(j),ye.lightsStateVersion=bt,ye.needsLights&&(Gt.ambientLightColor.value=Me.state.ambient,Gt.lightProbe.value=Me.state.probe,Gt.directionalLights.value=Me.state.directional,Gt.directionalLightShadows.value=Me.state.directionalShadow,Gt.spotLights.value=Me.state.spot,Gt.spotLightShadows.value=Me.state.spotShadow,Gt.rectAreaLights.value=Me.state.rectArea,Gt.ltc_1.value=Me.state.rectAreaLTC1,Gt.ltc_2.value=Me.state.rectAreaLTC2,Gt.pointLights.value=Me.state.point,Gt.pointLightShadows.value=Me.state.pointShadow,Gt.hemisphereLights.value=Me.state.hemi,Gt.directionalShadowMap.value=Me.state.directionalShadowMap,Gt.directionalShadowMatrix.value=Me.state.directionalShadowMatrix,Gt.spotShadowMap.value=Me.state.spotShadowMap,Gt.spotLightMatrix.value=Me.state.spotLightMatrix,Gt.spotLightMap.value=Me.state.spotLightMap,Gt.pointShadowMap.value=Me.state.pointShadowMap,Gt.pointShadowMatrix.value=Me.state.pointShadowMatrix);const vn=Qe.getUniforms(),dn=t3.seqWithValue(vn.seq,Gt);return ye.currentProgram=Qe,ye.uniformsList=dn,Qe}function ti(j,ve){const Te=me.get(j);Te.outputColorSpace=ve.outputColorSpace,Te.instancing=ve.instancing,Te.instancingColor=ve.instancingColor,Te.skinning=ve.skinning,Te.morphTargets=ve.morphTargets,Te.morphNormals=ve.morphNormals,Te.morphColors=ve.morphColors,Te.morphTargetsCount=ve.morphTargetsCount,Te.numClippingPlanes=ve.numClippingPlanes,Te.numIntersection=ve.numClipIntersection,Te.vertexAlphas=ve.vertexAlphas,Te.vertexTangents=ve.vertexTangents,Te.toneMapping=ve.toneMapping}function Ti(j,ve,Te,ye,Me){ve.isScene!==!0&&(ve=Fe),we.resetTextureUnits();const at=ve.fog,bt=ye.isMeshStandardMaterial?ve.environment:null,Bt=w===null?v.outputColorSpace:w.isXRRenderTarget===!0?w.texture.colorSpace:Ca,wt=(ye.isMeshStandardMaterial?Ae:Be).get(ye.envMap||bt),_t=ye.vertexColors===!0&&!!Te.attributes.color&&Te.attributes.color.itemSize===4,Qe=!!Te.attributes.tangent&&(!!ye.normalMap||ye.anisotropy>0),Gt=!!Te.morphAttributes.position,vn=!!Te.morphAttributes.normal,dn=!!Te.morphAttributes.color;let Fi=Wo;ye.toneMapped&&(w===null||w.isXRRenderTarget===!0)&&(Fi=v.toneMapping);const vr=Te.morphAttributes.position||Te.morphAttributes.normal||Te.morphAttributes.color,fn=vr!==void 0?vr.length:0,xt=me.get(ye),on=m.state.lights;if(re===!0&&(se===!0||j!==x)){const xi=j===x&&ye.id===E;Je.setState(ye,j,xi)}let Zt=!1;ye.version===xt.__version?(xt.needsLights&&xt.lightsStateVersion!==on.state.version||xt.outputColorSpace!==Bt||Me.isInstancedMesh&&xt.instancing===!1||!Me.isInstancedMesh&&xt.instancing===!0||Me.isSkinnedMesh&&xt.skinning===!1||!Me.isSkinnedMesh&&xt.skinning===!0||Me.isInstancedMesh&&xt.instancingColor===!0&&Me.instanceColor===null||Me.isInstancedMesh&&xt.instancingColor===!1&&Me.instanceColor!==null||xt.envMap!==wt||ye.fog===!0&&xt.fog!==at||xt.numClippingPlanes!==void 0&&(xt.numClippingPlanes!==Je.numPlanes||xt.numIntersection!==Je.numIntersection)||xt.vertexAlphas!==_t||xt.vertexTangents!==Qe||xt.morphTargets!==Gt||xt.morphNormals!==vn||xt.morphColors!==dn||xt.toneMapping!==Fi||pe.isWebGL2===!0&&xt.morphTargetsCount!==fn)&&(Zt=!0):(Zt=!0,xt.__version=ye.version);let vi=xt.currentProgram;Zt===!0&&(vi=wn(ye,ve,Me));let ci=!1,Qn=!1,ls=!1;const yn=vi.getUniforms(),Fn=xt.uniforms;if(be.useProgram(vi.program)&&(ci=!0,Qn=!0,ls=!0),ye.id!==E&&(E=ye.id,Qn=!0),ci||x!==j){yn.setValue(D,"projectionMatrix",j.projectionMatrix),yn.setValue(D,"viewMatrix",j.matrixWorldInverse);const xi=yn.map.cameraPosition;xi!==void 0&&xi.setValue(D,Ee.setFromMatrixPosition(j.matrixWorld)),pe.logarithmicDepthBuffer&&yn.setValue(D,"logDepthBufFC",2/(Math.log(j.far+1)/Math.LN2)),(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial)&&yn.setValue(D,"isOrthographic",j.isOrthographicCamera===!0),x!==j&&(x=j,Qn=!0,ls=!0)}if(Me.isSkinnedMesh){yn.setOptional(D,Me,"bindMatrix"),yn.setOptional(D,Me,"bindMatrixInverse");const xi=Me.skeleton;xi&&(pe.floatVertexTextures?(xi.boneTexture===null&&xi.computeBoneTexture(),yn.setValue(D,"boneTexture",xi.boneTexture,we),yn.setValue(D,"boneTextureSize",xi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Hr=Te.morphAttributes;if((Hr.position!==void 0||Hr.normal!==void 0||Hr.color!==void 0&&pe.isWebGL2===!0)&&ze.update(Me,Te,vi),(Qn||xt.receiveShadow!==Me.receiveShadow)&&(xt.receiveShadow=Me.receiveShadow,yn.setValue(D,"receiveShadow",Me.receiveShadow)),ye.isMeshGouraudMaterial&&ye.envMap!==null&&(Fn.envMap.value=wt,Fn.flipEnvMap.value=wt.isCubeTexture&&wt.isRenderTargetTexture===!1?-1:1),Qn&&(yn.setValue(D,"toneMappingExposure",v.toneMappingExposure),xt.needsLights&&uo(Fn,ls),at&&ye.fog===!0&&Le.refreshFogUniforms(Fn,at),Le.refreshMaterialUniforms(Fn,ye,z,Y,le),t3.upload(D,xt.uniformsList,Fn,we)),ye.isShaderMaterial&&ye.uniformsNeedUpdate===!0&&(t3.upload(D,xt.uniformsList,Fn,we),ye.uniformsNeedUpdate=!1),ye.isSpriteMaterial&&yn.setValue(D,"center",Me.center),yn.setValue(D,"modelViewMatrix",Me.modelViewMatrix),yn.setValue(D,"normalMatrix",Me.normalMatrix),yn.setValue(D,"modelMatrix",Me.matrixWorld),ye.isShaderMaterial||ye.isRawShaderMaterial){const xi=ye.uniformsGroups;for(let Za=0,Ea=xi.length;Za<Ea;Za++)if(pe.isWebGL2){const yr=xi[Za];Se.update(yr,vi),Se.bind(yr,vi)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return vi}function uo(j,ve){j.ambientLightColor.needsUpdate=ve,j.lightProbe.needsUpdate=ve,j.directionalLights.needsUpdate=ve,j.directionalLightShadows.needsUpdate=ve,j.pointLights.needsUpdate=ve,j.pointLightShadows.needsUpdate=ve,j.spotLights.needsUpdate=ve,j.spotLightShadows.needsUpdate=ve,j.rectAreaLights.needsUpdate=ve,j.hemisphereLights.needsUpdate=ve}function kr(j){return j.isMeshLambertMaterial||j.isMeshToonMaterial||j.isMeshPhongMaterial||j.isMeshStandardMaterial||j.isShadowMaterial||j.isShaderMaterial&&j.lights===!0}this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(j,ve,Te){me.get(j.texture).__webglTexture=ve,me.get(j.depthTexture).__webglTexture=Te;const ye=me.get(j);ye.__hasExternalTextures=!0,ye.__hasExternalTextures&&(ye.__autoAllocateDepthBuffer=Te===void 0,ye.__autoAllocateDepthBuffer||Ce.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ye.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(j,ve){const Te=me.get(j);Te.__webglFramebuffer=ve,Te.__useDefaultFramebuffer=ve===void 0},this.setRenderTarget=function(j,ve=0,Te=0){w=j,G=ve,R=Te;let ye=!0,Me=null,at=!1,bt=!1;if(j){const wt=me.get(j);wt.__useDefaultFramebuffer!==void 0?(be.bindFramebuffer(D.FRAMEBUFFER,null),ye=!1):wt.__webglFramebuffer===void 0?we.setupRenderTarget(j):wt.__hasExternalTextures&&we.rebindTextures(j,me.get(j.texture).__webglTexture,me.get(j.depthTexture).__webglTexture);const _t=j.texture;(_t.isData3DTexture||_t.isDataArrayTexture||_t.isCompressedArrayTexture)&&(bt=!0);const Qe=me.get(j).__webglFramebuffer;j.isWebGLCubeRenderTarget?(Array.isArray(Qe[ve])?Me=Qe[ve][Te]:Me=Qe[ve],at=!0):pe.isWebGL2&&j.samples>0&&we.useMultisampledRTT(j)===!1?Me=me.get(j).__webglMultisampledFramebuffer:Array.isArray(Qe)?Me=Qe[Te]:Me=Qe,W.copy(j.viewport),T.copy(j.scissor),k=j.scissorTest}else W.copy(V).multiplyScalar(z).floor(),T.copy(M).multiplyScalar(z).floor(),k=X;if(be.bindFramebuffer(D.FRAMEBUFFER,Me)&&pe.drawBuffers&&ye&&be.drawBuffers(j,Me),be.viewport(W),be.scissor(T),be.setScissorTest(k),at){const wt=me.get(j.texture);D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+ve,wt.__webglTexture,Te)}else if(bt){const wt=me.get(j.texture),_t=ve||0;D.framebufferTextureLayer(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,wt.__webglTexture,Te||0,_t)}E=-1},this.readRenderTargetPixels=function(j,ve,Te,ye,Me,at,bt){if(!(j&&j.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Bt=me.get(j).__webglFramebuffer;if(j.isWebGLCubeRenderTarget&&bt!==void 0&&(Bt=Bt[bt]),Bt){be.bindFramebuffer(D.FRAMEBUFFER,Bt);try{const wt=j.texture,_t=wt.format,Qe=wt.type;if(_t!==fi&&ke.convert(_t)!==D.getParameter(D.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Gt=Qe===Ri&&(Ce.has("EXT_color_buffer_half_float")||pe.isWebGL2&&Ce.has("EXT_color_buffer_float"));if(Qe!==Yi&&ke.convert(Qe)!==D.getParameter(D.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Qe===es&&(pe.isWebGL2||Ce.has("OES_texture_float")||Ce.has("WEBGL_color_buffer_float")))&&!Gt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ve>=0&&ve<=j.width-ye&&Te>=0&&Te<=j.height-Me&&D.readPixels(ve,Te,ye,Me,ke.convert(_t),ke.convert(Qe),at)}finally{const wt=w!==null?me.get(w).__webglFramebuffer:null;be.bindFramebuffer(D.FRAMEBUFFER,wt)}}},this.copyFramebufferToTexture=function(j,ve,Te=0){const ye=Math.pow(2,-Te),Me=Math.floor(ve.image.width*ye),at=Math.floor(ve.image.height*ye);we.setTexture2D(ve,0),D.copyTexSubImage2D(D.TEXTURE_2D,Te,0,0,j.x,j.y,Me,at),be.unbindTexture()},this.copyTextureToTexture=function(j,ve,Te,ye=0){const Me=ve.image.width,at=ve.image.height,bt=ke.convert(Te.format),Bt=ke.convert(Te.type);we.setTexture2D(Te,0),D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,Te.flipY),D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Te.premultiplyAlpha),D.pixelStorei(D.UNPACK_ALIGNMENT,Te.unpackAlignment),ve.isDataTexture?D.texSubImage2D(D.TEXTURE_2D,ye,j.x,j.y,Me,at,bt,Bt,ve.image.data):ve.isCompressedTexture?D.compressedTexSubImage2D(D.TEXTURE_2D,ye,j.x,j.y,ve.mipmaps[0].width,ve.mipmaps[0].height,bt,ve.mipmaps[0].data):D.texSubImage2D(D.TEXTURE_2D,ye,j.x,j.y,bt,Bt,ve.image),ye===0&&Te.generateMipmaps&&D.generateMipmap(D.TEXTURE_2D),be.unbindTexture()},this.copyTextureToTexture3D=function(j,ve,Te,ye,Me=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const at=j.max.x-j.min.x+1,bt=j.max.y-j.min.y+1,Bt=j.max.z-j.min.z+1,wt=ke.convert(ye.format),_t=ke.convert(ye.type);let Qe;if(ye.isData3DTexture)we.setTexture3D(ye,0),Qe=D.TEXTURE_3D;else if(ye.isDataArrayTexture)we.setTexture2DArray(ye,0),Qe=D.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,ye.flipY),D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ye.premultiplyAlpha),D.pixelStorei(D.UNPACK_ALIGNMENT,ye.unpackAlignment);const Gt=D.getParameter(D.UNPACK_ROW_LENGTH),vn=D.getParameter(D.UNPACK_IMAGE_HEIGHT),dn=D.getParameter(D.UNPACK_SKIP_PIXELS),Fi=D.getParameter(D.UNPACK_SKIP_ROWS),vr=D.getParameter(D.UNPACK_SKIP_IMAGES),fn=Te.isCompressedTexture?Te.mipmaps[0]:Te.image;D.pixelStorei(D.UNPACK_ROW_LENGTH,fn.width),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,fn.height),D.pixelStorei(D.UNPACK_SKIP_PIXELS,j.min.x),D.pixelStorei(D.UNPACK_SKIP_ROWS,j.min.y),D.pixelStorei(D.UNPACK_SKIP_IMAGES,j.min.z),Te.isDataTexture||Te.isData3DTexture?D.texSubImage3D(Qe,Me,ve.x,ve.y,ve.z,at,bt,Bt,wt,_t,fn.data):Te.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),D.compressedTexSubImage3D(Qe,Me,ve.x,ve.y,ve.z,at,bt,Bt,wt,fn.data)):D.texSubImage3D(Qe,Me,ve.x,ve.y,ve.z,at,bt,Bt,wt,_t,fn),D.pixelStorei(D.UNPACK_ROW_LENGTH,Gt),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,vn),D.pixelStorei(D.UNPACK_SKIP_PIXELS,dn),D.pixelStorei(D.UNPACK_SKIP_ROWS,Fi),D.pixelStorei(D.UNPACK_SKIP_IMAGES,vr),Me===0&&ye.generateMipmaps&&D.generateMipmap(Qe),be.unbindTexture()},this.initTexture=function(j){j.isCubeTexture?we.setTextureCube(j,0):j.isData3DTexture?we.setTexture3D(j,0):j.isDataArrayTexture||j.isCompressedArrayTexture?we.setTexture2DArray(j,0):we.setTexture2D(j,0),be.unbindTexture()},this.resetState=function(){G=0,R=0,w=null,be.reset(),$.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Da}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Hn?sc:ox}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===sc?Hn:Ca}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class kH extends Ix{}kH.prototype.isWebGL1Renderer=!0;class Mv{constructor(e,n=25e-5){this.isFogExp2=!0,this.name="",this.color=new et(e),this.density=n}clone(){return new Mv(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Tv{constructor(e,n=1,i=1e3){this.isFog=!0,this.name="",this.color=new et(e),this.near=n,this.far=i}clone(){return new Tv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}let pb=class extends cn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n}};class Fv{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=kf,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=$s()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,i){e*=this.stride,i*=n.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=n.array[i+r];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$s()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(n,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$s()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Dr=new P;class rI{constructor(e,n,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,i=this.data.count;n<i;n++)Dr.fromBufferAttribute(this,n),Dr.applyMatrix4(e),this.setXYZ(n,Dr.x,Dr.y,Dr.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)Dr.fromBufferAttribute(this,n),Dr.applyNormalMatrix(e),this.setXYZ(n,Dr.x,Dr.y,Dr.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)Dr.fromBufferAttribute(this,n),Dr.transformDirection(e),this.setXYZ(n,Dr.x,Dr.y,Dr.z);return this}setX(e,n){return this.normalized&&(n=Ot(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=Ot(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=Ot(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=Ot(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=bs(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=bs(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=bs(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=bs(n,this.array)),n}setXY(e,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this}setXYZ(e,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array),r=Ot(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,n,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(n=Ot(n,this.array),i=Ot(i,this.array),r=Ot(r,this.array),s=Ot(s,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[r+s])}return new Wn(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new rI(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class dx extends br{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new et(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ld;const kh=new P,gd=new P,cd=new P,ud=new xe,Hh=new xe,HH=new dt,Tm=new P,_h=new P,Fm=new P,iW=new xe,J5=new xe,rW=new xe;class _H extends cn{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",ld===void 0){ld=new Lt;const n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Fv(n,5);ld.setIndex([0,1,2,0,2,3]),ld.setAttribute("position",new rI(i,3,0,!1)),ld.setAttribute("uv",new rI(i,2,3,!1))}this.geometry=ld,this.material=e!==void 0?e:new dx,this.center=new xe(.5,.5)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),gd.setFromMatrixScale(this.matrixWorld),HH.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),cd.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&gd.multiplyScalar(-cd.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;Vm(Tm.set(-.5,-.5,0),cd,o,gd,r,s),Vm(_h.set(.5,-.5,0),cd,o,gd,r,s),Vm(Fm.set(.5,.5,0),cd,o,gd,r,s),iW.set(0,0),J5.set(1,0),rW.set(1,1);let a=e.ray.intersectTriangle(Tm,_h,Fm,!1,kh);if(a===null&&(Vm(_h.set(-.5,.5,0),cd,o,gd,r,s),J5.set(0,1),a=e.ray.intersectTriangle(Tm,Fm,_h,!1,kh),a===null))return;const l=e.ray.origin.distanceTo(kh);l<e.near||l>e.far||n.push({distance:l,point:kh.clone(),uv:ms.getInterpolation(kh,Tm,_h,Fm,iW,J5,rW,new xe),face:null,object:this})}copy(e,n){return super.copy(e,n),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Vm(t,e,n,i,r,s){ud.subVectors(t,n).addScalar(.5).multiply(i),r!==void 0?(Hh.x=s*ud.x-r*ud.y,Hh.y=r*ud.x+s*ud.y):Hh.copy(ud),t.copy(e),t.x+=Hh.x,t.y+=Hh.y,t.applyMatrix4(HH)}const Lm=new P,sW=new P;class XH extends cn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const n=e.levels;for(let i=0,r=n.length;i<r;i++){const s=n[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0,i=0){n=Math.abs(n);const r=this.levels;let s;for(s=0;s<r.length&&!(n<r[s].distance);s++);return r.splice(s,0,{distance:n,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const n=this.levels;if(n.length>0){let i,r;for(i=1,r=n.length;i<r;i++){let s=n[i].distance;if(n[i].object.visible&&(s-=s*n[i].hysteresis),e<s)break}return n[i-1].object}return null}raycast(e,n){if(this.levels.length>0){Lm.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(Lm);this.getObjectForDistance(r).raycast(e,n)}}update(e){const n=this.levels;if(n.length>1){Lm.setFromMatrixPosition(e.matrixWorld),sW.setFromMatrixPosition(this.matrixWorld);const i=Lm.distanceTo(sW)/e.zoom;n[0].object.visible=!0;let r,s;for(r=1,s=n.length;r<s;r++){let o=n[r].distance;if(n[r].object.visible&&(o-=o*n[r].hysteresis),i>=o)n[r-1].object.visible=!1,n[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)n[r].object.visible=!1}}toJSON(e){const n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const o=i[r];n.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return n}}const oW=new P,aW=new en,lW=new en,moe=new P,gW=new dt,Id=new P,j5=new Ho,cW=new dt,q5=new bI;class YH extends pn{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new dt,this.bindMatrixInverse=new dt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new va),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)Id.fromBufferAttribute(n,i),this.applyBoneTransform(i,Id),this.boundingBox.expandByPoint(Id)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ho),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)Id.fromBufferAttribute(n,i),this.applyBoneTransform(i,Id),this.boundingSphere.expandByPoint(Id)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),j5.copy(this.boundingSphere),j5.applyMatrix4(r),e.ray.intersectsSphere(j5)!==!1&&(cW.copy(r).invert(),q5.copy(e.ray).applyMatrix4(cW),!(this.boundingBox!==null&&q5.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,q5)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new en,n=this.geometry.attributes.skinWeight;for(let i=0,r=n.count;i<r;i++){e.fromBufferAttribute(n,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),n.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const i=this.skeleton,r=this.geometry;aW.fromBufferAttribute(r.attributes.skinIndex,e),lW.fromBufferAttribute(r.attributes.skinWeight,e),oW.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let s=0;s<4;s++){const o=lW.getComponent(s);if(o!==0){const a=aW.getComponent(s);gW.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),n.addScaledVector(moe.copy(oW).applyMatrix4(gW),o)}}return n.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,n){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,n)}}class Ax extends cn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ja extends ei{constructor(e=null,n=1,i=1,r,s,o,a,l,g=Vt,c=Vt,u,I){super(null,o,a,l,g,c,r,s,u,I),this.isDataTexture=!0,this.image={data:e,width:n,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const uW=new dt,boe=new dt;class Vv{constructor(e=[],n=[]){this.uuid=$s(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new dt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const i=new dt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,n=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:boe;uW.multiplyMatrices(a,n[s]),uW.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new Vv(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=BH(e),e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const i=new ja(n,e,e,fi,es);return i.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let n=0,i=this.bones.length;n<i;n++){const r=this.bones[n];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=n[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new Ax),this.bones.push(o),this.boneInverses.push(new dt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,i=this.boneInverses;for(let r=0,s=n.length;r<s;r++){const o=n[r];e.bones.push(o.uuid);const a=i[r];e.boneInverses.push(a.toArray())}return e}}class sI extends Wn{constructor(e,n,i,r=1){super(e,n,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const dd=new dt,IW=new dt,km=[],dW=new va,voe=new dt,Xh=new pn,Yh=new Ho;class hx extends pn{constructor(e,n,i){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new sI(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,voe)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new va),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,dd),dW.copy(e.boundingBox).applyMatrix4(dd),this.boundingBox.union(dW)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ho),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,dd),Yh.copy(e.boundingSphere).applyMatrix4(dd),this.boundingSphere.union(Yh)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}raycast(e,n){const i=this.matrixWorld,r=this.count;if(Xh.geometry=this.geometry,Xh.material=this.material,Xh.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Yh.copy(this.boundingSphere),Yh.applyMatrix4(i),e.ray.intersectsSphere(Yh)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,dd),IW.multiplyMatrices(i,dd),Xh.matrixWorld=IW,Xh.raycast(e,km);for(let o=0,a=km.length;o<a;o++){const l=km[o];l.instanceId=s,l.object=this,n.push(l)}km.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new sI(new Float32Array(this.instanceMatrix.count*3),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class os extends br{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new et(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const AW=new P,hW=new P,CW=new dt,$5=new bI,Hm=new Ho;class Cc extends cn{constructor(e=new Lt,n=new os){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[0];for(let r=1,s=n.count;r<s;r++)AW.fromBufferAttribute(n,r-1),hW.fromBufferAttribute(n,r),i[r]=i[r-1],i[r]+=AW.distanceTo(hW);e.setAttribute("lineDistance",new ut(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Hm.copy(i.boundingSphere),Hm.applyMatrix4(r),Hm.radius+=s,e.ray.intersectsSphere(Hm)===!1)return;CW.copy(r).invert(),$5.copy(e.ray).applyMatrix4(CW);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,g=new P,c=new P,u=new P,I=new P,h=this.isLineSegments?2:1,C=i.index,m=i.attributes.position;if(C!==null){const f=Math.max(0,o.start),p=Math.min(C.count,o.start+o.count);for(let v=f,B=p-1;v<B;v+=h){const G=C.getX(v),R=C.getX(v+1);if(g.fromBufferAttribute(m,G),c.fromBufferAttribute(m,R),$5.distanceSqToSegment(g,c,I,u)>l)continue;I.applyMatrix4(this.matrixWorld);const E=e.ray.origin.distanceTo(I);E<e.near||E>e.far||n.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{const f=Math.max(0,o.start),p=Math.min(m.count,o.start+o.count);for(let v=f,B=p-1;v<B;v+=h){if(g.fromBufferAttribute(m,v),c.fromBufferAttribute(m,v+1),$5.distanceSqToSegment(g,c,I,u)>l)continue;I.applyMatrix4(this.matrixWorld);const R=e.ray.origin.distanceTo(I);R<e.near||R>e.far||n.push({distance:R,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const fW=new P,pW=new P;class ol extends Cc{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[];for(let r=0,s=n.count;r<s;r+=2)fW.fromBufferAttribute(n,r),pW.fromBufferAttribute(n,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+fW.distanceTo(pW);e.setAttribute("lineDistance",new ut(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class KH extends Cc{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class Cx extends br{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new et(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const mW=new dt,nS=new bI,_m=new Ho,Xm=new P;class fx extends cn{constructor(e=new Lt,n=new Cx){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),_m.copy(i.boundingSphere),_m.applyMatrix4(r),_m.radius+=s,e.ray.intersectsSphere(_m)===!1)return;mW.copy(r).invert(),nS.copy(e.ray).applyMatrix4(mW);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,g=i.index,u=i.attributes.position;if(g!==null){const I=Math.max(0,o.start),h=Math.min(g.count,o.start+o.count);for(let C=I,b=h;C<b;C++){const m=g.getX(C);Xm.fromBufferAttribute(u,m),bW(Xm,m,l,r,e,n,this)}}else{const I=Math.max(0,o.start),h=Math.min(u.count,o.start+o.count);for(let C=I,b=h;C<b;C++)Xm.fromBufferAttribute(u,C),bW(Xm,C,l,r,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function bW(t,e,n,i,r,s,o){const a=nS.distanceSqToPoint(t);if(a<n){const l=new P;nS.closestPointToPoint(t,l),l.applyMatrix4(i);const g=r.ray.origin.distanceTo(l);if(g<r.near||g>r.far)return;s.push({distance:g,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class yoe extends ei{constructor(e,n,i,r,s,o,a,l,g){super(e,n,i,r,s,o,a,l,g),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:xn,this.magFilter=s!==void 0?s:xn,this.generateMipmaps=!1;const c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Boe extends ei{constructor(e,n){super({width:e,height:n}),this.isFramebufferTexture=!0,this.magFilter=Vt,this.minFilter=Vt,this.generateMipmaps=!1,this.needsUpdate=!0}}class fc extends ei{constructor(e,n,i,r,s,o,a,l,g,c,u,I){super(null,o,a,l,g,c,r,s,u,I),this.isCompressedTexture=!0,this.image={width:n,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}let Goe=class extends fc{constructor(e,n,i,r,s,o){super(e,n,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Ci}};class Soe extends fc{constructor(e,n,i){super(void 0,e[0].width,e[0].height,n,i,tg),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class woe extends ei{constructor(e,n,i,r,s,o,a,l,g){super(e,n,i,r,s,o,a,l,g),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ya{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){const i=this.getUtoTmapping(e);return this.getPoint(i,n)}getPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return n}getSpacedPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPointAt(i/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let i,r=this.getPoint(0),s=0;n.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),n.push(s),r=i;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){const i=this.getLengths();let r=0;const s=i.length;let o;n?o=n:o=e*i[s-1];let a=0,l=s-1,g;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),g=i[r]-o,g<0)a=r+1;else if(g>0)l=r-1;else{l=r;break}if(r=l,i[r]===o)return r/(s-1);const c=i[r],I=i[r+1]-c,h=(o-c)/I;return(r+h)/(s-1)}getTangent(e,n){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=n||(o.isVector2?new xe:new P);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,n){const i=this.getUtoTmapping(e);return this.getTangent(i,n)}computeFrenetFrames(e,n){const i=new P,r=[],s=[],o=[],a=new P,l=new dt;for(let h=0;h<=e;h++){const C=h/e;r[h]=this.getTangentAt(C,new P)}s[0]=new P,o[0]=new P;let g=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),I=Math.abs(r[0].z);c<=g&&(g=c,i.set(1,0,0)),u<=g&&(g=u,i.set(0,1,0)),I<=g&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let h=1;h<=e;h++){if(s[h]=s[h-1].clone(),o[h]=o[h-1].clone(),a.crossVectors(r[h-1],r[h]),a.length()>Number.EPSILON){a.normalize();const C=Math.acos(Ai(r[h-1].dot(r[h]),-1,1));s[h].applyMatrix4(l.makeRotationAxis(a,C))}o[h].crossVectors(r[h],s[h])}if(n===!0){let h=Math.acos(Ai(s[0].dot(s[e]),-1,1));h/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(h=-h);for(let C=1;C<=e;C++)s[C].applyMatrix4(l.makeRotationAxis(r[C],h*C)),o[C].crossVectors(r[C],s[C])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Lv extends ya{constructor(e=0,n=0,i=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,n){const i=n||new xe,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),g=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),I=l-this.aX,h=g-this.aY;l=I*c-h*u+this.aX,g=I*u+h*c+this.aY}return i.set(l,g)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class zH extends Lv{constructor(e,n,i,r,s,o){super(e,n,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function px(){let t=0,e=0,n=0,i=0;function r(s,o,a,l){t=s,e=a,n=-3*s+3*o-2*a-l,i=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,g){r(o,a,g*(a-s),g*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,g,c,u){let I=(o-s)/g-(a-s)/(g+c)+(a-o)/c,h=(a-o)/c-(l-o)/(c+u)+(l-a)/u;I*=c,h*=c,r(o,a,I,h)},calc:function(s){const o=s*s,a=o*s;return t+e*s+n*o+i*a}}}const Ym=new P,eB=new px,tB=new px,nB=new px;class UH extends ya{constructor(e=[],n=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=i,this.tension=r}getPoint(e,n=new P){const i=n,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let g,c;this.closed||a>0?g=r[(a-1)%s]:(Ym.subVectors(r[0],r[1]).add(r[0]),g=Ym);const u=r[a%s],I=r[(a+1)%s];if(this.closed||a+2<s?c=r[(a+2)%s]:(Ym.subVectors(r[s-1],r[s-2]).add(r[s-1]),c=Ym),this.curveType==="centripetal"||this.curveType==="chordal"){const h=this.curveType==="chordal"?.5:.25;let C=Math.pow(g.distanceToSquared(u),h),b=Math.pow(u.distanceToSquared(I),h),m=Math.pow(I.distanceToSquared(c),h);b<1e-4&&(b=1),C<1e-4&&(C=b),m<1e-4&&(m=b),eB.initNonuniformCatmullRom(g.x,u.x,I.x,c.x,C,b,m),tB.initNonuniformCatmullRom(g.y,u.y,I.y,c.y,C,b,m),nB.initNonuniformCatmullRom(g.z,u.z,I.z,c.z,C,b,m)}else this.curveType==="catmullrom"&&(eB.initCatmullRom(g.x,u.x,I.x,c.x,this.tension),tB.initCatmullRom(g.y,u.y,I.y,c.y,this.tension),nB.initCatmullRom(g.z,u.z,I.z,c.z,this.tension));return i.set(eB.calc(l),tB.calc(l),nB.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){const r=this.points[n];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(new P().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function vW(t,e,n,i,r){const s=(i-e)*.5,o=(r-n)*.5,a=t*t,l=t*a;return(2*n-2*i+s+o)*l+(-3*n+3*i-2*s-o)*a+s*t+n}function Roe(t,e){const n=1-t;return n*n*e}function xoe(t,e){return 2*(1-t)*t*e}function Zoe(t,e){return t*t*e}function VC(t,e,n,i){return Roe(t,e)+xoe(t,n)+Zoe(t,i)}function Eoe(t,e){const n=1-t;return n*n*n*e}function Woe(t,e){const n=1-t;return 3*n*n*t*e}function Noe(t,e){return 3*(1-t)*t*t*e}function Moe(t,e){return t*t*t*e}function LC(t,e,n,i,r){return Eoe(t,e)+Woe(t,n)+Noe(t,i)+Moe(t,r)}class mx extends ya{constructor(e=new xe,n=new xe,i=new xe,r=new xe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=i,this.v3=r}getPoint(e,n=new xe){const i=n,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(LC(e,r.x,s.x,o.x,a.x),LC(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class DH extends ya{constructor(e=new P,n=new P,i=new P,r=new P){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=i,this.v3=r}getPoint(e,n=new P){const i=n,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(LC(e,r.x,s.x,o.x,a.x),LC(e,r.y,s.y,o.y,a.y),LC(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class kv extends ya{constructor(e=new xe,n=new xe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new xe){const i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new xe){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class PH extends ya{constructor(e=new P,n=new P){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=n}getPoint(e,n=new P){const i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new P){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class bx extends ya{constructor(e=new xe,n=new xe,i=new xe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new xe){const i=n,r=this.v0,s=this.v1,o=this.v2;return i.set(VC(e,r.x,s.x,o.x),VC(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class vx extends ya{constructor(e=new P,n=new P,i=new P){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new P){const i=n,r=this.v0,s=this.v1,o=this.v2;return i.set(VC(e,r.x,s.x,o.x),VC(e,r.y,s.y,o.y),VC(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class yx extends ya{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,n=new xe){const i=n,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],g=r[o],c=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return i.set(vW(a,l.x,g.x,c.x,u.x),vW(a,l.y,g.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){const r=this.points[n];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const r=e.points[n];this.points.push(new xe().fromArray(r))}return this}}var Bx=Object.freeze({__proto__:null,ArcCurve:zH,CatmullRomCurve3:UH,CubicBezierCurve:mx,CubicBezierCurve3:DH,EllipseCurve:Lv,LineCurve:kv,LineCurve3:PH,QuadraticBezierCurve:bx,QuadraticBezierCurve3:vx,SplineCurve:yx});class OH extends ya{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);e.equals(n)||this.curves.push(new kv(n,e))}getPoint(e,n){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const o=r[s]-i,a=this.curves[s],l=a.getLength(),g=l===0?0:1-o/l;return a.getPointAt(g,n)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let n=0;for(let i=0,r=this.curves.length;i<r;i++)n+=this.curves[i].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){const n=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let g=0;g<l.length;g++){const c=l[g];i&&i.equals(c)||(n.push(c),i=c)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){const r=e.curves[n];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,i=this.curves.length;n<i;n++){const r=this.curves[n];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){const r=e.curves[n];this.curves.push(new Bx[r.type]().fromJSON(r))}return this}}let Xf=class extends OH{constructor(e){super(),this.type="Path",this.currentPoint=new xe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,i=e.length;n<i;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){const i=new kv(this.currentPoint.clone(),new xe(e,n));return this.curves.push(i),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,i,r){const s=new bx(this.currentPoint.clone(),new xe(e,n),new xe(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,n,i,r,s,o){const a=new mx(this.currentPoint.clone(),new xe(e,n),new xe(i,r),new xe(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const n=[this.currentPoint.clone()].concat(e),i=new yx(n);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,i,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,n+l,i,r,s,o),this}absarc(e,n,i,r,s,o){return this.absellipse(e,n,i,i,r,s,o),this}ellipse(e,n,i,r,s,o,a,l){const g=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+g,n+c,i,r,s,o,a,l),this}absellipse(e,n,i,r,s,o,a,l){const g=new Lv(e,n,i,r,s,o,a,l);if(this.curves.length>0){const u=g.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(g);const c=g.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}};class w0 extends Lt{constructor(e=[new xe(0,-.5),new xe(.5,0),new xe(0,.5)],n=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:i,phiLength:r},n=Math.floor(n),r=Ai(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],g=[],c=1/n,u=new P,I=new xe,h=new P,C=new P,b=new P;let m=0,f=0;for(let p=0;p<=e.length-1;p++)switch(p){case 0:m=e[p+1].x-e[p].x,f=e[p+1].y-e[p].y,h.x=f*1,h.y=-m,h.z=f*0,b.copy(h),h.normalize(),l.push(h.x,h.y,h.z);break;case e.length-1:l.push(b.x,b.y,b.z);break;default:m=e[p+1].x-e[p].x,f=e[p+1].y-e[p].y,h.x=f*1,h.y=-m,h.z=f*0,C.copy(h),h.x+=b.x,h.y+=b.y,h.z+=b.z,h.normalize(),l.push(h.x,h.y,h.z),b.copy(C)}for(let p=0;p<=n;p++){const v=i+p*c*r,B=Math.sin(v),G=Math.cos(v);for(let R=0;R<=e.length-1;R++){u.x=e[R].x*B,u.y=e[R].y,u.z=e[R].x*G,o.push(u.x,u.y,u.z),I.x=p/n,I.y=R/(e.length-1),a.push(I.x,I.y);const w=l[3*R+0]*B,E=l[3*R+1],x=l[3*R+0]*G;g.push(w,E,x)}}for(let p=0;p<n;p++)for(let v=0;v<e.length-1;v++){const B=v+p*e.length,G=B,R=B+e.length,w=B+e.length+1,E=B+1;s.push(G,R,E),s.push(w,E,R)}this.setIndex(s),this.setAttribute("position",new ut(o,3)),this.setAttribute("uv",new ut(a,2)),this.setAttribute("normal",new ut(g,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new w0(e.points,e.segments,e.phiStart,e.phiLength)}}class Hv extends w0{constructor(e=1,n=1,i=4,r=8){const s=new Xf;s.absarc(0,-n/2,e,Math.PI*1.5,0),s.absarc(0,n/2,e,0,Math.PI*.5),super(s.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:n,capSegments:i,radialSegments:r}}static fromJSON(e){return new Hv(e.radius,e.length,e.capSegments,e.radialSegments)}}class _v extends Lt{constructor(e=1,n=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:i,thetaLength:r},n=Math.max(3,n);const s=[],o=[],a=[],l=[],g=new P,c=new xe;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let u=0,I=3;u<=n;u++,I+=3){const h=i+u/n*r;g.x=e*Math.cos(h),g.y=e*Math.sin(h),o.push(g.x,g.y,g.z),a.push(0,0,1),c.x=(o[I]/e+1)/2,c.y=(o[I+1]/e+1)/2,l.push(c.x,c.y)}for(let u=1;u<=n;u++)s.push(u,u+1,0);this.setIndex(s),this.setAttribute("position",new ut(o,3)),this.setAttribute("normal",new ut(a,3)),this.setAttribute("uv",new ut(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _v(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class UA extends Lt{constructor(e=1,n=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const g=this;r=Math.floor(r),s=Math.floor(s);const c=[],u=[],I=[],h=[];let C=0;const b=[],m=i/2;let f=0;p(),o===!1&&(e>0&&v(!0),n>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new ut(u,3)),this.setAttribute("normal",new ut(I,3)),this.setAttribute("uv",new ut(h,2));function p(){const B=new P,G=new P;let R=0;const w=(n-e)/i;for(let E=0;E<=s;E++){const x=[],W=E/s,T=W*(n-e)+e;for(let k=0;k<=r;k++){const _=k/r,U=_*l+a,O=Math.sin(U),Y=Math.cos(U);G.x=T*O,G.y=-W*i+m,G.z=T*Y,u.push(G.x,G.y,G.z),B.set(O,w,Y).normalize(),I.push(B.x,B.y,B.z),h.push(_,1-W),x.push(C++)}b.push(x)}for(let E=0;E<r;E++)for(let x=0;x<s;x++){const W=b[x][E],T=b[x+1][E],k=b[x+1][E+1],_=b[x][E+1];c.push(W,T,_),c.push(T,k,_),R+=6}g.addGroup(f,R,0),f+=R}function v(B){const G=C,R=new xe,w=new P;let E=0;const x=B===!0?e:n,W=B===!0?1:-1;for(let k=1;k<=r;k++)u.push(0,m*W,0),I.push(0,W,0),h.push(.5,.5),C++;const T=C;for(let k=0;k<=r;k++){const U=k/r*l+a,O=Math.cos(U),Y=Math.sin(U);w.x=x*Y,w.y=m*W,w.z=x*O,u.push(w.x,w.y,w.z),I.push(0,W,0),R.x=O*.5+.5,R.y=Y*.5*W+.5,h.push(R.x,R.y),C++}for(let k=0;k<r;k++){const _=G+k,U=T+k;B===!0?c.push(U,U+1,_):c.push(U+1,U,_),E+=3}g.addGroup(f,E,B===!0?1:2),f+=E}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new UA(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Xv extends UA{constructor(e=1,n=1,i=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,n,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Xv(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Rc extends Lt{constructor(e=[],n=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:i,detail:r};const s=[],o=[];a(r),g(i),c(),this.setAttribute("position",new ut(s,3)),this.setAttribute("normal",new ut(s.slice(),3)),this.setAttribute("uv",new ut(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(p){const v=new P,B=new P,G=new P;for(let R=0;R<n.length;R+=3)h(n[R+0],v),h(n[R+1],B),h(n[R+2],G),l(v,B,G,p)}function l(p,v,B,G){const R=G+1,w=[];for(let E=0;E<=R;E++){w[E]=[];const x=p.clone().lerp(B,E/R),W=v.clone().lerp(B,E/R),T=R-E;for(let k=0;k<=T;k++)k===0&&E===R?w[E][k]=x:w[E][k]=x.clone().lerp(W,k/T)}for(let E=0;E<R;E++)for(let x=0;x<2*(R-E)-1;x++){const W=Math.floor(x/2);x%2===0?(I(w[E][W+1]),I(w[E+1][W]),I(w[E][W])):(I(w[E][W+1]),I(w[E+1][W+1]),I(w[E+1][W]))}}function g(p){const v=new P;for(let B=0;B<s.length;B+=3)v.x=s[B+0],v.y=s[B+1],v.z=s[B+2],v.normalize().multiplyScalar(p),s[B+0]=v.x,s[B+1]=v.y,s[B+2]=v.z}function c(){const p=new P;for(let v=0;v<s.length;v+=3){p.x=s[v+0],p.y=s[v+1],p.z=s[v+2];const B=m(p)/2/Math.PI+.5,G=f(p)/Math.PI+.5;o.push(B,1-G)}C(),u()}function u(){for(let p=0;p<o.length;p+=6){const v=o[p+0],B=o[p+2],G=o[p+4],R=Math.max(v,B,G),w=Math.min(v,B,G);R>.9&&w<.1&&(v<.2&&(o[p+0]+=1),B<.2&&(o[p+2]+=1),G<.2&&(o[p+4]+=1))}}function I(p){s.push(p.x,p.y,p.z)}function h(p,v){const B=p*3;v.x=e[B+0],v.y=e[B+1],v.z=e[B+2]}function C(){const p=new P,v=new P,B=new P,G=new P,R=new xe,w=new xe,E=new xe;for(let x=0,W=0;x<s.length;x+=9,W+=6){p.set(s[x+0],s[x+1],s[x+2]),v.set(s[x+3],s[x+4],s[x+5]),B.set(s[x+6],s[x+7],s[x+8]),R.set(o[W+0],o[W+1]),w.set(o[W+2],o[W+3]),E.set(o[W+4],o[W+5]),G.copy(p).add(v).add(B).divideScalar(3);const T=m(G);b(R,W+0,p,T),b(w,W+2,v,T),b(E,W+4,B,T)}}function b(p,v,B,G){G<0&&p.x===1&&(o[v]=p.x-1),B.x===0&&B.z===0&&(o[v]=G/2/Math.PI+.5)}function m(p){return Math.atan2(p.z,-p.x)}function f(p){return Math.atan2(-p.y,Math.sqrt(p.x*p.x+p.z*p.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rc(e.vertices,e.indices,e.radius,e.details)}}class Yv extends Rc{constructor(e=1,n=0){const i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Yv(e.radius,e.detail)}}const Km=new P,zm=new P,iB=new P,Um=new ms;class QH extends Lt{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){const r=Math.pow(10,4),s=Math.cos(Xu*n),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,g=[0,0,0],c=["a","b","c"],u=new Array(3),I={},h=[];for(let C=0;C<l;C+=3){o?(g[0]=o.getX(C),g[1]=o.getX(C+1),g[2]=o.getX(C+2)):(g[0]=C,g[1]=C+1,g[2]=C+2);const{a:b,b:m,c:f}=Um;if(b.fromBufferAttribute(a,g[0]),m.fromBufferAttribute(a,g[1]),f.fromBufferAttribute(a,g[2]),Um.getNormal(iB),u[0]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,u[1]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,u[2]=`${Math.round(f.x*r)},${Math.round(f.y*r)},${Math.round(f.z*r)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let p=0;p<3;p++){const v=(p+1)%3,B=u[p],G=u[v],R=Um[c[p]],w=Um[c[v]],E=`${B}_${G}`,x=`${G}_${B}`;x in I&&I[x]?(iB.dot(I[x].normal)<=s&&(h.push(R.x,R.y,R.z),h.push(w.x,w.y,w.z)),I[x]=null):E in I||(I[E]={index0:g[p],index1:g[v],normal:iB.clone()})}}for(const C in I)if(I[C]){const{index0:b,index1:m}=I[C];Km.fromBufferAttribute(a,b),zm.fromBufferAttribute(a,m),h.push(Km.x,Km.y,Km.z),h.push(zm.x,zm.y,zm.z)}this.setAttribute("position",new ut(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let Ku=class extends Xf{constructor(e){super(e),this.uuid=$s(),this.type="Shape",this.holes=[]}getPointsHoles(e){const n=[];for(let i=0,r=this.holes.length;i<r;i++)n[i]=this.holes[i].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){const r=e.holes[n];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,i=this.holes.length;n<i;n++){const r=this.holes[n];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){const r=e.holes[n];this.holes.push(new Xf().fromJSON(r))}return this}};const Toe={triangulate:function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=JH(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,g,c,u,I,h;if(i&&(s=Hoe(t,e,s,n)),t.length>80*n){a=g=t[0],l=c=t[1];for(let C=n;C<r;C+=n)u=t[C],I=t[C+1],u<a&&(a=u),I<l&&(l=I),u>g&&(g=u),I>c&&(c=I);h=Math.max(g-a,c-l),h=h!==0?32767/h:0}return Yf(s,o,n,a,l,h,0),o}};function JH(t,e,n,i,r){let s,o;if(r===Joe(t,e,n,i)>0)for(s=e;s<n;s+=i)o=yW(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=yW(s,t[s],t[s+1],o);return o&&Kv(o,o.next)&&(zf(o),o=o.next),o}function oI(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(Kv(n,n.next)||si(n.prev,n,n.next)===0)){if(zf(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Yf(t,e,n,i,r,s,o){if(!t)return;!o&&s&&zoe(t,i,r,s);let a=t,l,g;for(;t.prev!==t.next;){if(l=t.prev,g=t.next,s?Voe(t,i,r,s):Foe(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(g.i/n|0),zf(t),t=g.next,a=g.next;continue}if(t=g,t===a){o?o===1?(t=Loe(oI(t),e,n),Yf(t,e,n,i,r,s,2)):o===2&&koe(t,e,n,i,r,s):Yf(oI(t),e,n,i,r,s,1);break}}}function Foe(t){const e=t.prev,n=t,i=t.next;if(si(e,n,i)>=0)return!1;const r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,g=i.y,c=r<s?r<o?r:o:s<o?s:o,u=a<l?a<g?a:g:l<g?l:g,I=r>s?r>o?r:o:s>o?s:o,h=a>l?a>g?a:g:l>g?l:g;let C=i.next;for(;C!==e;){if(C.x>=c&&C.x<=I&&C.y>=u&&C.y<=h&&_d(r,a,s,l,o,g,C.x,C.y)&&si(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function Voe(t,e,n,i){const r=t.prev,s=t,o=t.next;if(si(r,s,o)>=0)return!1;const a=r.x,l=s.x,g=o.x,c=r.y,u=s.y,I=o.y,h=a<l?a<g?a:g:l<g?l:g,C=c<u?c<I?c:I:u<I?u:I,b=a>l?a>g?a:g:l>g?l:g,m=c>u?c>I?c:I:u>I?u:I,f=iS(h,C,e,n,i),p=iS(b,m,e,n,i);let v=t.prevZ,B=t.nextZ;for(;v&&v.z>=f&&B&&B.z<=p;){if(v.x>=h&&v.x<=b&&v.y>=C&&v.y<=m&&v!==r&&v!==o&&_d(a,c,l,u,g,I,v.x,v.y)&&si(v.prev,v,v.next)>=0||(v=v.prevZ,B.x>=h&&B.x<=b&&B.y>=C&&B.y<=m&&B!==r&&B!==o&&_d(a,c,l,u,g,I,B.x,B.y)&&si(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;v&&v.z>=f;){if(v.x>=h&&v.x<=b&&v.y>=C&&v.y<=m&&v!==r&&v!==o&&_d(a,c,l,u,g,I,v.x,v.y)&&si(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;B&&B.z<=p;){if(B.x>=h&&B.x<=b&&B.y>=C&&B.y<=m&&B!==r&&B!==o&&_d(a,c,l,u,g,I,B.x,B.y)&&si(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function Loe(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Kv(r,s)&&jH(r,i,i.next,s)&&Kf(r,s)&&Kf(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),zf(i),zf(i.next),i=t=s),i=i.next}while(i!==t);return oI(i)}function koe(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Poe(o,a)){let l=qH(o,a);o=oI(o,o.next),l=oI(l,l.next),Yf(o,e,n,i,r,s,0),Yf(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function Hoe(t,e,n,i){const r=[];let s,o,a,l,g;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,g=JH(t,a,l,i,!1),g===g.next&&(g.steiner=!0),r.push(Doe(g));for(r.sort(_oe),s=0;s<r.length;s++)n=Xoe(r[s],n);return n}function _oe(t,e){return t.x-e.x}function Xoe(t,e){const n=Yoe(t,e);if(!n)return e;const i=qH(n,t);return oI(i,i.next),oI(n,n.next)}function Yoe(t,e){let n=e,i=-1/0,r;const s=t.x,o=t.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const I=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(I<=s&&I>i&&(i=I,r=n.x<n.next.x?n:n.next,I===s))return r}n=n.next}while(n!==e);if(!r)return null;const a=r,l=r.x,g=r.y;let c=1/0,u;n=r;do s>=n.x&&n.x>=l&&s!==n.x&&_d(o<g?s:i,o,l,g,o<g?i:s,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(s-n.x),Kf(n,t)&&(u<c||u===c&&(n.x>r.x||n.x===r.x&&Koe(r,n)))&&(r=n,c=u)),n=n.next;while(n!==a);return r}function Koe(t,e){return si(t.prev,t,e.prev)<0&&si(e.next,t,t.next)<0}function zoe(t,e,n,i){let r=t;do r.z===0&&(r.z=iS(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,Uoe(r)}function Uoe(t){let e,n,i,r,s,o,a,l,g=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<g&&(a++,i=i.nextZ,!!i);e++);for(l=g;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,g*=2}while(o>1);return t}function iS(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Doe(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function _d(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function Poe(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Ooe(t,e)&&(Kf(t,e)&&Kf(e,t)&&Qoe(t,e)&&(si(t.prev,t,e.prev)||si(t,e.prev,e))||Kv(t,e)&&si(t.prev,t,t.next)>0&&si(e.prev,e,e.next)>0)}function si(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Kv(t,e){return t.x===e.x&&t.y===e.y}function jH(t,e,n,i){const r=Pm(si(t,e,n)),s=Pm(si(t,e,i)),o=Pm(si(n,i,t)),a=Pm(si(n,i,e));return!!(r!==s&&o!==a||r===0&&Dm(t,n,e)||s===0&&Dm(t,i,e)||o===0&&Dm(n,t,i)||a===0&&Dm(n,e,i))}function Dm(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Pm(t){return t>0?1:t<0?-1:0}function Ooe(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&jH(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Kf(t,e){return si(t.prev,t,t.next)<0?si(t,e,t.next)>=0&&si(t,t.prev,e)>=0:si(t,e,t.prev)<0||si(t,t.next,e)<0}function Qoe(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function qH(t,e){const n=new rS(t.i,t.x,t.y),i=new rS(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function yW(t,e,n,i){const r=new rS(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function zf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function rS(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Joe(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}class qa{static area(e){const n=e.length;let i=0;for(let r=n-1,s=0;s<n;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return qa.area(e)<0}static triangulateShape(e,n){const i=[],r=[],s=[];BW(e),GW(i,e);let o=e.length;n.forEach(BW);for(let l=0;l<n.length;l++)r.push(o),o+=n[l].length,GW(i,n[l]);const a=Toe.triangulate(i,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function BW(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function GW(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class zv extends Lt{constructor(e=new Ku([new xe(.5,.5),new xe(-.5,.5),new xe(-.5,-.5),new xe(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const g=e[a];o(g)}this.setAttribute("position",new ut(r,3)),this.setAttribute("uv",new ut(s,2)),this.computeVertexNormals();function o(a){const l=[],g=n.curveSegments!==void 0?n.curveSegments:12,c=n.steps!==void 0?n.steps:1,u=n.depth!==void 0?n.depth:1;let I=n.bevelEnabled!==void 0?n.bevelEnabled:!0,h=n.bevelThickness!==void 0?n.bevelThickness:.2,C=n.bevelSize!==void 0?n.bevelSize:h-.1,b=n.bevelOffset!==void 0?n.bevelOffset:0,m=n.bevelSegments!==void 0?n.bevelSegments:3;const f=n.extrudePath,p=n.UVGenerator!==void 0?n.UVGenerator:joe;let v,B=!1,G,R,w,E;f&&(v=f.getSpacedPoints(c),B=!0,I=!1,G=f.computeFrenetFrames(c,!1),R=new P,w=new P,E=new P),I||(m=0,h=0,C=0,b=0);const x=a.extractPoints(g);let W=x.shape;const T=x.holes;if(!qa.isClockWise(W)){W=W.reverse();for(let D=0,fe=T.length;D<fe;D++){const Ce=T[D];qa.isClockWise(Ce)&&(T[D]=Ce.reverse())}}const _=qa.triangulateShape(W,T),U=W;for(let D=0,fe=T.length;D<fe;D++){const Ce=T[D];W=W.concat(Ce)}function O(D,fe,Ce){return fe||console.error("THREE.ExtrudeGeometry: vec does not exist"),D.clone().addScaledVector(fe,Ce)}const Y=W.length,z=_.length;function N(D,fe,Ce){let pe,be,Ue;const me=D.x-fe.x,we=D.y-fe.y,Be=Ce.x-D.x,Ae=Ce.y-D.y,De=me*me+we*we,Q=me*Ae-we*Be;if(Math.abs(Q)>Number.EPSILON){const K=Math.sqrt(De),ge=Math.sqrt(Be*Be+Ae*Ae),Le=fe.x-we/K,Re=fe.y+me/K,Ze=Ce.x-Ae/ge,Je=Ce.y+Be/ge,Ye=((Ze-Le)*Ae-(Je-Re)*Be)/(me*Ae-we*Be);pe=Le+me*Ye-D.x,be=Re+we*Ye-D.y;const de=pe*pe+be*be;if(de<=2)return new xe(pe,be);Ue=Math.sqrt(de/2)}else{let K=!1;me>Number.EPSILON?Be>Number.EPSILON&&(K=!0):me<-Number.EPSILON?Be<-Number.EPSILON&&(K=!0):Math.sign(we)===Math.sign(Ae)&&(K=!0),K?(pe=-we,be=me,Ue=Math.sqrt(De)):(pe=me,be=we,Ue=Math.sqrt(De/2))}return new xe(pe/Ue,be/Ue)}const L=[];for(let D=0,fe=U.length,Ce=fe-1,pe=D+1;D<fe;D++,Ce++,pe++)Ce===fe&&(Ce=0),pe===fe&&(pe=0),L[D]=N(U[D],U[Ce],U[pe]);const V=[];let M,X=L.concat();for(let D=0,fe=T.length;D<fe;D++){const Ce=T[D];M=[];for(let pe=0,be=Ce.length,Ue=be-1,me=pe+1;pe<be;pe++,Ue++,me++)Ue===be&&(Ue=0),me===be&&(me=0),M[pe]=N(Ce[pe],Ce[Ue],Ce[me]);V.push(M),X=X.concat(M)}for(let D=0;D<m;D++){const fe=D/m,Ce=h*Math.cos(fe*Math.PI/2),pe=C*Math.sin(fe*Math.PI/2)+b;for(let be=0,Ue=U.length;be<Ue;be++){const me=O(U[be],L[be],pe);ae(me.x,me.y,-Ce)}for(let be=0,Ue=T.length;be<Ue;be++){const me=T[be];M=V[be];for(let we=0,Be=me.length;we<Be;we++){const Ae=O(me[we],M[we],pe);ae(Ae.x,Ae.y,-Ce)}}}const J=C+b;for(let D=0;D<Y;D++){const fe=I?O(W[D],X[D],J):W[D];B?(w.copy(G.normals[0]).multiplyScalar(fe.x),R.copy(G.binormals[0]).multiplyScalar(fe.y),E.copy(v[0]).add(w).add(R),ae(E.x,E.y,E.z)):ae(fe.x,fe.y,0)}for(let D=1;D<=c;D++)for(let fe=0;fe<Y;fe++){const Ce=I?O(W[fe],X[fe],J):W[fe];B?(w.copy(G.normals[D]).multiplyScalar(Ce.x),R.copy(G.binormals[D]).multiplyScalar(Ce.y),E.copy(v[D]).add(w).add(R),ae(E.x,E.y,E.z)):ae(Ce.x,Ce.y,u/c*D)}for(let D=m-1;D>=0;D--){const fe=D/m,Ce=h*Math.cos(fe*Math.PI/2),pe=C*Math.sin(fe*Math.PI/2)+b;for(let be=0,Ue=U.length;be<Ue;be++){const me=O(U[be],L[be],pe);ae(me.x,me.y,u+Ce)}for(let be=0,Ue=T.length;be<Ue;be++){const me=T[be];M=V[be];for(let we=0,Be=me.length;we<Be;we++){const Ae=O(me[we],M[we],pe);B?ae(Ae.x,Ae.y+v[c-1].y,v[c-1].x+Ce):ae(Ae.x,Ae.y,u+Ce)}}}re(),se();function re(){const D=r.length/3;if(I){let fe=0,Ce=Y*fe;for(let pe=0;pe<z;pe++){const be=_[pe];ce(be[2]+Ce,be[1]+Ce,be[0]+Ce)}fe=c+m*2,Ce=Y*fe;for(let pe=0;pe<z;pe++){const be=_[pe];ce(be[0]+Ce,be[1]+Ce,be[2]+Ce)}}else{for(let fe=0;fe<z;fe++){const Ce=_[fe];ce(Ce[2],Ce[1],Ce[0])}for(let fe=0;fe<z;fe++){const Ce=_[fe];ce(Ce[0]+Y*c,Ce[1]+Y*c,Ce[2]+Y*c)}}i.addGroup(D,r.length/3-D,0)}function se(){const D=r.length/3;let fe=0;le(U,fe),fe+=U.length;for(let Ce=0,pe=T.length;Ce<pe;Ce++){const be=T[Ce];le(be,fe),fe+=be.length}i.addGroup(D,r.length/3-D,1)}function le(D,fe){let Ce=D.length;for(;--Ce>=0;){const pe=Ce;let be=Ce-1;be<0&&(be=D.length-1);for(let Ue=0,me=c+m*2;Ue<me;Ue++){const we=Y*Ue,Be=Y*(Ue+1),Ae=fe+pe+we,De=fe+be+we,Q=fe+be+Be,K=fe+pe+Be;Ee(Ae,De,Q,K)}}}function ae(D,fe,Ce){l.push(D),l.push(fe),l.push(Ce)}function ce(D,fe,Ce){Fe(D),Fe(fe),Fe(Ce);const pe=r.length/3,be=p.generateTopUV(i,r,pe-3,pe-2,pe-1);oe(be[0]),oe(be[1]),oe(be[2])}function Ee(D,fe,Ce,pe){Fe(D),Fe(fe),Fe(pe),Fe(fe),Fe(Ce),Fe(pe);const be=r.length/3,Ue=p.generateSideWallUV(i,r,be-6,be-3,be-2,be-1);oe(Ue[0]),oe(Ue[1]),oe(Ue[3]),oe(Ue[1]),oe(Ue[2]),oe(Ue[3])}function Fe(D){r.push(l[D*3+0]),r.push(l[D*3+1]),r.push(l[D*3+2])}function oe(D){s.push(D.x),s.push(D.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes,i=this.parameters.options;return qoe(n,i,e)}static fromJSON(e,n){const i=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=n[e.shapes[s]];i.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new Bx[r.type]().fromJSON(r)),new zv(i,e.options)}}const joe={generateTopUV:function(t,e,n,i,r){const s=e[n*3],o=e[n*3+1],a=e[i*3],l=e[i*3+1],g=e[r*3],c=e[r*3+1];return[new xe(s,o),new xe(a,l),new xe(g,c)]},generateSideWallUV:function(t,e,n,i,r,s){const o=e[n*3],a=e[n*3+1],l=e[n*3+2],g=e[i*3],c=e[i*3+1],u=e[i*3+2],I=e[r*3],h=e[r*3+1],C=e[r*3+2],b=e[s*3],m=e[s*3+1],f=e[s*3+2];return Math.abs(a-c)<Math.abs(o-g)?[new xe(o,1-l),new xe(g,1-u),new xe(I,1-C),new xe(b,1-f)]:[new xe(a,1-l),new xe(c,1-u),new xe(h,1-C),new xe(m,1-f)]}};function qoe(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const s=t[i];n.shapes.push(s.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class Uv extends Rc{constructor(e=1,n=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Uv(e.radius,e.detail)}}class R0 extends Rc{constructor(e=1,n=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new R0(e.radius,e.detail)}}class Dv extends Lt{constructor(e=.5,n=1,i=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:o},i=Math.max(3,i),r=Math.max(1,r);const a=[],l=[],g=[],c=[];let u=e;const I=(n-e)/r,h=new P,C=new xe;for(let b=0;b<=r;b++){for(let m=0;m<=i;m++){const f=s+m/i*o;h.x=u*Math.cos(f),h.y=u*Math.sin(f),l.push(h.x,h.y,h.z),g.push(0,0,1),C.x=(h.x/n+1)/2,C.y=(h.y/n+1)/2,c.push(C.x,C.y)}u+=I}for(let b=0;b<r;b++){const m=b*(i+1);for(let f=0;f<i;f++){const p=f+m,v=p,B=p+i+1,G=p+i+2,R=p+1;a.push(v,B,R),a.push(B,G,R)}}this.setIndex(a),this.setAttribute("position",new ut(l,3)),this.setAttribute("normal",new ut(g,3)),this.setAttribute("uv",new ut(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dv(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Pv extends Lt{constructor(e=new Ku([new xe(0,.5),new xe(-.5,-.5),new xe(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};const i=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)g(e);else for(let c=0;c<e.length;c++)g(e[c]),this.addGroup(a,l,c),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new ut(r,3)),this.setAttribute("normal",new ut(s,3)),this.setAttribute("uv",new ut(o,2));function g(c){const u=r.length/3,I=c.extractPoints(n);let h=I.shape;const C=I.holes;qa.isClockWise(h)===!1&&(h=h.reverse());for(let m=0,f=C.length;m<f;m++){const p=C[m];qa.isClockWise(p)===!0&&(C[m]=p.reverse())}const b=qa.triangulateShape(h,C);for(let m=0,f=C.length;m<f;m++){const p=C[m];h=h.concat(p)}for(let m=0,f=h.length;m<f;m++){const p=h[m];r.push(p.x,p.y,0),s.push(0,0,1),o.push(p.x,p.y)}for(let m=0,f=b.length;m<f;m++){const p=b[m],v=p[0]+u,B=p[1]+u,G=p[2]+u;i.push(v,B,G),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes;return $oe(n,e)}static fromJSON(e,n){const i=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=n[e.shapes[r]];i.push(o)}return new Pv(i,e.curveSegments)}}function $oe(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}class x0 extends Lt{constructor(e=1,n=32,i=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},n=Math.max(3,Math.floor(n)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let g=0;const c=[],u=new P,I=new P,h=[],C=[],b=[],m=[];for(let f=0;f<=i;f++){const p=[],v=f/i;let B=0;f===0&&o===0?B=.5/n:f===i&&l===Math.PI&&(B=-.5/n);for(let G=0;G<=n;G++){const R=G/n;u.x=-e*Math.cos(r+R*s)*Math.sin(o+v*a),u.y=e*Math.cos(o+v*a),u.z=e*Math.sin(r+R*s)*Math.sin(o+v*a),C.push(u.x,u.y,u.z),I.copy(u).normalize(),b.push(I.x,I.y,I.z),m.push(R+B,1-v),p.push(g++)}c.push(p)}for(let f=0;f<i;f++)for(let p=0;p<n;p++){const v=c[f][p+1],B=c[f][p],G=c[f+1][p],R=c[f+1][p+1];(f!==0||o>0)&&h.push(v,B,R),(f!==i-1||l<Math.PI)&&h.push(B,G,R)}this.setIndex(h),this.setAttribute("position",new ut(C,3)),this.setAttribute("normal",new ut(b,3)),this.setAttribute("uv",new ut(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new x0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ov extends Rc{constructor(e=1,n=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Ov(e.radius,e.detail)}}class Qv extends Lt{constructor(e=1,n=.4,i=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],l=[],g=[],c=new P,u=new P,I=new P;for(let h=0;h<=i;h++)for(let C=0;C<=r;C++){const b=C/r*s,m=h/i*Math.PI*2;u.x=(e+n*Math.cos(m))*Math.cos(b),u.y=(e+n*Math.cos(m))*Math.sin(b),u.z=n*Math.sin(m),a.push(u.x,u.y,u.z),c.x=e*Math.cos(b),c.y=e*Math.sin(b),I.subVectors(u,c).normalize(),l.push(I.x,I.y,I.z),g.push(C/r),g.push(h/i)}for(let h=1;h<=i;h++)for(let C=1;C<=r;C++){const b=(r+1)*h+C-1,m=(r+1)*(h-1)+C-1,f=(r+1)*(h-1)+C,p=(r+1)*h+C;o.push(b,m,p),o.push(m,f,p)}this.setIndex(o),this.setAttribute("position",new ut(a,3)),this.setAttribute("normal",new ut(l,3)),this.setAttribute("uv",new ut(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qv(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Jv extends Lt{constructor(e=1,n=.4,i=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:i,radialSegments:r,p:s,q:o},i=Math.floor(i),r=Math.floor(r);const a=[],l=[],g=[],c=[],u=new P,I=new P,h=new P,C=new P,b=new P,m=new P,f=new P;for(let v=0;v<=i;++v){const B=v/i*s*Math.PI*2;p(B,s,o,e,h),p(B+.01,s,o,e,C),m.subVectors(C,h),f.addVectors(C,h),b.crossVectors(m,f),f.crossVectors(b,m),b.normalize(),f.normalize();for(let G=0;G<=r;++G){const R=G/r*Math.PI*2,w=-n*Math.cos(R),E=n*Math.sin(R);u.x=h.x+(w*f.x+E*b.x),u.y=h.y+(w*f.y+E*b.y),u.z=h.z+(w*f.z+E*b.z),l.push(u.x,u.y,u.z),I.subVectors(u,h).normalize(),g.push(I.x,I.y,I.z),c.push(v/i),c.push(G/r)}}for(let v=1;v<=i;v++)for(let B=1;B<=r;B++){const G=(r+1)*(v-1)+(B-1),R=(r+1)*v+(B-1),w=(r+1)*v+B,E=(r+1)*(v-1)+B;a.push(G,R,E),a.push(R,w,E)}this.setIndex(a),this.setAttribute("position",new ut(l,3)),this.setAttribute("normal",new ut(g,3)),this.setAttribute("uv",new ut(c,2));function p(v,B,G,R,w){const E=Math.cos(v),x=Math.sin(v),W=G/B*v,T=Math.cos(W);w.x=R*(2+T)*.5*E,w.y=R*(2+T)*x*.5,w.z=R*Math.sin(W)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jv(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class jv extends Lt{constructor(e=new vx(new P(-1,-1,0),new P(-1,1,0),new P(1,1,0)),n=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:i,radialSegments:r,closed:s};const o=e.computeFrenetFrames(n,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new P,l=new P,g=new xe;let c=new P;const u=[],I=[],h=[],C=[];b(),this.setIndex(C),this.setAttribute("position",new ut(u,3)),this.setAttribute("normal",new ut(I,3)),this.setAttribute("uv",new ut(h,2));function b(){for(let v=0;v<n;v++)m(v);m(s===!1?n:0),p(),f()}function m(v){c=e.getPointAt(v/n,c);const B=o.normals[v],G=o.binormals[v];for(let R=0;R<=r;R++){const w=R/r*Math.PI*2,E=Math.sin(w),x=-Math.cos(w);l.x=x*B.x+E*G.x,l.y=x*B.y+E*G.y,l.z=x*B.z+E*G.z,l.normalize(),I.push(l.x,l.y,l.z),a.x=c.x+i*l.x,a.y=c.y+i*l.y,a.z=c.z+i*l.z,u.push(a.x,a.y,a.z)}}function f(){for(let v=1;v<=n;v++)for(let B=1;B<=r;B++){const G=(r+1)*(v-1)+(B-1),R=(r+1)*v+(B-1),w=(r+1)*v+B,E=(r+1)*(v-1)+B;C.push(G,R,E),C.push(R,w,E)}}function p(){for(let v=0;v<=n;v++)for(let B=0;B<=r;B++)g.x=v/n,g.y=B/r,h.push(g.x,g.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new jv(new Bx[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class $H extends Lt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const n=[],i=new Set,r=new P,s=new P;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let g=0,c=l.length;g<c;++g){const u=l[g],I=u.start,h=u.count;for(let C=I,b=I+h;C<b;C+=3)for(let m=0;m<3;m++){const f=a.getX(C+m),p=a.getX(C+(m+1)%3);r.fromBufferAttribute(o,f),s.fromBufferAttribute(o,p),SW(r,s,i)===!0&&(n.push(r.x,r.y,r.z),n.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let g=0;g<3;g++){const c=3*a+g,u=3*a+(g+1)%3;r.fromBufferAttribute(o,c),s.fromBufferAttribute(o,u),SW(r,s,i)===!0&&(n.push(r.x,r.y,r.z),n.push(s.x,s.y,s.z))}}this.setAttribute("position",new ut(n,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function SW(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return n.has(i)===!0||n.has(r)===!0?!1:(n.add(i),n.add(r),!0)}var wW=Object.freeze({__proto__:null,BoxGeometry:wc,CapsuleGeometry:Hv,CircleGeometry:_v,ConeGeometry:Xv,CylinderGeometry:UA,DodecahedronGeometry:Yv,EdgesGeometry:QH,ExtrudeGeometry:zv,IcosahedronGeometry:Uv,LatheGeometry:w0,OctahedronGeometry:R0,PlaneGeometry:cg,PolyhedronGeometry:Rc,RingGeometry:Dv,ShapeGeometry:Pv,SphereGeometry:x0,TetrahedronGeometry:Ov,TorusGeometry:Qv,TorusKnotGeometry:Jv,TubeGeometry:jv,WireframeGeometry:$H});class e_ extends br{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new et(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class kC extends an{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Gx extends br{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new et(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sc,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class t_ extends Gx{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ai(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new et(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new et(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new et(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class n_ extends br{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new et(16777215),this.specular=new et(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sc,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=v0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class i_ extends br{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new et(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sc,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Z0 extends br{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sc,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class r_ extends br{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sc,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=v0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class s_ extends br{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new et(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sc,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class o_ extends os{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Bo(t,e,n){return Sx(t)?new t.constructor(t.subarray(e,n!==void 0?n:t.length)):t.slice(e,n)}function Tu(t,e,n){return!t||!n&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function Sx(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function a_(t){function e(r,s){return t[r]-t[s]}const n=t.length,i=new Array(n);for(let r=0;r!==n;++r)i[r]=r;return i.sort(e),i}function sS(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const a=n[s]*e;for(let l=0;l!==e;++l)r[o++]=t[a+l]}return r}function wx(t,e,n,i){let r=1,s=t[0];for(;s!==void 0&&s[i]===void 0;)s=t[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),n.push.apply(n,o)),s=t[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),n.push(o)),s=t[r++];while(s!==void 0)}function eae(t,e,n,i,r=30){const s=t.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const g=s.tracks[l],c=g.getValueSize(),u=[],I=[];for(let h=0;h<g.times.length;++h){const C=g.times[h]*r;if(!(C<n||C>=i)){u.push(g.times[h]);for(let b=0;b<c;++b)I.push(g.values[h*c+b])}}u.length!==0&&(g.times=Tu(u,g.times.constructor),g.values=Tu(I,g.values.constructor),o.push(g))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function tae(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let o=0;o<r;++o){const a=n.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const g=t.tracks.find(function(f){return f.name===a.name&&f.ValueTypeName===l});if(g===void 0)continue;let c=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);let I=0;const h=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(I=h/3);const C=a.times.length-1;let b;if(s<=a.times[0]){const f=c,p=u-c;b=Bo(a.values,f,p)}else if(s>=a.times[C]){const f=C*u+c,p=f+u-c;b=Bo(a.values,f,p)}else{const f=a.createInterpolant(),p=c,v=u-c;f.evaluate(s),b=Bo(f.resultBuffer,p,v)}l==="quaternion"&&new gr().fromArray(b).normalize().conjugate().toArray(b);const m=g.times.length;for(let f=0;f<m;++f){const p=f*h+I;if(l==="quaternion")gr.multiplyQuaternionsFlat(g.values,p,b,0,g.values,p);else{const v=h-I*2;for(let B=0;B<v;++B)g.values[p+B]-=b[B]}}}return t.blendMode=sx,t}const nae={arraySlice:Bo,convertArray:Tu,isTypedArray:Sx,getKeyframeOrder:a_,sortedArray:sS,flattenJSON:wx,subclip:eae,makeClipAdditive:tae};class E0{constructor(e,n,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let i=this._cachedIndex,r=n[i],s=n[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break i;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=n[++i],e<r)break t}o=n.length;break n}if(!(e>=s)){const a=n[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=n[--i-1],e>=s)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<n[a]?o=a:i=a+1}if(r=n[i],s=n[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)n[o]=i[s+o];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class l_ extends E0{constructor(e,n,i,r){super(e,n,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Wu,endingEnd:Wu}}intervalChanged_(e,n,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Nu:s=e,a=2*n-i;break;case Lf:s=r.length-2,a=n+r[s]-r[s+1];break;default:s=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Nu:o=e,l=2*i-n;break;case Lf:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=n}const g=(i-n)*.5,c=this.valueSize;this._weightPrev=g/(n-a),this._weightNext=g/(l-i),this._offsetPrev=s*c,this._offsetNext=o*c}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,g=l-a,c=this._offsetPrev,u=this._offsetNext,I=this._weightPrev,h=this._weightNext,C=(i-n)/(r-n),b=C*C,m=b*C,f=-I*m+2*I*b-I*C,p=(1+I)*m+(-1.5-2*I)*b+(-.5+I)*C+1,v=(-1-h)*m+(1.5+h)*b+.5*C,B=h*m-h*b;for(let G=0;G!==a;++G)s[G]=f*o[c+G]+p*o[g+G]+v*o[l+G]+B*o[u+G];return s}}class Rx extends E0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,g=l-a,c=(i-n)/(r-n),u=1-c;for(let I=0;I!==a;++I)s[I]=o[g+I]*u+o[l+I]*c;return s}}class g_ extends E0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ba{constructor(e,n,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Tu(n,this.TimeBufferType),this.values=Tu(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let i;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:Tu(e.times,Array),values:Tu(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new g_(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Rx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new l_(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case Ff:n=this.InterpolantFactoryMethodDiscrete;break;case Vf:n=this.InterpolantFactoryMethodLinear;break;case q2:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ff;case this.InterpolantFactoryMethodLinear:return Vf;case this.InterpolantFactoryMethodSmooth:return q2}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]*=e}return this}trim(e,n){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;o!==-1&&i[o]>n;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=Bo(i,s,o),this.values=Bo(this.values,s*a,o*a)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&Sx(r))for(let a=0,l=r.length;a!==l;++a){const g=r[a];if(isNaN(g)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,g),e=!1;break}}return e}optimize(){const e=Bo(this.times),n=Bo(this.values),i=this.getValueSize(),r=this.getInterpolation()===q2,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const g=e[a],c=e[a+1];if(g!==c&&(a!==1||g!==e[0]))if(r)l=!0;else{const u=a*i,I=u-i,h=u+i;for(let C=0;C!==i;++C){const b=n[u+C];if(b!==n[I+C]||b!==n[h+C]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const u=a*i,I=o*i;for(let h=0;h!==i;++h)n[I+h]=n[u+h]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,g=0;g!==i;++g)n[l+g]=n[a+g];++o}return o!==e.length?(this.times=Bo(e,0,o),this.values=Bo(n,0,o*i)):(this.times=e,this.values=n),this}clone(){const e=Bo(this.times,0),n=Bo(this.values,0),i=this.constructor,r=new i(this.name,e,n);return r.createInterpolant=this.createInterpolant,r}}Ba.prototype.TimeBufferType=Float32Array;Ba.prototype.ValueBufferType=Float32Array;Ba.prototype.DefaultInterpolation=Vf;class vI extends Ba{}vI.prototype.ValueTypeName="bool";vI.prototype.ValueBufferType=Array;vI.prototype.DefaultInterpolation=Ff;vI.prototype.InterpolantFactoryMethodLinear=void 0;vI.prototype.InterpolantFactoryMethodSmooth=void 0;class xx extends Ba{}xx.prototype.ValueTypeName="color";class Uf extends Ba{}Uf.prototype.ValueTypeName="number";class c_ extends E0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-n)/(r-n);let g=e*a;for(let c=g+a;g!==c;g+=4)gr.slerpFlat(s,0,o,g-a,o,g,l);return s}}class DA extends Ba{InterpolantFactoryMethodLinear(e){return new c_(this.times,this.values,this.getValueSize(),e)}}DA.prototype.ValueTypeName="quaternion";DA.prototype.DefaultInterpolation=Vf;DA.prototype.InterpolantFactoryMethodSmooth=void 0;class yI extends Ba{}yI.prototype.ValueTypeName="string";yI.prototype.ValueBufferType=Array;yI.prototype.DefaultInterpolation=Ff;yI.prototype.InterpolantFactoryMethodLinear=void 0;yI.prototype.InterpolantFactoryMethodSmooth=void 0;class Df extends Ba{}Df.prototype.ValueTypeName="vector";class Pf{constructor(e,n=-1,i,r=wv){this.name=e,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=$s(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)n.push(rae(i[o]).scale(r));const s=new this(e.name,e.duration,n,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const n=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)n.push(Ba.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,n,i,r){const s=n.length,o=[];for(let a=0;a<s;a++){let l=[],g=[];l.push((a+s-1)%s,a,(a+1)%s),g.push(0,1,0);const c=a_(l);l=sS(l,1,c),g=sS(g,1,c),!r&&l[0]===0&&(l.push(s),g.push(g[0])),o.push(new Uf(".morphTargetInfluences["+n[a].name+"]",l,g).scale(1/i))}return new this(e,-1,o)}static findByName(e,n){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===n)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,n,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const g=e[a],c=g.name.match(s);if(c&&c.length>1){const u=c[1];let I=r[u];I||(r[u]=I=[]),I.push(g)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],n,i));return o}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,I,h,C,b){if(h.length!==0){const m=[],f=[];wx(h,m,f,C),m.length!==0&&b.push(new u(I,m,f))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const g=e.hierarchy||[];for(let u=0;u<g.length;u++){const I=g[u].keys;if(!(!I||I.length===0))if(I[0].morphTargets){const h={};let C;for(C=0;C<I.length;C++)if(I[C].morphTargets)for(let b=0;b<I[C].morphTargets.length;b++)h[I[C].morphTargets[b]]=-1;for(const b in h){const m=[],f=[];for(let p=0;p!==I[C].morphTargets.length;++p){const v=I[C];m.push(v.time),f.push(v.morphTarget===b?1:0)}r.push(new Uf(".morphTargetInfluence["+b+"]",m,f))}l=h.length*o}else{const h=".bones["+n[u].name+"]";i(Df,h+".position",I,"pos",r),i(DA,h+".quaternion",I,"rot",r),i(Df,h+".scale",I,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let n=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];n=Math.max(n,s.times[s.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function iae(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Uf;case"vector":case"vector2":case"vector3":case"vector4":return Df;case"color":return xx;case"quaternion":return DA;case"bool":case"boolean":return vI;case"string":return yI}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function rae(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=iae(t.type);if(t.times===void 0){const n=[],i=[];wx(t.keys,n,i,"value"),t.times=n,t.values=i}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const aI={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Zx{constructor(e,n,i){const r=this;let s=!1,o=0,a=0,l;const g=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=i,this.itemStart=function(c){a++,s===!1&&r.onStart!==void 0&&r.onStart(c,o,a),s=!0},this.itemEnd=function(c){o++,r.onProgress!==void 0&&r.onProgress(c,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,u){return g.push(c,u),this},this.removeHandler=function(c){const u=g.indexOf(c);return u!==-1&&g.splice(u,2),this},this.getHandler=function(c){for(let u=0,I=g.length;u<I;u+=2){const h=g[u],C=g[u+1];if(h.global&&(h.lastIndex=0),h.test(c))return C}return null}}}const u_=new Zx;class Lr{constructor(e){this.manager=e!==void 0?e:u_,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const i=this;return new Promise(function(r,s){i.load(e,r,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Lr.DEFAULT_MATERIAL_NAME="__DEFAULT";const Wl={};class sae extends Error{constructor(e,n){super(e),this.response=n}}class ns extends Lr{constructor(e){super(e)}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=aI.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(s),this.manager.itemEnd(e)},0),s;if(Wl[e]!==void 0){Wl[e].push({onLoad:n,onProgress:i,onError:r});return}Wl[e]=[],Wl[e].push({onLoad:n,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(g=>{if(g.status===200||g.status===0){if(g.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||g.body===void 0||g.body.getReader===void 0)return g;const c=Wl[e],u=g.body.getReader(),I=g.headers.get("Content-Length")||g.headers.get("X-File-Size"),h=I?parseInt(I):0,C=h!==0;let b=0;const m=new ReadableStream({start(f){p();function p(){u.read().then(({done:v,value:B})=>{if(v)f.close();else{b+=B.byteLength;const G=new ProgressEvent("progress",{lengthComputable:C,loaded:b,total:h});for(let R=0,w=c.length;R<w;R++){const E=c[R];E.onProgress&&E.onProgress(G)}f.enqueue(B),p()}})}}});return new Response(m)}else throw new sae(`fetch for "${g.url}" responded with ${g.status}: ${g.statusText}`,g)}).then(g=>{switch(l){case"arraybuffer":return g.arrayBuffer();case"blob":return g.blob();case"document":return g.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return g.json();default:if(a===void 0)return g.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),I=u&&u[1]?u[1].toLowerCase():void 0,h=new TextDecoder(I);return g.arrayBuffer().then(C=>h.decode(C))}}}).then(g=>{aI.add(e,g);const c=Wl[e];delete Wl[e];for(let u=0,I=c.length;u<I;u++){const h=c[u];h.onLoad&&h.onLoad(g)}}).catch(g=>{const c=Wl[e];if(c===void 0)throw this.manager.itemError(e),g;delete Wl[e];for(let u=0,I=c.length;u<I;u++){const h=c[u];h.onError&&h.onError(g)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class oae extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=this,o=new ns(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{n(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const n=[];for(let i=0;i<e.length;i++){const r=Pf.parse(e[i]);n.push(r)}return n}}class aae extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=this,o=[],a=new fc,l=new ns(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let g=0;function c(u){l.load(e[u],function(I){const h=s.parse(I,!0);o[u]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},g+=1,g===6&&(h.mipmapCount===1&&(a.minFilter=xn),a.image=o,a.format=h.format,a.needsUpdate=!0,n&&n(a))},i,r)}if(Array.isArray(e))for(let u=0,I=e.length;u<I;++u)c(u);else l.load(e,function(u){const I=s.parse(u,!0);if(I.isCubemap){const h=I.mipmaps.length/I.mipmapCount;for(let C=0;C<h;C++){o[C]={mipmaps:[]};for(let b=0;b<I.mipmapCount;b++)o[C].mipmaps.push(I.mipmaps[C*I.mipmapCount+b]),o[C].format=I.format,o[C].width=I.width,o[C].height=I.height}a.image=o}else a.image.width=I.width,a.image.height=I.height,a.mipmaps=I.mipmaps;I.mipmapCount===1&&(a.minFilter=xn),a.format=I.format,a.needsUpdate=!0,n&&n(a)},i,r);return a}}class Of extends Lr{constructor(e){super(e)}load(e,n,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=aI.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a=_f("img");function l(){c(),aI.add(e,this),n&&n(this),s.manager.itemEnd(e)}function g(u){c(),r&&r(u),s.manager.itemError(e),s.manager.itemEnd(e)}function c(){a.removeEventListener("load",l,!1),a.removeEventListener("error",g,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",g,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class lae extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=new G0;s.colorSpace=Hn;const o=new Of(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(g){o.load(e[g],function(c){s.images[g]=c,a++,a===6&&(s.needsUpdate=!0,n&&n(s))},void 0,r)}for(let g=0;g<e.length;++g)l(g);return s}}class gae extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=this,o=new ja,a=new ns(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let g;try{g=s.parse(l)}catch(c){if(r!==void 0)r(c);else{console.error(c);return}}g.image!==void 0?o.image=g.image:g.data!==void 0&&(o.image.width=g.width,o.image.height=g.height,o.image.data=g.data),o.wrapS=g.wrapS!==void 0?g.wrapS:Ci,o.wrapT=g.wrapT!==void 0?g.wrapT:Ci,o.magFilter=g.magFilter!==void 0?g.magFilter:xn,o.minFilter=g.minFilter!==void 0?g.minFilter:xn,o.anisotropy=g.anisotropy!==void 0?g.anisotropy:1,g.colorSpace!==void 0?o.colorSpace=g.colorSpace:g.encoding!==void 0&&(o.encoding=g.encoding),g.flipY!==void 0&&(o.flipY=g.flipY),g.format!==void 0&&(o.format=g.format),g.type!==void 0&&(o.type=g.type),g.mipmaps!==void 0&&(o.mipmaps=g.mipmaps,o.minFilter=rl),g.mipmapCount===1&&(o.minFilter=xn),g.generateMipmaps!==void 0&&(o.generateMipmaps=g.generateMipmaps),o.needsUpdate=!0,n&&n(o,g)},i,r),o}}class cae extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=new ei,o=new Of(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,n!==void 0&&n(s)},i,r),s}}class xc extends cn{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new et(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),n}}class I_ extends xc{constructor(e,n,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(cn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new et(n)}copy(e,n){return super.copy(e,n),this.groundColor.copy(e.groundColor),this}}const rB=new dt,RW=new P,xW=new P;class Ex{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new xe(512,512),this.map=null,this.mapPass=null,this.matrix=new dt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ev,this._frameExtents=new xe(1,1),this._viewportCount=1,this._viewports=[new en(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,i=this.matrix;RW.setFromMatrixPosition(e.matrixWorld),n.position.copy(RW),xW.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(xW),n.updateMatrixWorld(),rB.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rB),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(rB)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class uae extends Ex{constructor(){super(new Zn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,i=vA*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||n.far;(i!==n.fov||r!==n.aspect||s!==n.far)&&(n.fov=i,n.aspect=r,n.far=s,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class d_ extends xc{constructor(e,n,i=0,r=Math.PI/3,s=0,o=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(cn.DEFAULT_UP),this.updateMatrix(),this.target=new cn,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new uae}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const ZW=new dt,Kh=new P,sB=new P;class Iae extends Ex{constructor(){super(new Zn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new xe(4,2),this._viewportCount=6,this._viewports=[new en(2,1,1,1),new en(0,1,1,1),new en(3,1,1,1),new en(1,1,1,1),new en(3,0,1,1),new en(1,0,1,1)],this._cubeDirections=[new P(1,0,0),new P(-1,0,0),new P(0,0,1),new P(0,0,-1),new P(0,1,0),new P(0,-1,0)],this._cubeUps=[new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,0,1),new P(0,0,-1)]}updateMatrices(e,n=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Kh.setFromMatrixPosition(e.matrixWorld),i.position.copy(Kh),sB.copy(i.position),sB.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(sB),i.updateMatrixWorld(),r.makeTranslation(-Kh.x,-Kh.y,-Kh.z),ZW.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ZW)}}class A_ extends xc{constructor(e,n,i=0,r=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Iae}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class dae extends Ex{constructor(){super(new Zo(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class h_ extends xc{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(cn.DEFAULT_UP),this.updateMatrix(),this.target=new cn,this.shadow=new dae}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class C_ extends xc{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class f_ extends xc{constructor(e,n,i=10,r=10){super(e,n),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}class p_{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new P)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return n.copy(o[0]).multiplyScalar(.282095),n.addScaledVector(o[1],.488603*r),n.addScaledVector(o[2],.488603*s),n.addScaledVector(o[3],.488603*i),n.addScaledVector(o[4],1.092548*(i*r)),n.addScaledVector(o[5],1.092548*(r*s)),n.addScaledVector(o[6],.315392*(3*s*s-1)),n.addScaledVector(o[7],1.092548*(i*s)),n.addScaledVector(o[8],.546274*(i*i-r*r)),n}getIrradianceAt(e,n){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return n.copy(o[0]).multiplyScalar(.886227),n.addScaledVector(o[1],2*.511664*r),n.addScaledVector(o[2],2*.511664*s),n.addScaledVector(o[3],2*.511664*i),n.addScaledVector(o[4],2*.429043*i*r),n.addScaledVector(o[5],2*.429043*r*s),n.addScaledVector(o[6],.743125*s*s-.247708),n.addScaledVector(o[7],2*.429043*i*s),n.addScaledVector(o[8],.429043*(i*i-r*r)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,n+r*3);return this}toArray(e=[],n=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,n+r*3);return e}static getBasisAt(e,n){const i=e.x,r=e.y,s=e.z;n[0]=.282095,n[1]=.488603*r,n[2]=.488603*s,n[3]=.488603*i,n[4]=1.092548*i*r,n[5]=1.092548*r*s,n[6]=.315392*(3*s*s-1),n[7]=1.092548*i*s,n[8]=.546274*(i*i-r*r)}}class qv extends xc{constructor(e=new p_,n=1){super(void 0,n),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}class $v extends Lr{constructor(e){super(e),this.textures={}}load(e,n,i,r){const s=this,o=new ns(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{n(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const n=this.textures;function i(s){return n[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),n[s]}const r=$v.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new et().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==1&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=i(o.value);break;case"c":r.uniforms[s].value=new et().setHex(o.value);break;case"v2":r.uniforms[s].value=new xe().fromArray(o.value);break;case"v3":r.uniforms[s].value=new P().fromArray(o.value);break;case"v4":r.uniforms[s].value=new en().fromArray(o.value);break;case"m3":r.uniforms[s].value=new Pt().fromArray(o.value);break;case"m4":r.uniforms[s].value=new dt().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new xe().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new xe().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const n={ShadowMaterial:e_,SpriteMaterial:dx,RawShaderMaterial:kC,ShaderMaterial:an,PointsMaterial:Cx,MeshPhysicalMaterial:t_,MeshStandardMaterial:Gx,MeshPhongMaterial:n_,MeshToonMaterial:i_,MeshNormalMaterial:Z0,MeshLambertMaterial:r_,MeshDepthMaterial:S0,MeshDistanceMaterial:Nv,MeshBasicMaterial:to,MeshMatcapMaterial:s_,LineDashedMaterial:o_,LineBasicMaterial:os,Material:br};return new n[e]}}class oS{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let i=0,r=e.length;i<r;i++)n+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class Wx extends Lt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class m_ extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=this,o=new ns(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{n(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const n={},i={};function r(h,C){if(n[C]!==void 0)return n[C];const m=h.interleavedBuffers[C],f=s(h,m.buffer),p=Ld(m.type,f),v=new Fv(p,m.stride);return v.uuid=m.uuid,n[C]=v,v}function s(h,C){if(i[C]!==void 0)return i[C];const m=h.arrayBuffers[C],f=new Uint32Array(m).buffer;return i[C]=f,f}const o=e.isInstancedBufferGeometry?new Wx:new Lt,a=e.data.index;if(a!==void 0){const h=Ld(a.type,a.array);o.setIndex(new Wn(h,1))}const l=e.data.attributes;for(const h in l){const C=l[h];let b;if(C.isInterleavedBufferAttribute){const m=r(e.data,C.data);b=new rI(m,C.itemSize,C.offset,C.normalized)}else{const m=Ld(C.type,C.array),f=C.isInstancedBufferAttribute?sI:Wn;b=new f(m,C.itemSize,C.normalized)}C.name!==void 0&&(b.name=C.name),C.usage!==void 0&&b.setUsage(C.usage),C.updateRange!==void 0&&(b.updateRange.offset=C.updateRange.offset,b.updateRange.count=C.updateRange.count),o.setAttribute(h,b)}const g=e.data.morphAttributes;if(g)for(const h in g){const C=g[h],b=[];for(let m=0,f=C.length;m<f;m++){const p=C[m];let v;if(p.isInterleavedBufferAttribute){const B=r(e.data,p.data);v=new rI(B,p.itemSize,p.offset,p.normalized)}else{const B=Ld(p.type,p.array);v=new Wn(B,p.itemSize,p.normalized)}p.name!==void 0&&(v.name=p.name),b.push(v)}o.morphAttributes[h]=b}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let h=0,C=u.length;h!==C;++h){const b=u[h];o.addGroup(b.start,b.count,b.materialIndex)}const I=e.data.boundingSphere;if(I!==void 0){const h=new P;I.center!==void 0&&h.fromArray(I.center),o.boundingSphere=new Ho(h,I.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class Aae extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=this,o=this.path===""?oS.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new ns(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let g=null;try{g=JSON.parse(l)}catch(u){r!==void 0&&r(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const c=g.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(g,n)},i,r)}async loadAsync(e,n){const i=this,r=this.path===""?oS.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new ns(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,n),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,n){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){n!==void 0&&n(g)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),g=this.parseObject(e.object,s,l,a,i),c=this.parseSkeletons(e.skeletons,g);if(this.bindSkeletons(g,c),n!==void 0){let u=!1;for(const I in o)if(o[I].data instanceof HTMLImageElement){u=!0;break}u===!1&&n(g)}return g}async parseAsync(e){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,n),g=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,g),l}parseShapes(e){const n={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const s=new Ku().fromJSON(e[i]);n[s.uuid]=s}return n}parseSkeletons(e,n){const i={},r={};if(n.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new Vv().fromJSON(e[s],r);i[a.uuid]=a}return i}parseGeometries(e,n){const i={};if(e!==void 0){const r=new m_;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in wW?a=wW[l.type].fromJSON(l,n):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,n){const i={},r={};if(e!==void 0){const s=new $v;s.setTextures(n);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=s.parse(l)),r[l.uuid]=i[l.uuid]}}return r}parseAnimations(e){const n={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],s=Pf.parse(r);n[s.uuid]=s}return n}parseImages(e,n){const i=this,r={};let s;function o(l){return i.manager.itemStart(l),s.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const g=l,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:i.resourcePath+g;return o(c)}else return l.data?{data:Ld(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new Zx(n);s=new Of(l),s.setCrossOrigin(this.crossOrigin);for(let g=0,c=e.length;g<c;g++){const u=e[g],I=u.url;if(Array.isArray(I)){const h=[];for(let C=0,b=I.length;C<b;C++){const m=I[C],f=a(m);f!==null&&(f instanceof HTMLImageElement?h.push(f):h.push(new ja(f.data,f.width,f.height)))}r[u.uuid]=new Mu(h)}else{const h=a(u.url);r[u.uuid]=new Mu(h)}}}return r}async parseImagesAsync(e){const n=this,i={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:n.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:Ld(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new Of(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],g=l.url;if(Array.isArray(g)){const c=[];for(let u=0,I=g.length;u<I;u++){const h=g[u],C=await s(h);C!==null&&(C instanceof HTMLImageElement?c.push(C):c.push(new ja(C.data,C.width,C.height)))}i[l.uuid]=new Mu(c)}else{const c=await s(l.url);i[l.uuid]=new Mu(c)}}}return i}parseTextures(e,n){function i(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),n[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=n[a.image],g=l.data;let c;Array.isArray(g)?(c=new G0,g.length===6&&(c.needsUpdate=!0)):(g&&g.data?c=new ja:c=new ei,g&&(c.needsUpdate=!0)),c.source=l,c.uuid=a.uuid,a.name!==void 0&&(c.name=a.name),a.mapping!==void 0&&(c.mapping=i(a.mapping,hae)),a.channel!==void 0&&(c.channel=a.channel),a.offset!==void 0&&c.offset.fromArray(a.offset),a.repeat!==void 0&&c.repeat.fromArray(a.repeat),a.center!==void 0&&c.center.fromArray(a.center),a.rotation!==void 0&&(c.rotation=a.rotation),a.wrap!==void 0&&(c.wrapS=i(a.wrap[0],EW),c.wrapT=i(a.wrap[1],EW)),a.format!==void 0&&(c.format=a.format),a.internalFormat!==void 0&&(c.internalFormat=a.internalFormat),a.type!==void 0&&(c.type=a.type),a.colorSpace!==void 0&&(c.colorSpace=a.colorSpace),a.encoding!==void 0&&(c.encoding=a.encoding),a.minFilter!==void 0&&(c.minFilter=i(a.minFilter,WW)),a.magFilter!==void 0&&(c.magFilter=i(a.magFilter,WW)),a.anisotropy!==void 0&&(c.anisotropy=a.anisotropy),a.flipY!==void 0&&(c.flipY=a.flipY),a.generateMipmaps!==void 0&&(c.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(c.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(c.compareFunction=a.compareFunction),a.userData!==void 0&&(c.userData=a.userData),r[a.uuid]=c}return r}parseObject(e,n,i,r,s){let o;function a(I){return n[I]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",I),n[I]}function l(I){if(I!==void 0){if(Array.isArray(I)){const h=[];for(let C=0,b=I.length;C<b;C++){const m=I[C];i[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),h.push(i[m])}return h}return i[I]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",I),i[I]}}function g(I){return r[I]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",I),r[I]}let c,u;switch(e.type){case"Scene":o=new pb,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new et(e.background):o.background=g(e.background)),e.environment!==void 0&&(o.environment=g(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new Tv(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Mv(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new Zn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Zo(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new C_(e.color,e.intensity);break;case"DirectionalLight":o=new h_(e.color,e.intensity);break;case"PointLight":o=new A_(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new f_(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new d_(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new I_(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new qv().fromJSON(e);break;case"SkinnedMesh":c=a(e.geometry),u=l(e.material),o=new YH(c,u),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":c=a(e.geometry),u=l(e.material),o=new pn(c,u);break;case"InstancedMesh":c=a(e.geometry),u=l(e.material);const I=e.count,h=e.instanceMatrix,C=e.instanceColor;o=new hx(c,u,I),o.instanceMatrix=new sI(new Float32Array(h.array),16),C!==void 0&&(o.instanceColor=new sI(new Float32Array(C.array),C.itemSize));break;case"LOD":o=new XH;break;case"Line":o=new Cc(a(e.geometry),l(e.material));break;case"LineLoop":o=new KH(a(e.geometry),l(e.material));break;case"LineSegments":o=new ol(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new fx(a(e.geometry),l(e.material));break;case"Sprite":o=new _H(l(e.material));break;case"Group":o=new Hd;break;case"Bone":o=new Ax;break;default:o=new cn}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const I=e.children;for(let h=0;h<I.length;h++)o.add(this.parseObject(I[h],n,i,r,s))}if(e.animations!==void 0){const I=e.animations;for(let h=0;h<I.length;h++){const C=I[h];o.animations.push(s[C])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const I=e.levels;for(let h=0;h<I.length;h++){const C=I[h],b=o.getObjectByProperty("uuid",C.object);b!==void 0&&o.addLevel(b,C.distance,C.hysteresis)}}return o}bindSkeletons(e,n){Object.keys(n).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=n[i.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}}const hae={UVMapping:Gv,CubeReflectionMapping:tg,CubeRefractionMapping:Ac,EquirectangularReflectionMapping:Rf,EquirectangularRefractionMapping:xf,CubeUVReflectionMapping:XA},EW={RepeatWrapping:ng,ClampToEdgeWrapping:Ci,MirroredRepeatWrapping:Zf},WW={NearestFilter:Vt,NearestMipmapNearestFilter:hb,NearestMipmapLinearFilter:MC,LinearFilter:xn,LinearMipmapNearestFilter:jR,LinearMipmapLinearFilter:rl};class Cae extends Lr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=aI.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){aI.add(e,l),n&&n(l),s.manager.itemEnd(e)}).catch(function(l){r&&r(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}let Om;class Nx{static getContext(){return Om===void 0&&(Om=new(window.AudioContext||window.webkitAudioContext)),Om}static setContext(e){Om=e}}class fae extends Lr{constructor(e){super(e)}load(e,n,i,r){const s=this,o=new ns(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const g=l.slice(0);Nx.getContext().decodeAudioData(g,function(u){n(u)},a)}catch(g){a(g)}},i,r);function a(l){r?r(l):console.error(l),s.manager.itemError(e)}}}class pae extends qv{constructor(e,n,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const r=new et().set(e),s=new et().set(n),o=new P(r.r,r.g,r.b),a=new P(s.r,s.g,s.b),l=Math.sqrt(Math.PI),g=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(g)}}class mae extends qv{constructor(e,n=1){super(void 0,n),this.isAmbientLightProbe=!0;const i=new et().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const NW=new dt,MW=new dt,eu=new dt;class bae{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Zn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Zn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const n=this._cache;if(n.focus!==e.focus||n.fov!==e.fov||n.aspect!==e.aspect*this.aspect||n.near!==e.near||n.far!==e.far||n.zoom!==e.zoom||n.eyeSep!==this.eyeSep){n.focus=e.focus,n.fov=e.fov,n.aspect=e.aspect*this.aspect,n.near=e.near,n.far=e.far,n.zoom=e.zoom,n.eyeSep=this.eyeSep,eu.copy(e.projectionMatrix);const r=n.eyeSep/2,s=r*n.near/n.focus,o=n.near*Math.tan(Xu*n.fov*.5)/n.zoom;let a,l;MW.elements[12]=-r,NW.elements[12]=r,a=-o*n.aspect+s,l=o*n.aspect+s,eu.elements[0]=2*n.near/(l-a),eu.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(eu),a=-o*n.aspect-s,l=o*n.aspect-s,eu.elements[0]=2*n.near/(l-a),eu.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(eu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(MW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(NW)}}class ey{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=TW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=TW();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}function TW(){return(typeof performance>"u"?Date:performance).now()}const tu=new P,FW=new gr,vae=new P,nu=new P;class yae extends cn{constructor(){super(),this.type="AudioListener",this.context=Nx.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ey}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const n=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(tu,FW,vae),nu.set(0,0,-1).applyQuaternion(FW),n.positionX){const r=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(tu.x,r),n.positionY.linearRampToValueAtTime(tu.y,r),n.positionZ.linearRampToValueAtTime(tu.z,r),n.forwardX.linearRampToValueAtTime(nu.x,r),n.forwardY.linearRampToValueAtTime(nu.y,r),n.forwardZ.linearRampToValueAtTime(nu.z,r),n.upX.linearRampToValueAtTime(i.x,r),n.upY.linearRampToValueAtTime(i.y,r),n.upZ.linearRampToValueAtTime(i.z,r)}else n.setPosition(tu.x,tu.y,tu.z),n.setOrientation(nu.x,nu.y,nu.z,i.x,i.y,i.z)}}class b_ extends cn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const iu=new P,VW=new gr,Bae=new P,ru=new P;class Gae extends b_{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,n,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(iu,VW,Bae),ru.set(0,0,1).applyQuaternion(VW);const n=this.panner;if(n.positionX){const i=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(iu.x,i),n.positionY.linearRampToValueAtTime(iu.y,i),n.positionZ.linearRampToValueAtTime(iu.z,i),n.orientationX.linearRampToValueAtTime(ru.x,i),n.orientationY.linearRampToValueAtTime(ru.y,i),n.orientationZ.linearRampToValueAtTime(ru.z,i)}else n.setPosition(iu.x,iu.y,iu.z),n.setOrientation(ru.x,ru.y,ru.z)}}class Sae{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const n=this.getFrequencyData();for(let i=0;i<n.length;i++)e+=n[i];return e/n.length}}class v_{constructor(e,n,i){this.binding=e,this.valueSize=i;let r,s,o;switch(n){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const i=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)i[s+a]=i[a];o=n}else{o+=n;const a=n/o;this._mixBufferRegion(i,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const n=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,i=this.buffer,r=e*n+n,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=n*this._origIndex;this._mixBufferRegion(i,r,l,1-s,n)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*n,1,n);for(let l=n,g=n+n;l!==g;++l)if(i[l]!==i[l+n]){a.setValue(i,r);break}}saveOriginalState(){const e=this.binding,n=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(n,r);for(let s=i,o=r;s!==o;++s)n[s]=n[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let i=e;i<n;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[n+i]=this.buffer[e+i]}_select(e,n,i,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[n+o]=e[i+o]}_slerp(e,n,i,r){gr.slerpFlat(e,n,e,n,e,i,r)}_slerpAdditive(e,n,i,r,s){const o=this._workIndex*s;gr.multiplyQuaternionsFlat(e,o,e,n,e,i),gr.slerpFlat(e,n,e,n,e,o,r)}_lerp(e,n,i,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=n+a;e[l]=e[l]*o+e[i+a]*r}}_lerpAdditive(e,n,i,r,s){for(let o=0;o!==s;++o){const a=n+o;e[a]=e[a]+e[i+o]*r}}}const Mx="\\[\\]\\.:\\/",wae=new RegExp("["+Mx+"]","g"),Tx="[^"+Mx+"]",Rae="[^"+Mx.replace("\\.","")+"]",xae=/((?:WC+[\/:])*)/.source.replace("WC",Tx),Zae=/(WCOD+)?/.source.replace("WCOD",Rae),Eae=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Tx),Wae=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Tx),Nae=new RegExp("^"+xae+Zae+Eae+Wae+"$"),Mae=["material","materials","bones","map"];class Tae{constructor(e,n,i){const r=i||ln.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,r)}getValue(e,n){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,n)}setValue(e,n){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].unbind()}}class ln{constructor(e,n,i){this.path=n,this.parsedPath=i||ln.parseTrackName(n),this.node=ln.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,i){return e&&e.isAnimationObjectGroup?new ln.Composite(e,n,i):new ln(e,n,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(wae,"")}static parseTrackName(e){const n=Nae.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);Mae.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(n);if(i!==void 0)return i}if(e.children){const i=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===n||a.uuid===n)return a;const l=i(a.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[n++]=i[r]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,i=n.objectName,r=n.propertyName;let s=n.propertyIndex;if(e||(e=ln.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let g=n.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===g){g=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(g!==void 0){if(e[g]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[g]}}const o=e[r];if(o===void 0){const g=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+g+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ln.Composite=Tae;ln.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ln.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ln.prototype.GetterByBindingType=[ln.prototype._getValue_direct,ln.prototype._getValue_array,ln.prototype._getValue_arrayElement,ln.prototype._getValue_toArray];ln.prototype.SetterByBindingTypeAndVersioning=[[ln.prototype._setValue_direct,ln.prototype._setValue_direct_setNeedsUpdate,ln.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ln.prototype._setValue_array,ln.prototype._setValue_array_setNeedsUpdate,ln.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ln.prototype._setValue_arrayElement,ln.prototype._setValue_arrayElement_setNeedsUpdate,ln.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ln.prototype._setValue_fromArray,ln.prototype._setValue_fromArray_setNeedsUpdate,ln.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Fae{constructor(){this.isAnimationObjectGroup=!0,this.uuid=$s(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){const e=this._objects,n=this._indicesByUUID,i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,g=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const I=arguments[c],h=I.uuid;let C=n[h];if(C===void 0){C=l++,n[h]=C,e.push(I);for(let b=0,m=o;b!==m;++b)s[b].push(new ln(I,i[b],r[b]))}else if(C<g){a=e[C];const b=--g,m=e[b];n[m.uuid]=C,e[C]=m,n[h]=b,e[b]=I;for(let f=0,p=o;f!==p;++f){const v=s[f],B=v[b];let G=v[C];v[C]=B,G===void 0&&(G=new ln(I,i[f],r[f])),v[b]=G}}else e[C]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=g}remove(){const e=this._objects,n=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],g=l.uuid,c=n[g];if(c!==void 0&&c>=s){const u=s++,I=e[u];n[I.uuid]=c,e[c]=I,n[g]=u,e[u]=l;for(let h=0,C=r;h!==C;++h){const b=i[h],m=b[u],f=b[c];b[c]=m,b[u]=f}}}this.nCachedObjects_=s}uncache(){const e=this._objects,n=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const g=arguments[a],c=g.uuid,u=n[c];if(u!==void 0)if(delete n[c],u<s){const I=--s,h=e[I],C=--o,b=e[C];n[h.uuid]=u,e[u]=h,n[b.uuid]=I,e[I]=b,e.pop();for(let m=0,f=r;m!==f;++m){const p=i[m],v=p[I],B=p[C];p[u]=v,p[I]=B,p.pop()}}else{const I=--o,h=e[I];I>0&&(n[h.uuid]=u),e[u]=h,e.pop();for(let C=0,b=r;C!==b;++C){const m=i[C];m[u]=m[I],m.pop()}}}this.nCachedObjects_=s}subscribe_(e,n){const i=this._bindingsIndicesByPath;let r=i[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,g=l.length,c=this.nCachedObjects_,u=new Array(g);r=s.length,i[e]=r,o.push(e),a.push(n),s.push(u);for(let I=c,h=l.length;I!==h;++I){const C=l[I];u[I]=new ln(C,e,n)}return u}unsubscribe_(e){const n=this._bindingsIndicesByPath,i=n[e];if(i!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],g=e[a];n[g]=i,o[i]=l,o.pop(),s[i]=s[a],s.pop(),r[i]=r[a],r.pop()}}}class y_{constructor(e,n,i=null,r=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=i,this.blendMode=r;const s=n.tracks,o=s.length,a=new Array(o),l={endingStart:Wu,endingEnd:Wu};for(let g=0;g!==o;++g){const c=s[g].createInterpolant(null);a[g]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=cH,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,i){if(e.fadeOut(n),this.fadeIn(n),i){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,n),this.warp(a,1,n)}return this}crossFadeTo(e,n,i){return e.crossFadeFrom(this,n,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,i){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,g=a.sampleValues;return l[0]=s,l[1]=s+i,g[0]=e/o,g[1]=n/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?n=0:(this._startTime=null,n=i*l)}n*=this._updateTimeScale(e);const o=this._updateTime(n),a=this._updateWeight(e);if(a>0){const l=this._interpolants,g=this._propertyBindings;switch(this.blendMode){case sx:for(let c=0,u=l.length;c!==u;++c)l[c].evaluate(o),g[c].accumulateAdditive(a);break;case wv:default:for(let c=0,u=l.length;c!==u;++c)l[c].evaluate(o),g[c].accumulate(r,a)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===uH;if(e===0)return s===-1?r:o&&(s&1)===1?n-r:r;if(i===gH){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=n)r=n;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=n||r<0){const a=Math.floor(r/n);r-=n*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?n:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const g=e<0;this._setEndings(g,!g,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return n-r}return r}_setEndings(e,n,i){const r=this._interpolantSettings;i?(r.endingStart=Nu,r.endingEnd=Nu):(e?r.endingStart=this.zeroSlopeAtStart?Nu:Wu:r.endingStart=Lf,n?r.endingEnd=this.zeroSlopeAtEnd?Nu:Wu:r.endingEnd=Lf)}_scheduleFading(e,n,i){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=n,a[1]=s+e,l[1]=i,this}}const Vae=new Float32Array(1);class Lae extends sl{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,g=this._bindingsByRootAndName;let c=g[l];c===void 0&&(c={},g[l]=c);for(let u=0;u!==s;++u){const I=r[u],h=I.name;let C=c[h];if(C!==void 0)++C.referenceCount,o[u]=C;else{if(C=o[u],C!==void 0){C._cacheIndex===null&&(++C.referenceCount,this._addInactiveBinding(C,l,h));continue}const b=n&&n._propertyBindings[u].binding.parsedPath;C=new v_(ln.create(i,h,b),I.ValueTypeName,I.getValueSize()),++C.referenceCount,this._addInactiveBinding(C,l,h),o[u]=C}a[u].resultBuffer=C.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,i){const r=this._actions,s=this._actionsByClip;let o=s[n];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[n]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const n=this._actions,i=n[n.length-1],r=e._cacheIndex;i._cacheIndex=r,n[r]=i,n.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,g=l[l.length-1],c=e._byClipCacheIndex;g._byClipCacheIndex=c,l[c]=g,l.pop(),e._byClipCacheIndex=null;const u=a.actionByRoot,I=(e._localRoot||this._root).uuid;delete u[I],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const n=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_takeBackAction(e){const n=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_addInactiveBinding(e,n,i){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[n];o===void 0&&(o={},r[n]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const n=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,a=o[r],l=n[n.length-1],g=e._cacheIndex;l._cacheIndex=g,n[g]=l,n.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const n=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_takeBackBinding(e){const n=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let i=e[n];return i===void 0&&(i=new Rx(new Float32Array(2),new Float32Array(2),1,Vae),i.__cacheIndex=n,e[n]=i),i}_takeBackControlInterpolant(e){const n=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=n[r];e.__cacheIndex=r,n[r]=e,s.__cacheIndex=i,n[i]=s}clipAction(e,n,i){const r=n||this._root,s=r.uuid;let o=typeof e=="string"?Pf.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let g=null;if(i===void 0&&(o!==null?i=o.blendMode:i=wv),l!==void 0){const u=l.actionByRoot[s];if(u!==void 0&&u.blendMode===i)return u;g=l.knownActions[0],o===null&&(o=g._clip)}if(o===null)return null;const c=new y_(this,o,n,i);return this._bindAction(c,g),this._addInactiveAction(c,a,s),c}existingAction(e,n){const i=n||this._root,r=i.uuid,s=typeof e=="string"?Pf.findByName(i,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let i=n-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const n=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let g=0;g!==i;++g)n[g]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let g=0;g!==l;++g)a[g].apply(o);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const g=o[a];this._deactivateAction(g);const c=g._cacheIndex,u=n[n.length-1];g._cacheIndex=null,g._byClipCacheIndex=null,u._cacheIndex=c,n[c]=u,n.pop(),this._removeInactiveBindingsForAction(g)}delete r[i]}}uncacheRoot(e){const n=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[n];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[n];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,n){const i=this.existingAction(e,n);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Fx{constructor(e){this.value=e}clone(){return new Fx(this.value.clone===void 0?this.value:this.value.clone())}}let kae=0;class Hae extends sl{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:kae++}),this.name="",this.usage=kf,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const n=this.uniforms.indexOf(e);return n!==-1&&this.uniforms.splice(n,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const n=e.uniforms;this.uniforms.length=0;for(let i=0,r=n.length;i<r;i++)this.uniforms.push(n[i].clone());return this}clone(){return new this.constructor().copy(this)}}class _ae extends Fv{constructor(e,n,i=1){super(e,n),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){const n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}class Xae{constructor(e,n,i,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=n,this.itemSize=i,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class B_{constructor(e,n,i=0,r=1/0){this.ray=new bI(e,n),this.near=i,this.far=r,this.camera=null,this.layers=new Yu,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}intersectObject(e,n=!0,i=[]){return aS(e,this,i,n),i.sort(LW),i}intersectObjects(e,n=!0,i=[]){for(let r=0,s=e.length;r<s;r++)aS(e[r],this,i,n);return i.sort(LW),i}}function LW(t,e){return t.distance-e.distance}function aS(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),i===!0){const r=t.children;for(let s=0,o=r.length;s<o;s++)aS(r[s],e,n,!0)}}class lS{constructor(e=1,n=0,i=0){return this.radius=e,this.phi=n,this.theta=i,this}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+n*n+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ai(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Yae{constructor(e=1,n=0,i=0){return this.radius=e,this.theta=n,this.y=i,this}set(e,n,i){return this.radius=e,this.theta=n,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=n,this}clone(){return new this.constructor().copy(this)}}const kW=new xe;class G_{constructor(e=new xe(1/0,1/0),n=new xe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=kW.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,kW).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const HW=new P,Qm=new P;class Kae{constructor(e=new P,n=new P){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){HW.subVectors(e,this.start),Qm.subVectors(this.end,this.start);const i=Qm.dot(Qm);let s=Qm.dot(HW)/i;return n&&(s=Ai(s,0,1)),s}closestPointToPoint(e,n,i){const r=this.closestPointToPointParameter(e,n);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _W=new P;class zae extends cn{constructor(e,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="SpotLightHelper";const i=new Lt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const g=o/l*Math.PI*2,c=a/l*Math.PI*2;r.push(Math.cos(g),Math.sin(g),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new ut(r,3));const s=new os({fog:!1,toneMapped:!1});this.cone=new ol(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),_W.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_W),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Eg=new P,Jm=new dt,oB=new dt;class Uae extends ol{constructor(e){const n=S_(e),i=new Lt,r=[],s=[],o=new et(0,0,1),a=new et(0,1,0);for(let g=0;g<n.length;g++){const c=n[g];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}i.setAttribute("position",new ut(r,3)),i.setAttribute("color",new ut(s,3));const l=new os({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const n=this.bones,i=this.geometry,r=i.getAttribute("position");oB.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<n.length;s++){const a=n[s];a.parent&&a.parent.isBone&&(Jm.multiplyMatrices(oB,a.matrixWorld),Eg.setFromMatrixPosition(Jm),r.setXYZ(o,Eg.x,Eg.y,Eg.z),Jm.multiplyMatrices(oB,a.parent.matrixWorld),Eg.setFromMatrixPosition(Jm),r.setXYZ(o+1,Eg.x,Eg.y,Eg.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function S_(t){const e=[];t.isBone===!0&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,S_(t.children[n]));return e}class Dae extends pn{constructor(e,n,i){const r=new x0(n,4,2),s=new to({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Pae=new P,XW=new et,YW=new et;class Oae extends cn{constructor(e,n,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new R0(n);r.rotateY(Math.PI*.5),this.material=new to({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new Wn(o,3)),this.add(new pn(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");XW.copy(this.light.color),YW.copy(this.light.groundColor);for(let i=0,r=n.count;i<r;i++){const s=i<r/2?XW:YW;n.setXYZ(i,s.r,s.g,s.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Pae.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Qae extends ol{constructor(e=10,n=10,i=4473924,r=8947848){i=new et(i),r=new et(r);const s=n/2,o=e/n,a=e/2,l=[],g=[];for(let I=0,h=0,C=-a;I<=n;I++,C+=o){l.push(-a,0,C,a,0,C),l.push(C,0,-a,C,0,a);const b=I===s?i:r;b.toArray(g,h),h+=3,b.toArray(g,h),h+=3,b.toArray(g,h),h+=3,b.toArray(g,h),h+=3}const c=new Lt;c.setAttribute("position",new ut(l,3)),c.setAttribute("color",new ut(g,3));const u=new os({vertexColors:!0,toneMapped:!1});super(c,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Jae extends ol{constructor(e=10,n=16,i=8,r=64,s=4473924,o=8947848){s=new et(s),o=new et(o);const a=[],l=[];if(n>1)for(let u=0;u<n;u++){const I=u/n*(Math.PI*2),h=Math.sin(I)*e,C=Math.cos(I)*e;a.push(0,0,0),a.push(h,0,C);const b=u&1?s:o;l.push(b.r,b.g,b.b),l.push(b.r,b.g,b.b)}for(let u=0;u<i;u++){const I=u&1?s:o,h=e-e/i*u;for(let C=0;C<r;C++){let b=C/r*(Math.PI*2),m=Math.sin(b)*h,f=Math.cos(b)*h;a.push(m,0,f),l.push(I.r,I.g,I.b),b=(C+1)/r*(Math.PI*2),m=Math.sin(b)*h,f=Math.cos(b)*h,a.push(m,0,f),l.push(I.r,I.g,I.b)}}const g=new Lt;g.setAttribute("position",new ut(a,3)),g.setAttribute("color",new ut(l,3));const c=new os({vertexColors:!0,toneMapped:!1});super(g,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const KW=new P,jm=new P,zW=new P;class jae extends cn{constructor(e,n,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",n===void 0&&(n=1);let r=new Lt;r.setAttribute("position",new ut([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const s=new os({fog:!1,toneMapped:!1});this.lightPlane=new Cc(r,s),this.add(this.lightPlane),r=new Lt,r.setAttribute("position",new ut([0,0,0,0,0,1],3)),this.targetLine=new Cc(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),KW.setFromMatrixPosition(this.light.matrixWorld),jm.setFromMatrixPosition(this.light.target.matrixWorld),zW.subVectors(jm,KW),this.lightPlane.lookAt(jm),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(jm),this.targetLine.scale.z=zW.length()}}const qm=new P,Ii=new B0;class qae extends ol{constructor(e){const n=new Lt,i=new os({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(C,b){l(C),l(b)}function l(C){r.push(0,0,0),s.push(0,0,0),o[C]===void 0&&(o[C]=[]),o[C].push(r.length/3-1)}n.setAttribute("position",new ut(r,3)),n.setAttribute("color",new ut(s,3)),super(n,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const g=new et(16755200),c=new et(16711680),u=new et(43775),I=new et(16777215),h=new et(3355443);this.setColors(g,c,u,I,h)}setColors(e,n,i,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,n.r,n.g,n.b),a.setXYZ(25,n.r,n.g,n.b),a.setXYZ(26,n.r,n.g,n.b),a.setXYZ(27,n.r,n.g,n.b),a.setXYZ(28,n.r,n.g,n.b),a.setXYZ(29,n.r,n.g,n.b),a.setXYZ(30,n.r,n.g,n.b),a.setXYZ(31,n.r,n.g,n.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,n=this.pointMap,i=1,r=1;Ii.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Si("c",n,e,Ii,0,0,-1),Si("t",n,e,Ii,0,0,1),Si("n1",n,e,Ii,-i,-r,-1),Si("n2",n,e,Ii,i,-r,-1),Si("n3",n,e,Ii,-i,r,-1),Si("n4",n,e,Ii,i,r,-1),Si("f1",n,e,Ii,-i,-r,1),Si("f2",n,e,Ii,i,-r,1),Si("f3",n,e,Ii,-i,r,1),Si("f4",n,e,Ii,i,r,1),Si("u1",n,e,Ii,i*.7,r*1.1,-1),Si("u2",n,e,Ii,-i*.7,r*1.1,-1),Si("u3",n,e,Ii,0,r*2,-1),Si("cf1",n,e,Ii,-i,0,1),Si("cf2",n,e,Ii,i,0,1),Si("cf3",n,e,Ii,0,-r,1),Si("cf4",n,e,Ii,0,r,1),Si("cn1",n,e,Ii,-i,0,-1),Si("cn2",n,e,Ii,i,0,-1),Si("cn3",n,e,Ii,0,-r,-1),Si("cn4",n,e,Ii,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Si(t,e,n,i,r,s,o){qm.set(r,s,o).unproject(i);const a=e[t];if(a!==void 0){const l=n.getAttribute("position");for(let g=0,c=a.length;g<c;g++)l.setXYZ(a[g],qm.x,qm.y,qm.z)}}const $m=new va;class $ae extends ol{constructor(e,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new Lt;s.setIndex(new Wn(i,1)),s.setAttribute("position",new Wn(r,3)),super(s,new os({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&$m.setFromObject(this.object),$m.isEmpty())return;const n=$m.min,i=$m.max,r=this.geometry.attributes.position,s=r.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=n.x,s[4]=i.y,s[5]=i.z,s[6]=n.x,s[7]=n.y,s[8]=i.z,s[9]=i.x,s[10]=n.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=n.z,s[15]=n.x,s[16]=i.y,s[17]=n.z,s[18]=n.x,s[19]=n.y,s[20]=n.z,s[21]=i.x,s[22]=n.y,s[23]=n.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,n){return super.copy(e,n),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ele extends ol{constructor(e,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Lt;s.setIndex(new Wn(i,1)),s.setAttribute("position",new ut(r,3)),super(s,new os({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class tle extends Cc{constructor(e,n=1,i=16776960){const r=i,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Lt;o.setAttribute("position",new ut(s,3)),o.computeBoundingSphere(),super(o,new os({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Lt;l.setAttribute("position",new ut(a,3)),l.computeBoundingSphere(),this.add(new pn(l,new to({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const UW=new P;let e2,aB;class nle extends cn{constructor(e=new P(0,0,1),n=new P(0,0,0),i=1,r=16776960,s=i*.2,o=s*.2){super(),this.type="ArrowHelper",e2===void 0&&(e2=new Lt,e2.setAttribute("position",new ut([0,0,0,0,1,0],3)),aB=new UA(0,.5,1,5,1),aB.translate(0,-.5,0)),this.position.copy(n),this.line=new Cc(e2,new os({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new pn(aB,new to({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{UW.set(e.z,0,-e.x).normalize();const n=Math.acos(e.y);this.quaternion.setFromAxisAngle(UW,n)}}setLength(e,n=e*.2,i=n*.2){this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(i,n,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class ile extends ol{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Lt;r.setAttribute("position",new ut(n,3)),r.setAttribute("color",new ut(i,3));const s=new os({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,n,i){const r=new et,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(n),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class w_{constructor(){this.type="ShapePath",this.color=new et,this.subPaths=[],this.currentPath=null}moveTo(e,n){return this.currentPath=new Xf,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,n),this}lineTo(e,n){return this.currentPath.lineTo(e,n),this}quadraticCurveTo(e,n,i,r){return this.currentPath.quadraticCurveTo(e,n,i,r),this}bezierCurveTo(e,n,i,r,s,o){return this.currentPath.bezierCurveTo(e,n,i,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function n(f){const p=[];for(let v=0,B=f.length;v<B;v++){const G=f[v],R=new Ku;R.curves=G.curves,p.push(R)}return p}function i(f,p){const v=p.length;let B=!1;for(let G=v-1,R=0;R<v;G=R++){let w=p[G],E=p[R],x=E.x-w.x,W=E.y-w.y;if(Math.abs(W)>Number.EPSILON){if(W<0&&(w=p[R],x=-x,E=p[G],W=-W),f.y<w.y||f.y>E.y)continue;if(f.y===w.y){if(f.x===w.x)return!0}else{const T=W*(f.x-w.x)-x*(f.y-w.y);if(T===0)return!0;if(T<0)continue;B=!B}}else{if(f.y!==w.y)continue;if(E.x<=f.x&&f.x<=w.x||w.x<=f.x&&f.x<=E.x)return!0}}return B}const r=qa.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const g=[];if(s.length===1)return a=s[0],l=new Ku,l.curves=a.curves,g.push(l),g;let c=!r(s[0].getPoints());c=e?!c:c;const u=[],I=[];let h=[],C=0,b;I[C]=void 0,h[C]=[];for(let f=0,p=s.length;f<p;f++)a=s[f],b=a.getPoints(),o=r(b),o=e?!o:o,o?(!c&&I[C]&&C++,I[C]={s:new Ku,p:b},I[C].s.curves=a.curves,c&&C++,h[C]=[]):h[C].push({h:a,p:b[0]});if(!I[0])return n(s);if(I.length>1){let f=!1,p=0;for(let v=0,B=I.length;v<B;v++)u[v]=[];for(let v=0,B=I.length;v<B;v++){const G=h[v];for(let R=0;R<G.length;R++){const w=G[R];let E=!0;for(let x=0;x<I.length;x++)i(w.p,I[x].p)&&(v!==x&&p++,E?(E=!1,u[x].push(w)):f=!0);E&&u[v].push(w)}}p>0&&f===!1&&(h=u)}let m;for(let f=0,p=I.length;f<p;f++){l=I[f].s,g.push(l),m=h[f];for(let v=0,B=m.length;v<B;v++)l.holes.push(m[v].h)}return g}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:gg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=gg);const rle=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:JR,AddEquation:Os,AddOperation:$k,AdditiveAnimationBlendMode:sx,AdditiveBlending:Bf,AlphaFormat:oH,AlwaysCompare:yH,AlwaysDepth:Dk,AlwaysStencilFunc:AH,AmbientLight:C_,AmbientLightProbe:mae,AnimationAction:y_,AnimationClip:Pf,AnimationLoader:oae,AnimationMixer:Lae,AnimationObjectGroup:Fae,AnimationUtils:nae,ArcCurve:zH,ArrayCamera:LH,ArrowHelper:nle,Audio:b_,AudioAnalyser:Sae,AudioContext:Nx,AudioListener:yae,AudioLoader:fae,AxesHelper:ile,BackSide:fr,BasicDepthPacking:IH,BasicShadowMap:Vk,Bone:Ax,BooleanKeyframeTrack:vI,Box2:G_,Box3:va,Box3Helper:ele,BoxGeometry:wc,BoxHelper:$ae,BufferAttribute:Wn,BufferGeometry:Lt,BufferGeometryLoader:m_,ByteType:rH,Cache:aI,Camera:B0,CameraHelper:qae,CanvasTexture:woe,CapsuleGeometry:Hv,CatmullRomCurve3:UH,CineonToneMapping:nH,CircleGeometry:_v,ClampToEdgeWrapping:Ci,Clock:ey,Color:et,ColorKeyframeTrack:xx,ColorManagement:yo,CompressedArrayTexture:Goe,CompressedCubeTexture:Soe,CompressedTexture:fc,CompressedTextureLoader:aae,ConeGeometry:Xv,CubeCamera:ZH,CubeReflectionMapping:tg,CubeRefractionMapping:Ac,CubeTexture:G0,CubeTextureLoader:lae,CubeUVReflectionMapping:XA,CubicBezierCurve:mx,CubicBezierCurve3:DH,CubicInterpolant:l_,CullFaceBack:R9,CullFaceFront:Fk,CullFaceFrontBack:pee,CullFaceNone:Tk,Curve:ya,CurvePath:OH,CustomBlending:Gf,CustomToneMapping:iH,CylinderGeometry:UA,Cylindrical:Yae,Data3DTexture:gx,DataArrayTexture:xv,DataTexture:ja,DataTextureLoader:gae,DataUtils:Wte,DecrementStencilOp:Wee,DecrementWrapStencilOp:Mee,DefaultLoadingManager:u_,DepthFormat:rc,DepthStencilFormat:hc,DepthTexture:zA,DirectionalLight:h_,DirectionalLightHelper:jae,DiscreteInterpolant:g_,DisplayP3ColorSpace:y0,DodecahedronGeometry:Yv,DoubleSide:Ps,DstAlphaFactor:yv,DstColorFactor:Bv,DynamicCopyUsage:Pee,DynamicDrawUsage:e3,DynamicReadUsage:zee,EdgesGeometry:QH,EllipseCurve:Lv,EqualCompare:fH,EqualDepth:Ok,EqualStencilFunc:Lee,EquirectangularReflectionMapping:Rf,EquirectangularRefractionMapping:xf,Euler:YA,EventDispatcher:sl,ExtrudeGeometry:zv,FileLoader:ns,Float16BufferAttribute:Lte,Float32BufferAttribute:ut,Float64BufferAttribute:kte,FloatType:es,Fog:Tv,FogExp2:Mv,FramebufferTexture:Boe,FrontSide:il,Frustum:Ev,GLBufferAttribute:Xae,GLSL1:Qee,GLSL3:q9,GreaterCompare:mH,GreaterDepth:Jk,GreaterEqualCompare:vH,GreaterEqualDepth:Qk,GreaterEqualStencilFunc:Xee,GreaterStencilFunc:Hee,GridHelper:Qae,Group:Hd,HalfFloatType:Ri,HemisphereLight:I_,HemisphereLightHelper:Oae,HemisphereLightProbe:pae,IcosahedronGeometry:Uv,ImageBitmapLoader:Cae,ImageLoader:Of,ImageUtils:lx,IncrementStencilOp:Eee,IncrementWrapStencilOp:Nee,InstancedBufferAttribute:sI,InstancedBufferGeometry:Wx,InstancedInterleavedBuffer:_ae,InstancedMesh:hx,Int16BufferAttribute:Fte,Int32BufferAttribute:Vte,Int8BufferAttribute:Nte,IntType:qR,InterleavedBuffer:Fv,InterleavedBufferAttribute:rI,Interpolant:E0,InterpolateDiscrete:Ff,InterpolateLinear:Vf,InterpolateSmooth:q2,InvertStencilOp:Tee,KeepStencilOp:$2,KeyframeTrack:Ba,LOD:XH,LatheGeometry:w0,Layers:Yu,LessCompare:CH,LessDepth:Pk,LessEqualCompare:pH,LessEqualDepth:Ab,LessEqualStencilFunc:kee,LessStencilFunc:Vee,Light:xc,LightProbe:qv,Line:Cc,Line3:Kae,LineBasicMaterial:os,LineCurve:kv,LineCurve3:PH,LineDashedMaterial:o_,LineLoop:KH,LineSegments:ol,LinearDisplayP3ColorSpace:Ree,LinearEncoding:ox,LinearFilter:xn,LinearInterpolant:Rx,LinearMipMapLinearFilter:Bee,LinearMipMapNearestFilter:yee,LinearMipmapLinearFilter:rl,LinearMipmapNearestFilter:jR,LinearSRGBColorSpace:Ca,LinearToneMapping:eH,Loader:Lr,LoaderUtils:oS,LoadingManager:Zx,LoopOnce:gH,LoopPingPong:uH,LoopRepeat:cH,LuminanceAlphaFormat:aH,LuminanceFormat:tx,MOUSE:Iu,Material:br,MaterialLoader:$v,MathUtils:ac,Matrix3:Pt,Matrix4:dt,MaxEquation:W9,Mesh:pn,MeshBasicMaterial:to,MeshDepthMaterial:S0,MeshDistanceMaterial:Nv,MeshLambertMaterial:r_,MeshMatcapMaterial:s_,MeshNormalMaterial:Z0,MeshPhongMaterial:n_,MeshPhysicalMaterial:t_,MeshStandardMaterial:Gx,MeshToonMaterial:i_,MinEquation:E9,MirroredRepeatWrapping:Zf,MixOperation:qk,MultiplyBlending:Z9,MultiplyOperation:v0,NearestFilter:Vt,NearestMipMapLinearFilter:vee,NearestMipMapNearestFilter:bee,NearestMipmapLinearFilter:MC,NearestMipmapNearestFilter:hb,NeverCompare:hH,NeverDepth:Uk,NeverStencilFunc:Fee,NoBlending:tn,NoColorSpace:oc,NoToneMapping:Wo,NormalAnimationBlendMode:wv,NormalBlending:Ja,NotEqualCompare:bH,NotEqualDepth:jk,NotEqualStencilFunc:_ee,NumberKeyframeTrack:Uf,Object3D:cn,ObjectLoader:Aae,ObjectSpaceNormalMap:dH,OctahedronGeometry:R0,OneFactor:Hk,OneMinusDstAlphaFactor:Yk,OneMinusDstColorFactor:Kk,OneMinusSrcAlphaFactor:wf,OneMinusSrcColorFactor:Xk,OrthographicCamera:Zo,PCFShadowMap:vv,PCFSoftShadowMap:NC,PMREMGenerator:eS,Path:Xf,PerspectiveCamera:Zn,Plane:Ds,PlaneGeometry:cg,PlaneHelper:tle,PointLight:A_,PointLightHelper:Dae,Points:fx,PointsMaterial:Cx,PolarGridHelper:Jae,PolyhedronGeometry:Rc,PositionalAudio:Gae,PropertyBinding:ln,PropertyMixer:v_,QuadraticBezierCurve:bx,QuadraticBezierCurve3:vx,Quaternion:gr,QuaternionKeyframeTrack:DA,QuaternionLinearInterpolant:c_,RED_GREEN_RGTC2_Format:J9,RED_RGTC1_Format:lH,REVISION:gg,RGBADepthPacking:Rv,RGBAFormat:fi,RGBAIntegerFormat:rx,RGBA_ASTC_10x10_Format:z9,RGBA_ASTC_10x5_Format:X9,RGBA_ASTC_10x6_Format:Y9,RGBA_ASTC_10x8_Format:K9,RGBA_ASTC_12x10_Format:U9,RGBA_ASTC_12x12_Format:D9,RGBA_ASTC_4x4_Format:Tf,RGBA_ASTC_5x4_Format:T9,RGBA_ASTC_5x5_Format:F9,RGBA_ASTC_6x5_Format:V9,RGBA_ASTC_6x6_Format:L9,RGBA_ASTC_8x5_Format:k9,RGBA_ASTC_8x6_Format:H9,RGBA_ASTC_8x8_Format:_9,RGBA_BPTC_Format:rA,RGBA_ETC2_EAC_Format:Mf,RGBA_PVRTC_2BPPV1_Format:M9,RGBA_PVRTC_4BPPV1_Format:Wf,RGBA_S3TC_DXT1_Format:J2,RGBA_S3TC_DXT3_Format:j2,RGBA_S3TC_DXT5_Format:iA,RGB_BPTC_SIGNED_Format:P9,RGB_BPTC_UNSIGNED_Format:O9,RGB_ETC1_Format:Sv,RGB_ETC2_Format:Nf,RGB_PVRTC_2BPPV1_Format:N9,RGB_PVRTC_4BPPV1_Format:Ef,RGB_S3TC_DXT1_Format:nA,RGFormat:Vd,RGIntegerFormat:ix,RawShaderMaterial:kC,Ray:bI,Raycaster:B_,RectAreaLight:f_,RedFormat:Eu,RedIntegerFormat:nx,ReinhardToneMapping:tH,RenderTarget:wH,RepeatWrapping:ng,ReplaceStencilOp:Zee,ReverseSubtractEquation:kk,RingGeometry:Dv,SIGNED_RED_GREEN_RGTC2_Format:j9,SIGNED_RED_RGTC1_Format:Q9,SRGBColorSpace:Hn,Scene:pb,ShaderChunk:Ut,ShaderLib:ra,ShaderMaterial:an,ShadowMaterial:e_,Shape:Ku,ShapeGeometry:Pv,ShapePath:w_,ShapeUtils:qa,ShortType:sH,Skeleton:Vv,SkeletonHelper:Uae,SkinnedMesh:YH,Source:Mu,Sphere:Ho,SphereGeometry:x0,Spherical:lS,SphericalHarmonics3:p_,SplineCurve:yx,SpotLight:d_,SpotLightHelper:zae,Sprite:_H,SpriteMaterial:dx,SrcAlphaFactor:Sf,SrcAlphaSaturateFactor:zk,SrcColorFactor:_k,StaticCopyUsage:Dee,StaticDrawUsage:kf,StaticReadUsage:Kee,StereoCamera:bae,StreamCopyUsage:Oee,StreamDrawUsage:Yee,StreamReadUsage:Uee,StringKeyframeTrack:yI,SubtractEquation:Lk,SubtractiveBlending:x9,TOUCH:du,TangentSpaceNormalMap:Sc,TetrahedronGeometry:Ov,Texture:ei,TextureLoader:cae,TorusGeometry:Qv,TorusKnotGeometry:Jv,Triangle:ms,TriangleFanDrawMode:wee,TriangleStripDrawMode:See,TrianglesDrawMode:Gee,TubeGeometry:jv,TwoPassDoubleSide:mee,UVMapping:Gv,Uint16BufferAttribute:cx,Uint32BufferAttribute:Zv,Uint8BufferAttribute:Mte,Uint8ClampedBufferAttribute:Tte,Uniform:Fx,UniformsGroup:Hae,UniformsLib:it,UniformsUtils:Pn,UnsignedByteType:Yi,UnsignedInt248Type:Ol,UnsignedIntType:Yl,UnsignedShort4444Type:$R,UnsignedShort5551Type:ex,UnsignedShortType:mI,VSMShadowMap:ea,Vector2:xe,Vector3:P,Vector4:en,VectorKeyframeTrack:Df,VideoTexture:yoe,WebGL1Renderer:kH,WebGL3DRenderTarget:mte,WebGLArrayRenderTarget:pte,WebGLCoordinateSystem:Da,WebGLCubeRenderTarget:EH,WebGLMultipleRenderTargets:bte,WebGLRenderTarget:En,WebGLRenderer:Ix,WebGLUtils:VH,WebGPUCoordinateSystem:Hf,WireframeGeometry:$H,WrapAroundEnding:Lf,ZeroCurvatureEnding:Wu,ZeroFactor:bA,ZeroSlopeEnding:Nu,ZeroStencilOp:xee,_SRGBAFormat:Cb,createCanvasElement:SH,sRGBEncoding:sc},Symbol.toStringTag,{value:"Module"}));var R_={exports:{}},BI={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */BI.ConcurrentRoot=1;BI.ContinuousEventPriority=4;BI.DefaultEventPriority=16;BI.DiscreteEventPriority=1;BI.IdleEventPriority=536870912;BI.LegacyRoot=0;R_.exports=BI;var Xd=R_.exports;function sle(t){let e;const n=new Set,i=(g,c)=>{const u=typeof g=="function"?g(e):g;if(u!==e){const I=e;e=c?u:Object.assign({},e,u),n.forEach(h=>h(e,I))}},r=()=>e,s=(g,c=r,u=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let I=c(e);function h(){const C=c(e);if(!u(I,C)){const b=I;g(I=C,b)}}return n.add(h),()=>n.delete(h)},l={setState:i,getState:r,subscribe:(g,c,u)=>c||u?s(g,c,u):(n.add(g),()=>n.delete(g)),destroy:()=>n.clear()};return e=t(i,r,l),l}const ole=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),DW=ole?H.useEffect:H.useLayoutEffect;function ale(t){const e=typeof t=="function"?sle(t):t,n=(i=e.getState,r=Object.is)=>{const[,s]=H.useReducer(m=>m+1,0),o=e.getState(),a=H.useRef(o),l=H.useRef(i),g=H.useRef(r),c=H.useRef(!1),u=H.useRef();u.current===void 0&&(u.current=i(o));let I,h=!1;(a.current!==o||l.current!==i||g.current!==r||c.current)&&(I=i(o),h=!r(u.current,I)),DW(()=>{h&&(u.current=I),a.current=o,l.current=i,g.current=r,c.current=!1});const C=H.useRef(o);DW(()=>{const m=()=>{try{const p=e.getState(),v=l.current(p);g.current(u.current,v)||(a.current=p,u.current=v,s())}catch{c.current=!0,s()}},f=e.subscribe(m);return e.getState()!==C.current&&m(),f},[]);const b=h?I:u.current;return H.useDebugValue(b),b};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[n,e];return{next(){const r=i.length<=0;return{value:i.shift(),done:r}}}},n}var x_={exports:{}},lB={exports:{}},gB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PW;function lle(){return PW||(PW=1,function(t){function e(N,L){var V=N.length;N.push(L);e:for(;0<V;){var M=V-1>>>1,X=N[M];if(0<r(X,L))N[M]=L,N[V]=X,V=M;else break e}}function n(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var L=N[0],V=N.pop();if(V!==L){N[0]=V;e:for(var M=0,X=N.length,J=X>>>1;M<J;){var re=2*(M+1)-1,se=N[re],le=re+1,ae=N[le];if(0>r(se,V))le<X&&0>r(ae,se)?(N[M]=ae,N[le]=V,M=le):(N[M]=se,N[re]=V,M=re);else if(le<X&&0>r(ae,V))N[M]=ae,N[le]=V,M=le;else break e}}return L}function r(N,L){var V=N.sortIndex-L.sortIndex;return V!==0?V:N.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],g=[],c=1,u=null,I=3,h=!1,C=!1,b=!1,m=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(N){for(var L=n(g);L!==null;){if(L.callback===null)i(g);else if(L.startTime<=N)i(g),L.sortIndex=L.expirationTime,e(l,L);else break;L=n(g)}}function B(N){if(b=!1,v(N),!C)if(n(l)!==null)C=!0,Y(G);else{var L=n(g);L!==null&&z(B,L.startTime-N)}}function G(N,L){C=!1,b&&(b=!1,f(E),E=-1),h=!0;var V=I;try{for(v(L),u=n(l);u!==null&&(!(u.expirationTime>L)||N&&!T());){var M=u.callback;if(typeof M=="function"){u.callback=null,I=u.priorityLevel;var X=M(u.expirationTime<=L);L=t.unstable_now(),typeof X=="function"?u.callback=X:u===n(l)&&i(l),v(L)}else i(l);u=n(l)}if(u!==null)var J=!0;else{var re=n(g);re!==null&&z(B,re.startTime-L),J=!1}return J}finally{u=null,I=V,h=!1}}var R=!1,w=null,E=-1,x=5,W=-1;function T(){return!(t.unstable_now()-W<x)}function k(){if(w!==null){var N=t.unstable_now();W=N;var L=!0;try{L=w(!0,N)}finally{L?_():(R=!1,w=null)}}else R=!1}var _;if(typeof p=="function")_=function(){p(k)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,O=U.port2;U.port1.onmessage=k,_=function(){O.postMessage(null)}}else _=function(){m(k,0)};function Y(N){w=N,R||(R=!0,_())}function z(N,L){E=m(function(){N(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_continueExecution=function(){C||h||(C=!0,Y(G))},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(N){switch(I){case 1:case 2:case 3:var L=3;break;default:L=I}var V=I;I=L;try{return N()}finally{I=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(N,L){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var V=I;I=N;try{return L()}finally{I=V}},t.unstable_scheduleCallback=function(N,L,V){var M=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?M+V:M):V=M,N){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=V+X,N={id:c++,callback:L,priorityLevel:N,startTime:V,expirationTime:X,sortIndex:-1},V>M?(N.sortIndex=V,e(g,N),n(l)===null&&N===n(g)&&(b?(f(E),E=-1):b=!0,z(B,V-M))):(N.sortIndex=X,e(l,N),C||h||(C=!0,Y(G))),N},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(N){var L=I;return function(){var V=I;I=L;try{return N.apply(this,arguments)}finally{I=V}}}}(gB)),gB}var OW;function gle(){return OW||(OW=1,lB.exports=lle()),lB.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cle=function(e){var n={},i=H,r=gle(),s=Object.assign;function o(d){for(var A="https://reactjs.org/docs/error-decoder.html?invariant="+d,y=1;y<arguments.length;y++)A+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+d+"; visit "+A+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),g=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),C=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),B=Symbol.for("react.offscreen"),G=Symbol.iterator;function R(d){return d===null||typeof d!="object"?null:(d=G&&d[G]||d["@@iterator"],typeof d=="function"?d:null)}function w(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case c:return"Fragment";case g:return"Portal";case I:return"Profiler";case u:return"StrictMode";case m:return"Suspense";case f:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case C:return(d.displayName||"Context")+".Consumer";case h:return(d._context.displayName||"Context")+".Provider";case b:var A=d.render;return d=d.displayName,d||(d=A.displayName||A.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case p:return A=d.displayName||null,A!==null?A:w(d.type)||"Memo";case v:A=d._payload,d=d._init;try{return w(d(A))}catch{}}return null}function E(d){var A=d.type;switch(d.tag){case 24:return"Cache";case 9:return(A.displayName||"Context")+".Consumer";case 10:return(A._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=A.render,d=d.displayName||d.name||"",A.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return A;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return w(A);case 8:return A===u?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof A=="function")return A.displayName||A.name||null;if(typeof A=="string")return A}return null}function x(d){var A=d,y=d;if(d.alternate)for(;A.return;)A=A.return;else{d=A;do A=d,A.flags&4098&&(y=A.return),d=A.return;while(d)}return A.tag===3?y:null}function W(d){if(x(d)!==d)throw Error(o(188))}function T(d){var A=d.alternate;if(!A){if(A=x(d),A===null)throw Error(o(188));return A!==d?null:d}for(var y=d,S=A;;){var Z=y.return;if(Z===null)break;var F=Z.alternate;if(F===null){if(S=Z.return,S!==null){y=S;continue}break}if(Z.child===F.child){for(F=Z.child;F;){if(F===y)return W(Z),d;if(F===S)return W(Z),A;F=F.sibling}throw Error(o(188))}if(y.return!==S.return)y=Z,S=F;else{for(var ie=!1,Ie=Z.child;Ie;){if(Ie===y){ie=!0,y=Z,S=F;break}if(Ie===S){ie=!0,S=Z,y=F;break}Ie=Ie.sibling}if(!ie){for(Ie=F.child;Ie;){if(Ie===y){ie=!0,y=F,S=Z;break}if(Ie===S){ie=!0,S=F,y=Z;break}Ie=Ie.sibling}if(!ie)throw Error(o(189))}}if(y.alternate!==S)throw Error(o(190))}if(y.tag!==3)throw Error(o(188));return y.stateNode.current===y?d:A}function k(d){return d=T(d),d!==null?_(d):null}function _(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var A=_(d);if(A!==null)return A;d=d.sibling}return null}function U(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){if(d.tag!==4){var A=U(d);if(A!==null)return A}d=d.sibling}return null}var O=Array.isArray,Y=e.getPublicInstance,z=e.getRootHostContext,N=e.getChildHostContext,L=e.prepareForCommit,V=e.resetAfterCommit,M=e.createInstance,X=e.appendInitialChild,J=e.finalizeInitialChildren,re=e.prepareUpdate,se=e.shouldSetTextContent,le=e.createTextInstance,ae=e.scheduleTimeout,ce=e.cancelTimeout,Ee=e.noTimeout,Fe=e.isPrimaryRenderer,oe=e.supportsMutation,D=e.supportsPersistence,fe=e.supportsHydration,Ce=e.getInstanceFromNode,pe=e.preparePortalMount,be=e.getCurrentEventPriority,Ue=e.detachDeletedInstance,me=e.supportsMicrotasks,we=e.scheduleMicrotask,Be=e.supportsTestSelectors,Ae=e.findFiberRoot,De=e.getBoundingRect,Q=e.getTextContent,K=e.isHiddenSubtree,ge=e.matchAccessibilityRole,Le=e.setFocusIfFocusable,Re=e.setupIntersectionObserver,Ze=e.appendChild,Je=e.appendChildToContainer,Ye=e.commitTextUpdate,de=e.commitMount,ze=e.commitUpdate,je=e.insertBefore,Pe=e.insertInContainerBefore,ke=e.removeChild,$=e.removeChildFromContainer,Se=e.resetTextContent,Ke=e.hideInstance,q=e.hideTextInstance,He=e.unhideInstance,ue=e.unhideTextInstance,_e=e.clearContainer,qe=e.cloneInstance,At=e.createContainerChildSet,vt=e.appendChildToContainerChildSet,Et=e.finalizeContainerChildren,Kt=e.replaceContainerChildren,zt=e.cloneHiddenInstance,Ht=e.cloneHiddenTextInstance,Tt=e.canHydrateInstance,Mn=e.canHydrateTextInstance,ji=e.canHydrateSuspenseInstance,In=e.isSuspenseInstancePending,Tn=e.isSuspenseInstanceFallback,ur=e.registerSuspenseInstanceRetry,wn=e.getNextHydratableSibling,ti=e.getFirstHydratableChild,Ti=e.getFirstHydratableChildWithinContainer,uo=e.getFirstHydratableChildWithinSuspenseInstance,kr=e.hydrateInstance,j=e.hydrateTextInstance,ve=e.hydrateSuspenseInstance,Te=e.getNextHydratableInstanceAfterSuspenseInstance,ye=e.commitHydratedContainer,Me=e.commitHydratedSuspenseInstance,at=e.clearSuspenseBoundary,bt=e.clearSuspenseBoundaryFromContainer,Bt=e.shouldDeleteUnhydratedTailInstances,wt=e.didNotMatchHydratedContainerTextInstance,_t=e.didNotMatchHydratedTextInstance,Qe;function Gt(d){if(Qe===void 0)try{throw Error()}catch(y){var A=y.stack.trim().match(/\n( *(at )?)/);Qe=A&&A[1]||""}return`
`+Qe+d}var vn=!1;function dn(d,A){if(!d||vn)return"";vn=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(A)if(A=function(){throw Error()},Object.defineProperty(A.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(A,[])}catch(tt){var S=tt}Reflect.construct(d,[],A)}else{try{A.call()}catch(tt){S=tt}d.call(A.prototype)}else{try{throw Error()}catch(tt){S=tt}d()}}catch(tt){if(tt&&S&&typeof tt.stack=="string"){for(var Z=tt.stack.split(`
`),F=S.stack.split(`
`),ie=Z.length-1,Ie=F.length-1;1<=ie&&0<=Ie&&Z[ie]!==F[Ie];)Ie--;for(;1<=ie&&0<=Ie;ie--,Ie--)if(Z[ie]!==F[Ie]){if(ie!==1||Ie!==1)do if(ie--,Ie--,0>Ie||Z[ie]!==F[Ie]){var Ve=`
`+Z[ie].replace(" at new "," at ");return d.displayName&&Ve.includes("<anonymous>")&&(Ve=Ve.replace("<anonymous>",d.displayName)),Ve}while(1<=ie&&0<=Ie);break}}}finally{vn=!1,Error.prepareStackTrace=y}return(d=d?d.displayName||d.name:"")?Gt(d):""}var Fi=Object.prototype.hasOwnProperty,vr=[],fn=-1;function xt(d){return{current:d}}function on(d){0>fn||(d.current=vr[fn],vr[fn]=null,fn--)}function Zt(d,A){fn++,vr[fn]=d.current,d.current=A}var vi={},ci=xt(vi),Qn=xt(!1),ls=vi;function yn(d,A){var y=d.type.contextTypes;if(!y)return vi;var S=d.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===A)return S.__reactInternalMemoizedMaskedChildContext;var Z={},F;for(F in y)Z[F]=A[F];return S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=A,d.__reactInternalMemoizedMaskedChildContext=Z),Z}function Fn(d){return d=d.childContextTypes,d!=null}function Hr(){on(Qn),on(ci)}function xi(d,A,y){if(ci.current!==vi)throw Error(o(168));Zt(ci,A),Zt(Qn,y)}function Za(d,A,y){var S=d.stateNode;if(A=A.childContextTypes,typeof S.getChildContext!="function")return y;S=S.getChildContext();for(var Z in S)if(!(Z in A))throw Error(o(108,E(d)||"Unknown",Z));return s({},y,S)}function Ea(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||vi,ls=ci.current,Zt(ci,d),Zt(Qn,Qn.current),!0}function yr(d,A,y){var S=d.stateNode;if(!S)throw Error(o(169));y?(d=Za(d,A,ls),S.__reactInternalMemoizedMergedChildContext=d,on(Qn),on(ci),Zt(ci,d)):on(Qn),Zt(Qn,y)}var Ms=Math.clz32?Math.clz32:np,ZI=Math.log,Tc=Math.LN2;function np(d){return d>>>=0,d===0?32:31-(ZI(d)/Tc|0)|0}var hl=64,Cl=4194304;function fl(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Fc(d,A){var y=d.pendingLanes;if(y===0)return 0;var S=0,Z=d.suspendedLanes,F=d.pingedLanes,ie=y&268435455;if(ie!==0){var Ie=ie&~Z;Ie!==0?S=fl(Ie):(F&=ie,F!==0&&(S=fl(F)))}else ie=y&~Z,ie!==0?S=fl(ie):F!==0&&(S=fl(F));if(S===0)return 0;if(A!==0&&A!==S&&!(A&Z)&&(Z=S&-S,F=A&-A,Z>=F||Z===16&&(F&4194240)!==0))return A;if(S&4&&(S|=y&16),A=d.entangledLanes,A!==0)for(d=d.entanglements,A&=S;0<A;)y=31-Ms(A),Z=1<<y,S|=d[y],A&=~Z;return S}function ip(d,A){switch(d){case 1:case 2:case 4:return A+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return A+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qA(d,A){for(var y=d.suspendedLanes,S=d.pingedLanes,Z=d.expirationTimes,F=d.pendingLanes;0<F;){var ie=31-Ms(F),Ie=1<<ie,Ve=Z[ie];Ve===-1?(!(Ie&y)||Ie&S)&&(Z[ie]=ip(Ie,A)):Ve<=A&&(d.expiredLanes|=Ie),F&=~Ie}}function pl(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function EI(d){for(var A=[],y=0;31>y;y++)A.push(d);return A}function Wa(d,A,y){d.pendingLanes|=A,A!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,A=31-Ms(A),d[A]=y}function hg(d,A){var y=d.pendingLanes&~A;d.pendingLanes=A,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=A,d.mutableReadLanes&=A,d.entangledLanes&=A,A=d.entanglements;var S=d.eventTimes;for(d=d.expirationTimes;0<y;){var Z=31-Ms(y),F=1<<Z;A[Z]=0,S[Z]=-1,d[Z]=-1,y&=~F}}function Na(d,A){var y=d.entangledLanes|=A;for(d=d.entanglements;y;){var S=31-Ms(y),Z=1<<S;Z&A|d[S]&A&&(d[S]|=A),y&=~Z}}var qt=0;function $A(d){return d&=-d,1<d?4<d?d&268435455?16:536870912:4:1}var ml=r.unstable_scheduleCallback,WI=r.unstable_cancelCallback,eh=r.unstable_shouldYield,rp=r.unstable_requestPaint,ni=r.unstable_now,Vc=r.unstable_ImmediatePriority,sp=r.unstable_UserBlockingPriority,_r=r.unstable_NormalPriority,th=r.unstable_IdlePriority,Lc=null,Ts=null;function nh(d){if(Ts&&typeof Ts.onCommitFiberRoot=="function")try{Ts.onCommitFiberRoot(Lc,d,void 0,(d.current.flags&128)===128)}catch{}}function op(d,A){return d===A&&(d!==0||1/d===1/A)||d!==d&&A!==A}var Fs=typeof Object.is=="function"?Object.is:op,Xr=null,Ma=!1,Io=!1;function ih(d){Xr===null?Xr=[d]:Xr.push(d)}function rh(d){Ma=!0,ih(d)}function gs(){if(!Io&&Xr!==null){Io=!0;var d=0,A=qt;try{var y=Xr;for(qt=1;d<y.length;d++){var S=y[d];do S=S(!0);while(S!==null)}Xr=null,Ma=!1}catch(Z){throw Xr!==null&&(Xr=Xr.slice(d+1)),ml(Vc,gs),Z}finally{qt=A,Io=!1}}return null}var kc=a.ReactCurrentBatchConfig;function Hc(d,A){if(Fs(d,A))return!0;if(typeof d!="object"||d===null||typeof A!="object"||A===null)return!1;var y=Object.keys(d),S=Object.keys(A);if(y.length!==S.length)return!1;for(S=0;S<y.length;S++){var Z=y[S];if(!Fi.call(A,Z)||!Fs(d[Z],A[Z]))return!1}return!0}function _c(d){switch(d.tag){case 5:return Gt(d.type);case 16:return Gt("Lazy");case 13:return Gt("Suspense");case 19:return Gt("SuspenseList");case 0:case 2:case 15:return d=dn(d.type,!1),d;case 11:return d=dn(d.type.render,!1),d;case 1:return d=dn(d.type,!0),d;default:return""}}function Yr(d,A){if(d&&d.defaultProps){A=s({},A),d=d.defaultProps;for(var y in d)A[y]===void 0&&(A[y]=d[y]);return A}return A}var qi=xt(null),NI=null,zo=null,Cg=null;function MI(){Cg=zo=NI=null}function ap(d,A,y){Fe?(Zt(qi,A._currentValue),A._currentValue=y):(Zt(qi,A._currentValue2),A._currentValue2=y)}function $i(d){var A=qi.current;on(qi),Fe?d._currentValue=A:d._currentValue2=A}function Kr(d,A,y){for(;d!==null;){var S=d.alternate;if((d.childLanes&A)!==A?(d.childLanes|=A,S!==null&&(S.childLanes|=A)):S!==null&&(S.childLanes&A)!==A&&(S.childLanes|=A),d===y)break;d=d.return}}function yi(d,A){NI=d,Cg=zo=null,d=d.dependencies,d!==null&&d.firstContext!==null&&(d.lanes&A&&(Hs=!0),d.firstContext=null)}function Bi(d){var A=Fe?d._currentValue:d._currentValue2;if(Cg!==d)if(d={context:d,memoizedValue:A,next:null},zo===null){if(NI===null)throw Error(o(308));zo=d,NI.dependencies={lanes:0,firstContext:d}}else zo=zo.next=d;return A}var Vs=null,fg=!1;function Dy(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function XZ(d,A){d=d.updateQueue,A.updateQueue===d&&(A.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function bl(d,A){return{eventTime:d,lane:A,tag:0,payload:null,callback:null,next:null}}function pg(d,A){var y=d.updateQueue;y!==null&&(y=y.shared,Zi!==null&&d.mode&1&&!(jt&2)?(d=y.interleaved,d===null?(A.next=A,Vs===null?Vs=[y]:Vs.push(y)):(A.next=d.next,d.next=A),y.interleaved=A):(d=y.pending,d===null?A.next=A:(A.next=d.next,d.next=A),y.pending=A))}function lp(d,A,y){if(A=A.updateQueue,A!==null&&(A=A.shared,(y&4194240)!==0)){var S=A.lanes;S&=d.pendingLanes,y|=S,A.lanes=y,Na(d,y)}}function YZ(d,A){var y=d.updateQueue,S=d.alternate;if(S!==null&&(S=S.updateQueue,y===S)){var Z=null,F=null;if(y=y.firstBaseUpdate,y!==null){do{var ie={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};F===null?Z=F=ie:F=F.next=ie,y=y.next}while(y!==null);F===null?Z=F=A:F=F.next=A}else Z=F=A;y={baseState:S.baseState,firstBaseUpdate:Z,lastBaseUpdate:F,shared:S.shared,effects:S.effects},d.updateQueue=y;return}d=y.lastBaseUpdate,d===null?y.firstBaseUpdate=A:d.next=A,y.lastBaseUpdate=A}function gp(d,A,y,S){var Z=d.updateQueue;fg=!1;var F=Z.firstBaseUpdate,ie=Z.lastBaseUpdate,Ie=Z.shared.pending;if(Ie!==null){Z.shared.pending=null;var Ve=Ie,tt=Ve.next;Ve.next=null,ie===null?F=tt:ie.next=tt,ie=Ve;var gt=d.alternate;gt!==null&&(gt=gt.updateQueue,Ie=gt.lastBaseUpdate,Ie!==ie&&(Ie===null?gt.firstBaseUpdate=tt:Ie.next=tt,gt.lastBaseUpdate=Ve))}if(F!==null){var Xt=Z.baseState;ie=0,gt=tt=Ve=null,Ie=F;do{var St=Ie.lane,Rn=Ie.eventTime;if((S&St)===St){gt!==null&&(gt=gt.next={eventTime:Rn,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var pt=d,wr=Ie;switch(St=A,Rn=y,wr.tag){case 1:if(pt=wr.payload,typeof pt=="function"){Xt=pt.call(Rn,Xt,St);break e}Xt=pt;break e;case 3:pt.flags=pt.flags&-65537|128;case 0:if(pt=wr.payload,St=typeof pt=="function"?pt.call(Rn,Xt,St):pt,St==null)break e;Xt=s({},Xt,St);break e;case 2:fg=!0}}Ie.callback!==null&&Ie.lane!==0&&(d.flags|=64,St=Z.effects,St===null?Z.effects=[Ie]:St.push(Ie))}else Rn={eventTime:Rn,lane:St,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},gt===null?(tt=gt=Rn,Ve=Xt):gt=gt.next=Rn,ie|=St;if(Ie=Ie.next,Ie===null){if(Ie=Z.shared.pending,Ie===null)break;St=Ie,Ie=St.next,St.next=null,Z.lastBaseUpdate=St,Z.shared.pending=null}}while(1);if(gt===null&&(Ve=Xt),Z.baseState=Ve,Z.firstBaseUpdate=tt,Z.lastBaseUpdate=gt,A=Z.shared.interleaved,A!==null){Z=A;do ie|=Z.lane,Z=Z.next;while(Z!==A)}else F===null&&(Z.shared.lanes=0);YI|=ie,d.lanes=ie,d.memoizedState=Xt}}function KZ(d,A,y){if(d=A.effects,A.effects=null,d!==null)for(A=0;A<d.length;A++){var S=d[A],Z=S.callback;if(Z!==null){if(S.callback=null,S=y,typeof Z!="function")throw Error(o(191,Z));Z.call(S)}}}var zZ=new i.Component().refs;function Py(d,A,y,S){A=d.memoizedState,y=y(S,A),y=y==null?A:s({},A,y),d.memoizedState=y,d.lanes===0&&(d.updateQueue.baseState=y)}var cp={isMounted:function(d){return(d=d._reactInternals)?x(d)===d:!1},enqueueSetState:function(d,A,y){d=d._reactInternals;var S=Ur(),Z=vg(d),F=bl(S,Z);F.payload=A,y!=null&&(F.callback=y),pg(d,F),A=po(d,Z,S),A!==null&&lp(A,d,Z)},enqueueReplaceState:function(d,A,y){d=d._reactInternals;var S=Ur(),Z=vg(d),F=bl(S,Z);F.tag=1,F.payload=A,y!=null&&(F.callback=y),pg(d,F),A=po(d,Z,S),A!==null&&lp(A,d,Z)},enqueueForceUpdate:function(d,A){d=d._reactInternals;var y=Ur(),S=vg(d),Z=bl(y,S);Z.tag=2,A!=null&&(Z.callback=A),pg(d,Z),A=po(d,S,y),A!==null&&lp(A,d,S)}};function UZ(d,A,y,S,Z,F,ie){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(S,F,ie):A.prototype&&A.prototype.isPureReactComponent?!Hc(y,S)||!Hc(Z,F):!0}function DZ(d,A,y){var S=!1,Z=vi,F=A.contextType;return typeof F=="object"&&F!==null?F=Bi(F):(Z=Fn(A)?ls:ci.current,S=A.contextTypes,F=(S=S!=null)?yn(d,Z):vi),A=new A(y,F),d.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,A.updater=cp,d.stateNode=A,A._reactInternals=d,S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=Z,d.__reactInternalMemoizedMaskedChildContext=F),A}function PZ(d,A,y,S){d=A.state,typeof A.componentWillReceiveProps=="function"&&A.componentWillReceiveProps(y,S),typeof A.UNSAFE_componentWillReceiveProps=="function"&&A.UNSAFE_componentWillReceiveProps(y,S),A.state!==d&&cp.enqueueReplaceState(A,A.state,null)}function Oy(d,A,y,S){var Z=d.stateNode;Z.props=y,Z.state=d.memoizedState,Z.refs=zZ,Dy(d);var F=A.contextType;typeof F=="object"&&F!==null?Z.context=Bi(F):(F=Fn(A)?ls:ci.current,Z.context=yn(d,F)),Z.state=d.memoizedState,F=A.getDerivedStateFromProps,typeof F=="function"&&(Py(d,A,F,y),Z.state=d.memoizedState),typeof A.getDerivedStateFromProps=="function"||typeof Z.getSnapshotBeforeUpdate=="function"||typeof Z.UNSAFE_componentWillMount!="function"&&typeof Z.componentWillMount!="function"||(A=Z.state,typeof Z.componentWillMount=="function"&&Z.componentWillMount(),typeof Z.UNSAFE_componentWillMount=="function"&&Z.UNSAFE_componentWillMount(),A!==Z.state&&cp.enqueueReplaceState(Z,Z.state,null),gp(d,y,Z,S),Z.state=d.memoizedState),typeof Z.componentDidMount=="function"&&(d.flags|=4194308)}var TI=[],FI=0,up=null,Ip=0,Ao=[],ho=0,Xc=null,vl=1,yl="";function Yc(d,A){TI[FI++]=Ip,TI[FI++]=up,up=d,Ip=A}function OZ(d,A,y){Ao[ho++]=vl,Ao[ho++]=yl,Ao[ho++]=Xc,Xc=d;var S=vl;d=yl;var Z=32-Ms(S)-1;S&=~(1<<Z),y+=1;var F=32-Ms(A)+Z;if(30<F){var ie=Z-Z%5;F=(S&(1<<ie)-1).toString(32),S>>=ie,Z-=ie,vl=1<<32-Ms(A)+Z|y<<Z|S,yl=F+d}else vl=1<<F|y<<Z|S,yl=d}function Qy(d){d.return!==null&&(Yc(d,1),OZ(d,1,0))}function Jy(d){for(;d===up;)up=TI[--FI],TI[FI]=null,Ip=TI[--FI],TI[FI]=null;for(;d===Xc;)Xc=Ao[--ho],Ao[ho]=null,yl=Ao[--ho],Ao[ho]=null,vl=Ao[--ho],Ao[ho]=null}var Ls=null,ks=null,Jn=!1,sh=!1,Uo=null;function QZ(d,A){var y=mo(5,null,null,0);y.elementType="DELETED",y.stateNode=A,y.return=d,A=d.deletions,A===null?(d.deletions=[y],d.flags|=16):A.push(y)}function JZ(d,A){switch(d.tag){case 5:return A=Tt(A,d.type,d.pendingProps),A!==null?(d.stateNode=A,Ls=d,ks=ti(A),!0):!1;case 6:return A=Mn(A,d.pendingProps),A!==null?(d.stateNode=A,Ls=d,ks=null,!0):!1;case 13:if(A=ji(A),A!==null){var y=Xc!==null?{id:vl,overflow:yl}:null;return d.memoizedState={dehydrated:A,treeContext:y,retryLane:1073741824},y=mo(18,null,null,0),y.stateNode=A,y.return=d,d.child=y,Ls=d,ks=null,!0}return!1;default:return!1}}function jy(d){return(d.mode&1)!==0&&(d.flags&128)===0}function qy(d){if(Jn){var A=ks;if(A){var y=A;if(!JZ(d,A)){if(jy(d))throw Error(o(418));A=wn(y);var S=Ls;A&&JZ(d,A)?QZ(S,y):(d.flags=d.flags&-4097|2,Jn=!1,Ls=d)}}else{if(jy(d))throw Error(o(418));d.flags=d.flags&-4097|2,Jn=!1,Ls=d}}}function jZ(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Ls=d}function oh(d){if(!fe||d!==Ls)return!1;if(!Jn)return jZ(d),Jn=!0,!1;if(d.tag!==3&&(d.tag!==5||Bt(d.type)&&!se(d.type,d.memoizedProps))){var A=ks;if(A){if(jy(d)){for(d=ks;d;)d=wn(d);throw Error(o(418))}for(;A;)QZ(d,A),A=wn(A)}}if(jZ(d),d.tag===13){if(!fe)throw Error(o(316));if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(o(317));ks=Te(d)}else ks=Ls?wn(d.stateNode):null;return!0}function VI(){fe&&(ks=Ls=null,sh=Jn=!1)}function $y(d){Uo===null?Uo=[d]:Uo.push(d)}function ah(d,A,y){if(d=y.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(o(309));var S=y.stateNode}if(!S)throw Error(o(147,d));var Z=S,F=""+d;return A!==null&&A.ref!==null&&typeof A.ref=="function"&&A.ref._stringRef===F?A.ref:(A=function(ie){var Ie=Z.refs;Ie===zZ&&(Ie=Z.refs={}),ie===null?delete Ie[F]:Ie[F]=ie},A._stringRef=F,A)}if(typeof d!="string")throw Error(o(284));if(!y._owner)throw Error(o(290,d))}return d}function dp(d,A){throw d=Object.prototype.toString.call(A),Error(o(31,d==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":d))}function qZ(d){var A=d._init;return A(d._payload)}function $Z(d){function A(Ge,he){if(d){var We=Ge.deletions;We===null?(Ge.deletions=[he],Ge.flags|=16):We.push(he)}}function y(Ge,he){if(!d)return null;for(;he!==null;)A(Ge,he),he=he.sibling;return null}function S(Ge,he){for(Ge=new Map;he!==null;)he.key!==null?Ge.set(he.key,he):Ge.set(he.index,he),he=he.sibling;return Ge}function Z(Ge,he){return Ge=Bg(Ge,he),Ge.index=0,Ge.sibling=null,Ge}function F(Ge,he,We){return Ge.index=We,d?(We=Ge.alternate,We!==null?(We=We.index,We<he?(Ge.flags|=2,he):We):(Ge.flags|=2,he)):(Ge.flags|=1048576,he)}function ie(Ge){return d&&Ge.alternate===null&&(Ge.flags|=2),Ge}function Ie(Ge,he,We,ot){return he===null||he.tag!==6?(he=V1(We,Ge.mode,ot),he.return=Ge,he):(he=Z(he,We),he.return=Ge,he)}function Ve(Ge,he,We,ot){var ht=We.type;return ht===c?gt(Ge,he,We.props.children,ot,We.key):he!==null&&(he.elementType===ht||typeof ht=="object"&&ht!==null&&ht.$$typeof===v&&qZ(ht)===he.type)?(ot=Z(he,We.props),ot.ref=ah(Ge,he,We),ot.return=Ge,ot):(ot=zp(We.type,We.key,We.props,null,Ge.mode,ot),ot.ref=ah(Ge,he,We),ot.return=Ge,ot)}function tt(Ge,he,We,ot){return he===null||he.tag!==4||he.stateNode.containerInfo!==We.containerInfo||he.stateNode.implementation!==We.implementation?(he=L1(We,Ge.mode,ot),he.return=Ge,he):(he=Z(he,We.children||[]),he.return=Ge,he)}function gt(Ge,he,We,ot,ht){return he===null||he.tag!==7?(he=Qc(We,Ge.mode,ot,ht),he.return=Ge,he):(he=Z(he,We),he.return=Ge,he)}function Xt(Ge,he,We){if(typeof he=="string"&&he!==""||typeof he=="number")return he=V1(""+he,Ge.mode,We),he.return=Ge,he;if(typeof he=="object"&&he!==null){switch(he.$$typeof){case l:return We=zp(he.type,he.key,he.props,null,Ge.mode,We),We.ref=ah(Ge,null,he),We.return=Ge,We;case g:return he=L1(he,Ge.mode,We),he.return=Ge,he;case v:var ot=he._init;return Xt(Ge,ot(he._payload),We)}if(O(he)||R(he))return he=Qc(he,Ge.mode,We,null),he.return=Ge,he;dp(Ge,he)}return null}function St(Ge,he,We,ot){var ht=he!==null?he.key:null;if(typeof We=="string"&&We!==""||typeof We=="number")return ht!==null?null:Ie(Ge,he,""+We,ot);if(typeof We=="object"&&We!==null){switch(We.$$typeof){case l:return We.key===ht?Ve(Ge,he,We,ot):null;case g:return We.key===ht?tt(Ge,he,We,ot):null;case v:return ht=We._init,St(Ge,he,ht(We._payload),ot)}if(O(We)||R(We))return ht!==null?null:gt(Ge,he,We,ot,null);dp(Ge,We)}return null}function Rn(Ge,he,We,ot,ht){if(typeof ot=="string"&&ot!==""||typeof ot=="number")return Ge=Ge.get(We)||null,Ie(he,Ge,""+ot,ht);if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case l:return Ge=Ge.get(ot.key===null?We:ot.key)||null,Ve(he,Ge,ot,ht);case g:return Ge=Ge.get(ot.key===null?We:ot.key)||null,tt(he,Ge,ot,ht);case v:var Jt=ot._init;return Rn(Ge,he,We,Jt(ot._payload),ht)}if(O(ot)||R(ot))return Ge=Ge.get(We)||null,gt(he,Ge,ot,ht,null);dp(he,ot)}return null}function pt(Ge,he,We,ot){for(var ht=null,Jt=null,Yt=he,An=he=0,tr=null;Yt!==null&&An<We.length;An++){Yt.index>An?(tr=Yt,Yt=null):tr=Yt.sibling;var hn=St(Ge,Yt,We[An],ot);if(hn===null){Yt===null&&(Yt=tr);break}d&&Yt&&hn.alternate===null&&A(Ge,Yt),he=F(hn,he,An),Jt===null?ht=hn:Jt.sibling=hn,Jt=hn,Yt=tr}if(An===We.length)return y(Ge,Yt),Jn&&Yc(Ge,An),ht;if(Yt===null){for(;An<We.length;An++)Yt=Xt(Ge,We[An],ot),Yt!==null&&(he=F(Yt,he,An),Jt===null?ht=Yt:Jt.sibling=Yt,Jt=Yt);return Jn&&Yc(Ge,An),ht}for(Yt=S(Ge,Yt);An<We.length;An++)tr=Rn(Yt,Ge,An,We[An],ot),tr!==null&&(d&&tr.alternate!==null&&Yt.delete(tr.key===null?An:tr.key),he=F(tr,he,An),Jt===null?ht=tr:Jt.sibling=tr,Jt=tr);return d&&Yt.forEach(function(Gg){return A(Ge,Gg)}),Jn&&Yc(Ge,An),ht}function wr(Ge,he,We,ot){var ht=R(We);if(typeof ht!="function")throw Error(o(150));if(We=ht.call(We),We==null)throw Error(o(151));for(var Jt=ht=null,Yt=he,An=he=0,tr=null,hn=We.next();Yt!==null&&!hn.done;An++,hn=We.next()){Yt.index>An?(tr=Yt,Yt=null):tr=Yt.sibling;var Gg=St(Ge,Yt,hn.value,ot);if(Gg===null){Yt===null&&(Yt=tr);break}d&&Yt&&Gg.alternate===null&&A(Ge,Yt),he=F(Gg,he,An),Jt===null?ht=Gg:Jt.sibling=Gg,Jt=Gg,Yt=tr}if(hn.done)return y(Ge,Yt),Jn&&Yc(Ge,An),ht;if(Yt===null){for(;!hn.done;An++,hn=We.next())hn=Xt(Ge,hn.value,ot),hn!==null&&(he=F(hn,he,An),Jt===null?ht=hn:Jt.sibling=hn,Jt=hn);return Jn&&Yc(Ge,An),ht}for(Yt=S(Ge,Yt);!hn.done;An++,hn=We.next())hn=Rn(Yt,Ge,An,hn.value,ot),hn!==null&&(d&&hn.alternate!==null&&Yt.delete(hn.key===null?An:hn.key),he=F(hn,he,An),Jt===null?ht=hn:Jt.sibling=hn,Jt=hn);return d&&Yt.forEach(function(MU){return A(Ge,MU)}),Jn&&Yc(Ge,An),ht}function bo(Ge,he,We,ot){if(typeof We=="object"&&We!==null&&We.type===c&&We.key===null&&(We=We.props.children),typeof We=="object"&&We!==null){switch(We.$$typeof){case l:e:{for(var ht=We.key,Jt=he;Jt!==null;){if(Jt.key===ht){if(ht=We.type,ht===c){if(Jt.tag===7){y(Ge,Jt.sibling),he=Z(Jt,We.props.children),he.return=Ge,Ge=he;break e}}else if(Jt.elementType===ht||typeof ht=="object"&&ht!==null&&ht.$$typeof===v&&qZ(ht)===Jt.type){y(Ge,Jt.sibling),he=Z(Jt,We.props),he.ref=ah(Ge,Jt,We),he.return=Ge,Ge=he;break e}y(Ge,Jt);break}else A(Ge,Jt);Jt=Jt.sibling}We.type===c?(he=Qc(We.props.children,Ge.mode,ot,We.key),he.return=Ge,Ge=he):(ot=zp(We.type,We.key,We.props,null,Ge.mode,ot),ot.ref=ah(Ge,he,We),ot.return=Ge,Ge=ot)}return ie(Ge);case g:e:{for(Jt=We.key;he!==null;){if(he.key===Jt)if(he.tag===4&&he.stateNode.containerInfo===We.containerInfo&&he.stateNode.implementation===We.implementation){y(Ge,he.sibling),he=Z(he,We.children||[]),he.return=Ge,Ge=he;break e}else{y(Ge,he);break}else A(Ge,he);he=he.sibling}he=L1(We,Ge.mode,ot),he.return=Ge,Ge=he}return ie(Ge);case v:return Jt=We._init,bo(Ge,he,Jt(We._payload),ot)}if(O(We))return pt(Ge,he,We,ot);if(R(We))return wr(Ge,he,We,ot);dp(Ge,We)}return typeof We=="string"&&We!==""||typeof We=="number"?(We=""+We,he!==null&&he.tag===6?(y(Ge,he.sibling),he=Z(he,We),he.return=Ge,Ge=he):(y(Ge,he),he=V1(We,Ge.mode,ot),he.return=Ge,Ge=he),ie(Ge)):y(Ge,he)}return bo}var LI=$Z(!0),e4=$Z(!1),lh={},Co=xt(lh),gh=xt(lh),kI=xt(lh);function Ta(d){if(d===lh)throw Error(o(174));return d}function e1(d,A){Zt(kI,A),Zt(gh,d),Zt(Co,lh),d=z(A),on(Co),Zt(Co,d)}function HI(){on(Co),on(gh),on(kI)}function t4(d){var A=Ta(kI.current),y=Ta(Co.current);A=N(y,d.type,A),y!==A&&(Zt(gh,d),Zt(Co,A))}function t1(d){gh.current===d&&(on(Co),on(gh))}var ii=xt(0);function Ap(d){for(var A=d;A!==null;){if(A.tag===13){var y=A.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||In(y)||Tn(y)))return A}else if(A.tag===19&&A.memoizedProps.revealOrder!==void 0){if(A.flags&128)return A}else if(A.child!==null){A.child.return=A,A=A.child;continue}if(A===d)break;for(;A.sibling===null;){if(A.return===null||A.return===d)return null;A=A.return}A.sibling.return=A.return,A=A.sibling}return null}var n1=[];function i1(){for(var d=0;d<n1.length;d++){var A=n1[d];Fe?A._workInProgressVersionPrimary=null:A._workInProgressVersionSecondary=null}n1.length=0}var hp=a.ReactCurrentDispatcher,fo=a.ReactCurrentBatchConfig,_I=0,ui=null,Br=null,er=null,Cp=!1,ch=!1,uh=0,rU=0;function Gr(){throw Error(o(321))}function r1(d,A){if(A===null)return!1;for(var y=0;y<A.length&&y<d.length;y++)if(!Fs(d[y],A[y]))return!1;return!0}function s1(d,A,y,S,Z,F){if(_I=F,ui=A,A.memoizedState=null,A.updateQueue=null,A.lanes=0,hp.current=d===null||d.memoizedState===null?lU:gU,d=y(S,Z),ch){F=0;do{if(ch=!1,uh=0,25<=F)throw Error(o(301));F+=1,er=Br=null,A.updateQueue=null,hp.current=cU,d=y(S,Z)}while(ch)}if(hp.current=vp,A=Br!==null&&Br.next!==null,_I=0,er=Br=ui=null,Cp=!1,A)throw Error(o(300));return d}function o1(){var d=uh!==0;return uh=0,d}function Bl(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return er===null?ui.memoizedState=er=d:er=er.next=d,er}function Fa(){if(Br===null){var d=ui.alternate;d=d!==null?d.memoizedState:null}else d=Br.next;var A=er===null?ui.memoizedState:er.next;if(A!==null)er=A,Br=d;else{if(d===null)throw Error(o(310));Br=d,d={memoizedState:Br.memoizedState,baseState:Br.baseState,baseQueue:Br.baseQueue,queue:Br.queue,next:null},er===null?ui.memoizedState=er=d:er=er.next=d}return er}function Kc(d,A){return typeof A=="function"?A(d):A}function fp(d){var A=Fa(),y=A.queue;if(y===null)throw Error(o(311));y.lastRenderedReducer=d;var S=Br,Z=S.baseQueue,F=y.pending;if(F!==null){if(Z!==null){var ie=Z.next;Z.next=F.next,F.next=ie}S.baseQueue=Z=F,y.pending=null}if(Z!==null){F=Z.next,S=S.baseState;var Ie=ie=null,Ve=null,tt=F;do{var gt=tt.lane;if((_I&gt)===gt)Ve!==null&&(Ve=Ve.next={lane:0,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null}),S=tt.hasEagerState?tt.eagerState:d(S,tt.action);else{var Xt={lane:gt,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null};Ve===null?(Ie=Ve=Xt,ie=S):Ve=Ve.next=Xt,ui.lanes|=gt,YI|=gt}tt=tt.next}while(tt!==null&&tt!==F);Ve===null?ie=S:Ve.next=Ie,Fs(S,A.memoizedState)||(Hs=!0),A.memoizedState=S,A.baseState=ie,A.baseQueue=Ve,y.lastRenderedState=S}if(d=y.interleaved,d!==null){Z=d;do F=Z.lane,ui.lanes|=F,YI|=F,Z=Z.next;while(Z!==d)}else Z===null&&(y.lanes=0);return[A.memoizedState,y.dispatch]}function pp(d){var A=Fa(),y=A.queue;if(y===null)throw Error(o(311));y.lastRenderedReducer=d;var S=y.dispatch,Z=y.pending,F=A.memoizedState;if(Z!==null){y.pending=null;var ie=Z=Z.next;do F=d(F,ie.action),ie=ie.next;while(ie!==Z);Fs(F,A.memoizedState)||(Hs=!0),A.memoizedState=F,A.baseQueue===null&&(A.baseState=F),y.lastRenderedState=F}return[F,S]}function n4(){}function i4(d,A){var y=ui,S=Fa(),Z=A(),F=!Fs(S.memoizedState,Z);if(F&&(S.memoizedState=Z,Hs=!0),S=S.queue,dh(o4.bind(null,y,S,d),[d]),S.getSnapshot!==A||F||er!==null&&er.memoizedState.tag&1){if(y.flags|=2048,Ih(9,s4.bind(null,y,S,Z,A),void 0,null),Zi===null)throw Error(o(349));_I&30||r4(y,A,Z)}return Z}function r4(d,A,y){d.flags|=16384,d={getSnapshot:A,value:y},A=ui.updateQueue,A===null?(A={lastEffect:null,stores:null},ui.updateQueue=A,A.stores=[d]):(y=A.stores,y===null?A.stores=[d]:y.push(d))}function s4(d,A,y,S){A.value=y,A.getSnapshot=S,a4(A)&&po(d,1,-1)}function o4(d,A,y){return y(function(){a4(A)&&po(d,1,-1)})}function a4(d){var A=d.getSnapshot;d=d.value;try{var y=A();return!Fs(d,y)}catch{return!0}}function a1(d){var A=Bl();return typeof d=="function"&&(d=d()),A.memoizedState=A.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Kc,lastRenderedState:d},A.queue=d,d=d.dispatch=aU.bind(null,ui,d),[A.memoizedState,d]}function Ih(d,A,y,S){return d={tag:d,create:A,destroy:y,deps:S,next:null},A=ui.updateQueue,A===null?(A={lastEffect:null,stores:null},ui.updateQueue=A,A.lastEffect=d.next=d):(y=A.lastEffect,y===null?A.lastEffect=d.next=d:(S=y.next,y.next=d,d.next=S,A.lastEffect=d)),d}function l4(){return Fa().memoizedState}function mp(d,A,y,S){var Z=Bl();ui.flags|=d,Z.memoizedState=Ih(1|A,y,void 0,S===void 0?null:S)}function bp(d,A,y,S){var Z=Fa();S=S===void 0?null:S;var F=void 0;if(Br!==null){var ie=Br.memoizedState;if(F=ie.destroy,S!==null&&r1(S,ie.deps)){Z.memoizedState=Ih(A,y,F,S);return}}ui.flags|=d,Z.memoizedState=Ih(1|A,y,F,S)}function l1(d,A){return mp(8390656,8,d,A)}function dh(d,A){return bp(2048,8,d,A)}function g4(d,A){return bp(4,2,d,A)}function c4(d,A){return bp(4,4,d,A)}function u4(d,A){if(typeof A=="function")return d=d(),A(d),function(){A(null)};if(A!=null)return d=d(),A.current=d,function(){A.current=null}}function I4(d,A,y){return y=y!=null?y.concat([d]):null,bp(4,4,u4.bind(null,A,d),y)}function g1(){}function d4(d,A){var y=Fa();A=A===void 0?null:A;var S=y.memoizedState;return S!==null&&A!==null&&r1(A,S[1])?S[0]:(y.memoizedState=[d,A],d)}function A4(d,A){var y=Fa();A=A===void 0?null:A;var S=y.memoizedState;return S!==null&&A!==null&&r1(A,S[1])?S[0]:(d=d(),y.memoizedState=[d,A],d)}function sU(d,A){var y=qt;qt=y!==0&&4>y?y:4,d(!0);var S=fo.transition;fo.transition={};try{d(!1),A()}finally{qt=y,fo.transition=S}}function h4(){return Fa().memoizedState}function oU(d,A,y){var S=vg(d);y={lane:S,action:y,hasEagerState:!1,eagerState:null,next:null},C4(d)?f4(A,y):(p4(d,A,y),y=Ur(),d=po(d,S,y),d!==null&&m4(d,A,S))}function aU(d,A,y){var S=vg(d),Z={lane:S,action:y,hasEagerState:!1,eagerState:null,next:null};if(C4(d))f4(A,Z);else{p4(d,A,Z);var F=d.alternate;if(d.lanes===0&&(F===null||F.lanes===0)&&(F=A.lastRenderedReducer,F!==null))try{var ie=A.lastRenderedState,Ie=F(ie,y);if(Z.hasEagerState=!0,Z.eagerState=Ie,Fs(Ie,ie))return}catch{}finally{}y=Ur(),d=po(d,S,y),d!==null&&m4(d,A,S)}}function C4(d){var A=d.alternate;return d===ui||A!==null&&A===ui}function f4(d,A){ch=Cp=!0;var y=d.pending;y===null?A.next=A:(A.next=y.next,y.next=A),d.pending=A}function p4(d,A,y){Zi!==null&&d.mode&1&&!(jt&2)?(d=A.interleaved,d===null?(y.next=y,Vs===null?Vs=[A]:Vs.push(A)):(y.next=d.next,d.next=y),A.interleaved=y):(d=A.pending,d===null?y.next=y:(y.next=d.next,d.next=y),A.pending=y)}function m4(d,A,y){if(y&4194240){var S=A.lanes;S&=d.pendingLanes,y|=S,A.lanes=y,Na(d,y)}}var vp={readContext:Bi,useCallback:Gr,useContext:Gr,useEffect:Gr,useImperativeHandle:Gr,useInsertionEffect:Gr,useLayoutEffect:Gr,useMemo:Gr,useReducer:Gr,useRef:Gr,useState:Gr,useDebugValue:Gr,useDeferredValue:Gr,useTransition:Gr,useMutableSource:Gr,useSyncExternalStore:Gr,useId:Gr,unstable_isNewReconciler:!1},lU={readContext:Bi,useCallback:function(d,A){return Bl().memoizedState=[d,A===void 0?null:A],d},useContext:Bi,useEffect:l1,useImperativeHandle:function(d,A,y){return y=y!=null?y.concat([d]):null,mp(4194308,4,u4.bind(null,A,d),y)},useLayoutEffect:function(d,A){return mp(4194308,4,d,A)},useInsertionEffect:function(d,A){return mp(4,2,d,A)},useMemo:function(d,A){var y=Bl();return A=A===void 0?null:A,d=d(),y.memoizedState=[d,A],d},useReducer:function(d,A,y){var S=Bl();return A=y!==void 0?y(A):A,S.memoizedState=S.baseState=A,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:A},S.queue=d,d=d.dispatch=oU.bind(null,ui,d),[S.memoizedState,d]},useRef:function(d){var A=Bl();return d={current:d},A.memoizedState=d},useState:a1,useDebugValue:g1,useDeferredValue:function(d){var A=a1(d),y=A[0],S=A[1];return l1(function(){var Z=fo.transition;fo.transition={};try{S(d)}finally{fo.transition=Z}},[d]),y},useTransition:function(){var d=a1(!1),A=d[0];return d=sU.bind(null,d[1]),Bl().memoizedState=d,[A,d]},useMutableSource:function(){},useSyncExternalStore:function(d,A,y){var S=ui,Z=Bl();if(Jn){if(y===void 0)throw Error(o(407));y=y()}else{if(y=A(),Zi===null)throw Error(o(349));_I&30||r4(S,A,y)}Z.memoizedState=y;var F={value:y,getSnapshot:A};return Z.queue=F,l1(o4.bind(null,S,F,d),[d]),S.flags|=2048,Ih(9,s4.bind(null,S,F,y,A),void 0,null),y},useId:function(){var d=Bl(),A=Zi.identifierPrefix;if(Jn){var y=yl,S=vl;y=(S&~(1<<32-Ms(S)-1)).toString(32)+y,A=":"+A+"R"+y,y=uh++,0<y&&(A+="H"+y.toString(32)),A+=":"}else y=rU++,A=":"+A+"r"+y.toString(32)+":";return d.memoizedState=A},unstable_isNewReconciler:!1},gU={readContext:Bi,useCallback:d4,useContext:Bi,useEffect:dh,useImperativeHandle:I4,useInsertionEffect:g4,useLayoutEffect:c4,useMemo:A4,useReducer:fp,useRef:l4,useState:function(){return fp(Kc)},useDebugValue:g1,useDeferredValue:function(d){var A=fp(Kc),y=A[0],S=A[1];return dh(function(){var Z=fo.transition;fo.transition={};try{S(d)}finally{fo.transition=Z}},[d]),y},useTransition:function(){var d=fp(Kc)[0],A=Fa().memoizedState;return[d,A]},useMutableSource:n4,useSyncExternalStore:i4,useId:h4,unstable_isNewReconciler:!1},cU={readContext:Bi,useCallback:d4,useContext:Bi,useEffect:dh,useImperativeHandle:I4,useInsertionEffect:g4,useLayoutEffect:c4,useMemo:A4,useReducer:pp,useRef:l4,useState:function(){return pp(Kc)},useDebugValue:g1,useDeferredValue:function(d){var A=pp(Kc),y=A[0],S=A[1];return dh(function(){var Z=fo.transition;fo.transition={};try{S(d)}finally{fo.transition=Z}},[d]),y},useTransition:function(){var d=pp(Kc)[0],A=Fa().memoizedState;return[d,A]},useMutableSource:n4,useSyncExternalStore:i4,useId:h4,unstable_isNewReconciler:!1};function c1(d,A){try{var y="",S=A;do y+=_c(S),S=S.return;while(S);var Z=y}catch(F){Z=`
Error generating stack: `+F.message+`
`+F.stack}return{value:d,source:A,stack:Z}}function u1(d,A){try{console.error(A.value)}catch(y){setTimeout(function(){throw y})}}var uU=typeof WeakMap=="function"?WeakMap:Map;function b4(d,A,y){y=bl(-1,y),y.tag=3,y.payload={element:null};var S=A.value;return y.callback=function(){Lp||(Lp=!0,Z1=S),u1(d,A)},y}function v4(d,A,y){y=bl(-1,y),y.tag=3;var S=d.type.getDerivedStateFromError;if(typeof S=="function"){var Z=A.value;y.payload=function(){return S(Z)},y.callback=function(){u1(d,A)}}var F=d.stateNode;return F!==null&&typeof F.componentDidCatch=="function"&&(y.callback=function(){u1(d,A),typeof S!="function"&&(mg===null?mg=new Set([this]):mg.add(this));var ie=A.stack;this.componentDidCatch(A.value,{componentStack:ie!==null?ie:""})}),y}function y4(d,A,y){var S=d.pingCache;if(S===null){S=d.pingCache=new uU;var Z=new Set;S.set(A,Z)}else Z=S.get(A),Z===void 0&&(Z=new Set,S.set(A,Z));Z.has(y)||(Z.add(y),d=SU.bind(null,d,A,y),A.then(d,d))}function B4(d){do{var A;if((A=d.tag===13)&&(A=d.memoizedState,A=A!==null?A.dehydrated!==null:!0),A)return d;d=d.return}while(d!==null);return null}function G4(d,A,y,S,Z){return d.mode&1?(d.flags|=65536,d.lanes=Z,d):(d===A?d.flags|=65536:(d.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(A=bl(-1,1),A.tag=2,pg(y,A))),y.lanes|=1),d)}function Va(d){d.flags|=4}function S4(d,A){if(d!==null&&d.child===A.child)return!0;if(A.flags&16)return!1;for(d=A.child;d!==null;){if(d.flags&12854||d.subtreeFlags&12854)return!1;d=d.sibling}return!0}var Ah,hh,yp,Bp;if(oe)Ah=function(d,A){for(var y=A.child;y!==null;){if(y.tag===5||y.tag===6)X(d,y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===A)break;for(;y.sibling===null;){if(y.return===null||y.return===A)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},hh=function(){},yp=function(d,A,y,S,Z){if(d=d.memoizedProps,d!==S){var F=A.stateNode,ie=Ta(Co.current);y=re(F,y,d,S,Z,ie),(A.updateQueue=y)&&Va(A)}},Bp=function(d,A,y,S){y!==S&&Va(A)};else if(D){Ah=function(d,A,y,S){for(var Z=A.child;Z!==null;){if(Z.tag===5){var F=Z.stateNode;y&&S&&(F=zt(F,Z.type,Z.memoizedProps,Z)),X(d,F)}else if(Z.tag===6)F=Z.stateNode,y&&S&&(F=Ht(F,Z.memoizedProps,Z)),X(d,F);else if(Z.tag!==4){if(Z.tag===22&&Z.memoizedState!==null)F=Z.child,F!==null&&(F.return=Z),Ah(d,Z,!0,!0);else if(Z.child!==null){Z.child.return=Z,Z=Z.child;continue}}if(Z===A)break;for(;Z.sibling===null;){if(Z.return===null||Z.return===A)return;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}};var w4=function(d,A,y,S){for(var Z=A.child;Z!==null;){if(Z.tag===5){var F=Z.stateNode;y&&S&&(F=zt(F,Z.type,Z.memoizedProps,Z)),vt(d,F)}else if(Z.tag===6)F=Z.stateNode,y&&S&&(F=Ht(F,Z.memoizedProps,Z)),vt(d,F);else if(Z.tag!==4){if(Z.tag===22&&Z.memoizedState!==null)F=Z.child,F!==null&&(F.return=Z),w4(d,Z,!0,!0);else if(Z.child!==null){Z.child.return=Z,Z=Z.child;continue}}if(Z===A)break;for(;Z.sibling===null;){if(Z.return===null||Z.return===A)return;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}};hh=function(d,A){var y=A.stateNode;if(!S4(d,A)){d=y.containerInfo;var S=At(d);w4(S,A,!1,!1),y.pendingChildren=S,Va(A),Et(d,S)}},yp=function(d,A,y,S,Z){var F=d.stateNode,ie=d.memoizedProps;if((d=S4(d,A))&&ie===S)A.stateNode=F;else{var Ie=A.stateNode,Ve=Ta(Co.current),tt=null;ie!==S&&(tt=re(Ie,y,ie,S,Z,Ve)),d&&tt===null?A.stateNode=F:(F=qe(F,tt,y,ie,S,A,d,Ie),J(F,y,S,Z,Ve)&&Va(A),A.stateNode=F,d?Va(A):Ah(F,A,!1,!1))}},Bp=function(d,A,y,S){y!==S?(d=Ta(kI.current),y=Ta(Co.current),A.stateNode=le(S,d,y,A),Va(A)):A.stateNode=d.stateNode}}else hh=function(){},yp=function(){},Bp=function(){};function Ch(d,A){if(!Jn)switch(d.tailMode){case"hidden":A=d.tail;for(var y=null;A!==null;)A.alternate!==null&&(y=A),A=A.sibling;y===null?d.tail=null:y.sibling=null;break;case"collapsed":y=d.tail;for(var S=null;y!==null;)y.alternate!==null&&(S=y),y=y.sibling;S===null?A||d.tail===null?d.tail=null:d.tail.sibling=null:S.sibling=null}}function Sr(d){var A=d.alternate!==null&&d.alternate.child===d.child,y=0,S=0;if(A)for(var Z=d.child;Z!==null;)y|=Z.lanes|Z.childLanes,S|=Z.subtreeFlags&14680064,S|=Z.flags&14680064,Z.return=d,Z=Z.sibling;else for(Z=d.child;Z!==null;)y|=Z.lanes|Z.childLanes,S|=Z.subtreeFlags,S|=Z.flags,Z.return=d,Z=Z.sibling;return d.subtreeFlags|=S,d.childLanes=y,A}function IU(d,A,y){var S=A.pendingProps;switch(Jy(A),A.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sr(A),null;case 1:return Fn(A.type)&&Hr(),Sr(A),null;case 3:return S=A.stateNode,HI(),on(Qn),on(ci),i1(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(d===null||d.child===null)&&(oh(A)?Va(A):d===null||d.memoizedState.isDehydrated&&!(A.flags&256)||(A.flags|=1024,Uo!==null&&(N1(Uo),Uo=null))),hh(d,A),Sr(A),null;case 5:t1(A),y=Ta(kI.current);var Z=A.type;if(d!==null&&A.stateNode!=null)yp(d,A,Z,S,y),d.ref!==A.ref&&(A.flags|=512,A.flags|=2097152);else{if(!S){if(A.stateNode===null)throw Error(o(166));return Sr(A),null}if(d=Ta(Co.current),oh(A)){if(!fe)throw Error(o(175));d=kr(A.stateNode,A.type,A.memoizedProps,y,d,A,!sh),A.updateQueue=d,d!==null&&Va(A)}else{var F=M(Z,S,y,d,A);Ah(F,A,!1,!1),A.stateNode=F,J(F,Z,S,y,d)&&Va(A)}A.ref!==null&&(A.flags|=512,A.flags|=2097152)}return Sr(A),null;case 6:if(d&&A.stateNode!=null)Bp(d,A,d.memoizedProps,S);else{if(typeof S!="string"&&A.stateNode===null)throw Error(o(166));if(d=Ta(kI.current),y=Ta(Co.current),oh(A)){if(!fe)throw Error(o(176));if(d=A.stateNode,S=A.memoizedProps,(y=j(d,S,A,!sh))&&(Z=Ls,Z!==null))switch(F=(Z.mode&1)!==0,Z.tag){case 3:wt(Z.stateNode.containerInfo,d,S,F);break;case 5:_t(Z.type,Z.memoizedProps,Z.stateNode,d,S,F)}y&&Va(A)}else A.stateNode=le(S,d,y,A)}return Sr(A),null;case 13:if(on(ii),S=A.memoizedState,Jn&&ks!==null&&A.mode&1&&!(A.flags&128)){for(d=ks;d;)d=wn(d);return VI(),A.flags|=98560,A}if(S!==null&&S.dehydrated!==null){if(S=oh(A),d===null){if(!S)throw Error(o(318));if(!fe)throw Error(o(344));if(d=A.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(o(317));ve(d,A)}else VI(),!(A.flags&128)&&(A.memoizedState=null),A.flags|=4;return Sr(A),null}return Uo!==null&&(N1(Uo),Uo=null),A.flags&128?(A.lanes=y,A):(S=S!==null,y=!1,d===null?oh(A):y=d.memoizedState!==null,S&&!y&&(A.child.flags|=8192,A.mode&1&&(d===null||ii.current&1?Vi===0&&(Vi=3):T1())),A.updateQueue!==null&&(A.flags|=4),Sr(A),null);case 4:return HI(),hh(d,A),d===null&&pe(A.stateNode.containerInfo),Sr(A),null;case 10:return $i(A.type._context),Sr(A),null;case 17:return Fn(A.type)&&Hr(),Sr(A),null;case 19:if(on(ii),Z=A.memoizedState,Z===null)return Sr(A),null;if(S=(A.flags&128)!==0,F=Z.rendering,F===null)if(S)Ch(Z,!1);else{if(Vi!==0||d!==null&&d.flags&128)for(d=A.child;d!==null;){if(F=Ap(d),F!==null){for(A.flags|=128,Ch(Z,!1),d=F.updateQueue,d!==null&&(A.updateQueue=d,A.flags|=4),A.subtreeFlags=0,d=y,S=A.child;S!==null;)y=S,Z=d,y.flags&=14680066,F=y.alternate,F===null?(y.childLanes=0,y.lanes=Z,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=F.childLanes,y.lanes=F.lanes,y.child=F.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=F.memoizedProps,y.memoizedState=F.memoizedState,y.updateQueue=F.updateQueue,y.type=F.type,Z=F.dependencies,y.dependencies=Z===null?null:{lanes:Z.lanes,firstContext:Z.firstContext}),S=S.sibling;return Zt(ii,ii.current&1|2),A.child}d=d.sibling}Z.tail!==null&&ni()>x1&&(A.flags|=128,S=!0,Ch(Z,!1),A.lanes=4194304)}else{if(!S)if(d=Ap(F),d!==null){if(A.flags|=128,S=!0,d=d.updateQueue,d!==null&&(A.updateQueue=d,A.flags|=4),Ch(Z,!0),Z.tail===null&&Z.tailMode==="hidden"&&!F.alternate&&!Jn)return Sr(A),null}else 2*ni()-Z.renderingStartTime>x1&&y!==1073741824&&(A.flags|=128,S=!0,Ch(Z,!1),A.lanes=4194304);Z.isBackwards?(F.sibling=A.child,A.child=F):(d=Z.last,d!==null?d.sibling=F:A.child=F,Z.last=F)}return Z.tail!==null?(A=Z.tail,Z.rendering=A,Z.tail=A.sibling,Z.renderingStartTime=ni(),A.sibling=null,d=ii.current,Zt(ii,S?d&1|2:d&1),A):(Sr(A),null);case 22:case 23:return M1(),S=A.memoizedState!==null,d!==null&&d.memoizedState!==null!==S&&(A.flags|=8192),S&&A.mode&1?_s&1073741824&&(Sr(A),oe&&A.subtreeFlags&6&&(A.flags|=8192)):Sr(A),null;case 24:return null;case 25:return null}throw Error(o(156,A.tag))}var dU=a.ReactCurrentOwner,Hs=!1;function zr(d,A,y,S){A.child=d===null?e4(A,null,y,S):LI(A,d.child,y,S)}function R4(d,A,y,S,Z){y=y.render;var F=A.ref;return yi(A,Z),S=s1(d,A,y,S,F,Z),y=o1(),d!==null&&!Hs?(A.updateQueue=d.updateQueue,A.flags&=-2053,d.lanes&=~Z,Gl(d,A,Z)):(Jn&&y&&Qy(A),A.flags|=1,zr(d,A,S,Z),A.child)}function x4(d,A,y,S,Z){if(d===null){var F=y.type;return typeof F=="function"&&!F1(F)&&F.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(A.tag=15,A.type=F,Z4(d,A,F,S,Z)):(d=zp(y.type,null,S,A,A.mode,Z),d.ref=A.ref,d.return=A,A.child=d)}if(F=d.child,!(d.lanes&Z)){var ie=F.memoizedProps;if(y=y.compare,y=y!==null?y:Hc,y(ie,S)&&d.ref===A.ref)return Gl(d,A,Z)}return A.flags|=1,d=Bg(F,S),d.ref=A.ref,d.return=A,A.child=d}function Z4(d,A,y,S,Z){if(d!==null&&Hc(d.memoizedProps,S)&&d.ref===A.ref)if(Hs=!1,(d.lanes&Z)!==0)d.flags&131072&&(Hs=!0);else return A.lanes=d.lanes,Gl(d,A,Z);return I1(d,A,y,S,Z)}function E4(d,A,y){var S=A.pendingProps,Z=S.children,F=d!==null?d.memoizedState:null;if(S.mode==="hidden")if(!(A.mode&1))A.memoizedState={baseLanes:0,cachePool:null},Zt(XI,_s),_s|=y;else if(y&1073741824)A.memoizedState={baseLanes:0,cachePool:null},S=F!==null?F.baseLanes:y,Zt(XI,_s),_s|=S;else return d=F!==null?F.baseLanes|y:y,A.lanes=A.childLanes=1073741824,A.memoizedState={baseLanes:d,cachePool:null},A.updateQueue=null,Zt(XI,_s),_s|=d,null;else F!==null?(S=F.baseLanes|y,A.memoizedState=null):S=y,Zt(XI,_s),_s|=S;return zr(d,A,Z,y),A.child}function W4(d,A){var y=A.ref;(d===null&&y!==null||d!==null&&d.ref!==y)&&(A.flags|=512,A.flags|=2097152)}function I1(d,A,y,S,Z){var F=Fn(y)?ls:ci.current;return F=yn(A,F),yi(A,Z),y=s1(d,A,y,S,F,Z),S=o1(),d!==null&&!Hs?(A.updateQueue=d.updateQueue,A.flags&=-2053,d.lanes&=~Z,Gl(d,A,Z)):(Jn&&S&&Qy(A),A.flags|=1,zr(d,A,y,Z),A.child)}function N4(d,A,y,S,Z){if(Fn(y)){var F=!0;Ea(A)}else F=!1;if(yi(A,Z),A.stateNode===null)d!==null&&(d.alternate=null,A.alternate=null,A.flags|=2),DZ(A,y,S),Oy(A,y,S,Z),S=!0;else if(d===null){var ie=A.stateNode,Ie=A.memoizedProps;ie.props=Ie;var Ve=ie.context,tt=y.contextType;typeof tt=="object"&&tt!==null?tt=Bi(tt):(tt=Fn(y)?ls:ci.current,tt=yn(A,tt));var gt=y.getDerivedStateFromProps,Xt=typeof gt=="function"||typeof ie.getSnapshotBeforeUpdate=="function";Xt||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(Ie!==S||Ve!==tt)&&PZ(A,ie,S,tt),fg=!1;var St=A.memoizedState;ie.state=St,gp(A,S,ie,Z),Ve=A.memoizedState,Ie!==S||St!==Ve||Qn.current||fg?(typeof gt=="function"&&(Py(A,y,gt,S),Ve=A.memoizedState),(Ie=fg||UZ(A,y,Ie,S,St,Ve,tt))?(Xt||typeof ie.UNSAFE_componentWillMount!="function"&&typeof ie.componentWillMount!="function"||(typeof ie.componentWillMount=="function"&&ie.componentWillMount(),typeof ie.UNSAFE_componentWillMount=="function"&&ie.UNSAFE_componentWillMount()),typeof ie.componentDidMount=="function"&&(A.flags|=4194308)):(typeof ie.componentDidMount=="function"&&(A.flags|=4194308),A.memoizedProps=S,A.memoizedState=Ve),ie.props=S,ie.state=Ve,ie.context=tt,S=Ie):(typeof ie.componentDidMount=="function"&&(A.flags|=4194308),S=!1)}else{ie=A.stateNode,XZ(d,A),Ie=A.memoizedProps,tt=A.type===A.elementType?Ie:Yr(A.type,Ie),ie.props=tt,Xt=A.pendingProps,St=ie.context,Ve=y.contextType,typeof Ve=="object"&&Ve!==null?Ve=Bi(Ve):(Ve=Fn(y)?ls:ci.current,Ve=yn(A,Ve));var Rn=y.getDerivedStateFromProps;(gt=typeof Rn=="function"||typeof ie.getSnapshotBeforeUpdate=="function")||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(Ie!==Xt||St!==Ve)&&PZ(A,ie,S,Ve),fg=!1,St=A.memoizedState,ie.state=St,gp(A,S,ie,Z);var pt=A.memoizedState;Ie!==Xt||St!==pt||Qn.current||fg?(typeof Rn=="function"&&(Py(A,y,Rn,S),pt=A.memoizedState),(tt=fg||UZ(A,y,tt,S,St,pt,Ve)||!1)?(gt||typeof ie.UNSAFE_componentWillUpdate!="function"&&typeof ie.componentWillUpdate!="function"||(typeof ie.componentWillUpdate=="function"&&ie.componentWillUpdate(S,pt,Ve),typeof ie.UNSAFE_componentWillUpdate=="function"&&ie.UNSAFE_componentWillUpdate(S,pt,Ve)),typeof ie.componentDidUpdate=="function"&&(A.flags|=4),typeof ie.getSnapshotBeforeUpdate=="function"&&(A.flags|=1024)):(typeof ie.componentDidUpdate!="function"||Ie===d.memoizedProps&&St===d.memoizedState||(A.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||Ie===d.memoizedProps&&St===d.memoizedState||(A.flags|=1024),A.memoizedProps=S,A.memoizedState=pt),ie.props=S,ie.state=pt,ie.context=Ve,S=tt):(typeof ie.componentDidUpdate!="function"||Ie===d.memoizedProps&&St===d.memoizedState||(A.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||Ie===d.memoizedProps&&St===d.memoizedState||(A.flags|=1024),S=!1)}return d1(d,A,y,S,F,Z)}function d1(d,A,y,S,Z,F){W4(d,A);var ie=(A.flags&128)!==0;if(!S&&!ie)return Z&&yr(A,y,!1),Gl(d,A,F);S=A.stateNode,dU.current=A;var Ie=ie&&typeof y.getDerivedStateFromError!="function"?null:S.render();return A.flags|=1,d!==null&&ie?(A.child=LI(A,d.child,null,F),A.child=LI(A,null,Ie,F)):zr(d,A,Ie,F),A.memoizedState=S.state,Z&&yr(A,y,!0),A.child}function M4(d){var A=d.stateNode;A.pendingContext?xi(d,A.pendingContext,A.pendingContext!==A.context):A.context&&xi(d,A.context,!1),e1(d,A.containerInfo)}function T4(d,A,y,S,Z){return VI(),$y(Z),A.flags|=256,zr(d,A,y,S),A.child}var Gp={dehydrated:null,treeContext:null,retryLane:0};function Sp(d){return{baseLanes:d,cachePool:null}}function F4(d,A,y){var S=A.pendingProps,Z=ii.current,F=!1,ie=(A.flags&128)!==0,Ie;if((Ie=ie)||(Ie=d!==null&&d.memoizedState===null?!1:(Z&2)!==0),Ie?(F=!0,A.flags&=-129):(d===null||d.memoizedState!==null)&&(Z|=1),Zt(ii,Z&1),d===null)return qy(A),d=A.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?(A.mode&1?Tn(d)?A.lanes=8:A.lanes=1073741824:A.lanes=1,null):(Z=S.children,d=S.fallback,F?(S=A.mode,F=A.child,Z={mode:"hidden",children:Z},!(S&1)&&F!==null?(F.childLanes=0,F.pendingProps=Z):F=Up(Z,S,0,null),d=Qc(d,S,y,null),F.return=A,d.return=A,F.sibling=d,A.child=F,A.child.memoizedState=Sp(y),A.memoizedState=Gp,d):A1(A,Z));if(Z=d.memoizedState,Z!==null){if(Ie=Z.dehydrated,Ie!==null){if(ie)return A.flags&256?(A.flags&=-257,wp(d,A,y,Error(o(422)))):A.memoizedState!==null?(A.child=d.child,A.flags|=128,null):(F=S.fallback,Z=A.mode,S=Up({mode:"visible",children:S.children},Z,0,null),F=Qc(F,Z,y,null),F.flags|=2,S.return=A,F.return=A,S.sibling=F,A.child=S,A.mode&1&&LI(A,d.child,null,y),A.child.memoizedState=Sp(y),A.memoizedState=Gp,F);if(!(A.mode&1))A=wp(d,A,y,null);else if(Tn(Ie))A=wp(d,A,y,Error(o(419)));else if(S=(y&d.childLanes)!==0,Hs||S){if(S=Zi,S!==null){switch(y&-y){case 4:F=2;break;case 16:F=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:F=32;break;case 536870912:F=268435456;break;default:F=0}S=F&(S.suspendedLanes|y)?0:F,S!==0&&S!==Z.retryLane&&(Z.retryLane=S,po(d,S,-1))}T1(),A=wp(d,A,y,Error(o(421)))}else In(Ie)?(A.flags|=128,A.child=d.child,A=wU.bind(null,d),ur(Ie,A),A=null):(y=Z.treeContext,fe&&(ks=uo(Ie),Ls=A,Jn=!0,Uo=null,sh=!1,y!==null&&(Ao[ho++]=vl,Ao[ho++]=yl,Ao[ho++]=Xc,vl=y.id,yl=y.overflow,Xc=A)),A=A1(A,A.pendingProps.children),A.flags|=4096);return A}return F?(S=L4(d,A,S.children,S.fallback,y),F=A.child,Z=d.child.memoizedState,F.memoizedState=Z===null?Sp(y):{baseLanes:Z.baseLanes|y,cachePool:null},F.childLanes=d.childLanes&~y,A.memoizedState=Gp,S):(y=V4(d,A,S.children,y),A.memoizedState=null,y)}return F?(S=L4(d,A,S.children,S.fallback,y),F=A.child,Z=d.child.memoizedState,F.memoizedState=Z===null?Sp(y):{baseLanes:Z.baseLanes|y,cachePool:null},F.childLanes=d.childLanes&~y,A.memoizedState=Gp,S):(y=V4(d,A,S.children,y),A.memoizedState=null,y)}function A1(d,A){return A=Up({mode:"visible",children:A},d.mode,0,null),A.return=d,d.child=A}function V4(d,A,y,S){var Z=d.child;return d=Z.sibling,y=Bg(Z,{mode:"visible",children:y}),!(A.mode&1)&&(y.lanes=S),y.return=A,y.sibling=null,d!==null&&(S=A.deletions,S===null?(A.deletions=[d],A.flags|=16):S.push(d)),A.child=y}function L4(d,A,y,S,Z){var F=A.mode;d=d.child;var ie=d.sibling,Ie={mode:"hidden",children:y};return!(F&1)&&A.child!==d?(y=A.child,y.childLanes=0,y.pendingProps=Ie,A.deletions=null):(y=Bg(d,Ie),y.subtreeFlags=d.subtreeFlags&14680064),ie!==null?S=Bg(ie,S):(S=Qc(S,F,Z,null),S.flags|=2),S.return=A,y.return=A,y.sibling=S,A.child=y,S}function wp(d,A,y,S){return S!==null&&$y(S),LI(A,d.child,null,y),d=A1(A,A.pendingProps.children),d.flags|=2,A.memoizedState=null,d}function k4(d,A,y){d.lanes|=A;var S=d.alternate;S!==null&&(S.lanes|=A),Kr(d.return,A,y)}function h1(d,A,y,S,Z){var F=d.memoizedState;F===null?d.memoizedState={isBackwards:A,rendering:null,renderingStartTime:0,last:S,tail:y,tailMode:Z}:(F.isBackwards=A,F.rendering=null,F.renderingStartTime=0,F.last=S,F.tail=y,F.tailMode=Z)}function H4(d,A,y){var S=A.pendingProps,Z=S.revealOrder,F=S.tail;if(zr(d,A,S.children,y),S=ii.current,S&2)S=S&1|2,A.flags|=128;else{if(d!==null&&d.flags&128)e:for(d=A.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&k4(d,y,A);else if(d.tag===19)k4(d,y,A);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===A)break e;for(;d.sibling===null;){if(d.return===null||d.return===A)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}S&=1}if(Zt(ii,S),!(A.mode&1))A.memoizedState=null;else switch(Z){case"forwards":for(y=A.child,Z=null;y!==null;)d=y.alternate,d!==null&&Ap(d)===null&&(Z=y),y=y.sibling;y=Z,y===null?(Z=A.child,A.child=null):(Z=y.sibling,y.sibling=null),h1(A,!1,Z,y,F);break;case"backwards":for(y=null,Z=A.child,A.child=null;Z!==null;){if(d=Z.alternate,d!==null&&Ap(d)===null){A.child=Z;break}d=Z.sibling,Z.sibling=y,y=Z,Z=d}h1(A,!0,y,null,F);break;case"together":h1(A,!1,null,null,void 0);break;default:A.memoizedState=null}return A.child}function Gl(d,A,y){if(d!==null&&(A.dependencies=d.dependencies),YI|=A.lanes,!(y&A.childLanes))return null;if(d!==null&&A.child!==d.child)throw Error(o(153));if(A.child!==null){for(d=A.child,y=Bg(d,d.pendingProps),A.child=y,y.return=A;d.sibling!==null;)d=d.sibling,y=y.sibling=Bg(d,d.pendingProps),y.return=A;y.sibling=null}return A.child}function AU(d,A,y){switch(A.tag){case 3:M4(A),VI();break;case 5:t4(A);break;case 1:Fn(A.type)&&Ea(A);break;case 4:e1(A,A.stateNode.containerInfo);break;case 10:ap(A,A.type._context,A.memoizedProps.value);break;case 13:var S=A.memoizedState;if(S!==null)return S.dehydrated!==null?(Zt(ii,ii.current&1),A.flags|=128,null):y&A.child.childLanes?F4(d,A,y):(Zt(ii,ii.current&1),d=Gl(d,A,y),d!==null?d.sibling:null);Zt(ii,ii.current&1);break;case 19:if(S=(y&A.childLanes)!==0,d.flags&128){if(S)return H4(d,A,y);A.flags|=128}var Z=A.memoizedState;if(Z!==null&&(Z.rendering=null,Z.tail=null,Z.lastEffect=null),Zt(ii,ii.current),S)break;return null;case 22:case 23:return A.lanes=0,E4(d,A,y)}return Gl(d,A,y)}function hU(d,A){switch(Jy(A),A.tag){case 1:return Fn(A.type)&&Hr(),d=A.flags,d&65536?(A.flags=d&-65537|128,A):null;case 3:return HI(),on(Qn),on(ci),i1(),d=A.flags,d&65536&&!(d&128)?(A.flags=d&-65537|128,A):null;case 5:return t1(A),null;case 13:if(on(ii),d=A.memoizedState,d!==null&&d.dehydrated!==null){if(A.alternate===null)throw Error(o(340));VI()}return d=A.flags,d&65536?(A.flags=d&-65537|128,A):null;case 19:return on(ii),null;case 4:return HI(),null;case 10:return $i(A.type._context),null;case 22:case 23:return M1(),null;case 24:return null;default:return null}}var Rp=!1,zc=!1,CU=typeof WeakSet=="function"?WeakSet:Set,st=null;function xp(d,A){var y=d.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(S){Is(d,A,S)}else y.current=null}function C1(d,A,y){try{y()}catch(S){Is(d,A,S)}}var _4=!1;function fU(d,A){for(L(d.containerInfo),st=A;st!==null;)if(d=st,A=d.child,(d.subtreeFlags&1028)!==0&&A!==null)A.return=d,st=A;else for(;st!==null;){d=st;try{var y=d.alternate;if(d.flags&1024)switch(d.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var S=y.memoizedProps,Z=y.memoizedState,F=d.stateNode,ie=F.getSnapshotBeforeUpdate(d.elementType===d.type?S:Yr(d.type,S),Z);F.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:oe&&_e(d.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Ie){Is(d,d.return,Ie)}if(A=d.sibling,A!==null){A.return=d.return,st=A;break}st=d.return}return y=_4,_4=!1,y}function Uc(d,A,y){var S=A.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var Z=S=S.next;do{if((Z.tag&d)===d){var F=Z.destroy;Z.destroy=void 0,F!==void 0&&C1(A,y,F)}Z=Z.next}while(Z!==S)}}function fh(d,A){if(A=A.updateQueue,A=A!==null?A.lastEffect:null,A!==null){var y=A=A.next;do{if((y.tag&d)===d){var S=y.create;y.destroy=S()}y=y.next}while(y!==A)}}function f1(d){var A=d.ref;if(A!==null){var y=d.stateNode;switch(d.tag){case 5:d=Y(y);break;default:d=y}typeof A=="function"?A(d):A.current=d}}function X4(d,A,y){if(Ts&&typeof Ts.onCommitFiberUnmount=="function")try{Ts.onCommitFiberUnmount(Lc,A)}catch{}switch(A.tag){case 0:case 11:case 14:case 15:if(d=A.updateQueue,d!==null&&(d=d.lastEffect,d!==null)){var S=d=d.next;do{var Z=S,F=Z.destroy;Z=Z.tag,F!==void 0&&(Z&2||Z&4)&&C1(A,y,F),S=S.next}while(S!==d)}break;case 1:if(xp(A,y),d=A.stateNode,typeof d.componentWillUnmount=="function")try{d.props=A.memoizedProps,d.state=A.memoizedState,d.componentWillUnmount()}catch(ie){Is(A,y,ie)}break;case 5:xp(A,y);break;case 4:oe?P4(d,A,y):D&&D&&(A=A.stateNode.containerInfo,y=At(A),Kt(A,y))}}function Y4(d,A,y){for(var S=A;;)if(X4(d,S,y),S.child===null||oe&&S.tag===4){if(S===A)break;for(;S.sibling===null;){if(S.return===null||S.return===A)return;S=S.return}S.sibling.return=S.return,S=S.sibling}else S.child.return=S,S=S.child}function K4(d){var A=d.alternate;A!==null&&(d.alternate=null,K4(A)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(A=d.stateNode,A!==null&&Ue(A)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function z4(d){return d.tag===5||d.tag===3||d.tag===4}function U4(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||z4(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function D4(d){if(oe){e:{for(var A=d.return;A!==null;){if(z4(A))break e;A=A.return}throw Error(o(160))}var y=A;switch(y.tag){case 5:A=y.stateNode,y.flags&32&&(Se(A),y.flags&=-33),y=U4(d),m1(d,y,A);break;case 3:case 4:A=y.stateNode.containerInfo,y=U4(d),p1(d,y,A);break;default:throw Error(o(161))}}}function p1(d,A,y){var S=d.tag;if(S===5||S===6)d=d.stateNode,A?Pe(y,d,A):Je(y,d);else if(S!==4&&(d=d.child,d!==null))for(p1(d,A,y),d=d.sibling;d!==null;)p1(d,A,y),d=d.sibling}function m1(d,A,y){var S=d.tag;if(S===5||S===6)d=d.stateNode,A?je(y,d,A):Ze(y,d);else if(S!==4&&(d=d.child,d!==null))for(m1(d,A,y),d=d.sibling;d!==null;)m1(d,A,y),d=d.sibling}function P4(d,A,y){for(var S=A,Z=!1,F,ie;;){if(!Z){Z=S.return;e:for(;;){if(Z===null)throw Error(o(160));switch(F=Z.stateNode,Z.tag){case 5:ie=!1;break e;case 3:F=F.containerInfo,ie=!0;break e;case 4:F=F.containerInfo,ie=!0;break e}Z=Z.return}Z=!0}if(S.tag===5||S.tag===6)Y4(d,S,y),ie?$(F,S.stateNode):ke(F,S.stateNode);else if(S.tag===18)ie?bt(F,S.stateNode):at(F,S.stateNode);else if(S.tag===4){if(S.child!==null){F=S.stateNode.containerInfo,ie=!0,S.child.return=S,S=S.child;continue}}else if(X4(d,S,y),S.child!==null){S.child.return=S,S=S.child;continue}if(S===A)break;for(;S.sibling===null;){if(S.return===null||S.return===A)return;S=S.return,S.tag===4&&(Z=!1)}S.sibling.return=S.return,S=S.sibling}}function b1(d,A){if(oe){switch(A.tag){case 0:case 11:case 14:case 15:Uc(3,A,A.return),fh(3,A),Uc(5,A,A.return);return;case 1:return;case 5:var y=A.stateNode;if(y!=null){var S=A.memoizedProps;d=d!==null?d.memoizedProps:S;var Z=A.type,F=A.updateQueue;A.updateQueue=null,F!==null&&ze(y,F,Z,d,S,A)}return;case 6:if(A.stateNode===null)throw Error(o(162));y=A.memoizedProps,Ye(A.stateNode,d!==null?d.memoizedProps:y,y);return;case 3:fe&&d!==null&&d.memoizedState.isDehydrated&&ye(A.stateNode.containerInfo);return;case 12:return;case 13:Zp(A);return;case 19:Zp(A);return;case 17:return}throw Error(o(163))}switch(A.tag){case 0:case 11:case 14:case 15:Uc(3,A,A.return),fh(3,A),Uc(5,A,A.return);return;case 12:return;case 13:Zp(A);return;case 19:Zp(A);return;case 3:fe&&d!==null&&d.memoizedState.isDehydrated&&ye(A.stateNode.containerInfo);break;case 22:case 23:return}e:if(D){switch(A.tag){case 1:case 5:case 6:break e;case 3:case 4:A=A.stateNode,Kt(A.containerInfo,A.pendingChildren);break e}throw Error(o(163))}}function Zp(d){var A=d.updateQueue;if(A!==null){d.updateQueue=null;var y=d.stateNode;y===null&&(y=d.stateNode=new CU),A.forEach(function(S){var Z=RU.bind(null,d,S);y.has(S)||(y.add(S),S.then(Z,Z))})}}function pU(d,A){for(st=A;st!==null;){A=st;var y=A.deletions;if(y!==null)for(var S=0;S<y.length;S++){var Z=y[S];try{var F=d;oe?P4(F,Z,A):Y4(F,Z,A);var ie=Z.alternate;ie!==null&&(ie.return=null),Z.return=null}catch(ht){Is(Z,A,ht)}}if(y=A.child,A.subtreeFlags&12854&&y!==null)y.return=A,st=y;else for(;st!==null;){A=st;try{var Ie=A.flags;if(Ie&32&&oe&&Se(A.stateNode),Ie&512){var Ve=A.alternate;if(Ve!==null){var tt=Ve.ref;tt!==null&&(typeof tt=="function"?tt(null):tt.current=null)}}if(Ie&8192)switch(A.tag){case 13:if(A.memoizedState!==null){var gt=A.alternate;(gt===null||gt.memoizedState===null)&&(R1=ni())}break;case 22:var Xt=A.memoizedState!==null,St=A.alternate,Rn=St!==null&&St.memoizedState!==null;if(y=A,oe){e:if(S=y,Z=Xt,F=null,oe)for(var pt=S;;){if(pt.tag===5){if(F===null){F=pt;var wr=pt.stateNode;Z?Ke(wr):He(pt.stateNode,pt.memoizedProps)}}else if(pt.tag===6){if(F===null){var bo=pt.stateNode;Z?q(bo):ue(bo,pt.memoizedProps)}}else if((pt.tag!==22&&pt.tag!==23||pt.memoizedState===null||pt===S)&&pt.child!==null){pt.child.return=pt,pt=pt.child;continue}if(pt===S)break;for(;pt.sibling===null;){if(pt.return===null||pt.return===S)break e;F===pt&&(F=null),pt=pt.return}F===pt&&(F=null),pt.sibling.return=pt.return,pt=pt.sibling}}if(Xt&&!Rn&&y.mode&1){st=y;for(var Ge=y.child;Ge!==null;){for(y=st=Ge;st!==null;){S=st;var he=S.child;switch(S.tag){case 0:case 11:case 14:case 15:Uc(4,S,S.return);break;case 1:xp(S,S.return);var We=S.stateNode;if(typeof We.componentWillUnmount=="function"){var ot=S.return;try{We.props=S.memoizedProps,We.state=S.memoizedState,We.componentWillUnmount()}catch(ht){Is(S,ot,ht)}}break;case 5:xp(S,S.return);break;case 22:if(S.memoizedState!==null){J4(y);continue}}he!==null?(he.return=S,st=he):J4(y)}Ge=Ge.sibling}}}switch(Ie&4102){case 2:D4(A),A.flags&=-3;break;case 6:D4(A),A.flags&=-3,b1(A.alternate,A);break;case 4096:A.flags&=-4097;break;case 4100:A.flags&=-4097,b1(A.alternate,A);break;case 4:b1(A.alternate,A)}}catch(ht){Is(A,A.return,ht)}if(y=A.sibling,y!==null){y.return=A.return,st=y;break}st=A.return}}}function mU(d,A,y){st=d,O4(d)}function O4(d,A,y){for(var S=(d.mode&1)!==0;st!==null;){var Z=st,F=Z.child;if(Z.tag===22&&S){var ie=Z.memoizedState!==null||Rp;if(!ie){var Ie=Z.alternate,Ve=Ie!==null&&Ie.memoizedState!==null||zc;Ie=Rp;var tt=zc;if(Rp=ie,(zc=Ve)&&!tt)for(st=Z;st!==null;)ie=st,Ve=ie.child,ie.tag===22&&ie.memoizedState!==null?j4(Z):Ve!==null?(Ve.return=ie,st=Ve):j4(Z);for(;F!==null;)st=F,O4(F),F=F.sibling;st=Z,Rp=Ie,zc=tt}Q4(d)}else Z.subtreeFlags&8772&&F!==null?(F.return=Z,st=F):Q4(d)}}function Q4(d){for(;st!==null;){var A=st;if(A.flags&8772){var y=A.alternate;try{if(A.flags&8772)switch(A.tag){case 0:case 11:case 15:zc||fh(5,A);break;case 1:var S=A.stateNode;if(A.flags&4&&!zc)if(y===null)S.componentDidMount();else{var Z=A.elementType===A.type?y.memoizedProps:Yr(A.type,y.memoizedProps);S.componentDidUpdate(Z,y.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var F=A.updateQueue;F!==null&&KZ(A,F,S);break;case 3:var ie=A.updateQueue;if(ie!==null){if(y=null,A.child!==null)switch(A.child.tag){case 5:y=Y(A.child.stateNode);break;case 1:y=A.child.stateNode}KZ(A,ie,y)}break;case 5:var Ie=A.stateNode;y===null&&A.flags&4&&de(Ie,A.type,A.memoizedProps,A);break;case 6:break;case 4:break;case 12:break;case 13:if(fe&&A.memoizedState===null){var Ve=A.alternate;if(Ve!==null){var tt=Ve.memoizedState;if(tt!==null){var gt=tt.dehydrated;gt!==null&&Me(gt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}zc||A.flags&512&&f1(A)}catch(Xt){Is(A,A.return,Xt)}}if(A===d){st=null;break}if(y=A.sibling,y!==null){y.return=A.return,st=y;break}st=A.return}}function J4(d){for(;st!==null;){var A=st;if(A===d){st=null;break}var y=A.sibling;if(y!==null){y.return=A.return,st=y;break}st=A.return}}function j4(d){for(;st!==null;){var A=st;try{switch(A.tag){case 0:case 11:case 15:var y=A.return;try{fh(4,A)}catch(Ve){Is(A,y,Ve)}break;case 1:var S=A.stateNode;if(typeof S.componentDidMount=="function"){var Z=A.return;try{S.componentDidMount()}catch(Ve){Is(A,Z,Ve)}}var F=A.return;try{f1(A)}catch(Ve){Is(A,F,Ve)}break;case 5:var ie=A.return;try{f1(A)}catch(Ve){Is(A,ie,Ve)}}}catch(Ve){Is(A,A.return,Ve)}if(A===d){st=null;break}var Ie=A.sibling;if(Ie!==null){Ie.return=A.return,st=Ie;break}st=A.return}}var Ep=0,Wp=1,Np=2,Mp=3,Tp=4;if(typeof Symbol=="function"&&Symbol.for){var ph=Symbol.for;Ep=ph("selector.component"),Wp=ph("selector.has_pseudo_class"),Np=ph("selector.role"),Mp=ph("selector.test_id"),Tp=ph("selector.text")}function v1(d){var A=Ce(d);if(A!=null){if(typeof A.memoizedProps["data-testname"]!="string")throw Error(o(364));return A}if(d=Ae(d),d===null)throw Error(o(362));return d.stateNode.current}function y1(d,A){switch(A.$$typeof){case Ep:if(d.type===A.value)return!0;break;case Wp:e:{A=A.value,d=[d,0];for(var y=0;y<d.length;){var S=d[y++],Z=d[y++],F=A[Z];if(S.tag!==5||!K(S)){for(;F!=null&&y1(S,F);)Z++,F=A[Z];if(Z===A.length){A=!0;break e}else for(S=S.child;S!==null;)d.push(S,Z),S=S.sibling}}A=!1}return A;case Np:if(d.tag===5&&ge(d.stateNode,A.value))return!0;break;case Tp:if((d.tag===5||d.tag===6)&&(d=Q(d),d!==null&&0<=d.indexOf(A.value)))return!0;break;case Mp:if(d.tag===5&&(d=d.memoizedProps["data-testname"],typeof d=="string"&&d.toLowerCase()===A.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function B1(d){switch(d.$$typeof){case Ep:return"<"+(w(d.value)||"Unknown")+">";case Wp:return":has("+(B1(d)||"")+")";case Np:return'[role="'+d.value+'"]';case Tp:return'"'+d.value+'"';case Mp:return'[data-testname="'+d.value+'"]';default:throw Error(o(365))}}function q4(d,A){var y=[];d=[d,0];for(var S=0;S<d.length;){var Z=d[S++],F=d[S++],ie=A[F];if(Z.tag!==5||!K(Z)){for(;ie!=null&&y1(Z,ie);)F++,ie=A[F];if(F===A.length)y.push(Z);else for(Z=Z.child;Z!==null;)d.push(Z,F),Z=Z.sibling}}return y}function G1(d,A){if(!Be)throw Error(o(363));d=v1(d),d=q4(d,A),A=[],d=Array.from(d);for(var y=0;y<d.length;){var S=d[y++];if(S.tag===5)K(S)||A.push(S.stateNode);else for(S=S.child;S!==null;)d.push(S),S=S.sibling}return A}var bU=Math.ceil,Fp=a.ReactCurrentDispatcher,S1=a.ReactCurrentOwner,Gi=a.ReactCurrentBatchConfig,jt=0,Zi=null,Ei=null,Ir=0,_s=0,XI=xt(0),Vi=0,mh=null,YI=0,Vp=0,w1=0,bh=null,cs=null,R1=0,x1=1/0;function KI(){x1=ni()+500}var Lp=!1,Z1=null,mg=null,kp=!1,bg=null,Hp=0,vh=0,E1=null,_p=-1,Xp=0;function Ur(){return jt&6?ni():_p!==-1?_p:_p=ni()}function vg(d){return d.mode&1?jt&2&&Ir!==0?Ir&-Ir:kc.transition!==null?(Xp===0&&(d=hl,hl<<=1,!(hl&4194240)&&(hl=64),Xp=d),Xp):(d=qt,d!==0?d:be()):1}function po(d,A,y){if(50<vh)throw vh=0,E1=null,Error(o(185));var S=Yp(d,A);return S===null?null:(Wa(S,A,y),(!(jt&2)||S!==Zi)&&(S===Zi&&(!(jt&2)&&(Vp|=A),Vi===4&&yg(S,Ir)),us(S,y),A===1&&jt===0&&!(d.mode&1)&&(KI(),Ma&&gs())),S)}function Yp(d,A){d.lanes|=A;var y=d.alternate;for(y!==null&&(y.lanes|=A),y=d,d=d.return;d!==null;)d.childLanes|=A,y=d.alternate,y!==null&&(y.childLanes|=A),y=d,d=d.return;return y.tag===3?y.stateNode:null}function us(d,A){var y=d.callbackNode;qA(d,A);var S=Fc(d,d===Zi?Ir:0);if(S===0)y!==null&&WI(y),d.callbackNode=null,d.callbackPriority=0;else if(A=S&-S,d.callbackPriority!==A){if(y!=null&&WI(y),A===1)d.tag===0?rh(eE.bind(null,d)):ih(eE.bind(null,d)),me?we(function(){jt===0&&gs()}):ml(Vc,gs),y=null;else{switch($A(S)){case 1:y=Vc;break;case 4:y=sp;break;case 16:y=_r;break;case 536870912:y=th;break;default:y=_r}y=gE(y,$4.bind(null,d))}d.callbackPriority=A,d.callbackNode=y}}function $4(d,A){if(_p=-1,Xp=0,jt&6)throw Error(o(327));var y=d.callbackNode;if(Oc()&&d.callbackNode!==y)return null;var S=Fc(d,d===Zi?Ir:0);if(S===0)return null;if(S&30||S&d.expiredLanes||A)A=Kp(d,S);else{A=S;var Z=jt;jt|=2;var F=iE();(Zi!==d||Ir!==A)&&(KI(),Dc(d,A));do try{BU();break}catch(Ie){nE(d,Ie)}while(1);MI(),Fp.current=F,jt=Z,Ei!==null?A=0:(Zi=null,Ir=0,A=Vi)}if(A!==0){if(A===2&&(Z=pl(d),Z!==0&&(S=Z,A=W1(d,Z))),A===1)throw y=mh,Dc(d,0),yg(d,S),us(d,ni()),y;if(A===6)yg(d,S);else{if(Z=d.current.alternate,!(S&30)&&!vU(Z)&&(A=Kp(d,S),A===2&&(F=pl(d),F!==0&&(S=F,A=W1(d,F))),A===1))throw y=mh,Dc(d,0),yg(d,S),us(d,ni()),y;switch(d.finishedWork=Z,d.finishedLanes=S,A){case 0:case 1:throw Error(o(345));case 2:Pc(d,cs);break;case 3:if(yg(d,S),(S&130023424)===S&&(A=R1+500-ni(),10<A)){if(Fc(d,0)!==0)break;if(Z=d.suspendedLanes,(Z&S)!==S){Ur(),d.pingedLanes|=d.suspendedLanes&Z;break}d.timeoutHandle=ae(Pc.bind(null,d,cs),A);break}Pc(d,cs);break;case 4:if(yg(d,S),(S&4194240)===S)break;for(A=d.eventTimes,Z=-1;0<S;){var ie=31-Ms(S);F=1<<ie,ie=A[ie],ie>Z&&(Z=ie),S&=~F}if(S=Z,S=ni()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*bU(S/1960))-S,10<S){d.timeoutHandle=ae(Pc.bind(null,d,cs),S);break}Pc(d,cs);break;case 5:Pc(d,cs);break;default:throw Error(o(329))}}}return us(d,ni()),d.callbackNode===y?$4.bind(null,d):null}function W1(d,A){var y=bh;return d.current.memoizedState.isDehydrated&&(Dc(d,A).flags|=256),d=Kp(d,A),d!==2&&(A=cs,cs=y,A!==null&&N1(A)),d}function N1(d){cs===null?cs=d:cs.push.apply(cs,d)}function vU(d){for(var A=d;;){if(A.flags&16384){var y=A.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var S=0;S<y.length;S++){var Z=y[S],F=Z.getSnapshot;Z=Z.value;try{if(!Fs(F(),Z))return!1}catch{return!1}}}if(y=A.child,A.subtreeFlags&16384&&y!==null)y.return=A,A=y;else{if(A===d)break;for(;A.sibling===null;){if(A.return===null||A.return===d)return!0;A=A.return}A.sibling.return=A.return,A=A.sibling}}return!0}function yg(d,A){for(A&=~w1,A&=~Vp,d.suspendedLanes|=A,d.pingedLanes&=~A,d=d.expirationTimes;0<A;){var y=31-Ms(A),S=1<<y;d[y]=-1,A&=~S}}function eE(d){if(jt&6)throw Error(o(327));Oc();var A=Fc(d,0);if(!(A&1))return us(d,ni()),null;var y=Kp(d,A);if(d.tag!==0&&y===2){var S=pl(d);S!==0&&(A=S,y=W1(d,S))}if(y===1)throw y=mh,Dc(d,0),yg(d,A),us(d,ni()),y;if(y===6)throw Error(o(345));return d.finishedWork=d.current.alternate,d.finishedLanes=A,Pc(d,cs),us(d,ni()),null}function tE(d){bg!==null&&bg.tag===0&&!(jt&6)&&Oc();var A=jt;jt|=1;var y=Gi.transition,S=qt;try{if(Gi.transition=null,qt=1,d)return d()}finally{qt=S,Gi.transition=y,jt=A,!(jt&6)&&gs()}}function M1(){_s=XI.current,on(XI)}function Dc(d,A){d.finishedWork=null,d.finishedLanes=0;var y=d.timeoutHandle;if(y!==Ee&&(d.timeoutHandle=Ee,ce(y)),Ei!==null)for(y=Ei.return;y!==null;){var S=y;switch(Jy(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&Hr();break;case 3:HI(),on(Qn),on(ci),i1();break;case 5:t1(S);break;case 4:HI();break;case 13:on(ii);break;case 19:on(ii);break;case 10:$i(S.type._context);break;case 22:case 23:M1()}y=y.return}if(Zi=d,Ei=d=Bg(d.current,null),Ir=_s=A,Vi=0,mh=null,w1=Vp=YI=0,cs=bh=null,Vs!==null){for(A=0;A<Vs.length;A++)if(y=Vs[A],S=y.interleaved,S!==null){y.interleaved=null;var Z=S.next,F=y.pending;if(F!==null){var ie=F.next;F.next=Z,S.next=ie}y.pending=S}Vs=null}return d}function nE(d,A){do{var y=Ei;try{if(MI(),hp.current=vp,Cp){for(var S=ui.memoizedState;S!==null;){var Z=S.queue;Z!==null&&(Z.pending=null),S=S.next}Cp=!1}if(_I=0,er=Br=ui=null,ch=!1,uh=0,S1.current=null,y===null||y.return===null){Vi=1,mh=A,Ei=null;break}e:{var F=d,ie=y.return,Ie=y,Ve=A;if(A=Ir,Ie.flags|=32768,Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var tt=Ve,gt=Ie,Xt=gt.tag;if(!(gt.mode&1)&&(Xt===0||Xt===11||Xt===15)){var St=gt.alternate;St?(gt.updateQueue=St.updateQueue,gt.memoizedState=St.memoizedState,gt.lanes=St.lanes):(gt.updateQueue=null,gt.memoizedState=null)}var Rn=B4(ie);if(Rn!==null){Rn.flags&=-257,G4(Rn,ie,Ie,F,A),Rn.mode&1&&y4(F,tt,A),A=Rn,Ve=tt;var pt=A.updateQueue;if(pt===null){var wr=new Set;wr.add(Ve),A.updateQueue=wr}else pt.add(Ve);break e}else{if(!(A&1)){y4(F,tt,A),T1();break e}Ve=Error(o(426))}}else if(Jn&&Ie.mode&1){var bo=B4(ie);if(bo!==null){!(bo.flags&65536)&&(bo.flags|=256),G4(bo,ie,Ie,F,A),$y(Ve);break e}}F=Ve,Vi!==4&&(Vi=2),bh===null?bh=[F]:bh.push(F),Ve=c1(Ve,Ie),Ie=ie;do{switch(Ie.tag){case 3:Ie.flags|=65536,A&=-A,Ie.lanes|=A;var Ge=b4(Ie,Ve,A);YZ(Ie,Ge);break e;case 1:F=Ve;var he=Ie.type,We=Ie.stateNode;if(!(Ie.flags&128)&&(typeof he.getDerivedStateFromError=="function"||We!==null&&typeof We.componentDidCatch=="function"&&(mg===null||!mg.has(We)))){Ie.flags|=65536,A&=-A,Ie.lanes|=A;var ot=v4(Ie,F,A);YZ(Ie,ot);break e}}Ie=Ie.return}while(Ie!==null)}sE(y)}catch(ht){A=ht,Ei===y&&y!==null&&(Ei=y=y.return);continue}break}while(1)}function iE(){var d=Fp.current;return Fp.current=vp,d===null?vp:d}function T1(){(Vi===0||Vi===3||Vi===2)&&(Vi=4),Zi===null||!(YI&268435455)&&!(Vp&268435455)||yg(Zi,Ir)}function Kp(d,A){var y=jt;jt|=2;var S=iE();Zi===d&&Ir===A||Dc(d,A);do try{yU();break}catch(Z){nE(d,Z)}while(1);if(MI(),jt=y,Fp.current=S,Ei!==null)throw Error(o(261));return Zi=null,Ir=0,Vi}function yU(){for(;Ei!==null;)rE(Ei)}function BU(){for(;Ei!==null&&!eh();)rE(Ei)}function rE(d){var A=lE(d.alternate,d,_s);d.memoizedProps=d.pendingProps,A===null?sE(d):Ei=A,S1.current=null}function sE(d){var A=d;do{var y=A.alternate;if(d=A.return,A.flags&32768){if(y=hU(y,A),y!==null){y.flags&=32767,Ei=y;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Vi=6,Ei=null;return}}else if(y=IU(y,A,_s),y!==null){Ei=y;return}if(A=A.sibling,A!==null){Ei=A;return}Ei=A=d}while(A!==null);Vi===0&&(Vi=5)}function Pc(d,A){var y=qt,S=Gi.transition;try{Gi.transition=null,qt=1,GU(d,A,y)}finally{Gi.transition=S,qt=y}return null}function GU(d,A,y){do Oc();while(bg!==null);if(jt&6)throw Error(o(327));var S=d.finishedWork,Z=d.finishedLanes;if(S===null)return null;if(d.finishedWork=null,d.finishedLanes=0,S===d.current)throw Error(o(177));d.callbackNode=null,d.callbackPriority=0;var F=S.lanes|S.childLanes;if(hg(d,F),d===Zi&&(Ei=Zi=null,Ir=0),!(S.subtreeFlags&2064)&&!(S.flags&2064)||kp||(kp=!0,gE(_r,function(){return Oc(),null})),F=(S.flags&15990)!==0,S.subtreeFlags&15990||F){F=Gi.transition,Gi.transition=null;var ie=qt;qt=1;var Ie=jt;jt|=4,S1.current=null,fU(d,S),pU(d,S),V(d.containerInfo),d.current=S,mU(S),rp(),jt=Ie,qt=ie,Gi.transition=F}else d.current=S;if(kp&&(kp=!1,bg=d,Hp=Z),F=d.pendingLanes,F===0&&(mg=null),nh(S.stateNode),us(d,ni()),A!==null)for(y=d.onRecoverableError,S=0;S<A.length;S++)y(A[S]);if(Lp)throw Lp=!1,d=Z1,Z1=null,d;return Hp&1&&d.tag!==0&&Oc(),F=d.pendingLanes,F&1?d===E1?vh++:(vh=0,E1=d):vh=0,gs(),null}function Oc(){if(bg!==null){var d=$A(Hp),A=Gi.transition,y=qt;try{if(Gi.transition=null,qt=16>d?16:d,bg===null)var S=!1;else{if(d=bg,bg=null,Hp=0,jt&6)throw Error(o(331));var Z=jt;for(jt|=4,st=d.current;st!==null;){var F=st,ie=F.child;if(st.flags&16){var Ie=F.deletions;if(Ie!==null){for(var Ve=0;Ve<Ie.length;Ve++){var tt=Ie[Ve];for(st=tt;st!==null;){var gt=st;switch(gt.tag){case 0:case 11:case 15:Uc(8,gt,F)}var Xt=gt.child;if(Xt!==null)Xt.return=gt,st=Xt;else for(;st!==null;){gt=st;var St=gt.sibling,Rn=gt.return;if(K4(gt),gt===tt){st=null;break}if(St!==null){St.return=Rn,st=St;break}st=Rn}}}var pt=F.alternate;if(pt!==null){var wr=pt.child;if(wr!==null){pt.child=null;do{var bo=wr.sibling;wr.sibling=null,wr=bo}while(wr!==null)}}st=F}}if(F.subtreeFlags&2064&&ie!==null)ie.return=F,st=ie;else e:for(;st!==null;){if(F=st,F.flags&2048)switch(F.tag){case 0:case 11:case 15:Uc(9,F,F.return)}var Ge=F.sibling;if(Ge!==null){Ge.return=F.return,st=Ge;break e}st=F.return}}var he=d.current;for(st=he;st!==null;){ie=st;var We=ie.child;if(ie.subtreeFlags&2064&&We!==null)We.return=ie,st=We;else e:for(ie=he;st!==null;){if(Ie=st,Ie.flags&2048)try{switch(Ie.tag){case 0:case 11:case 15:fh(9,Ie)}}catch(ht){Is(Ie,Ie.return,ht)}if(Ie===ie){st=null;break e}var ot=Ie.sibling;if(ot!==null){ot.return=Ie.return,st=ot;break e}st=Ie.return}}if(jt=Z,gs(),Ts&&typeof Ts.onPostCommitFiberRoot=="function")try{Ts.onPostCommitFiberRoot(Lc,d)}catch{}S=!0}return S}finally{qt=y,Gi.transition=A}}return!1}function oE(d,A,y){A=c1(y,A),A=b4(d,A,1),pg(d,A),A=Ur(),d=Yp(d,1),d!==null&&(Wa(d,1,A),us(d,A))}function Is(d,A,y){if(d.tag===3)oE(d,d,y);else for(;A!==null;){if(A.tag===3){oE(A,d,y);break}else if(A.tag===1){var S=A.stateNode;if(typeof A.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(mg===null||!mg.has(S))){d=c1(y,d),d=v4(A,d,1),pg(A,d),d=Ur(),A=Yp(A,1),A!==null&&(Wa(A,1,d),us(A,d));break}}A=A.return}}function SU(d,A,y){var S=d.pingCache;S!==null&&S.delete(A),A=Ur(),d.pingedLanes|=d.suspendedLanes&y,Zi===d&&(Ir&y)===y&&(Vi===4||Vi===3&&(Ir&130023424)===Ir&&500>ni()-R1?Dc(d,0):w1|=y),us(d,A)}function aE(d,A){A===0&&(d.mode&1?(A=Cl,Cl<<=1,!(Cl&130023424)&&(Cl=4194304)):A=1);var y=Ur();d=Yp(d,A),d!==null&&(Wa(d,A,y),us(d,y))}function wU(d){var A=d.memoizedState,y=0;A!==null&&(y=A.retryLane),aE(d,y)}function RU(d,A){var y=0;switch(d.tag){case 13:var S=d.stateNode,Z=d.memoizedState;Z!==null&&(y=Z.retryLane);break;case 19:S=d.stateNode;break;default:throw Error(o(314))}S!==null&&S.delete(A),aE(d,y)}var lE;lE=function(d,A,y){if(d!==null)if(d.memoizedProps!==A.pendingProps||Qn.current)Hs=!0;else{if(!(d.lanes&y)&&!(A.flags&128))return Hs=!1,AU(d,A,y);Hs=!!(d.flags&131072)}else Hs=!1,Jn&&A.flags&1048576&&OZ(A,Ip,A.index);switch(A.lanes=0,A.tag){case 2:var S=A.type;d!==null&&(d.alternate=null,A.alternate=null,A.flags|=2),d=A.pendingProps;var Z=yn(A,ci.current);yi(A,y),Z=s1(null,A,S,d,Z,y);var F=o1();return A.flags|=1,typeof Z=="object"&&Z!==null&&typeof Z.render=="function"&&Z.$$typeof===void 0?(A.tag=1,A.memoizedState=null,A.updateQueue=null,Fn(S)?(F=!0,Ea(A)):F=!1,A.memoizedState=Z.state!==null&&Z.state!==void 0?Z.state:null,Dy(A),Z.updater=cp,A.stateNode=Z,Z._reactInternals=A,Oy(A,S,d,y),A=d1(null,A,S,!0,F,y)):(A.tag=0,Jn&&F&&Qy(A),zr(null,A,Z,y),A=A.child),A;case 16:S=A.elementType;e:{switch(d!==null&&(d.alternate=null,A.alternate=null,A.flags|=2),d=A.pendingProps,Z=S._init,S=Z(S._payload),A.type=S,Z=A.tag=ZU(S),d=Yr(S,d),Z){case 0:A=I1(null,A,S,d,y);break e;case 1:A=N4(null,A,S,d,y);break e;case 11:A=R4(null,A,S,d,y);break e;case 14:A=x4(null,A,S,Yr(S.type,d),y);break e}throw Error(o(306,S,""))}return A;case 0:return S=A.type,Z=A.pendingProps,Z=A.elementType===S?Z:Yr(S,Z),I1(d,A,S,Z,y);case 1:return S=A.type,Z=A.pendingProps,Z=A.elementType===S?Z:Yr(S,Z),N4(d,A,S,Z,y);case 3:e:{if(M4(A),d===null)throw Error(o(387));S=A.pendingProps,F=A.memoizedState,Z=F.element,XZ(d,A),gp(A,S,null,y);var ie=A.memoizedState;if(S=ie.element,fe&&F.isDehydrated)if(F={element:S,isDehydrated:!1,cache:ie.cache,transitions:ie.transitions},A.updateQueue.baseState=F,A.memoizedState=F,A.flags&256){Z=Error(o(423)),A=T4(d,A,S,y,Z);break e}else if(S!==Z){Z=Error(o(424)),A=T4(d,A,S,y,Z);break e}else for(fe&&(ks=Ti(A.stateNode.containerInfo),Ls=A,Jn=!0,Uo=null,sh=!1),y=e4(A,null,S,y),A.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(VI(),S===Z){A=Gl(d,A,y);break e}zr(d,A,S,y)}A=A.child}return A;case 5:return t4(A),d===null&&qy(A),S=A.type,Z=A.pendingProps,F=d!==null?d.memoizedProps:null,ie=Z.children,se(S,Z)?ie=null:F!==null&&se(S,F)&&(A.flags|=32),W4(d,A),zr(d,A,ie,y),A.child;case 6:return d===null&&qy(A),null;case 13:return F4(d,A,y);case 4:return e1(A,A.stateNode.containerInfo),S=A.pendingProps,d===null?A.child=LI(A,null,S,y):zr(d,A,S,y),A.child;case 11:return S=A.type,Z=A.pendingProps,Z=A.elementType===S?Z:Yr(S,Z),R4(d,A,S,Z,y);case 7:return zr(d,A,A.pendingProps,y),A.child;case 8:return zr(d,A,A.pendingProps.children,y),A.child;case 12:return zr(d,A,A.pendingProps.children,y),A.child;case 10:e:{if(S=A.type._context,Z=A.pendingProps,F=A.memoizedProps,ie=Z.value,ap(A,S,ie),F!==null)if(Fs(F.value,ie)){if(F.children===Z.children&&!Qn.current){A=Gl(d,A,y);break e}}else for(F=A.child,F!==null&&(F.return=A);F!==null;){var Ie=F.dependencies;if(Ie!==null){ie=F.child;for(var Ve=Ie.firstContext;Ve!==null;){if(Ve.context===S){if(F.tag===1){Ve=bl(-1,y&-y),Ve.tag=2;var tt=F.updateQueue;if(tt!==null){tt=tt.shared;var gt=tt.pending;gt===null?Ve.next=Ve:(Ve.next=gt.next,gt.next=Ve),tt.pending=Ve}}F.lanes|=y,Ve=F.alternate,Ve!==null&&(Ve.lanes|=y),Kr(F.return,y,A),Ie.lanes|=y;break}Ve=Ve.next}}else if(F.tag===10)ie=F.type===A.type?null:F.child;else if(F.tag===18){if(ie=F.return,ie===null)throw Error(o(341));ie.lanes|=y,Ie=ie.alternate,Ie!==null&&(Ie.lanes|=y),Kr(ie,y,A),ie=F.sibling}else ie=F.child;if(ie!==null)ie.return=F;else for(ie=F;ie!==null;){if(ie===A){ie=null;break}if(F=ie.sibling,F!==null){F.return=ie.return,ie=F;break}ie=ie.return}F=ie}zr(d,A,Z.children,y),A=A.child}return A;case 9:return Z=A.type,S=A.pendingProps.children,yi(A,y),Z=Bi(Z),S=S(Z),A.flags|=1,zr(d,A,S,y),A.child;case 14:return S=A.type,Z=Yr(S,A.pendingProps),Z=Yr(S.type,Z),x4(d,A,S,Z,y);case 15:return Z4(d,A,A.type,A.pendingProps,y);case 17:return S=A.type,Z=A.pendingProps,Z=A.elementType===S?Z:Yr(S,Z),d!==null&&(d.alternate=null,A.alternate=null,A.flags|=2),A.tag=1,Fn(S)?(d=!0,Ea(A)):d=!1,yi(A,y),DZ(A,S,Z),Oy(A,S,Z,y),d1(null,A,S,!0,d,y);case 19:return H4(d,A,y);case 22:return E4(d,A,y)}throw Error(o(156,A.tag))};function gE(d,A){return ml(d,A)}function xU(d,A,y,S){this.tag=d,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=A,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mo(d,A,y,S){return new xU(d,A,y,S)}function F1(d){return d=d.prototype,!(!d||!d.isReactComponent)}function ZU(d){if(typeof d=="function")return F1(d)?1:0;if(d!=null){if(d=d.$$typeof,d===b)return 11;if(d===p)return 14}return 2}function Bg(d,A){var y=d.alternate;return y===null?(y=mo(d.tag,A,d.key,d.mode),y.elementType=d.elementType,y.type=d.type,y.stateNode=d.stateNode,y.alternate=d,d.alternate=y):(y.pendingProps=A,y.type=d.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=d.flags&14680064,y.childLanes=d.childLanes,y.lanes=d.lanes,y.child=d.child,y.memoizedProps=d.memoizedProps,y.memoizedState=d.memoizedState,y.updateQueue=d.updateQueue,A=d.dependencies,y.dependencies=A===null?null:{lanes:A.lanes,firstContext:A.firstContext},y.sibling=d.sibling,y.index=d.index,y.ref=d.ref,y}function zp(d,A,y,S,Z,F){var ie=2;if(S=d,typeof d=="function")F1(d)&&(ie=1);else if(typeof d=="string")ie=5;else e:switch(d){case c:return Qc(y.children,Z,F,A);case u:ie=8,Z|=8;break;case I:return d=mo(12,y,A,Z|2),d.elementType=I,d.lanes=F,d;case m:return d=mo(13,y,A,Z),d.elementType=m,d.lanes=F,d;case f:return d=mo(19,y,A,Z),d.elementType=f,d.lanes=F,d;case B:return Up(y,Z,F,A);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case h:ie=10;break e;case C:ie=9;break e;case b:ie=11;break e;case p:ie=14;break e;case v:ie=16,S=null;break e}throw Error(o(130,d==null?d:typeof d,""))}return A=mo(ie,y,A,Z),A.elementType=d,A.type=S,A.lanes=F,A}function Qc(d,A,y,S){return d=mo(7,d,S,A),d.lanes=y,d}function Up(d,A,y,S){return d=mo(22,d,S,A),d.elementType=B,d.lanes=y,d.stateNode={},d}function V1(d,A,y){return d=mo(6,d,null,A),d.lanes=y,d}function L1(d,A,y){return A=mo(4,d.children!==null?d.children:[],d.key,A),A.lanes=y,A.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},A}function EU(d,A,y,S,Z){this.tag=A,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Ee,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=EI(0),this.expirationTimes=EI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=EI(0),this.identifierPrefix=S,this.onRecoverableError=Z,fe&&(this.mutableSourceEagerHydrationData=null)}function cE(d,A,y,S,Z,F,ie,Ie,Ve){return d=new EU(d,A,y,Ie,Ve),A===1?(A=1,F===!0&&(A|=8)):A=0,F=mo(3,null,null,A),d.current=F,F.stateNode=d,F.memoizedState={element:S,isDehydrated:y,cache:null,transitions:null},Dy(F),d}function uE(d){if(!d)return vi;d=d._reactInternals;e:{if(x(d)!==d||d.tag!==1)throw Error(o(170));var A=d;do{switch(A.tag){case 3:A=A.stateNode.context;break e;case 1:if(Fn(A.type)){A=A.stateNode.__reactInternalMemoizedMergedChildContext;break e}}A=A.return}while(A!==null);throw Error(o(171))}if(d.tag===1){var y=d.type;if(Fn(y))return Za(d,y,A)}return A}function IE(d){var A=d._reactInternals;if(A===void 0)throw typeof d.render=="function"?Error(o(188)):(d=Object.keys(d).join(","),Error(o(268,d)));return d=k(A),d===null?null:d.stateNode}function dE(d,A){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var y=d.retryLane;d.retryLane=y!==0&&y<A?y:A}}function k1(d,A){dE(d,A),(d=d.alternate)&&dE(d,A)}function WU(d){return d=k(d),d===null?null:d.stateNode}function NU(){return null}return n.attemptContinuousHydration=function(d){if(d.tag===13){var A=Ur();po(d,134217728,A),k1(d,134217728)}},n.attemptHydrationAtCurrentPriority=function(d){if(d.tag===13){var A=Ur(),y=vg(d);po(d,y,A),k1(d,y)}},n.attemptSynchronousHydration=function(d){switch(d.tag){case 3:var A=d.stateNode;if(A.current.memoizedState.isDehydrated){var y=fl(A.pendingLanes);y!==0&&(Na(A,y|1),us(A,ni()),!(jt&6)&&(KI(),gs()))}break;case 13:var S=Ur();tE(function(){return po(d,1,S)}),k1(d,1)}},n.batchedUpdates=function(d,A){var y=jt;jt|=1;try{return d(A)}finally{jt=y,jt===0&&(KI(),Ma&&gs())}},n.createComponentSelector=function(d){return{$$typeof:Ep,value:d}},n.createContainer=function(d,A,y,S,Z,F,ie){return cE(d,A,!1,null,y,S,Z,F,ie)},n.createHasPseudoClassSelector=function(d){return{$$typeof:Wp,value:d}},n.createHydrationContainer=function(d,A,y,S,Z,F,ie,Ie,Ve){return d=cE(y,S,!0,d,Z,F,ie,Ie,Ve),d.context=uE(null),y=d.current,S=Ur(),Z=vg(y),F=bl(S,Z),F.callback=A??null,pg(y,F),d.current.lanes=Z,Wa(d,Z,S),us(d,S),d},n.createPortal=function(d,A,y){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:g,key:S==null?null:""+S,children:d,containerInfo:A,implementation:y}},n.createRoleSelector=function(d){return{$$typeof:Np,value:d}},n.createTestNameSelector=function(d){return{$$typeof:Mp,value:d}},n.createTextSelector=function(d){return{$$typeof:Tp,value:d}},n.deferredUpdates=function(d){var A=qt,y=Gi.transition;try{return Gi.transition=null,qt=16,d()}finally{qt=A,Gi.transition=y}},n.discreteUpdates=function(d,A,y,S,Z){var F=qt,ie=Gi.transition;try{return Gi.transition=null,qt=1,d(A,y,S,Z)}finally{qt=F,Gi.transition=ie,jt===0&&KI()}},n.findAllNodes=G1,n.findBoundingRects=function(d,A){if(!Be)throw Error(o(363));A=G1(d,A),d=[];for(var y=0;y<A.length;y++)d.push(De(A[y]));for(A=d.length-1;0<A;A--){y=d[A];for(var S=y.x,Z=S+y.width,F=y.y,ie=F+y.height,Ie=A-1;0<=Ie;Ie--)if(A!==Ie){var Ve=d[Ie],tt=Ve.x,gt=tt+Ve.width,Xt=Ve.y,St=Xt+Ve.height;if(S>=tt&&F>=Xt&&Z<=gt&&ie<=St){d.splice(A,1);break}else if(S!==tt||y.width!==Ve.width||St<F||Xt>ie){if(!(F!==Xt||y.height!==Ve.height||gt<S||tt>Z)){tt>S&&(Ve.width+=tt-S,Ve.x=S),gt<Z&&(Ve.width=Z-tt),d.splice(A,1);break}}else{Xt>F&&(Ve.height+=Xt-F,Ve.y=F),St<ie&&(Ve.height=ie-Xt),d.splice(A,1);break}}}return d},n.findHostInstance=IE,n.findHostInstanceWithNoPortals=function(d){return d=T(d),d=d!==null?U(d):null,d===null?null:d.stateNode},n.findHostInstanceWithWarning=function(d){return IE(d)},n.flushControlled=function(d){var A=jt;jt|=1;var y=Gi.transition,S=qt;try{Gi.transition=null,qt=1,d()}finally{qt=S,Gi.transition=y,jt=A,jt===0&&(KI(),gs())}},n.flushPassiveEffects=Oc,n.flushSync=tE,n.focusWithin=function(d,A){if(!Be)throw Error(o(363));for(d=v1(d),A=q4(d,A),A=Array.from(A),d=0;d<A.length;){var y=A[d++];if(!K(y)){if(y.tag===5&&Le(y.stateNode))return!0;for(y=y.child;y!==null;)A.push(y),y=y.sibling}}return!1},n.getCurrentUpdatePriority=function(){return qt},n.getFindAllNodesFailureDescription=function(d,A){if(!Be)throw Error(o(363));var y=0,S=[];d=[v1(d),0];for(var Z=0;Z<d.length;){var F=d[Z++],ie=d[Z++],Ie=A[ie];if((F.tag!==5||!K(F))&&(y1(F,Ie)&&(S.push(B1(Ie)),ie++,ie>y&&(y=ie)),ie<A.length))for(F=F.child;F!==null;)d.push(F,ie),F=F.sibling}if(y<A.length){for(d=[];y<A.length;y++)d.push(B1(A[y]));return`findAllNodes was able to match part of the selector:
  `+(S.join(" > ")+`

No matching component was found for:
  `)+d.join(" > ")}return null},n.getPublicRootInstance=function(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return Y(d.child.stateNode);default:return d.child.stateNode}},n.injectIntoDevTools=function(d){if(d={bundleType:d.bundleType,version:d.version,rendererPackageName:d.rendererPackageName,rendererConfig:d.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:WU,findFiberByHostInstance:d.findFiberByHostInstance||NU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")d=!1;else{var A=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(A.isDisabled||!A.supportsFiber)d=!0;else{try{Lc=A.inject(d),Ts=A}catch{}d=!!A.checkDCE}}return d},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(d,A,y,S){if(!Be)throw Error(o(363));d=G1(d,A);var Z=Re(d,y,S).disconnect;return{disconnect:function(){Z()}}},n.registerMutableSourceForHydration=function(d,A){var y=A._getVersion;y=y(A._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[A,y]:d.mutableSourceEagerHydrationData.push(A,y)},n.runWithPriority=function(d,A){var y=qt;try{return qt=d,A()}finally{qt=y}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(d,A,y,S){var Z=A.current,F=Ur(),ie=vg(Z);return y=uE(y),A.context===null?A.context=y:A.pendingContext=y,A=bl(F,ie),A.payload={element:d},S=S===void 0?null:S,S!==null&&(A.callback=S),pg(Z,A),d=po(Z,ie,F),d!==null&&lp(d,Z,ie),ie},n};x_.exports=cle;var ule=x_.exports;const Ile=l0(ule);var Z_={exports:{}},E_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(N,L){var V=N.length;N.push(L);e:for(;0<V;){var M=V-1>>>1,X=N[M];if(0<r(X,L))N[M]=L,N[V]=X,V=M;else break e}}function n(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var L=N[0],V=N.pop();if(V!==L){N[0]=V;e:for(var M=0,X=N.length,J=X>>>1;M<J;){var re=2*(M+1)-1,se=N[re],le=re+1,ae=N[le];if(0>r(se,V))le<X&&0>r(ae,se)?(N[M]=ae,N[le]=V,M=le):(N[M]=se,N[re]=V,M=re);else if(le<X&&0>r(ae,V))N[M]=ae,N[le]=V,M=le;else break e}}return L}function r(N,L){var V=N.sortIndex-L.sortIndex;return V!==0?V:N.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],g=[],c=1,u=null,I=3,h=!1,C=!1,b=!1,m=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(N){for(var L=n(g);L!==null;){if(L.callback===null)i(g);else if(L.startTime<=N)i(g),L.sortIndex=L.expirationTime,e(l,L);else break;L=n(g)}}function B(N){if(b=!1,v(N),!C)if(n(l)!==null)C=!0,Y(G);else{var L=n(g);L!==null&&z(B,L.startTime-N)}}function G(N,L){C=!1,b&&(b=!1,f(E),E=-1),h=!0;var V=I;try{for(v(L),u=n(l);u!==null&&(!(u.expirationTime>L)||N&&!T());){var M=u.callback;if(typeof M=="function"){u.callback=null,I=u.priorityLevel;var X=M(u.expirationTime<=L);L=t.unstable_now(),typeof X=="function"?u.callback=X:u===n(l)&&i(l),v(L)}else i(l);u=n(l)}if(u!==null)var J=!0;else{var re=n(g);re!==null&&z(B,re.startTime-L),J=!1}return J}finally{u=null,I=V,h=!1}}var R=!1,w=null,E=-1,x=5,W=-1;function T(){return!(t.unstable_now()-W<x)}function k(){if(w!==null){var N=t.unstable_now();W=N;var L=!0;try{L=w(!0,N)}finally{L?_():(R=!1,w=null)}}else R=!1}var _;if(typeof p=="function")_=function(){p(k)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,O=U.port2;U.port1.onmessage=k,_=function(){O.postMessage(null)}}else _=function(){m(k,0)};function Y(N){w=N,R||(R=!0,_())}function z(N,L){E=m(function(){N(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_continueExecution=function(){C||h||(C=!0,Y(G))},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(N){switch(I){case 1:case 2:case 3:var L=3;break;default:L=I}var V=I;I=L;try{return N()}finally{I=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(N,L){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var V=I;I=N;try{return L()}finally{I=V}},t.unstable_scheduleCallback=function(N,L,V){var M=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?M+V:M):V=M,N){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=V+X,N={id:c++,callback:L,priorityLevel:N,startTime:V,expirationTime:X,sortIndex:-1},V>M?(N.sortIndex=V,e(g,N),n(l)===null&&N===n(g)&&(b?(f(E),E=-1):b=!0,z(B,V-M))):(N.sortIndex=X,e(l,N),C||h||(C=!0,Y(G))),N},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(N){var L=I;return function(){var V=I;I=L;try{return N.apply(this,arguments)}finally{I=V}}}})(E_);Z_.exports=E_;var QW=Z_.exports;const dle=t=>typeof t=="object"&&typeof t.then=="function",t2=[];function Ale(t,e,n=(i,r)=>i===r){if(t===e)return!0;if(!t||!e)return!1;const i=t.length;if(e.length!==i)return!1;for(let r=0;r<i;r++)if(!n(t[r],e[r]))return!1;return!0}function hle(t,e=null,n=!1,i={}){e===null&&(e=[t]);for(const s of t2)if(Ale(e,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return i.lifespan&&i.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,i.lifespan)),s.response;if(!n)throw s.promise}const r={keys:e,equal:i.equal,remove:()=>{const s=t2.indexOf(r);s!==-1&&t2.splice(s,1)},promise:(dle(t)?t:t(...e)).then(s=>{r.response=s,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(s=>r.error=s)};if(t2.push(r),!n)throw r.promise}const Cle=(t,e,n)=>hle(t,e,!1,n),Vx={},W_=t=>void Object.assign(Vx,t);function fle(t,e){function n(c,{args:u=[],attach:I,...h},C){let b=`${c[0].toUpperCase()}${c.slice(1)}`,m;if(c==="primitive"){if(h.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const f=h.object;m=bd(f,{type:c,root:C,attach:I,primitive:!0})}else{const f=Vx[b];if(!f)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(u))throw new Error("R3F: The args prop must be an array!");m=bd(new f(...u),{type:c,root:C,attach:I,memoizedProps:{args:u}})}return m.__r3f.attach===void 0&&(m instanceof Lt?m.__r3f.attach="geometry":m instanceof br&&(m.__r3f.attach="material")),b!=="inject"&&IB(m,h),m}function i(c,u){let I=!1;if(u){var h,C;(h=u.__r3f)!=null&&h.attach?uB(c,u,u.__r3f.attach):u.isObject3D&&c.isObject3D&&(c.add(u),I=!0),I||(C=c.__r3f)==null||C.objects.push(u),u.__r3f||bd(u,{}),u.__r3f.parent=c,cS(u),vd(u)}}function r(c,u,I){let h=!1;if(u){var C,b;if((C=u.__r3f)!=null&&C.attach)uB(c,u,u.__r3f.attach);else if(u.isObject3D&&c.isObject3D){u.parent=c,u.dispatchEvent({type:"added"});const m=c.children.filter(p=>p!==u),f=m.indexOf(I);c.children=[...m.slice(0,f),u,...m.slice(f)],h=!0}h||(b=c.__r3f)==null||b.objects.push(u),u.__r3f||bd(u,{}),u.__r3f.parent=c,cS(u),vd(u)}}function s(c,u,I=!1){c&&[...c].forEach(h=>o(u,h,I))}function o(c,u,I){if(u){var h,C,b;if(u.__r3f&&(u.__r3f.parent=null),(h=c.__r3f)!=null&&h.objects&&(c.__r3f.objects=c.__r3f.objects.filter(B=>B!==u)),(C=u.__r3f)!=null&&C.attach)eN(c,u,u.__r3f.attach);else if(u.isObject3D&&c.isObject3D){var m;c.remove(u),(m=u.__r3f)!=null&&m.root&&Gle(u.__r3f.root,u)}const p=(b=u.__r3f)==null?void 0:b.primitive,v=I===void 0?u.dispose!==null&&!p:I;if(!p){var f;s((f=u.__r3f)==null?void 0:f.objects,u,v),s(u.children,u,v)}delete u.__r3f,v&&u.dispose&&u.type!=="Scene"&&QW.unstable_scheduleCallback(QW.unstable_IdlePriority,()=>{try{u.dispose()}catch{}}),vd(c)}}function a(c,u,I,h){var C;const b=(C=c.__r3f)==null?void 0:C.parent;if(!b)return;const m=n(u,I,c.__r3f.root);if(c.children){for(const f of c.children)f.__r3f&&i(m,f);c.children=c.children.filter(f=>!f.__r3f)}c.__r3f.objects.forEach(f=>i(m,f)),c.__r3f.objects=[],c.__r3f.autoRemovedBeforeAppend||o(b,c),m.parent&&(m.__r3f.autoRemovedBeforeAppend=!0),i(b,m),m.raycast&&m.__r3f.eventCount&&m.__r3f.root.getState().internal.interaction.push(m),[h,h.alternate].forEach(f=>{f!==null&&(f.stateNode=m,f.ref&&(typeof f.ref=="function"?f.ref(m):f.ref.current=m))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Ile({createInstance:n,removeChild:o,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(c,u)=>{if(!u)return;const I=c.getState().scene;I.__r3f&&(I.__r3f.root=c,i(I,u))},removeChildFromContainer:(c,u)=>{u&&o(c.getState().scene,u)},insertInContainerBefore:(c,u,I)=>{if(!u||!I)return;const h=c.getState().scene;h.__r3f&&r(h,u,I)},getRootHostContext:()=>null,getChildHostContext:c=>c,finalizeInitialChildren(c){var u;return!!((u=c==null?void 0:c.__r3f)!=null?u:{}).handlers},prepareUpdate(c,u,I,h){var C;if(((C=c==null?void 0:c.__r3f)!=null?C:{}).primitive&&h.object&&h.object!==c)return[!0];{const{args:m=[],children:f,...p}=h,{args:v=[],children:B,...G}=I;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((w,E)=>w!==v[E]))return[!0];const R=k_(c,p,G,!0);return R.changes.length?[!1,R]:null}},commitUpdate(c,[u,I],h,C,b,m){u?a(c,h,b,m):IB(c,I)},commitMount(c,u,I,h){var C;const b=(C=c.__r3f)!=null?C:{};c.raycast&&b.handlers&&b.eventCount&&c.__r3f.root.getState().internal.interaction.push(c)},getPublicInstance:c=>c,prepareForCommit:()=>null,preparePortalMount:c=>bd(c.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(c){var u;const{attach:I,parent:h}=(u=c.__r3f)!=null?u:{};I&&h&&eN(h,c,I),c.isObject3D&&(c.visible=!1),vd(c)},unhideInstance(c,u){var I;const{attach:h,parent:C}=(I=c.__r3f)!=null?I:{};h&&C&&uB(C,c,h),(c.isObject3D&&u.visible==null||u.visible)&&(c.visible=!0),vd(c)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():Xd.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&jn.fun(performance.now)?performance.now:jn.fun(Date.now)?Date.now:()=>0,scheduleTimeout:jn.fun(setTimeout)?setTimeout:void 0,cancelTimeout:jn.fun(clearTimeout)?clearTimeout:void 0}),applyProps:IB}}var JW,jW;const cB=t=>"colorSpace"in t||"outputColorSpace"in t,N_=()=>{var t;return(t=Vx.ColorManagement)!=null?t:null},M_=t=>t&&t.isOrthographicCamera,ple=t=>t&&t.hasOwnProperty("current"),W0=typeof window<"u"&&((JW=window.document)!=null&&JW.createElement||((jW=window.navigator)==null?void 0:jW.product)==="ReactNative")?H.useLayoutEffect:H.useEffect;function T_(t){const e=H.useRef(t);return W0(()=>void(e.current=t),[t]),e}function mle({set:t}){return W0(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class F_ extends H.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}F_.getDerivedStateFromError=()=>({error:!0});const V_="__default",qW=new Map,ble=t=>t&&!!t.memoized&&!!t.changes;function L_(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}const zh=t=>{var e;return(e=t.__r3f)==null?void 0:e.root.getState()},jn={obj:t=>t===Object(t)&&!jn.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:i="reference",strict:r=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(jn.str(t)||jn.num(t))return t===e;const s=jn.obj(t);if(s&&i==="reference")return t===e;const o=jn.arr(t);if(o&&n==="reference")return t===e;if((o||s)&&t===e)return!0;let a;for(a in t)if(!(a in e))return!1;if(s&&n==="shallow"&&i==="shallow"){for(a in r?e:t)if(!jn.equ(t[a],e[a],{strict:r,objects:"reference"}))return!1}else for(a in r?e:t)if(t[a]!==e[a])return!1;if(jn.und(a)){if(o&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function vle(t){t.dispose&&t.type!=="Scene"&&t.dispose();for(const e in t)e.dispose==null||e.dispose(),delete t[e]}function bd(t,e){const n=t;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},t}function gS(t,e){let n=t;if(e.includes("-")){const i=e.split("-"),r=i.pop();return n=i.reduce((s,o)=>s[o],t),{target:n,key:r}}else return{target:n,key:e}}const $W=/-\d+$/;function uB(t,e,n){if(jn.str(n)){if($W.test(n)){const s=n.replace($W,""),{target:o,key:a}=gS(t,s);Array.isArray(o[a])||(o[a]=[])}const{target:i,key:r}=gS(t,n);e.__r3f.previousAttach=i[r],i[r]=e}else e.__r3f.previousAttach=n(t,e)}function eN(t,e,n){var i,r;if(jn.str(n)){const{target:s,key:o}=gS(t,n),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(i=e.__r3f)==null||i.previousAttach==null||i.previousAttach(t,e);(r=e.__r3f)==null||delete r.previousAttach}function k_(t,{children:e,key:n,ref:i,...r},{children:s,key:o,ref:a,...l}={},g=!1){var c;const u=(c=t==null?void 0:t.__r3f)!=null?c:{},I=Object.entries(r),h=[];if(g){const b=Object.keys(l);for(let m=0;m<b.length;m++)r.hasOwnProperty(b[m])||I.unshift([b[m],V_+"remove"])}I.forEach(([b,m])=>{var f;if((f=t.__r3f)!=null&&f.primitive&&b==="object"||jn.equ(m,l[b]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(b))return h.push([b,m,!0,[]]);let p=[];b.includes("-")&&(p=b.split("-")),h.push([b,m,!1,p]);for(const v in r){const B=r[v];v.startsWith(`${b}-`)&&h.push([v,B,!1,v.split("-")])}});const C={...r};return u.memoizedProps&&u.memoizedProps.args&&(C.args=u.memoizedProps.args),u.memoizedProps&&u.memoizedProps.attach&&(C.attach=u.memoizedProps.attach),{memoized:C,changes:h}}function IB(t,e){var n,i,r;const s=(n=t.__r3f)!=null?n:{},o=s.root,a=(i=o==null||o.getState==null?void 0:o.getState())!=null?i:{},{memoized:l,changes:g}=ble(e)?e:k_(t,e),c=s.eventCount;t.__r3f&&(t.__r3f.memoizedProps=l);for(let I=0;I<g.length;I++){let[h,C,b,m]=g[I];if(cB(t)){const B="srgb",G="srgb-linear";h==="encoding"?(h="colorSpace",C=C===3001?B:G):h==="outputEncoding"&&(h="outputColorSpace",C=C===3001?B:G)}let f=t,p=f[h];if(m.length&&(p=m.reduce((v,B)=>v[B],t),!(p&&p.set))){const[v,...B]=m.reverse();f=B.reverse().reduce((G,R)=>G[R],t),h=v}if(C===V_+"remove")if(f.constructor){let v=qW.get(f.constructor);v||(v=new f.constructor,qW.set(f.constructor,v)),C=v[h]}else C=0;if(b)C?s.handlers[h]=C:delete s.handlers[h],s.eventCount=Object.keys(s.handlers).length;else if(p&&p.set&&(p.copy||p instanceof Yu)){if(Array.isArray(C))p.fromArray?p.fromArray(C):p.set(...C);else if(p.copy&&C&&C.constructor&&p.constructor===C.constructor)p.copy(C);else if(C!==void 0){const v=p instanceof et;!v&&p.setScalar?p.setScalar(C):p instanceof Yu&&C instanceof Yu?p.mask=C.mask:p.set(C),!N_()&&!a.linear&&v&&p.convertSRGBToLinear()}}else if(f[h]=C,f[h]instanceof ei&&f[h].format===fi&&f[h].type===Yi){const v=f[h];cB(v)&&cB(a.gl)?v.colorSpace=a.gl.outputColorSpace:v.encoding=a.gl.outputEncoding}vd(t)}if(s.parent&&a.internal&&t.raycast&&c!==s.eventCount){const I=a.internal.interaction.indexOf(t);I>-1&&a.internal.interaction.splice(I,1),s.eventCount&&a.internal.interaction.push(t)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(r=t.__r3f)!=null&&r.parent&&cS(t),t}function vd(t){var e,n;const i=(e=t.__r3f)==null||(n=e.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function cS(t){t.onUpdate==null||t.onUpdate(t)}function yle(t,e){t.manual||(M_(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function n2(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function Ble(){var t;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return Xd.DefaultEventPriority;switch((t=e.event)==null?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Xd.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Xd.ContinuousEventPriority;default:return Xd.DefaultEventPriority}}function H_(t,e,n,i){const r=n.get(e);r&&(n.delete(e),n.size===0&&(t.delete(i),r.target.releasePointerCapture(i)))}function Gle(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(i=>i!==e),n.initialHits=n.initialHits.filter(i=>i!==e),n.hovered.forEach((i,r)=>{(i.eventObject===e||i.object===e)&&n.hovered.delete(r)}),n.capturedMap.forEach((i,r)=>{H_(n.capturedMap,e,i,r)})}function Sle(t){function e(l){const{internal:g}=t.getState(),c=l.offsetX-g.initialClick[0],u=l.offsetY-g.initialClick[1];return Math.round(Math.sqrt(c*c+u*u))}function n(l){return l.filter(g=>["Move","Over","Enter","Out","Leave"].some(c=>{var u;return(u=g.__r3f)==null?void 0:u.handlers["onPointer"+c]}))}function i(l,g){const c=t.getState(),u=new Set,I=[],h=g?g(c.internal.interaction):c.internal.interaction;for(let f=0;f<h.length;f++){const p=zh(h[f]);p&&(p.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(l,c);function C(f){const p=zh(f);if(!p||!p.events.enabled||p.raycaster.camera===null)return[];if(p.raycaster.camera===void 0){var v;p.events.compute==null||p.events.compute(l,p,(v=p.previousRoot)==null?void 0:v.getState()),p.raycaster.camera===void 0&&(p.raycaster.camera=null)}return p.raycaster.camera?p.raycaster.intersectObject(f,!0):[]}let b=h.flatMap(C).sort((f,p)=>{const v=zh(f.object),B=zh(p.object);return!v||!B?f.distance-p.distance:B.events.priority-v.events.priority||f.distance-p.distance}).filter(f=>{const p=n2(f);return u.has(p)?!1:(u.add(p),!0)});c.events.filter&&(b=c.events.filter(b,c));for(const f of b){let p=f.object;for(;p;){var m;(m=p.__r3f)!=null&&m.eventCount&&I.push({...f,eventObject:p}),p=p.parent}}if("pointerId"in l&&c.internal.capturedMap.has(l.pointerId))for(let f of c.internal.capturedMap.get(l.pointerId).values())u.has(n2(f.intersection))||I.push(f.intersection);return I}function r(l,g,c,u){const I=t.getState();if(l.length){const h={stopped:!1};for(const C of l){const b=zh(C.object)||I,{raycaster:m,pointer:f,camera:p,internal:v}=b,B=new P(f.x,f.y,0).unproject(p),G=W=>{var T,k;return(T=(k=v.capturedMap.get(W))==null?void 0:k.has(C.eventObject))!=null?T:!1},R=W=>{const T={intersection:C,target:g.target};v.capturedMap.has(W)?v.capturedMap.get(W).set(C.eventObject,T):v.capturedMap.set(W,new Map([[C.eventObject,T]])),g.target.setPointerCapture(W)},w=W=>{const T=v.capturedMap.get(W);T&&H_(v.capturedMap,C.eventObject,T,W)};let E={};for(let W in g){let T=g[W];typeof T!="function"&&(E[W]=T)}let x={...C,...E,pointer:f,intersections:l,stopped:h.stopped,delta:c,unprojectedPoint:B,ray:m.ray,camera:p,stopPropagation(){const W="pointerId"in g&&v.capturedMap.get(g.pointerId);if((!W||W.has(C.eventObject))&&(x.stopped=h.stopped=!0,v.hovered.size&&Array.from(v.hovered.values()).find(T=>T.eventObject===C.eventObject))){const T=l.slice(0,l.indexOf(C));s([...T,C])}},target:{hasPointerCapture:G,setPointerCapture:R,releasePointerCapture:w},currentTarget:{hasPointerCapture:G,setPointerCapture:R,releasePointerCapture:w},nativeEvent:g};if(u(x),h.stopped===!0)break}}return l}function s(l){const{internal:g}=t.getState();for(const c of g.hovered.values())if(!l.length||!l.find(u=>u.object===c.object&&u.index===c.index&&u.instanceId===c.instanceId)){const I=c.eventObject.__r3f,h=I==null?void 0:I.handlers;if(g.hovered.delete(n2(c)),I!=null&&I.eventCount){const C={...c,intersections:l};h.onPointerOut==null||h.onPointerOut(C),h.onPointerLeave==null||h.onPointerLeave(C)}}}function o(l,g){for(let c=0;c<g.length;c++){const u=g[c].__r3f;u==null||u.handlers.onPointerMissed==null||u.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return g=>{const{internal:c}=t.getState();"pointerId"in g&&c.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(g.pointerId)&&(c.capturedMap.delete(g.pointerId),s([]))})}}return function(c){const{onPointerMissed:u,internal:I}=t.getState();I.lastEvent.current=c;const h=l==="onPointerMove",C=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",m=i(c,h?n:void 0),f=C?e(c):0;l==="onPointerDown"&&(I.initialClick=[c.offsetX,c.offsetY],I.initialHits=m.map(v=>v.eventObject)),C&&!m.length&&f<=2&&(o(c,I.interaction),u&&u(c)),h&&s(m);function p(v){const B=v.eventObject,G=B.__r3f,R=G==null?void 0:G.handlers;if(G!=null&&G.eventCount)if(h){if(R.onPointerOver||R.onPointerEnter||R.onPointerOut||R.onPointerLeave){const w=n2(v),E=I.hovered.get(w);E?E.stopped&&v.stopPropagation():(I.hovered.set(w,v),R.onPointerOver==null||R.onPointerOver(v),R.onPointerEnter==null||R.onPointerEnter(v))}R.onPointerMove==null||R.onPointerMove(v)}else{const w=R[l];w?(!C||I.initialHits.includes(B))&&(o(c,I.interaction.filter(E=>!I.initialHits.includes(E))),w(v)):C&&I.initialHits.includes(B)&&o(c,I.interaction.filter(E=>!I.initialHits.includes(E)))}}r(m,c,f,p)}}return{handlePointer:a}}const __=t=>!!(t!=null&&t.render),X_=H.createContext(null),wle=(t,e)=>{const n=ale((a,l)=>{const g=new P,c=new P,u=new P;function I(f=l().camera,p=c,v=l().size){const{width:B,height:G,top:R,left:w}=v,E=B/G;p instanceof P?u.copy(p):u.set(...p);const x=f.getWorldPosition(g).distanceTo(u);if(M_(f))return{width:B/f.zoom,height:G/f.zoom,top:R,left:w,factor:1,distance:x,aspect:E};{const W=f.fov*Math.PI/180,T=2*Math.tan(W/2)*x,k=T*(B/G);return{width:k,height:T,top:R,left:w,factor:B/k,distance:x,aspect:E}}}let h;const C=f=>a(p=>({performance:{...p.performance,current:f}})),b=new xe;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(f=1)=>t(l(),f),advance:(f,p)=>e(f,p,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ey,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const f=l();h&&clearTimeout(h),f.performance.current!==f.performance.min&&C(f.performance.min),h=setTimeout(()=>C(l().performance.max),f.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:I},setEvents:f=>a(p=>({...p,events:{...p.events,...f}})),setSize:(f,p,v,B,G)=>{const R=l().camera,w={width:f,height:p,top:B||0,left:G||0,updateStyle:v};a(E=>({size:w,viewport:{...E.viewport,...I(R,c,w)}}))},setDpr:f=>a(p=>{const v=L_(f);return{viewport:{...p.viewport,dpr:v,initialDpr:p.viewport.initialDpr||v}}}),setFrameloop:(f="always")=>{const p=l().clock;p.stop(),p.elapsedTime=0,f!=="never"&&(p.start(),p.elapsedTime=0),a(()=>({frameloop:f}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:H.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(f,p,v)=>{const B=l().internal;return B.priority=B.priority+(p>0?1:0),B.subscribers.push({ref:f,priority:p,store:v}),B.subscribers=B.subscribers.sort((G,R)=>G.priority-R.priority),()=>{const G=l().internal;G!=null&&G.subscribers&&(G.priority=G.priority-(p>0?1:0),G.subscribers=G.subscribers.filter(R=>R.ref!==f))}}}}}),i=n.getState();let r=i.size,s=i.viewport.dpr,o=i.camera;return n.subscribe(()=>{const{camera:a,size:l,viewport:g,gl:c,set:u}=n.getState();if(l!==r||g.dpr!==s){var I;r=l,s=g.dpr,yle(a,l),c.setPixelRatio(g.dpr);const h=(I=l.updateStyle)!=null?I:typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(l.width,l.height,h)}a!==o&&(o=a,u(h=>({viewport:{...h.viewport,...h.viewport.getCurrentViewport(a)}})))}),n.subscribe(a=>t(a)),n};let i2,Rle=new Set,xle=new Set,Zle=new Set;function dB(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function Uh(t,e){switch(t){case"before":return dB(Rle,e);case"after":return dB(xle,e);case"tail":return dB(Zle,e)}}let AB,hB;function CB(t,e,n){let i=e.clock.getDelta();for(e.frameloop==="never"&&typeof t=="number"&&(i=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),AB=e.internal.subscribers,i2=0;i2<AB.length;i2++)hB=AB[i2],hB.ref.current(hB.store.getState(),i,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function Ele(t){let e=!1,n,i,r;function s(l){i=requestAnimationFrame(s),e=!0,n=0,Uh("before",l);for(const c of t.values()){var g;r=c.store.getState(),r.internal.active&&(r.frameloop==="always"||r.internal.frames>0)&&!((g=r.gl.xr)!=null&&g.isPresenting)&&(n+=CB(l,r))}if(Uh("after",l),n===0)return Uh("tail",l),e=!1,cancelAnimationFrame(i)}function o(l,g=1){var c;if(!l)return t.forEach(u=>o(u.store.getState()),g);(c=l.gl.xr)!=null&&c.isPresenting||!l.internal.active||l.frameloop==="never"||(l.internal.frames=Math.min(60,l.internal.frames+g),e||(e=!0,requestAnimationFrame(s)))}function a(l,g=!0,c,u){if(g&&Uh("before",l),c)CB(l,c,u);else for(const I of t.values())CB(l,I.store.getState());g&&Uh("after",l)}return{loop:s,invalidate:o,advance:a}}function Y_(){const t=H.useContext(X_);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Go(t=n=>n,e){return Y_()(t,e)}function GI(t,e=0){const n=Y_(),i=n.getState().internal.subscribe,r=T_(t);return W0(()=>i(r,e,n),[e,i,n]),null}const BA=new Map,{invalidate:tN,advance:nN}=Ele(BA),{reconciler:mb,applyProps:Ad}=fle(BA,Ble),hd={objects:"shallow",strict:!1},Wle=(t,e)=>{const n=typeof t=="function"?t(e):t;return __(n)?n:new Ix({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...t})};function Nle(t,e){if(e)return e;if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:n,height:i,top:r,left:s}=t.parentElement.getBoundingClientRect();return{width:n,height:i,top:r,left:s}}else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Mle(t){const e=BA.get(t),n=e==null?void 0:e.fiber,i=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=i||wle(tN,nN),o=n||mb.createContainer(s,Xd.ConcurrentRoot,null,!1,null,"",r,null);e||BA.set(t,{fiber:o,store:s});let a,l=!1,g;return{configure(c={}){let{gl:u,size:I,scene:h,events:C,onCreated:b,shadows:m=!1,linear:f=!1,flat:p=!1,legacy:v=!1,orthographic:B=!1,frameloop:G="always",dpr:R=[1,2],performance:w,raycaster:E,camera:x,onPointerMissed:W}=c,T=s.getState(),k=T.gl;T.gl||T.set({gl:k=Wle(u,t)});let _=T.raycaster;_||T.set({raycaster:_=new B_});const{params:U,...O}=E||{};if(jn.equ(O,_,hd)||Ad(_,{...O}),jn.equ(U,_.params,hd)||Ad(_,{params:{..._.params,...U}}),!T.camera||T.camera===g&&!jn.equ(g,x,hd)){g=x;const X=x instanceof B0,J=X?x:B?new Zo(0,0,0,0,.1,1e3):new Zn(75,0,.1,1e3);X||(J.position.z=5,x&&Ad(J,x),!T.camera&&!(x!=null&&x.rotation)&&J.lookAt(0,0,0)),T.set({camera:J})}if(!T.scene){let X;h instanceof pb?X=h:(X=new pb,h&&Ad(X,h)),T.set({scene:bd(X)})}if(!T.xr){var Y;const X=(se,le)=>{const ae=s.getState();ae.frameloop!=="never"&&nN(se,!0,ae,le)},J=()=>{const se=s.getState();se.gl.xr.enabled=se.gl.xr.isPresenting,se.gl.xr.setAnimationLoop(se.gl.xr.isPresenting?X:null),se.gl.xr.isPresenting||tN(se)},re={connect(){const se=s.getState().gl;se.xr.addEventListener("sessionstart",J),se.xr.addEventListener("sessionend",J)},disconnect(){const se=s.getState().gl;se.xr.removeEventListener("sessionstart",J),se.xr.removeEventListener("sessionend",J)}};typeof((Y=k.xr)==null?void 0:Y.addEventListener)=="function"&&re.connect(),T.set({xr:re})}if(k.shadowMap){const X=k.shadowMap.enabled,J=k.shadowMap.type;if(k.shadowMap.enabled=!!m,jn.boo(m))k.shadowMap.type=NC;else if(jn.str(m)){var z;const re={basic:Vk,percentage:vv,soft:NC,variance:ea};k.shadowMap.type=(z=re[m])!=null?z:NC}else jn.obj(m)&&Object.assign(k.shadowMap,m);(X!==k.shadowMap.enabled||J!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}const N=N_();N&&("enabled"in N?N.enabled=!v:"legacyMode"in N&&(N.legacyMode=v)),Ad(k,{outputEncoding:f?3e3:3001,toneMapping:p?Wo:JR}),T.legacy!==v&&T.set(()=>({legacy:v})),T.linear!==f&&T.set(()=>({linear:f})),T.flat!==p&&T.set(()=>({flat:p})),u&&!jn.fun(u)&&!__(u)&&!jn.equ(u,k,hd)&&Ad(k,u),C&&!T.events.handlers&&T.set({events:C(s)});const M=Nle(t,I);return jn.equ(M,T.size,hd)||T.setSize(M.width,M.height,M.updateStyle,M.top,M.left),R&&T.viewport.dpr!==L_(R)&&T.setDpr(R),T.frameloop!==G&&T.setFrameloop(G),T.onPointerMissed||T.set({onPointerMissed:W}),w&&!jn.equ(w,T.performance,hd)&&T.set(X=>({performance:{...X.performance,...w}})),a=b,l=!0,this},render(c){return l||this.configure(),mb.updateContainer(H.createElement(Tle,{store:s,children:c,onCreated:a,rootElement:t}),o,null,()=>{}),s},unmount(){K_(t)}}}function Tle({store:t,children:e,onCreated:n,rootElement:i}){return W0(()=>{const r=t.getState();r.set(s=>({internal:{...s.internal,active:!0}})),n&&n(r),t.getState().events.connected||r.events.connect==null||r.events.connect(i)},[]),H.createElement(X_.Provider,{value:t},e)}function K_(t,e){const n=BA.get(t),i=n==null?void 0:n.fiber;if(i){const r=n==null?void 0:n.store.getState();r&&(r.internal.active=!1),mb.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var s,o,a,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),vle(r),BA.delete(t),e&&e(t)}catch{}},500)})}}mb.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:H.version});function Es(){return Es=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Es.apply(this,arguments)}function uS(t,e,n){var i,r,s,o,a;e==null&&(e=100);function l(){var c=Date.now()-o;c<e&&c>=0?i=setTimeout(l,e-c):(i=null,n||(a=t.apply(s,r),s=r=null))}var g=function(){s=this,r=arguments,o=Date.now();var c=n&&!i;return i||(i=setTimeout(l,e)),c&&(a=t.apply(s,r),s=r=null),a};return g.clear=function(){i&&(clearTimeout(i),i=null)},g.flush=function(){i&&(a=t.apply(s,r),s=r=null,clearTimeout(i),i=null)},g}uS.debounce=uS;var Fle=uS;const iN=l0(Fle);function Vle(t){let{debounce:e,scroll:n,polyfill:i,offsetSize:r}=t===void 0?{debounce:0,scroll:!1,offsetSize:!1}:t;const s=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,a]=H.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=H.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o}),g=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,u=H.useRef(!1);H.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[I,h,C]=H.useMemo(()=>{const p=()=>{if(!l.current.element)return;const{left:v,top:B,width:G,height:R,bottom:w,right:E,x,y:W}=l.current.element.getBoundingClientRect(),T={left:v,top:B,width:G,height:R,bottom:w,right:E,x,y:W};l.current.element instanceof HTMLElement&&r&&(T.height=l.current.element.offsetHeight,T.width=l.current.element.offsetWidth),Object.freeze(T),u.current&&!_le(l.current.lastBounds,T)&&a(l.current.lastBounds=T)};return[p,c?iN(p,c):p,g?iN(p,g):p]},[a,r,g,c]);function b(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(p=>p.removeEventListener("scroll",C,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null)}function m(){l.current.element&&(l.current.resizeObserver=new s(C),l.current.resizeObserver.observe(l.current.element),n&&l.current.scrollContainers&&l.current.scrollContainers.forEach(p=>p.addEventListener("scroll",C,{capture:!0,passive:!0})))}const f=p=>{!p||p===l.current.element||(b(),l.current.element=p,l.current.scrollContainers=z_(p),m())};return kle(C,!!n),Lle(h),H.useEffect(()=>{b(),m()},[n,C,h]),H.useEffect(()=>b,[]),[f,o,I]}function Lle(t){H.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function kle(t,e){H.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function z_(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:i,overflowY:r}=window.getComputedStyle(t);return[n,i,r].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...z_(t.parentElement)]}const Hle=["x","y","top","bottom","left","right","width","height"],_le=(t,e)=>Hle.every(n=>t[n]===e[n]);var Xle=Object.defineProperty,Yle=Object.defineProperties,Kle=Object.getOwnPropertyDescriptors,rN=Object.getOwnPropertySymbols,zle=Object.prototype.hasOwnProperty,Ule=Object.prototype.propertyIsEnumerable,sN=(t,e,n)=>e in t?Xle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,oN=(t,e)=>{for(var n in e||(e={}))zle.call(e,n)&&sN(t,n,e[n]);if(rN)for(var n of rN(e))Ule.call(e,n)&&sN(t,n,e[n]);return t},Dle=(t,e)=>Yle(t,Kle(e));function U_(t,e,n){if(!t)return;if(n(t)===!0)return t;let i=e?t.return:t.child;for(;i;){const r=U_(i,e,n);if(r)return r;i=e?null:i.sibling}}function D_(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const Lx=D_(H.createContext(null));class P_ extends H.Component{render(){return H.createElement(Lx.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:aN,ReactCurrentDispatcher:lN}=H.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Ple(){const t=H.useContext(Lx);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=H.useId();return H.useMemo(()=>{for(const i of[aN==null?void 0:aN.current,t,t==null?void 0:t.alternate]){if(!i)continue;const r=U_(i,!1,s=>{let o=s.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(r)return r}},[t,e])}function Ole(){var t,e;const n=Ple(),[i]=H.useState(()=>new Map);i.clear();let r=n;for(;r;){const s=(t=r.type)==null?void 0:t._context;s&&s!==Lx&&!i.has(s)&&i.set(s,(e=lN==null?void 0:lN.current)==null?void 0:e.readContext(D_(s))),r=r.return}return i}function Qle(){const t=Ole();return H.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>i=>H.createElement(e,null,H.createElement(n.Provider,Dle(oN({},i),{value:t.get(n)}))),e=>H.createElement(P_,oN({},e))),[t])}const fB={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Jle(t){const{handlePointer:e}=Sle(t);return{priority:1,enabled:!0,compute(n,i,r){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(fB).reduce((n,i)=>({...n,[i]:e(i)}),{}),update:()=>{var n;const{events:i,internal:r}=t.getState();(n=r.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(r.lastEvent.current)},connect:n=>{var i;const{set:r,events:s}=t.getState();s.disconnect==null||s.disconnect(),r(o=>({events:{...o.events,connected:n}})),Object.entries((i=s.handlers)!=null?i:[]).forEach(([o,a])=>{const[l,g]=fB[o];n.addEventListener(l,a,{passive:g})})},disconnect:()=>{const{set:n,events:i}=t.getState();if(i.connected){var r;Object.entries((r=i.handlers)!=null?r:[]).forEach(([s,o])=>{if(i&&i.connected instanceof HTMLElement){const[a]=fB[s];i.connected.removeEventListener(a,o)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}const jle=H.forwardRef(function({children:e,fallback:n,resize:i,style:r,gl:s,events:o=Jle,eventSource:a,eventPrefix:l,shadows:g,linear:c,flat:u,legacy:I,orthographic:h,frameloop:C,dpr:b,performance:m,raycaster:f,camera:p,scene:v,onPointerMissed:B,onCreated:G,...R},w){H.useMemo(()=>W_(rle),[]);const E=Qle(),[x,W]=Vle({scroll:!0,debounce:{scroll:50,resize:0},...i}),T=H.useRef(null),k=H.useRef(null);H.useImperativeHandle(w,()=>T.current);const _=T_(B),[U,O]=H.useState(!1),[Y,z]=H.useState(!1);if(U)throw U;if(Y)throw Y;const N=H.useRef(null);W0(()=>{const V=T.current;W.width>0&&W.height>0&&V&&(N.current||(N.current=Mle(V)),N.current.configure({gl:s,events:o,shadows:g,linear:c,flat:u,legacy:I,orthographic:h,frameloop:C,dpr:b,performance:m,raycaster:f,camera:p,scene:v,size:W,onPointerMissed:(...M)=>_.current==null?void 0:_.current(...M),onCreated:M=>{M.events.connect==null||M.events.connect(a?ple(a)?a.current:a:k.current),l&&M.setEvents({compute:(X,J)=>{const re=X[l+"X"],se=X[l+"Y"];J.pointer.set(re/J.size.width*2-1,-(se/J.size.height)*2+1),J.raycaster.setFromCamera(J.pointer,J.camera)}}),G==null||G(M)}}),N.current.render(H.createElement(E,null,H.createElement(F_,{set:z},H.createElement(H.Suspense,{fallback:H.createElement(mle,{set:O})},e)))))}),H.useEffect(()=>{const V=T.current;if(V)return()=>K_(V)},[]);const L=a?"none":"auto";return H.createElement("div",Es({ref:k,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:L,...r}},R),H.createElement("div",{ref:x,style:{width:"100%",height:"100%"}},H.createElement("canvas",{ref:T,style:{display:"block"}},n)))}),qle=H.forwardRef(function(e,n){return H.createElement(P_,null,H.createElement(jle,Es({},e,{ref:n})))});var kx={exports:{}},oA=typeof Reflect=="object"?Reflect:null,gN=oA&&typeof oA.apply=="function"?oA.apply:function(e,n,i){return Function.prototype.apply.call(e,n,i)},n3;oA&&typeof oA.ownKeys=="function"?n3=oA.ownKeys:Object.getOwnPropertySymbols?n3=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:n3=function(e){return Object.getOwnPropertyNames(e)};function $le(t){console&&console.warn&&console.warn(t)}var O_=Number.isNaN||function(e){return e!==e};function Sn(){Sn.init.call(this)}kx.exports=Sn;kx.exports.once=ige;Sn.EventEmitter=Sn;Sn.prototype._events=void 0;Sn.prototype._eventsCount=0;Sn.prototype._maxListeners=void 0;var cN=10;function ty(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Sn,"defaultMaxListeners",{enumerable:!0,get:function(){return cN},set:function(t){if(typeof t!="number"||t<0||O_(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");cN=t}});Sn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Sn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||O_(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Q_(t){return t._maxListeners===void 0?Sn.defaultMaxListeners:t._maxListeners}Sn.prototype.getMaxListeners=function(){return Q_(this)};Sn.prototype.emit=function(e){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")gN(l,this,n);else for(var g=l.length,c=eX(l,g),i=0;i<g;++i)gN(c[i],this,n);return!0};function J_(t,e,n,i){var r,s,o;if(ty(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),r=Q_(t),r>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,$le(a)}return t}Sn.prototype.addListener=function(e,n){return J_(this,e,n,!1)};Sn.prototype.on=Sn.prototype.addListener;Sn.prototype.prependListener=function(e,n){return J_(this,e,n,!0)};function ege(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function j_(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=ege.bind(i);return r.listener=n,i.wrapFn=r,r}Sn.prototype.once=function(e,n){return ty(n),this.on(e,j_(this,e,n)),this};Sn.prototype.prependOnceListener=function(e,n){return ty(n),this.prependListener(e,j_(this,e,n)),this};Sn.prototype.removeListener=function(e,n){var i,r,s,o,a;if(ty(n),r=this._events,r===void 0)return this;if(i=r[e],i===void 0)return this;if(i===n||i.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||n));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===n||i[o].listener===n){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():tge(i,s),i.length===1&&(r[e]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};Sn.prototype.off=Sn.prototype.removeListener;Sn.prototype.removeAllListeners=function(e){var n,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=i[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(r=n.length-1;r>=0;r--)this.removeListener(e,n[r]);return this};function q_(t,e,n){var i=t._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?n?[r.listener||r]:[r]:n?nge(r):eX(r,r.length)}Sn.prototype.listeners=function(e){return q_(this,e,!0)};Sn.prototype.rawListeners=function(e){return q_(this,e,!1)};Sn.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):$_.call(t,e)};Sn.prototype.listenerCount=$_;function $_(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Sn.prototype.eventNames=function(){return this._eventsCount>0?n3(this._events):[]};function eX(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function tge(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function nge(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function ige(t,e){return new Promise(function(n,i){function r(o){t.removeListener(e,s),i(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",r),n([].slice.call(arguments))}tX(t,e,s,{once:!0}),e!=="error"&&rge(t,r,{once:!0})})}function rge(t,e,n){typeof t.on=="function"&&tX(t,"error",e,n)}function tX(t,e,n,i){if(typeof t.on=="function")i.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function r(s){i.once&&t.removeEventListener(e,r),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var sge=kx.exports;function oge(t,e){var n=atob(t);if(e){for(var i=new Uint8Array(n.length),r=0,s=n.length;r<s;++r)i[r]=n.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}function age(t,e,n){var i=e===void 0?null:e,r=n===void 0?!1:n,s=oge(t,r),o=s.indexOf(`
`,10)+1,a=s.substring(o)+(i?"//# sourceMappingURL="+i:""),l=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(l)}function lge(t,e,n){var i;return function(s){return i=i||age(t,e,n),new Worker(i,s)}}var gge=lge("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1);class cge extends sge{constructor(n){let{allowSleep:i=!1,axisIndex:r=0,broadphase:s="Naive",defaultContactMaterial:o={contactEquationStiffness:1e6},frictionGravity:a=null,gravity:l=[0,-9.81,0],iterations:g=5,quatNormalizeFast:c=!1,quatNormalizeSkip:u=0,size:I=1e3,solver:h="GS",tolerance:C=.001}=n;super();H1(this,"messageQueue",[]);H1(this,"worker",null);this.config={allowSleep:i,axisIndex:r,broadphase:s,defaultContactMaterial:o,frictionGravity:a,gravity:l,iterations:g,quatNormalizeFast:c,quatNormalizeSkip:u,size:I,solver:h,tolerance:C},this.buffers={positions:new Float32Array(I*3),quaternions:new Float32Array(I*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(n){this.config.axisIndex=n,this.postMessage({op:"setAxisIndex",props:n})}get broadphase(){return this.config.broadphase}set broadphase(n){this.config.broadphase=n,this.postMessage({op:"setBroadphase",props:n})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(n){this.config.frictionGravity=n,this.postMessage({op:"setFrictionGravity",props:n})}get gravity(){return this.config.gravity}set gravity(n){this.config.gravity=n,this.postMessage({op:"setGravity",props:n})}get iterations(){return this.config.iterations}set iterations(n){this.config.iterations=n,this.postMessage({op:"setIterations",props:n})}get tolerance(){return this.config.tolerance}set tolerance(n){this.config.tolerance=n,this.postMessage({op:"setTolerance",props:n})}addBodies(n){let{props:i,type:r,uuid:s}=n;this.postMessage({op:"addBodies",props:i,type:r,uuid:s})}addConstraint(n){let{props:[i,r,s],type:o,uuid:a}=n;this.postMessage({op:"addConstraint",props:[i,r,s],type:o,uuid:a})}addContactMaterial(n){let{props:i,uuid:r}=n;this.postMessage({op:"addContactMaterial",props:i,uuid:r})}addRay(n){let{props:i,uuid:r}=n;this.postMessage({op:"addRay",props:i,uuid:r})}addRaycastVehicle(n){let{props:[i,r,s,o,a,l],uuid:g}=n;this.postMessage({op:"addRaycastVehicle",props:[i,r,s,o,a,l],uuid:g})}addSpring(n){let{props:[i,r,s],uuid:o}=n;this.postMessage({op:"addSpring",props:[i,r,s],uuid:o})}applyForce(n){let{props:i,uuid:r}=n;this.postMessage({op:"applyForce",props:i,uuid:r})}applyImpulse(n){let{props:i,uuid:r}=n;this.postMessage({op:"applyImpulse",props:i,uuid:r})}applyLocalForce(n){let{props:i,uuid:r}=n;this.postMessage({op:"applyLocalForce",props:i,uuid:r})}applyLocalImpulse(n){let{props:i,uuid:r}=n;this.postMessage({op:"applyLocalImpulse",props:i,uuid:r})}applyRaycastVehicleEngineForce(n){let{props:i,uuid:r}=n;this.postMessage({op:"applyRaycastVehicleEngineForce",props:i,uuid:r})}applyTorque(n){let{props:i,uuid:r}=n;this.postMessage({op:"applyTorque",props:i,uuid:r})}connect(){this.worker=new gge,this.worker.onmessage=n=>{if(n.data.op==="frame"){this.buffers.positions=n.data.positions,this.buffers.quaternions=n.data.quaternions,this.emit(n.data.op,n.data);return}this.emit(n.data.type,n.data)};for(const n of this.messageQueue)this.worker.postMessage(n);this.messageQueue.length=0}disableConstraint(n){let{uuid:i}=n;this.postMessage({op:"disableConstraint",uuid:i})}disableConstraintMotor(n){let{uuid:i}=n;this.postMessage({op:"disableConstraintMotor",uuid:i})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(n){let{uuid:i}=n;this.postMessage({op:"enableConstraint",uuid:i})}enableConstraintMotor(n){let{uuid:i}=n;this.postMessage({op:"enableConstraintMotor",uuid:i})}init(){const{allowSleep:n,axisIndex:i,broadphase:r,defaultContactMaterial:s,frictionGravity:o,gravity:a,iterations:l,quatNormalizeFast:g,quatNormalizeSkip:c,solver:u,tolerance:I}=this.config;this.postMessage({op:"init",props:{allowSleep:n,axisIndex:i,broadphase:r,defaultContactMaterial:s,frictionGravity:o,gravity:a,iterations:l,quatNormalizeFast:g,quatNormalizeSkip:c,solver:u,tolerance:I}})}removeBodies(n){let{uuid:i}=n;this.postMessage({op:"removeBodies",uuid:i})}removeConstraint(n){let{uuid:i}=n;this.postMessage({op:"removeConstraint",uuid:i})}removeContactMaterial(n){let{uuid:i}=n;this.postMessage({op:"removeContactMaterial",uuid:i})}removeRay(n){let{uuid:i}=n;this.postMessage({op:"removeRay",uuid:i})}removeRaycastVehicle(n){let{uuid:i}=n;this.postMessage({op:"removeRaycastVehicle",uuid:i})}removeSpring(n){let{uuid:i}=n;this.postMessage({op:"removeSpring",uuid:i})}setAllowSleep(n){let{props:i,uuid:r}=n;this.postMessage({op:"setAllowSleep",props:i,uuid:r})}setAngularDamping(n){let{props:i,uuid:r}=n;this.postMessage({op:"setAngularDamping",props:i,uuid:r})}setAngularFactor(n){let{props:i,uuid:r}=n;this.postMessage({op:"setAngularFactor",props:i,uuid:r})}setAngularVelocity(n){let{props:i,uuid:r}=n;this.postMessage({op:"setAngularVelocity",props:i,uuid:r})}setCollisionFilterGroup(n){let{props:i,uuid:r}=n;this.postMessage({op:"setCollisionFilterGroup",props:i,uuid:r})}setCollisionFilterMask(n){let{props:i,uuid:r}=n;this.postMessage({op:"setCollisionFilterMask",props:i,uuid:r})}setCollisionResponse(n){let{props:i,uuid:r}=n;this.postMessage({op:"setCollisionResponse",props:i,uuid:r})}setConstraintMotorMaxForce(n){let{props:i,uuid:r}=n;this.postMessage({op:"setConstraintMotorMaxForce",props:i,uuid:r})}setConstraintMotorSpeed(n){let{props:i,uuid:r}=n;this.postMessage({op:"setConstraintMotorSpeed",props:i,uuid:r})}setFixedRotation(n){let{props:i,uuid:r}=n;this.postMessage({op:"setFixedRotation",props:i,uuid:r})}setIsTrigger(n){let{props:i,uuid:r}=n;this.postMessage({op:"setIsTrigger",props:i,uuid:r})}setLinearDamping(n){let{props:i,uuid:r}=n;this.postMessage({op:"setLinearDamping",props:i,uuid:r})}setLinearFactor(n){let{props:i,uuid:r}=n;this.postMessage({op:"setLinearFactor",props:i,uuid:r})}setMass(n){let{props:i,uuid:r}=n;this.postMessage({op:"setMass",props:i,uuid:r})}setMaterial(n){let{props:i,uuid:r}=n;this.postMessage({op:"setMaterial",props:i,uuid:r})}setPosition(n){let{props:i,uuid:r}=n;this.postMessage({op:"setPosition",props:i,uuid:r})}setQuaternion(n){let{props:[i,r,s,o],uuid:a}=n;this.postMessage({op:"setQuaternion",props:[i,r,s,o],uuid:a})}setRaycastVehicleBrake(n){let{props:i,uuid:r}=n;this.postMessage({op:"setRaycastVehicleBrake",props:i,uuid:r})}setRaycastVehicleSteeringValue(n){let{props:i,uuid:r}=n;this.postMessage({op:"setRaycastVehicleSteeringValue",props:i,uuid:r})}setRotation(n){let{props:i,uuid:r}=n;this.postMessage({op:"setRotation",props:i,uuid:r})}setSleepSpeedLimit(n){let{props:i,uuid:r}=n;this.postMessage({op:"setSleepSpeedLimit",props:i,uuid:r})}setSleepTimeLimit(n){let{props:i,uuid:r}=n;this.postMessage({op:"setSleepTimeLimit",props:i,uuid:r})}setSpringDamping(n){let{props:i,uuid:r}=n;this.postMessage({op:"setSpringDamping",props:i,uuid:r})}setSpringRestLength(n){let{props:i,uuid:r}=n;this.postMessage({op:"setSpringRestLength",props:i,uuid:r})}setSpringStiffness(n){let{props:i,uuid:r}=n;this.postMessage({op:"setSpringStiffness",props:i,uuid:r})}setUserData(n){let{props:i,uuid:r}=n;this.postMessage({op:"setUserData",props:i,uuid:r})}setVelocity(n){let{props:i,uuid:r}=n;this.postMessage({op:"setVelocity",props:i,uuid:r})}sleep(n){let{uuid:i}=n;this.postMessage({op:"sleep",uuid:i})}step(n){var i;const{buffers:{positions:r,quaternions:s}}=this;!r.byteLength&&!s.byteLength||(i=this.worker)==null||i.postMessage({op:"step",positions:r,props:n,quaternions:s},[r.buffer,s.buffer])}subscribe(n){let{props:{id:i,target:r,type:s},uuid:o}=n;this.postMessage({op:"subscribe",props:{id:i,target:r,type:s},uuid:o})}terminate(){var n;(n=this.worker)==null||n.terminate(),this.worker=null}unsubscribe(n){let{props:i}=n;this.postMessage({op:"unsubscribe",props:i})}wakeUp(n){let{uuid:i}=n;this.postMessage({op:"wakeUp",uuid:i})}postMessage(n){if(this.worker)return this.worker.postMessage(n);this.messageQueue.push(n)}}class Kl{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const n=this.elements;n[0]=e.x,n[4]=e.y,n[8]=e.z}getTrace(e){e===void 0&&(e=new ee);const n=this.elements;return e.x=n[0],e.y=n[4],e.z=n[8],e}vmult(e,n){n===void 0&&(n=new ee);const i=this.elements,r=e.x,s=e.y,o=e.z;return n.x=i[0]*r+i[1]*s+i[2]*o,n.y=i[3]*r+i[4]*s+i[5]*o,n.z=i[6]*r+i[7]*s+i[8]*o,n}smult(e){for(let n=0;n<this.elements.length;n++)this.elements[n]*=e}mmult(e,n){n===void 0&&(n=new Kl);const i=this.elements,r=e.elements,s=n.elements,o=i[0],a=i[1],l=i[2],g=i[3],c=i[4],u=i[5],I=i[6],h=i[7],C=i[8],b=r[0],m=r[1],f=r[2],p=r[3],v=r[4],B=r[5],G=r[6],R=r[7],w=r[8];return s[0]=o*b+a*p+l*G,s[1]=o*m+a*v+l*R,s[2]=o*f+a*B+l*w,s[3]=g*b+c*p+u*G,s[4]=g*m+c*v+u*R,s[5]=g*f+c*B+u*w,s[6]=I*b+h*p+C*G,s[7]=I*m+h*v+C*R,s[8]=I*f+h*B+C*w,n}scale(e,n){n===void 0&&(n=new Kl);const i=this.elements,r=n.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*i[3*s+0],r[3*s+1]=e.y*i[3*s+1],r[3*s+2]=e.z*i[3*s+2];return n}solve(e,n){n===void 0&&(n=new ee);const i=3,r=4,s=[];let o,a;for(o=0;o<i*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let l=3;const g=l;let c;const u=4;let I;do{if(o=g-l,s[o+r*o]===0){for(a=o+1;a<g;a++)if(s[o+r*a]!==0){c=u;do I=u-c,s[I+r*o]+=s[I+r*a];while(--c);break}}if(s[o+r*o]!==0)for(a=o+1;a<g;a++){const h=s[o+r*a]/s[o+r*o];c=u;do I=u-c,s[I+r*a]=I<=o?0:s[I+r*a]-s[I+r*o]*h;while(--c)}}while(--l);if(n.z=s[2*r+3]/s[2*r+2],n.y=(s[1*r+3]-s[1*r+2]*n.z)/s[1*r+1],n.x=(s[0*r+3]-s[0*r+2]*n.z-s[0*r+1]*n.y)/s[0*r+0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw`Could not solve equation! Got x=[${n.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return n}e(e,n,i){if(i===void 0)return this.elements[n+3*e];this.elements[n+3*e]=i}copy(e){for(let n=0;n<e.elements.length;n++)this.elements[n]=e.elements[n];return this}toString(){let e="";const n=",";for(let i=0;i<9;i++)e+=this.elements[i]+n;return e}reverse(e){e===void 0&&(e=new Kl);const n=3,i=6,r=uge;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+i*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3;const l=a;let g;const c=i;let u;do{if(s=l-a,r[s+i*s]===0){for(o=s+1;o<l;o++)if(r[s+i*o]!==0){g=c;do u=c-g,r[u+i*s]+=r[u+i*o];while(--g);break}}if(r[s+i*s]!==0)for(o=s+1;o<l;o++){const I=r[s+i*o]/r[s+i*s];g=c;do u=c-g,r[u+i*o]=u<=s?0:r[u+i*o]-r[u+i*s]*I;while(--g)}}while(--a);s=2;do{o=s-1;do{const I=r[s+i*o]/r[s+i*s];g=i;do u=i-g,r[u+i*o]=r[u+i*o]-r[u+i*s]*I;while(--g)}while(o--)}while(--s);s=2;do{const I=1/r[s+i*s];g=i;do u=i-g,r[u+i*s]=r[u+i*s]*I;while(--g)}while(s--);s=2;do{o=2;do{if(u=r[n+o+i*s],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,u)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const n=e.x,i=e.y,r=e.z,s=e.w,o=n+n,a=i+i,l=r+r,g=n*o,c=n*a,u=n*l,I=i*a,h=i*l,C=r*l,b=s*o,m=s*a,f=s*l,p=this.elements;return p[3*0+0]=1-(I+C),p[3*0+1]=c-f,p[3*0+2]=u+m,p[3*1+0]=c+f,p[3*1+1]=1-(g+C),p[3*1+2]=h-b,p[3*2+0]=u-m,p[3*2+1]=h+b,p[3*2+2]=1-(g+I),this}transpose(e){e===void 0&&(e=new Kl);const n=this.elements,i=e.elements;let r;return i[0]=n[0],i[4]=n[4],i[8]=n[8],r=n[1],i[1]=n[3],i[3]=r,r=n[2],i[2]=n[6],i[6]=r,r=n[5],i[5]=n[7],i[7]=r,e}}const uge=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ee{constructor(e,n,i){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),this.x=e,this.y=n,this.z=i}cross(e,n){n===void 0&&(n=new ee);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z;return n.x=a*s-l*r,n.y=l*i-o*s,n.z=o*r-a*i,n}set(e,n,i){return this.x=e,this.y=n,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,n){if(n)n.x=e.x+this.x,n.y=e.y+this.y,n.z=e.z+this.z;else return new ee(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,n){if(n)n.x=this.x-e.x,n.y=this.y-e.y,n.z=this.z-e.z;else return new ee(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Kl([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,n=this.y,i=this.z,r=Math.sqrt(e*e+n*n+i*i);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new ee);const n=this.x,i=this.y,r=this.z;let s=Math.sqrt(n*n+i*i+r*r);return s>0?(s=1/s,e.x=n*s,e.y=i*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,n=this.y,i=this.z;return Math.sqrt(e*e+n*n+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const n=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-n)*(s-n)+(o-i)*(o-i)+(a-r)*(a-r))}distanceSquared(e){const n=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-n)*(s-n)+(o-i)*(o-i)+(a-r)*(a-r)}scale(e,n){n===void 0&&(n=new ee);const i=this.x,r=this.y,s=this.z;return n.x=e*i,n.y=e*r,n.z=e*s,n}vmul(e,n){return n===void 0&&(n=new ee),n.x=e.x*this.x,n.y=e.y*this.y,n.z=e.z*this.z,n}addScaledVector(e,n,i){return i===void 0&&(i=new ee),i.x=this.x+e*n.x,i.y=this.y+e*n.y,i.z=this.z+e*n.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ee),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,n){const i=this.length();if(i>0){const r=Ige,s=1/i;r.set(this.x*s,this.y*s,this.z*s);const o=dge;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,n)}else e.set(1,0,0),n.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,n,i){const r=this.x,s=this.y,o=this.z;i.x=r+(e.x-r)*n,i.y=s+(e.y-s)*n,i.z=o+(e.z-o)*n}almostEquals(e,n){return n===void 0&&(n=1e-6),!(Math.abs(this.x-e.x)>n||Math.abs(this.y-e.y)>n||Math.abs(this.z-e.z)>n)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,n){return this.negate(uN),uN.almostEquals(e,n)}clone(){return new ee(this.x,this.y,this.z)}}ee.ZERO=new ee(0,0,0);ee.UNIT_X=new ee(1,0,0);ee.UNIT_Y=new ee(0,1,0);ee.UNIT_Z=new ee(0,0,1);const Ige=new ee,dge=new ee,uN=new ee;class _o{constructor(e){e===void 0&&(e={}),this.lowerBound=new ee,this.upperBound=new ee,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,n,i,r){const s=this.lowerBound,o=this.upperBound,a=i;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let l=1;l<e.length;l++){let g=e[l];a&&(a.vmult(g,IN),g=IN),g.x>o.x&&(o.x=g.x),g.x<s.x&&(s.x=g.x),g.y>o.y&&(o.y=g.y),g.y<s.y&&(s.y=g.y),g.z>o.z&&(o.z=g.z),g.z<s.z&&(s.z=g.z)}return n&&(n.vadd(s,s),n.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new _o().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const n=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=i.x&&i.x<=s.x||n.x<=s.x&&s.x<=i.x,a=r.y<=i.y&&i.y<=s.y||n.y<=s.y&&s.y<=i.y,l=r.z<=i.z&&i.z<=s.z||n.z<=s.z&&s.z<=i.z;return o&&a&&l}volume(){const e=this.lowerBound,n=this.upperBound;return(n.x-e.x)*(n.y-e.y)*(n.z-e.z)}contains(e){const n=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound;return n.x<=r.x&&i.x>=s.x&&n.y<=r.y&&i.y>=s.y&&n.z<=r.z&&i.z>=s.z}getCorners(e,n,i,r,s,o,a,l){const g=this.lowerBound,c=this.upperBound;e.copy(g),n.set(c.x,g.y,g.z),i.set(c.x,c.y,g.z),r.set(g.x,c.y,c.z),s.set(c.x,g.y,c.z),o.set(g.x,c.y,g.z),a.set(g.x,g.y,c.z),l.copy(c)}toLocalFrame(e,n){const i=dN,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(r,s,o,a,l,g,c,u);for(let I=0;I!==8;I++){const h=i[I];e.pointToLocal(h,h)}return n.setFromPoints(i)}toWorldFrame(e,n){const i=dN,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(r,s,o,a,l,g,c,u);for(let I=0;I!==8;I++){const h=i[I];e.pointToWorld(h,h)}return n.setFromPoints(i)}overlapsRay(e){const{direction:n,from:i}=e,r=1/n.x,s=1/n.y,o=1/n.z,a=(this.lowerBound.x-i.x)*r,l=(this.upperBound.x-i.x)*r,g=(this.lowerBound.y-i.y)*s,c=(this.upperBound.y-i.y)*s,u=(this.lowerBound.z-i.z)*o,I=(this.upperBound.z-i.z)*o,h=Math.max(Math.max(Math.min(a,l),Math.min(g,c)),Math.min(u,I)),C=Math.min(Math.min(Math.max(a,l),Math.max(g,c)),Math.max(u,I));return!(C<0||h>C)}}const IN=new ee,dN=[new ee,new ee,new ee,new ee,new ee,new ee,new ee,new ee];class jr{constructor(e,n,i,r){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),r===void 0&&(r=1),this.x=e,this.y=n,this.z=i,this.w=r}set(e,n,i,r){return this.x=e,this.y=n,this.z=i,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,n){const i=Math.sin(n*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(n*.5),this}toAxisAngle(e){e===void 0&&(e=new ee),this.normalize();const n=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,n]}setFromVectors(e,n){if(e.isAntiparallelTo(n)){const i=Age,r=hge;e.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(n);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*n.length()**2)+e.dot(n),this.normalize()}return this}mult(e,n){n===void 0&&(n=new jr);const i=this.x,r=this.y,s=this.z,o=this.w,a=e.x,l=e.y,g=e.z,c=e.w;return n.x=i*c+o*a+r*g-s*l,n.y=r*c+o*l+s*a-i*g,n.z=s*c+o*g+i*l-r*a,n.w=o*c-i*a-r*l-s*g,n}inverse(e){e===void 0&&(e=new jr);const n=this.x,i=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(n*n+i*i+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new jr),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,n){n===void 0&&(n=new ee);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z,g=this.w,c=g*i+a*s-l*r,u=g*r+l*i-o*s,I=g*s+o*r-a*i,h=-o*i-a*r-l*s;return n.x=c*g+h*-o+u*-l-I*-a,n.y=u*g+h*-a+I*-o-c*-l,n.z=I*g+h*-l+c*-a-u*-o,n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,n){n===void 0&&(n="YZX");let i,r,s;const o=this.x,a=this.y,l=this.z,g=this.w;switch(n){case"YZX":const c=o*a+l*g;if(c>.499&&(i=2*Math.atan2(o,g),r=Math.PI/2,s=0),c<-.499&&(i=-2*Math.atan2(o,g),r=-Math.PI/2,s=0),i===void 0){const u=o*o,I=a*a,h=l*l;i=Math.atan2(2*a*g-2*o*l,1-2*I-2*h),r=Math.asin(2*c),s=Math.atan2(2*o*g-2*a*l,1-2*u-2*h)}break;default:throw new Error(`Euler order ${n} not supported yet.`)}e.y=i,e.z=r,e.x=s}setFromEuler(e,n,i,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(n/2),a=Math.cos(i/2),l=Math.sin(e/2),g=Math.sin(n/2),c=Math.sin(i/2);return r==="XYZ"?(this.x=l*o*a+s*g*c,this.y=s*g*a-l*o*c,this.z=s*o*c+l*g*a,this.w=s*o*a-l*g*c):r==="YXZ"?(this.x=l*o*a+s*g*c,this.y=s*g*a-l*o*c,this.z=s*o*c-l*g*a,this.w=s*o*a+l*g*c):r==="ZXY"?(this.x=l*o*a-s*g*c,this.y=s*g*a+l*o*c,this.z=s*o*c+l*g*a,this.w=s*o*a-l*g*c):r==="ZYX"?(this.x=l*o*a-s*g*c,this.y=s*g*a+l*o*c,this.z=s*o*c-l*g*a,this.w=s*o*a+l*g*c):r==="YZX"?(this.x=l*o*a+s*g*c,this.y=s*g*a+l*o*c,this.z=s*o*c-l*g*a,this.w=s*o*a-l*g*c):r==="XZY"&&(this.x=l*o*a-s*g*c,this.y=s*g*a-l*o*c,this.z=s*o*c+l*g*a,this.w=s*o*a+l*g*c),this}clone(){return new jr(this.x,this.y,this.z,this.w)}slerp(e,n,i){i===void 0&&(i=new jr);const r=this.x,s=this.y,o=this.z,a=this.w;let l=e.x,g=e.y,c=e.z,u=e.w,I,h,C,b,m;return h=r*l+s*g+o*c+a*u,h<0&&(h=-h,l=-l,g=-g,c=-c,u=-u),1-h>1e-6?(I=Math.acos(h),C=Math.sin(I),b=Math.sin((1-n)*I)/C,m=Math.sin(n*I)/C):(b=1-n,m=n),i.x=b*r+m*l,i.y=b*s+m*g,i.z=b*o+m*c,i.w=b*a+m*u,i}integrate(e,n,i,r){r===void 0&&(r=new jr);const s=e.x*i.x,o=e.y*i.y,a=e.z*i.z,l=this.x,g=this.y,c=this.z,u=this.w,I=n*.5;return r.x+=I*(s*u+o*c-a*g),r.y+=I*(o*u+a*l-s*c),r.z+=I*(a*u+s*g-o*l),r.w+=I*(-s*l-o*g-a*c),r}}const Age=new ee,hge=new ee,Cge={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Ct{constructor(e){e===void 0&&(e={}),this.id=Ct.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,n){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,n,i,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Ct.idCounter=0;Ct.types=Cge;class Cs{constructor(e){e===void 0&&(e={}),this.position=new ee,this.quaternion=new jr,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,n){return Cs.pointToLocalFrame(this.position,this.quaternion,e,n)}pointToWorld(e,n){return Cs.pointToWorldFrame(this.position,this.quaternion,e,n)}vectorToWorldFrame(e,n){return n===void 0&&(n=new ee),this.quaternion.vmult(e,n),n}static pointToLocalFrame(e,n,i,r){return r===void 0&&(r=new ee),i.vsub(e,r),n.conjugate(AN),AN.vmult(r,r),r}static pointToWorldFrame(e,n,i,r){return r===void 0&&(r=new ee),n.vmult(i,r),r.vadd(e,r),r}static vectorToWorldFrame(e,n,i){return i===void 0&&(i=new ee),e.vmult(n,i),i}static vectorToLocalFrame(e,n,i,r){return r===void 0&&(r=new ee),n.w*=-1,n.vmult(i,r),n.w*=-1,r}}const AN=new jr;new ee;new ee;new ee;new ee;new ee,new ee,new ee,new ee,new ee,new ee,new ee,new ee;new ee;new jr;new _o;new Kl;new Kl;new Kl;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new jr;new ee;new ee;new ee;new ee;class IS{constructor(){this.rayFromWorld=new ee,this.rayToWorld=new ee,this.hitNormalWorld=new ee,this.hitPointWorld=new ee,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,n,i,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(n),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}}let nX,iX,rX,sX,oX,aX,lX;const Hx={CLOSEST:1,ANY:2,ALL:4};nX=Ct.types.SPHERE;iX=Ct.types.PLANE;rX=Ct.types.BOX;sX=Ct.types.CYLINDER;oX=Ct.types.CONVEXPOLYHEDRON;aX=Ct.types.HEIGHTFIELD;lX=Ct.types.TRIMESH;class Wr{get[nX](){return this._intersectSphere}get[iX](){return this._intersectPlane}get[rX](){return this._intersectBox}get[sX](){return this._intersectConvex}get[oX](){return this._intersectConvex}get[aX](){return this._intersectHeightfield}get[lX](){return this._intersectTrimesh}constructor(e,n){e===void 0&&(e=new ee),n===void 0&&(n=new ee),this.from=e.clone(),this.to=n.clone(),this.direction=new ee,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Wr.ANY,this.result=new IS,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,n){return this.mode=n.mode||Wr.ANY,this.result=n.result||new IS,this.skipBackfaces=!!n.skipBackfaces,this.collisionFilterMask=typeof n.collisionFilterMask<"u"?n.collisionFilterMask:-1,this.collisionFilterGroup=typeof n.collisionFilterGroup<"u"?n.collisionFilterGroup:-1,this.checkCollisionResponse=typeof n.checkCollisionResponse<"u"?n.checkCollisionResponse:!0,n.from&&this.from.copy(n.from),n.to&&this.to.copy(n.to),this.callback=n.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(hN),pB.length=0,e.broadphase.aabbQuery(e,hN,pB),this.intersectBodies(pB),this.hasHit}intersectBody(e,n){n&&(this.result=n,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const r=fge,s=pge;for(let o=0,a=e.shapes.length;o<a;o++){const l=e.shapes[o];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(l,s,r,e),this.result.shouldStop))break}}intersectBodies(e,n){n&&(this.result=n,this.updateDirection());for(let i=0,r=e.length;!this.result.shouldStop&&i<r;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,n,i,r){const s=this.from;if(Nge(s,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,n,i,r,e)}_intersectBox(e,n,i,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,n,i,r,s)}_intersectPlane(e,n,i,r,s){const o=this.from,a=this.to,l=this.direction,g=new ee(0,0,1);n.vmult(g,g);const c=new ee;o.vsub(i,c);const u=c.dot(g);a.vsub(i,c);const I=c.dot(g);if(u*I>0||o.distanceTo(a)<u)return;const h=g.dot(l);if(Math.abs(h)<this.precision)return;const C=new ee,b=new ee,m=new ee;o.vsub(i,C);const f=-g.dot(C)/h;l.scale(f,b),o.vadd(b,m),this.reportIntersection(g,m,s,r,-1)}getAABB(e){const{lowerBound:n,upperBound:i}=e,r=this.to,s=this.from;n.x=Math.min(r.x,s.x),n.y=Math.min(r.y,s.y),n.z=Math.min(r.z,s.z),i.x=Math.max(r.x,s.x),i.y=Math.max(r.y,s.y),i.z=Math.max(r.z,s.z)}_intersectHeightfield(e,n,i,r,s){e.data,e.elementSize;const o=mge;o.from.copy(this.from),o.to.copy(this.to),Cs.pointToLocalFrame(i,n,o.from,o.from),Cs.pointToLocalFrame(i,n,o.to,o.to),o.updateDirection();const a=bge;let l,g,c,u;l=g=0,c=u=e.data.length-1;const I=new _o;o.getAABB(I),e.getIndexOfPosition(I.lowerBound.x,I.lowerBound.y,a,!0),l=Math.max(l,a[0]),g=Math.max(g,a[1]),e.getIndexOfPosition(I.upperBound.x,I.upperBound.y,a,!0),c=Math.min(c,a[0]+1),u=Math.min(u,a[1]+1);for(let h=l;h<c;h++)for(let C=g;C<u;C++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,C,I),!!I.overlapsRay(o)){if(e.getConvexTrianglePillar(h,C,!1),Cs.pointToWorldFrame(i,n,e.pillarOffset,r2),this._intersectConvex(e.pillarConvex,n,r2,r,s,CN),this.result.shouldStop)return;e.getConvexTrianglePillar(h,C,!0),Cs.pointToWorldFrame(i,n,e.pillarOffset,r2),this._intersectConvex(e.pillarConvex,n,r2,r,s,CN)}}}_intersectSphere(e,n,i,r,s){const o=this.from,a=this.to,l=e.radius,g=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,c=2*((a.x-o.x)*(o.x-i.x)+(a.y-o.y)*(o.y-i.y)+(a.z-o.z)*(o.z-i.z)),u=(o.x-i.x)**2+(o.y-i.y)**2+(o.z-i.z)**2-l**2,I=c**2-4*g*u,h=vge,C=yge;if(!(I<0))if(I===0)o.lerp(a,I,h),h.vsub(i,C),C.normalize(),this.reportIntersection(C,h,s,r,-1);else{const b=(-c-Math.sqrt(I))/(2*g),m=(-c+Math.sqrt(I))/(2*g);if(b>=0&&b<=1&&(o.lerp(a,b,h),h.vsub(i,C),C.normalize(),this.reportIntersection(C,h,s,r,-1)),this.result.shouldStop)return;m>=0&&m<=1&&(o.lerp(a,m,h),h.vsub(i,C),C.normalize(),this.reportIntersection(C,h,s,r,-1))}}_intersectConvex(e,n,i,r,s,o){const a=Bge,l=fN,g=o&&o.faceList||null,c=e.faces,u=e.vertices,I=e.faceNormals,h=this.direction,C=this.from,b=this.to,m=C.distanceTo(b),f=g?g.length:c.length,p=this.result;for(let v=0;!p.shouldStop&&v<f;v++){const B=g?g[v]:v,G=c[B],R=I[B],w=n,E=i;l.copy(u[G[0]]),w.vmult(l,l),l.vadd(E,l),l.vsub(C,l),w.vmult(R,a);const x=h.dot(a);if(Math.abs(x)<this.precision)continue;const W=a.dot(l)/x;if(!(W<0)){h.scale(W,ds),ds.vadd(C,ds),Jo.copy(u[G[0]]),w.vmult(Jo,Jo),E.vadd(Jo,Jo);for(let T=1;!p.shouldStop&&T<G.length-1;T++){ka.copy(u[G[T]]),Ha.copy(u[G[T+1]]),w.vmult(ka,ka),w.vmult(Ha,Ha),E.vadd(ka,ka),E.vadd(Ha,Ha);const k=ds.distanceTo(C);!(Wr.pointInTriangle(ds,Jo,ka,Ha)||Wr.pointInTriangle(ds,ka,Jo,Ha))||k>m||this.reportIntersection(a,ds,s,r,B)}}}}_intersectTrimesh(e,n,i,r,s,o){const a=Gge,l=Ege,g=Wge,c=fN,u=Sge,I=wge,h=Rge,C=Zge,b=xge,m=e.indices;e.vertices;const f=this.from,p=this.to,v=this.direction;g.position.copy(i),g.quaternion.copy(n),Cs.vectorToLocalFrame(i,n,v,u),Cs.pointToLocalFrame(i,n,f,I),Cs.pointToLocalFrame(i,n,p,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,I.x*=e.scale.x,I.y*=e.scale.y,I.z*=e.scale.z,h.vsub(I,u),u.normalize();const B=I.distanceSquared(h);e.tree.rayQuery(this,g,l);for(let G=0,R=l.length;!this.result.shouldStop&&G!==R;G++){const w=l[G];e.getNormal(w,a),e.getVertex(m[w*3],Jo),Jo.vsub(I,c);const E=u.dot(a),x=a.dot(c)/E;if(x<0)continue;u.scale(x,ds),ds.vadd(I,ds),e.getVertex(m[w*3+1],ka),e.getVertex(m[w*3+2],Ha);const W=ds.distanceSquared(I);!(Wr.pointInTriangle(ds,ka,Jo,Ha)||Wr.pointInTriangle(ds,Jo,ka,Ha))||W>B||(Cs.vectorToWorldFrame(n,a,b),Cs.pointToWorldFrame(i,n,ds,C),this.reportIntersection(b,C,s,r,w))}l.length=0}reportIntersection(e,n,i,r,s){const o=this.from,a=this.to,l=o.distanceTo(n),g=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(g.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case Wr.ALL:this.hasHit=!0,g.set(o,a,e,n,i,r,l),g.hasHit=!0,this.callback(g);break;case Wr.CLOSEST:(l<g.distance||!g.hasHit)&&(this.hasHit=!0,g.hasHit=!0,g.set(o,a,e,n,i,r,l));break;case Wr.ANY:this.hasHit=!0,g.hasHit=!0,g.set(o,a,e,n,i,r,l),g.shouldStop=!0;break}}static pointInTriangle(e,n,i,r){r.vsub(n,vu),i.vsub(n,Dh),e.vsub(n,mB);const s=vu.dot(vu),o=vu.dot(Dh),a=vu.dot(mB),l=Dh.dot(Dh),g=Dh.dot(mB);let c,u;return(c=l*a-o*g)>=0&&(u=s*g-o*a)>=0&&c+u<s*l-o*o}}Wr.CLOSEST=Hx.CLOSEST;Wr.ANY=Hx.ANY;Wr.ALL=Hx.ALL;const hN=new _o,pB=[],Dh=new ee,mB=new ee,fge=new ee,pge=new jr,ds=new ee,Jo=new ee,ka=new ee,Ha=new ee;new ee;new IS;const CN={faceList:[0]},r2=new ee,mge=new Wr,bge=[],vge=new ee,yge=new ee,Bge=new ee;new ee;new ee;const fN=new ee,Gge=new ee,Sge=new ee,wge=new ee,Rge=new ee,xge=new ee,Zge=new ee;new _o;const Ege=[],Wge=new Cs,vu=new ee,s2=new ee;function Nge(t,e,n){n.vsub(t,vu);const i=vu.dot(e);return e.scale(i,s2),s2.vadd(t,s2),n.distanceTo(s2)}new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new Wr;new ee;new ee;new ee;new ee(1,0,0),new ee(0,1,0),new ee(0,0,1);new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new _o;new ee;new _o;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new _o;new ee;new Cs;new _o;Ct.types.SPHERE,Ct.types.SPHERE|Ct.types.PLANE,Ct.types.BOX|Ct.types.BOX,Ct.types.SPHERE|Ct.types.BOX,Ct.types.PLANE|Ct.types.BOX,Ct.types.CONVEXPOLYHEDRON,Ct.types.SPHERE|Ct.types.CONVEXPOLYHEDRON,Ct.types.PLANE|Ct.types.CONVEXPOLYHEDRON,Ct.types.BOX|Ct.types.CONVEXPOLYHEDRON,Ct.types.SPHERE|Ct.types.HEIGHTFIELD,Ct.types.BOX|Ct.types.HEIGHTFIELD,Ct.types.CONVEXPOLYHEDRON|Ct.types.HEIGHTFIELD,Ct.types.PARTICLE|Ct.types.SPHERE,Ct.types.PLANE|Ct.types.PARTICLE,Ct.types.BOX|Ct.types.PARTICLE,Ct.types.PARTICLE|Ct.types.CONVEXPOLYHEDRON,Ct.types.CYLINDER,Ct.types.SPHERE|Ct.types.CYLINDER,Ct.types.PLANE|Ct.types.CYLINDER,Ct.types.BOX|Ct.types.CYLINDER,Ct.types.CONVEXPOLYHEDRON|Ct.types.CYLINDER,Ct.types.HEIGHTFIELD|Ct.types.CYLINDER,Ct.types.PARTICLE|Ct.types.CYLINDER,Ct.types.SPHERE|Ct.types.TRIMESH,Ct.types.PLANE|Ct.types.TRIMESH;new ee;new ee;new ee;new ee;new ee;new jr;new jr;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new _o;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee,new ee,new ee,new ee,new ee,new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new jr;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new _o;new Wr;const Ph=globalThis.performance||{};if(!Ph.now){let t=Date.now();Ph.timing&&Ph.timing.navigationStart&&(t=Ph.timing.navigationStart),Ph.now=()=>Date.now()-t}new ee;class zl{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const n=this.elements;n[0]=e.x,n[4]=e.y,n[8]=e.z}getTrace(e){e===void 0&&(e=new te);const n=this.elements;return e.x=n[0],e.y=n[4],e.z=n[8],e}vmult(e,n){n===void 0&&(n=new te);const i=this.elements,r=e.x,s=e.y,o=e.z;return n.x=i[0]*r+i[1]*s+i[2]*o,n.y=i[3]*r+i[4]*s+i[5]*o,n.z=i[6]*r+i[7]*s+i[8]*o,n}smult(e){for(let n=0;n<this.elements.length;n++)this.elements[n]*=e}mmult(e,n){n===void 0&&(n=new zl);const i=this.elements,r=e.elements,s=n.elements,o=i[0],a=i[1],l=i[2],g=i[3],c=i[4],u=i[5],I=i[6],h=i[7],C=i[8],b=r[0],m=r[1],f=r[2],p=r[3],v=r[4],B=r[5],G=r[6],R=r[7],w=r[8];return s[0]=o*b+a*p+l*G,s[1]=o*m+a*v+l*R,s[2]=o*f+a*B+l*w,s[3]=g*b+c*p+u*G,s[4]=g*m+c*v+u*R,s[5]=g*f+c*B+u*w,s[6]=I*b+h*p+C*G,s[7]=I*m+h*v+C*R,s[8]=I*f+h*B+C*w,n}scale(e,n){n===void 0&&(n=new zl);const i=this.elements,r=n.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*i[3*s+0],r[3*s+1]=e.y*i[3*s+1],r[3*s+2]=e.z*i[3*s+2];return n}solve(e,n){n===void 0&&(n=new te);const i=3,r=4,s=[];let o,a;for(o=0;o<i*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let l=3;const g=l;let c;const u=4;let I;do{if(o=g-l,s[o+r*o]===0){for(a=o+1;a<g;a++)if(s[o+r*a]!==0){c=u;do I=u-c,s[I+r*o]+=s[I+r*a];while(--c);break}}if(s[o+r*o]!==0)for(a=o+1;a<g;a++){const h=s[o+r*a]/s[o+r*o];c=u;do I=u-c,s[I+r*a]=I<=o?0:s[I+r*a]-s[I+r*o]*h;while(--c)}}while(--l);if(n.z=s[2*r+3]/s[2*r+2],n.y=(s[1*r+3]-s[1*r+2]*n.z)/s[1*r+1],n.x=(s[0*r+3]-s[0*r+2]*n.z-s[0*r+1]*n.y)/s[0*r+0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw`Could not solve equation! Got x=[${n.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return n}e(e,n,i){if(i===void 0)return this.elements[n+3*e];this.elements[n+3*e]=i}copy(e){for(let n=0;n<e.elements.length;n++)this.elements[n]=e.elements[n];return this}toString(){let e="";const n=",";for(let i=0;i<9;i++)e+=this.elements[i]+n;return e}reverse(e){e===void 0&&(e=new zl);const n=3,i=6,r=Mge;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+i*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3;const l=a;let g;const c=i;let u;do{if(s=l-a,r[s+i*s]===0){for(o=s+1;o<l;o++)if(r[s+i*o]!==0){g=c;do u=c-g,r[u+i*s]+=r[u+i*o];while(--g);break}}if(r[s+i*s]!==0)for(o=s+1;o<l;o++){const I=r[s+i*o]/r[s+i*s];g=c;do u=c-g,r[u+i*o]=u<=s?0:r[u+i*o]-r[u+i*s]*I;while(--g)}}while(--a);s=2;do{o=s-1;do{const I=r[s+i*o]/r[s+i*s];g=i;do u=i-g,r[u+i*o]=r[u+i*o]-r[u+i*s]*I;while(--g)}while(o--)}while(--s);s=2;do{const I=1/r[s+i*s];g=i;do u=i-g,r[u+i*s]=r[u+i*s]*I;while(--g)}while(s--);s=2;do{o=2;do{if(u=r[n+o+i*s],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,u)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const n=e.x,i=e.y,r=e.z,s=e.w,o=n+n,a=i+i,l=r+r,g=n*o,c=n*a,u=n*l,I=i*a,h=i*l,C=r*l,b=s*o,m=s*a,f=s*l,p=this.elements;return p[3*0+0]=1-(I+C),p[3*0+1]=c-f,p[3*0+2]=u+m,p[3*1+0]=c+f,p[3*1+1]=1-(g+C),p[3*1+2]=h-b,p[3*2+0]=u-m,p[3*2+1]=h+b,p[3*2+2]=1-(g+I),this}transpose(e){e===void 0&&(e=new zl);const n=this.elements,i=e.elements;let r;return i[0]=n[0],i[4]=n[4],i[8]=n[8],r=n[1],i[1]=n[3],i[3]=r,r=n[2],i[2]=n[6],i[6]=r,r=n[5],i[5]=n[7],i[7]=r,e}}const Mge=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class te{constructor(e,n,i){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),this.x=e,this.y=n,this.z=i}cross(e,n){n===void 0&&(n=new te);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z;return n.x=a*s-l*r,n.y=l*i-o*s,n.z=o*r-a*i,n}set(e,n,i){return this.x=e,this.y=n,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,n){if(n)n.x=e.x+this.x,n.y=e.y+this.y,n.z=e.z+this.z;else return new te(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,n){if(n)n.x=this.x-e.x,n.y=this.y-e.y,n.z=this.z-e.z;else return new te(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new zl([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,n=this.y,i=this.z,r=Math.sqrt(e*e+n*n+i*i);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new te);const n=this.x,i=this.y,r=this.z;let s=Math.sqrt(n*n+i*i+r*r);return s>0?(s=1/s,e.x=n*s,e.y=i*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,n=this.y,i=this.z;return Math.sqrt(e*e+n*n+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const n=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-n)*(s-n)+(o-i)*(o-i)+(a-r)*(a-r))}distanceSquared(e){const n=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-n)*(s-n)+(o-i)*(o-i)+(a-r)*(a-r)}scale(e,n){n===void 0&&(n=new te);const i=this.x,r=this.y,s=this.z;return n.x=e*i,n.y=e*r,n.z=e*s,n}vmul(e,n){return n===void 0&&(n=new te),n.x=e.x*this.x,n.y=e.y*this.y,n.z=e.z*this.z,n}addScaledVector(e,n,i){return i===void 0&&(i=new te),i.x=this.x+e*n.x,i.y=this.y+e*n.y,i.z=this.z+e*n.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new te),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,n){const i=this.length();if(i>0){const r=Tge,s=1/i;r.set(this.x*s,this.y*s,this.z*s);const o=Fge;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,n)}else e.set(1,0,0),n.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,n,i){const r=this.x,s=this.y,o=this.z;i.x=r+(e.x-r)*n,i.y=s+(e.y-s)*n,i.z=o+(e.z-o)*n}almostEquals(e,n){return n===void 0&&(n=1e-6),!(Math.abs(this.x-e.x)>n||Math.abs(this.y-e.y)>n||Math.abs(this.z-e.z)>n)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,n){return this.negate(pN),pN.almostEquals(e,n)}clone(){return new te(this.x,this.y,this.z)}}te.ZERO=new te(0,0,0);te.UNIT_X=new te(1,0,0);te.UNIT_Y=new te(0,1,0);te.UNIT_Z=new te(0,0,1);const Tge=new te,Fge=new te,pN=new te;class Xo{constructor(e){e===void 0&&(e={}),this.lowerBound=new te,this.upperBound=new te,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,n,i,r){const s=this.lowerBound,o=this.upperBound,a=i;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let l=1;l<e.length;l++){let g=e[l];a&&(a.vmult(g,mN),g=mN),g.x>o.x&&(o.x=g.x),g.x<s.x&&(s.x=g.x),g.y>o.y&&(o.y=g.y),g.y<s.y&&(s.y=g.y),g.z>o.z&&(o.z=g.z),g.z<s.z&&(s.z=g.z)}return n&&(n.vadd(s,s),n.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Xo().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const n=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=i.x&&i.x<=s.x||n.x<=s.x&&s.x<=i.x,a=r.y<=i.y&&i.y<=s.y||n.y<=s.y&&s.y<=i.y,l=r.z<=i.z&&i.z<=s.z||n.z<=s.z&&s.z<=i.z;return o&&a&&l}volume(){const e=this.lowerBound,n=this.upperBound;return(n.x-e.x)*(n.y-e.y)*(n.z-e.z)}contains(e){const n=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound;return n.x<=r.x&&i.x>=s.x&&n.y<=r.y&&i.y>=s.y&&n.z<=r.z&&i.z>=s.z}getCorners(e,n,i,r,s,o,a,l){const g=this.lowerBound,c=this.upperBound;e.copy(g),n.set(c.x,g.y,g.z),i.set(c.x,c.y,g.z),r.set(g.x,c.y,c.z),s.set(c.x,g.y,c.z),o.set(g.x,c.y,g.z),a.set(g.x,g.y,c.z),l.copy(c)}toLocalFrame(e,n){const i=bN,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(r,s,o,a,l,g,c,u);for(let I=0;I!==8;I++){const h=i[I];e.pointToLocal(h,h)}return n.setFromPoints(i)}toWorldFrame(e,n){const i=bN,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(r,s,o,a,l,g,c,u);for(let I=0;I!==8;I++){const h=i[I];e.pointToWorld(h,h)}return n.setFromPoints(i)}overlapsRay(e){const{direction:n,from:i}=e,r=1/n.x,s=1/n.y,o=1/n.z,a=(this.lowerBound.x-i.x)*r,l=(this.upperBound.x-i.x)*r,g=(this.lowerBound.y-i.y)*s,c=(this.upperBound.y-i.y)*s,u=(this.lowerBound.z-i.z)*o,I=(this.upperBound.z-i.z)*o,h=Math.max(Math.max(Math.min(a,l),Math.min(g,c)),Math.min(u,I)),C=Math.min(Math.min(Math.max(a,l),Math.max(g,c)),Math.max(u,I));return!(C<0||h>C)}}const mN=new te,bN=[new te,new te,new te,new te,new te,new te,new te,new te];class qr{constructor(e,n,i,r){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),r===void 0&&(r=1),this.x=e,this.y=n,this.z=i,this.w=r}set(e,n,i,r){return this.x=e,this.y=n,this.z=i,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,n){const i=Math.sin(n*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(n*.5),this}toAxisAngle(e){e===void 0&&(e=new te),this.normalize();const n=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,n]}setFromVectors(e,n){if(e.isAntiparallelTo(n)){const i=Vge,r=Lge;e.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(n);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*n.length()**2)+e.dot(n),this.normalize()}return this}mult(e,n){n===void 0&&(n=new qr);const i=this.x,r=this.y,s=this.z,o=this.w,a=e.x,l=e.y,g=e.z,c=e.w;return n.x=i*c+o*a+r*g-s*l,n.y=r*c+o*l+s*a-i*g,n.z=s*c+o*g+i*l-r*a,n.w=o*c-i*a-r*l-s*g,n}inverse(e){e===void 0&&(e=new qr);const n=this.x,i=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(n*n+i*i+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new qr),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,n){n===void 0&&(n=new te);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z,g=this.w,c=g*i+a*s-l*r,u=g*r+l*i-o*s,I=g*s+o*r-a*i,h=-o*i-a*r-l*s;return n.x=c*g+h*-o+u*-l-I*-a,n.y=u*g+h*-a+I*-o-c*-l,n.z=I*g+h*-l+c*-a-u*-o,n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,n){n===void 0&&(n="YZX");let i,r,s;const o=this.x,a=this.y,l=this.z,g=this.w;switch(n){case"YZX":const c=o*a+l*g;if(c>.499&&(i=2*Math.atan2(o,g),r=Math.PI/2,s=0),c<-.499&&(i=-2*Math.atan2(o,g),r=-Math.PI/2,s=0),i===void 0){const u=o*o,I=a*a,h=l*l;i=Math.atan2(2*a*g-2*o*l,1-2*I-2*h),r=Math.asin(2*c),s=Math.atan2(2*o*g-2*a*l,1-2*u-2*h)}break;default:throw new Error(`Euler order ${n} not supported yet.`)}e.y=i,e.z=r,e.x=s}setFromEuler(e,n,i,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(n/2),a=Math.cos(i/2),l=Math.sin(e/2),g=Math.sin(n/2),c=Math.sin(i/2);return r==="XYZ"?(this.x=l*o*a+s*g*c,this.y=s*g*a-l*o*c,this.z=s*o*c+l*g*a,this.w=s*o*a-l*g*c):r==="YXZ"?(this.x=l*o*a+s*g*c,this.y=s*g*a-l*o*c,this.z=s*o*c-l*g*a,this.w=s*o*a+l*g*c):r==="ZXY"?(this.x=l*o*a-s*g*c,this.y=s*g*a+l*o*c,this.z=s*o*c+l*g*a,this.w=s*o*a-l*g*c):r==="ZYX"?(this.x=l*o*a-s*g*c,this.y=s*g*a+l*o*c,this.z=s*o*c-l*g*a,this.w=s*o*a+l*g*c):r==="YZX"?(this.x=l*o*a+s*g*c,this.y=s*g*a+l*o*c,this.z=s*o*c-l*g*a,this.w=s*o*a-l*g*c):r==="XZY"&&(this.x=l*o*a-s*g*c,this.y=s*g*a-l*o*c,this.z=s*o*c+l*g*a,this.w=s*o*a+l*g*c),this}clone(){return new qr(this.x,this.y,this.z,this.w)}slerp(e,n,i){i===void 0&&(i=new qr);const r=this.x,s=this.y,o=this.z,a=this.w;let l=e.x,g=e.y,c=e.z,u=e.w,I,h,C,b,m;return h=r*l+s*g+o*c+a*u,h<0&&(h=-h,l=-l,g=-g,c=-c,u=-u),1-h>1e-6?(I=Math.acos(h),C=Math.sin(I),b=Math.sin((1-n)*I)/C,m=Math.sin(n*I)/C):(b=1-n,m=n),i.x=b*r+m*l,i.y=b*s+m*g,i.z=b*o+m*c,i.w=b*a+m*u,i}integrate(e,n,i,r){r===void 0&&(r=new qr);const s=e.x*i.x,o=e.y*i.y,a=e.z*i.z,l=this.x,g=this.y,c=this.z,u=this.w,I=n*.5;return r.x+=I*(s*u+o*c-a*g),r.y+=I*(o*u+a*l-s*c),r.z+=I*(a*u+s*g-o*l),r.w+=I*(-s*l-o*g-a*c),r}}const Vge=new te,Lge=new te,kge={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class ft{constructor(e){e===void 0&&(e={}),this.id=ft.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,n){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,n,i,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}ft.idCounter=0;ft.types=kge;class fs{constructor(e){e===void 0&&(e={}),this.position=new te,this.quaternion=new qr,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,n){return fs.pointToLocalFrame(this.position,this.quaternion,e,n)}pointToWorld(e,n){return fs.pointToWorldFrame(this.position,this.quaternion,e,n)}vectorToWorldFrame(e,n){return n===void 0&&(n=new te),this.quaternion.vmult(e,n),n}static pointToLocalFrame(e,n,i,r){return r===void 0&&(r=new te),i.vsub(e,r),n.conjugate(vN),vN.vmult(r,r),r}static pointToWorldFrame(e,n,i,r){return r===void 0&&(r=new te),n.vmult(i,r),r.vadd(e,r),r}static vectorToWorldFrame(e,n,i){return i===void 0&&(i=new te),e.vmult(n,i),i}static vectorToLocalFrame(e,n,i,r){return r===void 0&&(r=new te),n.w*=-1,n.vmult(i,r),n.w*=-1,r}}const vN=new qr;new te;new te;new te;new te;new te,new te,new te,new te,new te,new te,new te,new te;new te;new qr;new Xo;new zl;new zl;new zl;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new qr;new te;new te;new te;new te;class dS{constructor(){this.rayFromWorld=new te,this.rayToWorld=new te,this.hitNormalWorld=new te,this.hitPointWorld=new te,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,n,i,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(n),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}}let gX,cX,uX,IX,dX,AX,hX;const _x={CLOSEST:1,ANY:2,ALL:4};gX=ft.types.SPHERE;cX=ft.types.PLANE;uX=ft.types.BOX;IX=ft.types.CYLINDER;dX=ft.types.CONVEXPOLYHEDRON;AX=ft.types.HEIGHTFIELD;hX=ft.types.TRIMESH;class Nr{get[gX](){return this._intersectSphere}get[cX](){return this._intersectPlane}get[uX](){return this._intersectBox}get[IX](){return this._intersectConvex}get[dX](){return this._intersectConvex}get[AX](){return this._intersectHeightfield}get[hX](){return this._intersectTrimesh}constructor(e,n){e===void 0&&(e=new te),n===void 0&&(n=new te),this.from=e.clone(),this.to=n.clone(),this.direction=new te,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Nr.ANY,this.result=new dS,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,n){return this.mode=n.mode||Nr.ANY,this.result=n.result||new dS,this.skipBackfaces=!!n.skipBackfaces,this.collisionFilterMask=typeof n.collisionFilterMask<"u"?n.collisionFilterMask:-1,this.collisionFilterGroup=typeof n.collisionFilterGroup<"u"?n.collisionFilterGroup:-1,this.checkCollisionResponse=typeof n.checkCollisionResponse<"u"?n.checkCollisionResponse:!0,n.from&&this.from.copy(n.from),n.to&&this.to.copy(n.to),this.callback=n.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(yN),bB.length=0,e.broadphase.aabbQuery(e,yN,bB),this.intersectBodies(bB),this.hasHit}intersectBody(e,n){n&&(this.result=n,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const r=Hge,s=_ge;for(let o=0,a=e.shapes.length;o<a;o++){const l=e.shapes[o];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(l,s,r,e),this.result.shouldStop))break}}intersectBodies(e,n){n&&(this.result=n,this.updateDirection());for(let i=0,r=e.length;!this.result.shouldStop&&i<r;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,n,i,r){const s=this.from;if(ece(s,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,n,i,r,e)}_intersectBox(e,n,i,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,n,i,r,s)}_intersectPlane(e,n,i,r,s){const o=this.from,a=this.to,l=this.direction,g=new te(0,0,1);n.vmult(g,g);const c=new te;o.vsub(i,c);const u=c.dot(g);a.vsub(i,c);const I=c.dot(g);if(u*I>0||o.distanceTo(a)<u)return;const h=g.dot(l);if(Math.abs(h)<this.precision)return;const C=new te,b=new te,m=new te;o.vsub(i,C);const f=-g.dot(C)/h;l.scale(f,b),o.vadd(b,m),this.reportIntersection(g,m,s,r,-1)}getAABB(e){const{lowerBound:n,upperBound:i}=e,r=this.to,s=this.from;n.x=Math.min(r.x,s.x),n.y=Math.min(r.y,s.y),n.z=Math.min(r.z,s.z),i.x=Math.max(r.x,s.x),i.y=Math.max(r.y,s.y),i.z=Math.max(r.z,s.z)}_intersectHeightfield(e,n,i,r,s){e.data,e.elementSize;const o=Xge;o.from.copy(this.from),o.to.copy(this.to),fs.pointToLocalFrame(i,n,o.from,o.from),fs.pointToLocalFrame(i,n,o.to,o.to),o.updateDirection();const a=Yge;let l,g,c,u;l=g=0,c=u=e.data.length-1;const I=new Xo;o.getAABB(I),e.getIndexOfPosition(I.lowerBound.x,I.lowerBound.y,a,!0),l=Math.max(l,a[0]),g=Math.max(g,a[1]),e.getIndexOfPosition(I.upperBound.x,I.upperBound.y,a,!0),c=Math.min(c,a[0]+1),u=Math.min(u,a[1]+1);for(let h=l;h<c;h++)for(let C=g;C<u;C++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,C,I),!!I.overlapsRay(o)){if(e.getConvexTrianglePillar(h,C,!1),fs.pointToWorldFrame(i,n,e.pillarOffset,o2),this._intersectConvex(e.pillarConvex,n,o2,r,s,BN),this.result.shouldStop)return;e.getConvexTrianglePillar(h,C,!0),fs.pointToWorldFrame(i,n,e.pillarOffset,o2),this._intersectConvex(e.pillarConvex,n,o2,r,s,BN)}}}_intersectSphere(e,n,i,r,s){const o=this.from,a=this.to,l=e.radius,g=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,c=2*((a.x-o.x)*(o.x-i.x)+(a.y-o.y)*(o.y-i.y)+(a.z-o.z)*(o.z-i.z)),u=(o.x-i.x)**2+(o.y-i.y)**2+(o.z-i.z)**2-l**2,I=c**2-4*g*u,h=Kge,C=zge;if(!(I<0))if(I===0)o.lerp(a,I,h),h.vsub(i,C),C.normalize(),this.reportIntersection(C,h,s,r,-1);else{const b=(-c-Math.sqrt(I))/(2*g),m=(-c+Math.sqrt(I))/(2*g);if(b>=0&&b<=1&&(o.lerp(a,b,h),h.vsub(i,C),C.normalize(),this.reportIntersection(C,h,s,r,-1)),this.result.shouldStop)return;m>=0&&m<=1&&(o.lerp(a,m,h),h.vsub(i,C),C.normalize(),this.reportIntersection(C,h,s,r,-1))}}_intersectConvex(e,n,i,r,s,o){const a=Uge,l=GN,g=o&&o.faceList||null,c=e.faces,u=e.vertices,I=e.faceNormals,h=this.direction,C=this.from,b=this.to,m=C.distanceTo(b),f=g?g.length:c.length,p=this.result;for(let v=0;!p.shouldStop&&v<f;v++){const B=g?g[v]:v,G=c[B],R=I[B],w=n,E=i;l.copy(u[G[0]]),w.vmult(l,l),l.vadd(E,l),l.vsub(C,l),w.vmult(R,a);const x=h.dot(a);if(Math.abs(x)<this.precision)continue;const W=a.dot(l)/x;if(!(W<0)){h.scale(W,As),As.vadd(C,As),jo.copy(u[G[0]]),w.vmult(jo,jo),E.vadd(jo,jo);for(let T=1;!p.shouldStop&&T<G.length-1;T++){_a.copy(u[G[T]]),Xa.copy(u[G[T+1]]),w.vmult(_a,_a),w.vmult(Xa,Xa),E.vadd(_a,_a),E.vadd(Xa,Xa);const k=As.distanceTo(C);!(Nr.pointInTriangle(As,jo,_a,Xa)||Nr.pointInTriangle(As,_a,jo,Xa))||k>m||this.reportIntersection(a,As,s,r,B)}}}}_intersectTrimesh(e,n,i,r,s,o){const a=Dge,l=qge,g=$ge,c=GN,u=Pge,I=Oge,h=Qge,C=jge,b=Jge,m=e.indices;e.vertices;const f=this.from,p=this.to,v=this.direction;g.position.copy(i),g.quaternion.copy(n),fs.vectorToLocalFrame(i,n,v,u),fs.pointToLocalFrame(i,n,f,I),fs.pointToLocalFrame(i,n,p,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,I.x*=e.scale.x,I.y*=e.scale.y,I.z*=e.scale.z,h.vsub(I,u),u.normalize();const B=I.distanceSquared(h);e.tree.rayQuery(this,g,l);for(let G=0,R=l.length;!this.result.shouldStop&&G!==R;G++){const w=l[G];e.getNormal(w,a),e.getVertex(m[w*3],jo),jo.vsub(I,c);const E=u.dot(a),x=a.dot(c)/E;if(x<0)continue;u.scale(x,As),As.vadd(I,As),e.getVertex(m[w*3+1],_a),e.getVertex(m[w*3+2],Xa);const W=As.distanceSquared(I);!(Nr.pointInTriangle(As,_a,jo,Xa)||Nr.pointInTriangle(As,jo,_a,Xa))||W>B||(fs.vectorToWorldFrame(n,a,b),fs.pointToWorldFrame(i,n,As,C),this.reportIntersection(b,C,s,r,w))}l.length=0}reportIntersection(e,n,i,r,s){const o=this.from,a=this.to,l=o.distanceTo(n),g=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(g.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case Nr.ALL:this.hasHit=!0,g.set(o,a,e,n,i,r,l),g.hasHit=!0,this.callback(g);break;case Nr.CLOSEST:(l<g.distance||!g.hasHit)&&(this.hasHit=!0,g.hasHit=!0,g.set(o,a,e,n,i,r,l));break;case Nr.ANY:this.hasHit=!0,g.hasHit=!0,g.set(o,a,e,n,i,r,l),g.shouldStop=!0;break}}static pointInTriangle(e,n,i,r){r.vsub(n,yu),i.vsub(n,Oh),e.vsub(n,vB);const s=yu.dot(yu),o=yu.dot(Oh),a=yu.dot(vB),l=Oh.dot(Oh),g=Oh.dot(vB);let c,u;return(c=l*a-o*g)>=0&&(u=s*g-o*a)>=0&&c+u<s*l-o*o}}Nr.CLOSEST=_x.CLOSEST;Nr.ANY=_x.ANY;Nr.ALL=_x.ALL;const yN=new Xo,bB=[],Oh=new te,vB=new te,Hge=new te,_ge=new qr,As=new te,jo=new te,_a=new te,Xa=new te;new te;new dS;const BN={faceList:[0]},o2=new te,Xge=new Nr,Yge=[],Kge=new te,zge=new te,Uge=new te;new te;new te;const GN=new te,Dge=new te,Pge=new te,Oge=new te,Qge=new te,Jge=new te,jge=new te;new Xo;const qge=[],$ge=new fs,yu=new te,a2=new te;function ece(t,e,n){n.vsub(t,yu);const i=yu.dot(e);return e.scale(i,a2),a2.vadd(t,a2),n.distanceTo(a2)}new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new Nr;new te;new te;new te;new te(1,0,0),new te(0,1,0),new te(0,0,1);new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new Xo;new te;new Xo;new te;new te;new te;new te;new te;new te;new te;new Xo;new te;new fs;new Xo;ft.types.SPHERE,ft.types.SPHERE|ft.types.PLANE,ft.types.BOX|ft.types.BOX,ft.types.SPHERE|ft.types.BOX,ft.types.PLANE|ft.types.BOX,ft.types.CONVEXPOLYHEDRON,ft.types.SPHERE|ft.types.CONVEXPOLYHEDRON,ft.types.PLANE|ft.types.CONVEXPOLYHEDRON,ft.types.BOX|ft.types.CONVEXPOLYHEDRON,ft.types.SPHERE|ft.types.HEIGHTFIELD,ft.types.BOX|ft.types.HEIGHTFIELD,ft.types.CONVEXPOLYHEDRON|ft.types.HEIGHTFIELD,ft.types.PARTICLE|ft.types.SPHERE,ft.types.PLANE|ft.types.PARTICLE,ft.types.BOX|ft.types.PARTICLE,ft.types.PARTICLE|ft.types.CONVEXPOLYHEDRON,ft.types.CYLINDER,ft.types.SPHERE|ft.types.CYLINDER,ft.types.PLANE|ft.types.CYLINDER,ft.types.BOX|ft.types.CYLINDER,ft.types.CONVEXPOLYHEDRON|ft.types.CYLINDER,ft.types.HEIGHTFIELD|ft.types.CYLINDER,ft.types.PARTICLE|ft.types.CYLINDER,ft.types.SPHERE|ft.types.TRIMESH,ft.types.PLANE|ft.types.TRIMESH;new te;new te;new te;new te;new te;new qr;new qr;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new Xo;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te,new te,new te,new te,new te,new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new qr;new te;new te;new te;new te;new te;new te;new te;new te;new te;new Xo;new Nr;const Qh=globalThis.performance||{};if(!Qh.now){let t=Date.now();Qh.timing&&Qh.timing.navigationStart&&(t=Qh.timing.navigationStart),Qh.now=()=>Date.now()-t}new te;const tce=H.createContext(null);new P(1,1,1);new P;new dt;new cn;new YA;const nce=new P,ice=new P(1,1,1),rce=new gr,l2=new dt;function SN(t,e,n,i,r){return i===void 0&&(i=ice),t!==void 0?(l2.compose(nce.fromArray(e,t*3),rce.fromArray(n,t*4),i),r&&(r.matrixAutoUpdate=!1,r.matrix.copy(l2)),l2):l2.identity()}const sce=()=>{const t=[];return e=>t.includes(e)?!1:!!t.push(e)};function oce(t){let{allowSleep:e=!1,axisIndex:n=0,broadphase:i="Naive",children:r,defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:a=[0,-9.81,0],isPaused:l=!1,iterations:g=5,maxSubSteps:c=10,quatNormalizeFast:u=!1,quatNormalizeSkip:I=0,shouldInvalidate:h=!0,size:C=1e3,solver:b="GS",stepSize:m=1/60,tolerance:f=.001}=t;const{invalidate:p}=Go(),[{bodies:v,events:B,refs:G,scaleOverrides:R,subscriptions:w,worker:E}]=H.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new cge({allowSleep:e,axisIndex:n,broadphase:i,defaultContactMaterial:s,frictionGravity:o,gravity:a,iterations:g,quatNormalizeFast:u,quatNormalizeSkip:I,size:C,solver:b,tolerance:f})}));let x=0;const W=H.useCallback((z,N)=>{l||(x+=N,E.step({maxSubSteps:c,stepSize:m,timeSinceLastCalled:x}),x=0)},[l,c,m]),T=z=>{var N;let{body:L,contact:{bi:V,bj:M,...X},target:J,...re}=z;const se=(N=B[J])==null?void 0:N.collide;se&&se({body:G[L],contact:{bi:G[V],bj:G[M],...X},target:G[J],...re})},k=z=>{var N,L;let{bodyA:V,bodyB:M}=z;const X=(N=B[V])==null?void 0:N.collideBegin;X&&X({body:G[M],op:"event",target:G[V],type:"collideBegin"});const J=(L=B[M])==null?void 0:L.collideBegin;J&&J({body:G[V],op:"event",target:G[M],type:"collideBegin"})},_=z=>{var N,L;let{bodyA:V,bodyB:M}=z;const X=(N=B[V])==null?void 0:N.collideEnd;X&&X({body:G[M],op:"event",target:G[V],type:"collideEnd"});const J=(L=B[M])==null?void 0:L.collideEnd;J&&J({body:G[V],op:"event",target:G[M],type:"collideEnd"})},U=z=>{let{active:N,bodies:L=[],observations:V,positions:M,quaternions:X}=z;for(let J=0;J<L.length;J++)v[L[J]]=J;if(V.forEach(J=>{let[re,se,le]=J;const ce=(w[re]||{})[le];ce&&ce(se)}),!!N){for(const J of Object.values(G).filter(sce()))if(J instanceof hx)for(let re=0;re<J.count;re++){const se=`${J.uuid}/${re}`,le=v[se];le!==void 0&&(J.setMatrixAt(re,SN(le,M,X,R[se])),J.instanceMatrix.needsUpdate=!0)}else{const re=R[J.uuid]||J.scale;SN(v[J.uuid],M,X,re,J)}h&&p()}},O=z=>{var N;let{body:L,ray:{uuid:V,...M},...X}=z;const J=(N=B[V])==null?void 0:N.rayhit;J&&J({body:L?G[L]:null,ray:{uuid:V,...M},...X})};GI(W),H.useEffect(()=>(E.connect(),E.init(),E.on("collide",T),E.on("collideBegin",k),E.on("collideEnd",_),E.on("frame",U),E.on("rayhit",O),()=>{E.terminate(),E.removeAllListeners()}),[]),H.useEffect(()=>{E.axisIndex=n},[n]),H.useEffect(()=>{E.broadphase=i},[i]),H.useEffect(()=>{E.gravity=a},[a]),H.useEffect(()=>{E.iterations=g},[g]),H.useEffect(()=>{E.tolerance=f},[f]);const Y=H.useMemo(()=>({bodies:v,events:B,refs:G,scaleOverrides:R,subscriptions:w,worker:E}),[v,B,G,w,E]);return ne.jsx(tce.Provider,{value:Y,children:r})}const N0=new P,Xx=new P,ace=new P;function lce(t,e,n){const i=N0.setFromMatrixPosition(t.matrixWorld);i.project(e);const r=n.width/2,s=n.height/2;return[i.x*r+r,-(i.y*s)+s]}function gce(t,e){const n=N0.setFromMatrixPosition(t.matrixWorld),i=Xx.setFromMatrixPosition(e.matrixWorld),r=n.sub(i),s=e.getWorldDirection(ace);return r.angleTo(s)>Math.PI/2}function cce(t,e,n,i){const r=N0.setFromMatrixPosition(t.matrixWorld),s=r.clone();s.project(e),n.setFromCamera(s,e);const o=n.intersectObjects(i,!0);if(o.length){const a=o[0].distance;return r.distanceTo(n.ray.origin)<a}return!0}function uce(t,e){if(e instanceof Zo)return e.zoom;if(e instanceof Zn){const n=N0.setFromMatrixPosition(t.matrixWorld),i=Xx.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=n.distanceTo(i);return 1/(2*Math.tan(r/2)*s)}else return 1}function Ice(t,e,n){if(e instanceof Zn||e instanceof Zo){const i=N0.setFromMatrixPosition(t.matrixWorld),r=Xx.setFromMatrixPosition(e.matrixWorld),s=i.distanceTo(r),o=(n[1]-n[0])/(e.far-e.near),a=n[1]-o*e.far;return Math.round(o*s+a)}}const AS=t=>Math.abs(t)<1e-10?0:t;function CX(t,e,n=""){let i="matrix3d(";for(let r=0;r!==16;r++)i+=AS(e[r]*t.elements[r])+(r!==15?",":")");return n+i}const dce=(t=>e=>CX(e,t))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Ace=(t=>(e,n)=>CX(e,t(n),"translate(-50%,-50%)"))(t=>[1/t,1/t,1/t,1,-1/t,-1/t,-1/t,-1,1/t,1/t,1/t,1,1,1,1,1]);function hce(t){return t&&typeof t=="object"&&"current"in t}const Cce=H.forwardRef(({children:t,eps:e=.001,style:n,className:i,prepend:r,center:s,fullscreen:o,portal:a,distanceFactor:l,sprite:g=!1,transform:c=!1,occlude:u,onOcclude:I,castShadow:h,receiveShadow:C,material:b,geometry:m,zIndexRange:f=[16777271,0],calculatePosition:p=lce,as:v="div",wrapperClass:B,pointerEvents:G="auto",...R},w)=>{const{gl:E,camera:x,scene:W,size:T,raycaster:k,events:_,viewport:U}=Go(),[O]=H.useState(()=>document.createElement(v)),Y=H.useRef(),z=H.useRef(null),N=H.useRef(0),L=H.useRef([0,0]),V=H.useRef(null),M=H.useRef(null),X=(a==null?void 0:a.current)||_.connected||E.domElement.parentNode,J=H.useRef(null),re=H.useRef(!1),se=H.useMemo(()=>u&&u!=="blending"||Array.isArray(u)&&u.length&&hce(u[0]),[u]);H.useLayoutEffect(()=>{const Fe=E.domElement;u&&u==="blending"?(Fe.style.zIndex=`${Math.floor(f[0]/2)}`,Fe.style.position="absolute",Fe.style.pointerEvents="none"):(Fe.style.zIndex=null,Fe.style.position=null,Fe.style.pointerEvents=null)},[u]),H.useLayoutEffect(()=>{if(z.current){const Fe=Y.current=LV(O);if(W.updateMatrixWorld(),c)O.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const oe=p(z.current,x,T);O.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${oe[0]}px,${oe[1]}px,0);transform-origin:0 0;`}return X&&(r?X.prepend(O):X.appendChild(O)),()=>{X&&X.removeChild(O),Fe.unmount()}}},[X,c]),H.useLayoutEffect(()=>{B&&(O.className=B)},[B]);const le=H.useMemo(()=>c?{position:"absolute",top:0,left:0,width:T.width,height:T.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-T.height/2,left:-T.width/2,width:T.width,height:T.height},...n},[n,s,o,T,c]),ae=H.useMemo(()=>({position:"absolute",pointerEvents:G}),[G]);H.useLayoutEffect(()=>{if(re.current=!1,c){var Fe;(Fe=Y.current)==null||Fe.render(H.createElement("div",{ref:V,style:le},H.createElement("div",{ref:M,style:ae},H.createElement("div",{ref:w,className:i,style:n,children:t}))))}else{var oe;(oe=Y.current)==null||oe.render(H.createElement("div",{ref:w,style:le,className:i,children:t}))}});const ce=H.useRef(!0);GI(Fe=>{if(z.current){x.updateMatrixWorld(),z.current.updateWorldMatrix(!0,!1);const oe=c?L.current:p(z.current,x,T);if(c||Math.abs(N.current-x.zoom)>e||Math.abs(L.current[0]-oe[0])>e||Math.abs(L.current[1]-oe[1])>e){const D=gce(z.current,x);let fe=!1;se&&(Array.isArray(u)?fe=u.map(Ue=>Ue.current):u!=="blending"&&(fe=[W]));const Ce=ce.current;if(fe){const Ue=cce(z.current,x,k,fe);ce.current=Ue&&!D}else ce.current=!D;Ce!==ce.current&&(I?I(!ce.current):O.style.display=ce.current?"block":"none");const pe=Math.floor(f[0]/2),be=u?se?[f[0],pe]:[pe-1,0]:f;if(O.style.zIndex=`${Ice(z.current,x,be)}`,c){const[Ue,me]=[T.width/2,T.height/2],we=x.projectionMatrix.elements[5]*me,{isOrthographicCamera:Be,top:Ae,left:De,bottom:Q,right:K}=x,ge=dce(x.matrixWorldInverse),Le=Be?`scale(${we})translate(${AS(-(K+De)/2)}px,${AS((Ae+Q)/2)}px)`:`translateZ(${we}px)`;let Re=z.current.matrixWorld;g&&(Re=x.matrixWorldInverse.clone().transpose().copyPosition(Re).scale(z.current.scale),Re.elements[3]=Re.elements[7]=Re.elements[11]=0,Re.elements[15]=1),O.style.width=T.width+"px",O.style.height=T.height+"px",O.style.perspective=Be?"":`${we}px`,V.current&&M.current&&(V.current.style.transform=`${Le}${ge}translate(${Ue}px,${me}px)`,M.current.style.transform=Ace(Re,1/((l||10)/400)))}else{const Ue=l===void 0?1:uce(z.current,x)*l;O.style.transform=`translate3d(${oe[0]}px,${oe[1]}px,0) scale(${Ue})`}L.current=oe,N.current=x.zoom}}if(!se&&J.current&&!re.current)if(c){if(V.current){const oe=V.current.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const{isOrthographicCamera:D}=x;if(D||m)R.scale&&(Array.isArray(R.scale)?R.scale instanceof P?J.current.scale.copy(R.scale.clone().divideScalar(1)):J.current.scale.set(1/R.scale[0],1/R.scale[1],1/R.scale[2]):J.current.scale.setScalar(1/R.scale));else{const fe=(l||10)/400,Ce=oe.clientWidth*fe,pe=oe.clientHeight*fe;J.current.scale.set(Ce,pe,1)}re.current=!0}}}else{const oe=O.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const D=1/U.factor,fe=oe.clientWidth*D,Ce=oe.clientHeight*D;J.current.scale.set(fe,Ce,1),re.current=!0}J.current.lookAt(Fe.camera.position)}});const Ee=H.useMemo(()=>({vertexShader:c?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[c]);return H.createElement("group",Es({},R,{ref:z}),u&&!se&&H.createElement("mesh",{castShadow:h,receiveShadow:C,ref:J},m||H.createElement("planeGeometry",null),b||H.createElement("shaderMaterial",{side:Ps,vertexShader:Ee.vertexShader,fragmentShader:Ee.fragmentShader})))});function fce(t){return function(e){t.forEach(function(n){typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function Yx(){}Yx.prototype.s2u=function(t){for(var e=this.s2uTable,n="",i=0;i<t.length;){var r=t[i++];if(!(r>=0&&r<=126||r>=161&&r<=223)&&i<t.length&&(r=r<<8|t[i++]),e[r]===void 0)return console.error("unknown char code "+r+"."),n;n+=String.fromCharCode(e[r])}return n};Yx.prototype.s2uTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:65340,33120:65374,33121:8741,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:65293,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:65504,33170:65505,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:65506,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34624:9312,34625:9313,34626:9314,34627:9315,34628:9316,34629:9317,34630:9318,34631:9319,34632:9320,34633:9321,34634:9322,34635:9323,34636:9324,34637:9325,34638:9326,34639:9327,34640:9328,34641:9329,34642:9330,34643:9331,34644:8544,34645:8545,34646:8546,34647:8547,34648:8548,34649:8549,34650:8550,34651:8551,34652:8552,34653:8553,34655:13129,34656:13076,34657:13090,34658:13133,34659:13080,34660:13095,34661:13059,34662:13110,34663:13137,34664:13143,34665:13069,34666:13094,34667:13091,34668:13099,34669:13130,34670:13115,34671:13212,34672:13213,34673:13214,34674:13198,34675:13199,34676:13252,34677:13217,34686:13179,34688:12317,34689:12319,34690:8470,34691:13261,34692:8481,34693:12964,34694:12965,34695:12966,34696:12967,34697:12968,34698:12849,34699:12850,34700:12857,34701:13182,34702:13181,34703:13180,34704:8786,34705:8801,34706:8747,34707:8750,34708:8721,34709:8730,34710:8869,34711:8736,34712:8735,34713:8895,34714:8757,34715:8745,34716:8746,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081,60736:32394,60737:35100,60738:37704,60739:37512,60740:34012,60741:20425,60742:28859,60743:26161,60744:26824,60745:37625,60746:26363,60747:24389,60748:20008,60749:20193,60750:20220,60751:20224,60752:20227,60753:20281,60754:20310,60755:20370,60756:20362,60757:20378,60758:20372,60759:20429,60760:20544,60761:20514,60762:20479,60763:20510,60764:20550,60765:20592,60766:20546,60767:20628,60768:20724,60769:20696,60770:20810,60771:20836,60772:20893,60773:20926,60774:20972,60775:21013,60776:21148,60777:21158,60778:21184,60779:21211,60780:21248,60781:21255,60782:21284,60783:21362,60784:21395,60785:21426,60786:21469,60787:64014,60788:21660,60789:21642,60790:21673,60791:21759,60792:21894,60793:22361,60794:22373,60795:22444,60796:22472,60797:22471,60798:64015,60800:64016,60801:22686,60802:22706,60803:22795,60804:22867,60805:22875,60806:22877,60807:22883,60808:22948,60809:22970,60810:23382,60811:23488,60812:29999,60813:23512,60814:23532,60815:23582,60816:23718,60817:23738,60818:23797,60819:23847,60820:23891,60821:64017,60822:23874,60823:23917,60824:23992,60825:23993,60826:24016,60827:24353,60828:24372,60829:24423,60830:24503,60831:24542,60832:24669,60833:24709,60834:24714,60835:24798,60836:24789,60837:24864,60838:24818,60839:24849,60840:24887,60841:24880,60842:24984,60843:25107,60844:25254,60845:25589,60846:25696,60847:25757,60848:25806,60849:25934,60850:26112,60851:26133,60852:26171,60853:26121,60854:26158,60855:26142,60856:26148,60857:26213,60858:26199,60859:26201,60860:64018,60861:26227,60862:26265,60863:26272,60864:26290,60865:26303,60866:26362,60867:26382,60868:63785,60869:26470,60870:26555,60871:26706,60872:26560,60873:26625,60874:26692,60875:26831,60876:64019,60877:26984,60878:64020,60879:27032,60880:27106,60881:27184,60882:27243,60883:27206,60884:27251,60885:27262,60886:27362,60887:27364,60888:27606,60889:27711,60890:27740,60891:27782,60892:27759,60893:27866,60894:27908,60895:28039,60896:28015,60897:28054,60898:28076,60899:28111,60900:28152,60901:28146,60902:28156,60903:28217,60904:28252,60905:28199,60906:28220,60907:28351,60908:28552,60909:28597,60910:28661,60911:28677,60912:28679,60913:28712,60914:28805,60915:28843,60916:28943,60917:28932,60918:29020,60919:28998,60920:28999,60921:64021,60922:29121,60923:29182,60924:29361,60992:29374,60993:29476,60994:64022,60995:29559,60996:29629,60997:29641,60998:29654,60999:29667,61e3:29650,61001:29703,61002:29685,61003:29734,61004:29738,61005:29737,61006:29742,61007:29794,61008:29833,61009:29855,61010:29953,61011:30063,61012:30338,61013:30364,61014:30366,61015:30363,61016:30374,61017:64023,61018:30534,61019:21167,61020:30753,61021:30798,61022:30820,61023:30842,61024:31024,61025:64024,61026:64025,61027:64026,61028:31124,61029:64027,61030:31131,61031:31441,61032:31463,61033:64028,61034:31467,61035:31646,61036:64029,61037:32072,61038:32092,61039:32183,61040:32160,61041:32214,61042:32338,61043:32583,61044:32673,61045:64030,61046:33537,61047:33634,61048:33663,61049:33735,61050:33782,61051:33864,61052:33972,61053:34131,61054:34137,61056:34155,61057:64031,61058:34224,61059:64032,61060:64033,61061:34823,61062:35061,61063:35346,61064:35383,61065:35449,61066:35495,61067:35518,61068:35551,61069:64034,61070:35574,61071:35667,61072:35711,61073:36080,61074:36084,61075:36114,61076:36214,61077:64035,61078:36559,61079:64036,61080:64037,61081:36967,61082:37086,61083:64038,61084:37141,61085:37159,61086:37338,61087:37335,61088:37342,61089:37357,61090:37358,61091:37348,61092:37349,61093:37382,61094:37392,61095:37386,61096:37434,61097:37440,61098:37436,61099:37454,61100:37465,61101:37457,61102:37433,61103:37479,61104:37543,61105:37495,61106:37496,61107:37607,61108:37591,61109:37593,61110:37584,61111:64039,61112:37589,61113:37600,61114:37587,61115:37669,61116:37665,61117:37627,61118:64040,61119:37662,61120:37631,61121:37661,61122:37634,61123:37744,61124:37719,61125:37796,61126:37830,61127:37854,61128:37880,61129:37937,61130:37957,61131:37960,61132:38290,61133:63964,61134:64041,61135:38557,61136:38575,61137:38707,61138:38715,61139:38723,61140:38733,61141:38735,61142:38737,61143:38741,61144:38999,61145:39013,61146:64042,61147:64043,61148:39207,61149:64044,61150:39326,61151:39502,61152:39641,61153:39644,61154:39797,61155:39794,61156:39823,61157:39857,61158:39867,61159:39936,61160:40304,61161:40299,61162:64045,61163:40473,61164:40657,61167:8560,61168:8561,61169:8562,61170:8563,61171:8564,61172:8565,61173:8566,61174:8567,61175:8568,61176:8569,61177:65506,61178:65508,61179:65287,61180:65282,61504:57344,61505:57345,61506:57346,61507:57347,61508:57348,61509:57349,61510:57350,61511:57351,61512:57352,61513:57353,61514:57354,61515:57355,61516:57356,61517:57357,61518:57358,61519:57359,61520:57360,61521:57361,61522:57362,61523:57363,61524:57364,61525:57365,61526:57366,61527:57367,61528:57368,61529:57369,61530:57370,61531:57371,61532:57372,61533:57373,61534:57374,61535:57375,61536:57376,61537:57377,61538:57378,61539:57379,61540:57380,61541:57381,61542:57382,61543:57383,61544:57384,61545:57385,61546:57386,61547:57387,61548:57388,61549:57389,61550:57390,61551:57391,61552:57392,61553:57393,61554:57394,61555:57395,61556:57396,61557:57397,61558:57398,61559:57399,61560:57400,61561:57401,61562:57402,61563:57403,61564:57404,61565:57405,61566:57406,61568:57407,61569:57408,61570:57409,61571:57410,61572:57411,61573:57412,61574:57413,61575:57414,61576:57415,61577:57416,61578:57417,61579:57418,61580:57419,61581:57420,61582:57421,61583:57422,61584:57423,61585:57424,61586:57425,61587:57426,61588:57427,61589:57428,61590:57429,61591:57430,61592:57431,61593:57432,61594:57433,61595:57434,61596:57435,61597:57436,61598:57437,61599:57438,61600:57439,61601:57440,61602:57441,61603:57442,61604:57443,61605:57444,61606:57445,61607:57446,61608:57447,61609:57448,61610:57449,61611:57450,61612:57451,61613:57452,61614:57453,61615:57454,61616:57455,61617:57456,61618:57457,61619:57458,61620:57459,61621:57460,61622:57461,61623:57462,61624:57463,61625:57464,61626:57465,61627:57466,61628:57467,61629:57468,61630:57469,61631:57470,61632:57471,61633:57472,61634:57473,61635:57474,61636:57475,61637:57476,61638:57477,61639:57478,61640:57479,61641:57480,61642:57481,61643:57482,61644:57483,61645:57484,61646:57485,61647:57486,61648:57487,61649:57488,61650:57489,61651:57490,61652:57491,61653:57492,61654:57493,61655:57494,61656:57495,61657:57496,61658:57497,61659:57498,61660:57499,61661:57500,61662:57501,61663:57502,61664:57503,61665:57504,61666:57505,61667:57506,61668:57507,61669:57508,61670:57509,61671:57510,61672:57511,61673:57512,61674:57513,61675:57514,61676:57515,61677:57516,61678:57517,61679:57518,61680:57519,61681:57520,61682:57521,61683:57522,61684:57523,61685:57524,61686:57525,61687:57526,61688:57527,61689:57528,61690:57529,61691:57530,61692:57531,61760:57532,61761:57533,61762:57534,61763:57535,61764:57536,61765:57537,61766:57538,61767:57539,61768:57540,61769:57541,61770:57542,61771:57543,61772:57544,61773:57545,61774:57546,61775:57547,61776:57548,61777:57549,61778:57550,61779:57551,61780:57552,61781:57553,61782:57554,61783:57555,61784:57556,61785:57557,61786:57558,61787:57559,61788:57560,61789:57561,61790:57562,61791:57563,61792:57564,61793:57565,61794:57566,61795:57567,61796:57568,61797:57569,61798:57570,61799:57571,61800:57572,61801:57573,61802:57574,61803:57575,61804:57576,61805:57577,61806:57578,61807:57579,61808:57580,61809:57581,61810:57582,61811:57583,61812:57584,61813:57585,61814:57586,61815:57587,61816:57588,61817:57589,61818:57590,61819:57591,61820:57592,61821:57593,61822:57594,61824:57595,61825:57596,61826:57597,61827:57598,61828:57599,61829:57600,61830:57601,61831:57602,61832:57603,61833:57604,61834:57605,61835:57606,61836:57607,61837:57608,61838:57609,61839:57610,61840:57611,61841:57612,61842:57613,61843:57614,61844:57615,61845:57616,61846:57617,61847:57618,61848:57619,61849:57620,61850:57621,61851:57622,61852:57623,61853:57624,61854:57625,61855:57626,61856:57627,61857:57628,61858:57629,61859:57630,61860:57631,61861:57632,61862:57633,61863:57634,61864:57635,61865:57636,61866:57637,61867:57638,61868:57639,61869:57640,61870:57641,61871:57642,61872:57643,61873:57644,61874:57645,61875:57646,61876:57647,61877:57648,61878:57649,61879:57650,61880:57651,61881:57652,61882:57653,61883:57654,61884:57655,61885:57656,61886:57657,61887:57658,61888:57659,61889:57660,61890:57661,61891:57662,61892:57663,61893:57664,61894:57665,61895:57666,61896:57667,61897:57668,61898:57669,61899:57670,61900:57671,61901:57672,61902:57673,61903:57674,61904:57675,61905:57676,61906:57677,61907:57678,61908:57679,61909:57680,61910:57681,61911:57682,61912:57683,61913:57684,61914:57685,61915:57686,61916:57687,61917:57688,61918:57689,61919:57690,61920:57691,61921:57692,61922:57693,61923:57694,61924:57695,61925:57696,61926:57697,61927:57698,61928:57699,61929:57700,61930:57701,61931:57702,61932:57703,61933:57704,61934:57705,61935:57706,61936:57707,61937:57708,61938:57709,61939:57710,61940:57711,61941:57712,61942:57713,61943:57714,61944:57715,61945:57716,61946:57717,61947:57718,61948:57719,62016:57720,62017:57721,62018:57722,62019:57723,62020:57724,62021:57725,62022:57726,62023:57727,62024:57728,62025:57729,62026:57730,62027:57731,62028:57732,62029:57733,62030:57734,62031:57735,62032:57736,62033:57737,62034:57738,62035:57739,62036:57740,62037:57741,62038:57742,62039:57743,62040:57744,62041:57745,62042:57746,62043:57747,62044:57748,62045:57749,62046:57750,62047:57751,62048:57752,62049:57753,62050:57754,62051:57755,62052:57756,62053:57757,62054:57758,62055:57759,62056:57760,62057:57761,62058:57762,62059:57763,62060:57764,62061:57765,62062:57766,62063:57767,62064:57768,62065:57769,62066:57770,62067:57771,62068:57772,62069:57773,62070:57774,62071:57775,62072:57776,62073:57777,62074:57778,62075:57779,62076:57780,62077:57781,62078:57782,62080:57783,62081:57784,62082:57785,62083:57786,62084:57787,62085:57788,62086:57789,62087:57790,62088:57791,62089:57792,62090:57793,62091:57794,62092:57795,62093:57796,62094:57797,62095:57798,62096:57799,62097:57800,62098:57801,62099:57802,62100:57803,62101:57804,62102:57805,62103:57806,62104:57807,62105:57808,62106:57809,62107:57810,62108:57811,62109:57812,62110:57813,62111:57814,62112:57815,62113:57816,62114:57817,62115:57818,62116:57819,62117:57820,62118:57821,62119:57822,62120:57823,62121:57824,62122:57825,62123:57826,62124:57827,62125:57828,62126:57829,62127:57830,62128:57831,62129:57832,62130:57833,62131:57834,62132:57835,62133:57836,62134:57837,62135:57838,62136:57839,62137:57840,62138:57841,62139:57842,62140:57843,62141:57844,62142:57845,62143:57846,62144:57847,62145:57848,62146:57849,62147:57850,62148:57851,62149:57852,62150:57853,62151:57854,62152:57855,62153:57856,62154:57857,62155:57858,62156:57859,62157:57860,62158:57861,62159:57862,62160:57863,62161:57864,62162:57865,62163:57866,62164:57867,62165:57868,62166:57869,62167:57870,62168:57871,62169:57872,62170:57873,62171:57874,62172:57875,62173:57876,62174:57877,62175:57878,62176:57879,62177:57880,62178:57881,62179:57882,62180:57883,62181:57884,62182:57885,62183:57886,62184:57887,62185:57888,62186:57889,62187:57890,62188:57891,62189:57892,62190:57893,62191:57894,62192:57895,62193:57896,62194:57897,62195:57898,62196:57899,62197:57900,62198:57901,62199:57902,62200:57903,62201:57904,62202:57905,62203:57906,62204:57907,62272:57908,62273:57909,62274:57910,62275:57911,62276:57912,62277:57913,62278:57914,62279:57915,62280:57916,62281:57917,62282:57918,62283:57919,62284:57920,62285:57921,62286:57922,62287:57923,62288:57924,62289:57925,62290:57926,62291:57927,62292:57928,62293:57929,62294:57930,62295:57931,62296:57932,62297:57933,62298:57934,62299:57935,62300:57936,62301:57937,62302:57938,62303:57939,62304:57940,62305:57941,62306:57942,62307:57943,62308:57944,62309:57945,62310:57946,62311:57947,62312:57948,62313:57949,62314:57950,62315:57951,62316:57952,62317:57953,62318:57954,62319:57955,62320:57956,62321:57957,62322:57958,62323:57959,62324:57960,62325:57961,62326:57962,62327:57963,62328:57964,62329:57965,62330:57966,62331:57967,62332:57968,62333:57969,62334:57970,62336:57971,62337:57972,62338:57973,62339:57974,62340:57975,62341:57976,62342:57977,62343:57978,62344:57979,62345:57980,62346:57981,62347:57982,62348:57983,62349:57984,62350:57985,62351:57986,62352:57987,62353:57988,62354:57989,62355:57990,62356:57991,62357:57992,62358:57993,62359:57994,62360:57995,62361:57996,62362:57997,62363:57998,62364:57999,62365:58e3,62366:58001,62367:58002,62368:58003,62369:58004,62370:58005,62371:58006,62372:58007,62373:58008,62374:58009,62375:58010,62376:58011,62377:58012,62378:58013,62379:58014,62380:58015,62381:58016,62382:58017,62383:58018,62384:58019,62385:58020,62386:58021,62387:58022,62388:58023,62389:58024,62390:58025,62391:58026,62392:58027,62393:58028,62394:58029,62395:58030,62396:58031,62397:58032,62398:58033,62399:58034,62400:58035,62401:58036,62402:58037,62403:58038,62404:58039,62405:58040,62406:58041,62407:58042,62408:58043,62409:58044,62410:58045,62411:58046,62412:58047,62413:58048,62414:58049,62415:58050,62416:58051,62417:58052,62418:58053,62419:58054,62420:58055,62421:58056,62422:58057,62423:58058,62424:58059,62425:58060,62426:58061,62427:58062,62428:58063,62429:58064,62430:58065,62431:58066,62432:58067,62433:58068,62434:58069,62435:58070,62436:58071,62437:58072,62438:58073,62439:58074,62440:58075,62441:58076,62442:58077,62443:58078,62444:58079,62445:58080,62446:58081,62447:58082,62448:58083,62449:58084,62450:58085,62451:58086,62452:58087,62453:58088,62454:58089,62455:58090,62456:58091,62457:58092,62458:58093,62459:58094,62460:58095,62528:58096,62529:58097,62530:58098,62531:58099,62532:58100,62533:58101,62534:58102,62535:58103,62536:58104,62537:58105,62538:58106,62539:58107,62540:58108,62541:58109,62542:58110,62543:58111,62544:58112,62545:58113,62546:58114,62547:58115,62548:58116,62549:58117,62550:58118,62551:58119,62552:58120,62553:58121,62554:58122,62555:58123,62556:58124,62557:58125,62558:58126,62559:58127,62560:58128,62561:58129,62562:58130,62563:58131,62564:58132,62565:58133,62566:58134,62567:58135,62568:58136,62569:58137,62570:58138,62571:58139,62572:58140,62573:58141,62574:58142,62575:58143,62576:58144,62577:58145,62578:58146,62579:58147,62580:58148,62581:58149,62582:58150,62583:58151,62584:58152,62585:58153,62586:58154,62587:58155,62588:58156,62589:58157,62590:58158,62592:58159,62593:58160,62594:58161,62595:58162,62596:58163,62597:58164,62598:58165,62599:58166,62600:58167,62601:58168,62602:58169,62603:58170,62604:58171,62605:58172,62606:58173,62607:58174,62608:58175,62609:58176,62610:58177,62611:58178,62612:58179,62613:58180,62614:58181,62615:58182,62616:58183,62617:58184,62618:58185,62619:58186,62620:58187,62621:58188,62622:58189,62623:58190,62624:58191,62625:58192,62626:58193,62627:58194,62628:58195,62629:58196,62630:58197,62631:58198,62632:58199,62633:58200,62634:58201,62635:58202,62636:58203,62637:58204,62638:58205,62639:58206,62640:58207,62641:58208,62642:58209,62643:58210,62644:58211,62645:58212,62646:58213,62647:58214,62648:58215,62649:58216,62650:58217,62651:58218,62652:58219,62653:58220,62654:58221,62655:58222,62656:58223,62657:58224,62658:58225,62659:58226,62660:58227,62661:58228,62662:58229,62663:58230,62664:58231,62665:58232,62666:58233,62667:58234,62668:58235,62669:58236,62670:58237,62671:58238,62672:58239,62673:58240,62674:58241,62675:58242,62676:58243,62677:58244,62678:58245,62679:58246,62680:58247,62681:58248,62682:58249,62683:58250,62684:58251,62685:58252,62686:58253,62687:58254,62688:58255,62689:58256,62690:58257,62691:58258,62692:58259,62693:58260,62694:58261,62695:58262,62696:58263,62697:58264,62698:58265,62699:58266,62700:58267,62701:58268,62702:58269,62703:58270,62704:58271,62705:58272,62706:58273,62707:58274,62708:58275,62709:58276,62710:58277,62711:58278,62712:58279,62713:58280,62714:58281,62715:58282,62716:58283,62784:58284,62785:58285,62786:58286,62787:58287,62788:58288,62789:58289,62790:58290,62791:58291,62792:58292,62793:58293,62794:58294,62795:58295,62796:58296,62797:58297,62798:58298,62799:58299,62800:58300,62801:58301,62802:58302,62803:58303,62804:58304,62805:58305,62806:58306,62807:58307,62808:58308,62809:58309,62810:58310,62811:58311,62812:58312,62813:58313,62814:58314,62815:58315,62816:58316,62817:58317,62818:58318,62819:58319,62820:58320,62821:58321,62822:58322,62823:58323,62824:58324,62825:58325,62826:58326,62827:58327,62828:58328,62829:58329,62830:58330,62831:58331,62832:58332,62833:58333,62834:58334,62835:58335,62836:58336,62837:58337,62838:58338,62839:58339,62840:58340,62841:58341,62842:58342,62843:58343,62844:58344,62845:58345,62846:58346,62848:58347,62849:58348,62850:58349,62851:58350,62852:58351,62853:58352,62854:58353,62855:58354,62856:58355,62857:58356,62858:58357,62859:58358,62860:58359,62861:58360,62862:58361,62863:58362,62864:58363,62865:58364,62866:58365,62867:58366,62868:58367,62869:58368,62870:58369,62871:58370,62872:58371,62873:58372,62874:58373,62875:58374,62876:58375,62877:58376,62878:58377,62879:58378,62880:58379,62881:58380,62882:58381,62883:58382,62884:58383,62885:58384,62886:58385,62887:58386,62888:58387,62889:58388,62890:58389,62891:58390,62892:58391,62893:58392,62894:58393,62895:58394,62896:58395,62897:58396,62898:58397,62899:58398,62900:58399,62901:58400,62902:58401,62903:58402,62904:58403,62905:58404,62906:58405,62907:58406,62908:58407,62909:58408,62910:58409,62911:58410,62912:58411,62913:58412,62914:58413,62915:58414,62916:58415,62917:58416,62918:58417,62919:58418,62920:58419,62921:58420,62922:58421,62923:58422,62924:58423,62925:58424,62926:58425,62927:58426,62928:58427,62929:58428,62930:58429,62931:58430,62932:58431,62933:58432,62934:58433,62935:58434,62936:58435,62937:58436,62938:58437,62939:58438,62940:58439,62941:58440,62942:58441,62943:58442,62944:58443,62945:58444,62946:58445,62947:58446,62948:58447,62949:58448,62950:58449,62951:58450,62952:58451,62953:58452,62954:58453,62955:58454,62956:58455,62957:58456,62958:58457,62959:58458,62960:58459,62961:58460,62962:58461,62963:58462,62964:58463,62965:58464,62966:58465,62967:58466,62968:58467,62969:58468,62970:58469,62971:58470,62972:58471,63040:58472,63041:58473,63042:58474,63043:58475,63044:58476,63045:58477,63046:58478,63047:58479,63048:58480,63049:58481,63050:58482,63051:58483,63052:58484,63053:58485,63054:58486,63055:58487,63056:58488,63057:58489,63058:58490,63059:58491,63060:58492,63061:58493,63062:58494,63063:58495,63064:58496,63065:58497,63066:58498,63067:58499,63068:58500,63069:58501,63070:58502,63071:58503,63072:58504,63073:58505,63074:58506,63075:58507,63076:58508,63077:58509,63078:58510,63079:58511,63080:58512,63081:58513,63082:58514,63083:58515,63084:58516,63085:58517,63086:58518,63087:58519,63088:58520,63089:58521,63090:58522,63091:58523,63092:58524,63093:58525,63094:58526,63095:58527,63096:58528,63097:58529,63098:58530,63099:58531,63100:58532,63101:58533,63102:58534,63104:58535,63105:58536,63106:58537,63107:58538,63108:58539,63109:58540,63110:58541,63111:58542,63112:58543,63113:58544,63114:58545,63115:58546,63116:58547,63117:58548,63118:58549,63119:58550,63120:58551,63121:58552,63122:58553,63123:58554,63124:58555,63125:58556,63126:58557,63127:58558,63128:58559,63129:58560,63130:58561,63131:58562,63132:58563,63133:58564,63134:58565,63135:58566,63136:58567,63137:58568,63138:58569,63139:58570,63140:58571,63141:58572,63142:58573,63143:58574,63144:58575,63145:58576,63146:58577,63147:58578,63148:58579,63149:58580,63150:58581,63151:58582,63152:58583,63153:58584,63154:58585,63155:58586,63156:58587,63157:58588,63158:58589,63159:58590,63160:58591,63161:58592,63162:58593,63163:58594,63164:58595,63165:58596,63166:58597,63167:58598,63168:58599,63169:58600,63170:58601,63171:58602,63172:58603,63173:58604,63174:58605,63175:58606,63176:58607,63177:58608,63178:58609,63179:58610,63180:58611,63181:58612,63182:58613,63183:58614,63184:58615,63185:58616,63186:58617,63187:58618,63188:58619,63189:58620,63190:58621,63191:58622,63192:58623,63193:58624,63194:58625,63195:58626,63196:58627,63197:58628,63198:58629,63199:58630,63200:58631,63201:58632,63202:58633,63203:58634,63204:58635,63205:58636,63206:58637,63207:58638,63208:58639,63209:58640,63210:58641,63211:58642,63212:58643,63213:58644,63214:58645,63215:58646,63216:58647,63217:58648,63218:58649,63219:58650,63220:58651,63221:58652,63222:58653,63223:58654,63224:58655,63225:58656,63226:58657,63227:58658,63228:58659,63296:58660,63297:58661,63298:58662,63299:58663,63300:58664,63301:58665,63302:58666,63303:58667,63304:58668,63305:58669,63306:58670,63307:58671,63308:58672,63309:58673,63310:58674,63311:58675,63312:58676,63313:58677,63314:58678,63315:58679,63316:58680,63317:58681,63318:58682,63319:58683,63320:58684,63321:58685,63322:58686,63323:58687,63324:58688,63325:58689,63326:58690,63327:58691,63328:58692,63329:58693,63330:58694,63331:58695,63332:58696,63333:58697,63334:58698,63335:58699,63336:58700,63337:58701,63338:58702,63339:58703,63340:58704,63341:58705,63342:58706,63343:58707,63344:58708,63345:58709,63346:58710,63347:58711,63348:58712,63349:58713,63350:58714,63351:58715,63352:58716,63353:58717,63354:58718,63355:58719,63356:58720,63357:58721,63358:58722,63360:58723,63361:58724,63362:58725,63363:58726,63364:58727,63365:58728,63366:58729,63367:58730,63368:58731,63369:58732,63370:58733,63371:58734,63372:58735,63373:58736,63374:58737,63375:58738,63376:58739,63377:58740,63378:58741,63379:58742,63380:58743,63381:58744,63382:58745,63383:58746,63384:58747,63385:58748,63386:58749,63387:58750,63388:58751,63389:58752,63390:58753,63391:58754,63392:58755,63393:58756,63394:58757,63395:58758,63396:58759,63397:58760,63398:58761,63399:58762,63400:58763,63401:58764,63402:58765,63403:58766,63404:58767,63405:58768,63406:58769,63407:58770,63408:58771,63409:58772,63410:58773,63411:58774,63412:58775,63413:58776,63414:58777,63415:58778,63416:58779,63417:58780,63418:58781,63419:58782,63420:58783,63421:58784,63422:58785,63423:58786,63424:58787,63425:58788,63426:58789,63427:58790,63428:58791,63429:58792,63430:58793,63431:58794,63432:58795,63433:58796,63434:58797,63435:58798,63436:58799,63437:58800,63438:58801,63439:58802,63440:58803,63441:58804,63442:58805,63443:58806,63444:58807,63445:58808,63446:58809,63447:58810,63448:58811,63449:58812,63450:58813,63451:58814,63452:58815,63453:58816,63454:58817,63455:58818,63456:58819,63457:58820,63458:58821,63459:58822,63460:58823,63461:58824,63462:58825,63463:58826,63464:58827,63465:58828,63466:58829,63467:58830,63468:58831,63469:58832,63470:58833,63471:58834,63472:58835,63473:58836,63474:58837,63475:58838,63476:58839,63477:58840,63478:58841,63479:58842,63480:58843,63481:58844,63482:58845,63483:58846,63484:58847,63552:58848,63553:58849,63554:58850,63555:58851,63556:58852,63557:58853,63558:58854,63559:58855,63560:58856,63561:58857,63562:58858,63563:58859,63564:58860,63565:58861,63566:58862,63567:58863,63568:58864,63569:58865,63570:58866,63571:58867,63572:58868,63573:58869,63574:58870,63575:58871,63576:58872,63577:58873,63578:58874,63579:58875,63580:58876,63581:58877,63582:58878,63583:58879,63584:58880,63585:58881,63586:58882,63587:58883,63588:58884,63589:58885,63590:58886,63591:58887,63592:58888,63593:58889,63594:58890,63595:58891,63596:58892,63597:58893,63598:58894,63599:58895,63600:58896,63601:58897,63602:58898,63603:58899,63604:58900,63605:58901,63606:58902,63607:58903,63608:58904,63609:58905,63610:58906,63611:58907,63612:58908,63613:58909,63614:58910,63616:58911,63617:58912,63618:58913,63619:58914,63620:58915,63621:58916,63622:58917,63623:58918,63624:58919,63625:58920,63626:58921,63627:58922,63628:58923,63629:58924,63630:58925,63631:58926,63632:58927,63633:58928,63634:58929,63635:58930,63636:58931,63637:58932,63638:58933,63639:58934,63640:58935,63641:58936,63642:58937,63643:58938,63644:58939,63645:58940,63646:58941,63647:58942,63648:58943,63649:58944,63650:58945,63651:58946,63652:58947,63653:58948,63654:58949,63655:58950,63656:58951,63657:58952,63658:58953,63659:58954,63660:58955,63661:58956,63662:58957,63663:58958,63664:58959,63665:58960,63666:58961,63667:58962,63668:58963,63669:58964,63670:58965,63671:58966,63672:58967,63673:58968,63674:58969,63675:58970,63676:58971,63677:58972,63678:58973,63679:58974,63680:58975,63681:58976,63682:58977,63683:58978,63684:58979,63685:58980,63686:58981,63687:58982,63688:58983,63689:58984,63690:58985,63691:58986,63692:58987,63693:58988,63694:58989,63695:58990,63696:58991,63697:58992,63698:58993,63699:58994,63700:58995,63701:58996,63702:58997,63703:58998,63704:58999,63705:59e3,63706:59001,63707:59002,63708:59003,63709:59004,63710:59005,63711:59006,63712:59007,63713:59008,63714:59009,63715:59010,63716:59011,63717:59012,63718:59013,63719:59014,63720:59015,63721:59016,63722:59017,63723:59018,63724:59019,63725:59020,63726:59021,63727:59022,63728:59023,63729:59024,63730:59025,63731:59026,63732:59027,63733:59028,63734:59029,63735:59030,63736:59031,63737:59032,63738:59033,63739:59034,63740:59035,64064:8560,64065:8561,64066:8562,64067:8563,64068:8564,64069:8565,64070:8566,64071:8567,64072:8568,64073:8569,64074:8544,64075:8545,64076:8546,64077:8547,64078:8548,64079:8549,64080:8550,64081:8551,64082:8552,64083:8553,64084:65506,64085:65508,64086:65287,64087:65282,64088:12849,64089:8470,64090:8481,64091:8757,64092:32394,64093:35100,64094:37704,64095:37512,64096:34012,64097:20425,64098:28859,64099:26161,64100:26824,64101:37625,64102:26363,64103:24389,64104:20008,64105:20193,64106:20220,64107:20224,64108:20227,64109:20281,64110:20310,64111:20370,64112:20362,64113:20378,64114:20372,64115:20429,64116:20544,64117:20514,64118:20479,64119:20510,64120:20550,64121:20592,64122:20546,64123:20628,64124:20724,64125:20696,64126:20810,64128:20836,64129:20893,64130:20926,64131:20972,64132:21013,64133:21148,64134:21158,64135:21184,64136:21211,64137:21248,64138:21255,64139:21284,64140:21362,64141:21395,64142:21426,64143:21469,64144:64014,64145:21660,64146:21642,64147:21673,64148:21759,64149:21894,64150:22361,64151:22373,64152:22444,64153:22472,64154:22471,64155:64015,64156:64016,64157:22686,64158:22706,64159:22795,64160:22867,64161:22875,64162:22877,64163:22883,64164:22948,64165:22970,64166:23382,64167:23488,64168:29999,64169:23512,64170:23532,64171:23582,64172:23718,64173:23738,64174:23797,64175:23847,64176:23891,64177:64017,64178:23874,64179:23917,64180:23992,64181:23993,64182:24016,64183:24353,64184:24372,64185:24423,64186:24503,64187:24542,64188:24669,64189:24709,64190:24714,64191:24798,64192:24789,64193:24864,64194:24818,64195:24849,64196:24887,64197:24880,64198:24984,64199:25107,64200:25254,64201:25589,64202:25696,64203:25757,64204:25806,64205:25934,64206:26112,64207:26133,64208:26171,64209:26121,64210:26158,64211:26142,64212:26148,64213:26213,64214:26199,64215:26201,64216:64018,64217:26227,64218:26265,64219:26272,64220:26290,64221:26303,64222:26362,64223:26382,64224:63785,64225:26470,64226:26555,64227:26706,64228:26560,64229:26625,64230:26692,64231:26831,64232:64019,64233:26984,64234:64020,64235:27032,64236:27106,64237:27184,64238:27243,64239:27206,64240:27251,64241:27262,64242:27362,64243:27364,64244:27606,64245:27711,64246:27740,64247:27782,64248:27759,64249:27866,64250:27908,64251:28039,64252:28015,64320:28054,64321:28076,64322:28111,64323:28152,64324:28146,64325:28156,64326:28217,64327:28252,64328:28199,64329:28220,64330:28351,64331:28552,64332:28597,64333:28661,64334:28677,64335:28679,64336:28712,64337:28805,64338:28843,64339:28943,64340:28932,64341:29020,64342:28998,64343:28999,64344:64021,64345:29121,64346:29182,64347:29361,64348:29374,64349:29476,64350:64022,64351:29559,64352:29629,64353:29641,64354:29654,64355:29667,64356:29650,64357:29703,64358:29685,64359:29734,64360:29738,64361:29737,64362:29742,64363:29794,64364:29833,64365:29855,64366:29953,64367:30063,64368:30338,64369:30364,64370:30366,64371:30363,64372:30374,64373:64023,64374:30534,64375:21167,64376:30753,64377:30798,64378:30820,64379:30842,64380:31024,64381:64024,64382:64025,64384:64026,64385:31124,64386:64027,64387:31131,64388:31441,64389:31463,64390:64028,64391:31467,64392:31646,64393:64029,64394:32072,64395:32092,64396:32183,64397:32160,64398:32214,64399:32338,64400:32583,64401:32673,64402:64030,64403:33537,64404:33634,64405:33663,64406:33735,64407:33782,64408:33864,64409:33972,64410:34131,64411:34137,64412:34155,64413:64031,64414:34224,64415:64032,64416:64033,64417:34823,64418:35061,64419:35346,64420:35383,64421:35449,64422:35495,64423:35518,64424:35551,64425:64034,64426:35574,64427:35667,64428:35711,64429:36080,64430:36084,64431:36114,64432:36214,64433:64035,64434:36559,64435:64036,64436:64037,64437:36967,64438:37086,64439:64038,64440:37141,64441:37159,64442:37338,64443:37335,64444:37342,64445:37357,64446:37358,64447:37348,64448:37349,64449:37382,64450:37392,64451:37386,64452:37434,64453:37440,64454:37436,64455:37454,64456:37465,64457:37457,64458:37433,64459:37479,64460:37543,64461:37495,64462:37496,64463:37607,64464:37591,64465:37593,64466:37584,64467:64039,64468:37589,64469:37600,64470:37587,64471:37669,64472:37665,64473:37627,64474:64040,64475:37662,64476:37631,64477:37661,64478:37634,64479:37744,64480:37719,64481:37796,64482:37830,64483:37854,64484:37880,64485:37937,64486:37957,64487:37960,64488:38290,64489:63964,64490:64041,64491:38557,64492:38575,64493:38707,64494:38715,64495:38723,64496:38733,64497:38735,64498:38737,64499:38741,64500:38999,64501:39013,64502:64042,64503:64043,64504:39207,64505:64044,64506:39326,64507:39502,64508:39641,64576:39644,64577:39797,64578:39794,64579:39823,64580:39857,64581:39867,64582:39936,64583:40304,64584:40299,64585:64045,64586:40473,64587:40657};function wN(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=e!==void 0?e:!0,this.encoder=new Yx}wN.prototype={constructor:wN,getInt8:function(){var t=this.dv.getInt8(this.offset);return this.offset+=1,t},getInt8Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt8());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getUint8Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getUint8());return e},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt16Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt16());return e},getUint16:function(){var t=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},getUint16Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getUint16());return e},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getUint32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getUint32());return e},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e},getIndex:function(t,e){switch(t){case 1:return e===!0?this.getUint8():this.getInt8();case 2:return e===!0?this.getUint16():this.getInt16();case 4:return this.getInt32();default:throw"unknown number type "+t+" exception."}},getIndexArray:function(t,e,n){for(var i=[],r=0;r<e;r++)i.push(this.getIndex(t,n));return i},getChars:function(t){for(var e="";t>0;){var n=this.getUint8();if(t--,n===0)break;e+=String.fromCharCode(n)}for(;t>0;)this.getUint8(),t--;return e},getSjisStringsAsUnicode:function(t){for(var e=[];t>0;){var n=this.getUint8();if(t--,n===0)break;e.push(n)}for(;t>0;)this.getUint8(),t--;return this.encoder.s2u(new Uint8Array(e))},getUnicodeStrings:function(t){for(var e="";t>0;){var n=this.getUint16();if(t-=2,n===0)break;e+=String.fromCharCode(n)}for(;t>0;)this.getUint8(),t--;return e},getTextBuffer:function(){var t=this.getUint32();return this.getUnicodeStrings(t)}};function RN(){}RN.prototype={constructor:RN,leftToRightVector3:function(t){t[2]=-t[2]},leftToRightQuaternion:function(t){t[0]=-t[0],t[1]=-t[1]},leftToRightEuler:function(t){t[0]=-t[0],t[1]=-t[1]},leftToRightIndexOrder:function(t){var e=t[2];t[2]=t[0],t[0]=e},leftToRightVector3Range:function(t,e){var n=-e[2];e[2]=-t[2],t[2]=n},leftToRightEulerRange:function(t,e){var n=-e[0],i=-e[1];e[0]=-t[0],e[1]=-t[1],t[0]=n,t[1]=i}};const fX=0,pce=2,mce=0,bce=0,vce=2,yce=0,Bce=0,Gce=1,hS=2,Sce=1,wce=64,pX=0,mX=9,Kx=15,bX=16,zx=22,vX=37,Ux=43,yX=76,BX=83,GX=97,SX=100,wX=103,RX=109;class Rce{constructor(){this.vkFormat=pX,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=fX,this.levels=[],this.dataFormatDescriptor=[{vendorId:bce,descriptorType:mce,descriptorBlockSize:0,versionNumber:vce,colorModel:yce,colorPrimaries:Sce,transferFunction:hS,flags:Bce,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Jh{constructor(e,n,i,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+n,i),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),n=this._dataView.getUint32(this._offset+4,this._littleEndian),i=e+2**32*n;return this._offset+=8,i}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,n=0){const i=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==n&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,r)}}const Pr=[171,75,84,88,32,50,48,187,13,10,26,10];function xN(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function xce(t){const e=new Uint8Array(t.buffer,t.byteOffset,Pr.length);if(e[0]!==Pr[0]||e[1]!==Pr[1]||e[2]!==Pr[2]||e[3]!==Pr[3]||e[4]!==Pr[4]||e[5]!==Pr[5]||e[6]!==Pr[6]||e[7]!==Pr[7]||e[8]!==Pr[8]||e[9]!==Pr[9]||e[10]!==Pr[10]||e[11]!==Pr[11])throw new Error("Missing KTX 2.0 identifier.");const n=new Rce,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new Jh(t,Pr.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();const s=r._nextUint32();n.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),g=r._nextUint32(),c=r._nextUint64(),u=r._nextUint64(),I=s*3*8,h=new Jh(t,Pr.length+i,I,!0);for(let V=0;V<s;V++)n.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+h._nextUint64(),h._nextUint64()),uncompressedByteLength:h._nextUint64()});const C=new Jh(t,o,a,!0),b={vendorId:C._skip(4)._nextUint16(),descriptorType:C._nextUint16(),versionNumber:C._nextUint16(),descriptorBlockSize:C._nextUint16(),colorModel:C._nextUint8(),colorPrimaries:C._nextUint8(),transferFunction:C._nextUint8(),flags:C._nextUint8(),texelBlockDimension:[C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8()],bytesPlane:[C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8()],samples:[]},m=6,f=4,p=(b.descriptorBlockSize/4-m)/f;for(let V=0;V<p;V++){const M={bitOffset:C._nextUint16(),bitLength:C._nextUint8(),channelType:C._nextUint8(),samplePosition:[C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};M.channelType&wce?(M.sampleLower=C._nextInt32(),M.sampleUpper=C._nextInt32()):(M.sampleLower=C._nextUint32(),M.sampleUpper=C._nextUint32()),b.samples[V]=M}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(b);const v=new Jh(t,l,g,!0);for(;v._offset<g;){const V=v._nextUint32(),M=v._scan(V),X=xN(M),J=v._scan(V-M.byteLength);n.keyValue[X]=X.match(/^ktx/i)?xN(J):J,v._offset%4&&v._skip(4-v._offset%4)}if(u<=0)return n;const B=new Jh(t,c,u,!0),G=B._nextUint16(),R=B._nextUint16(),w=B._nextUint32(),E=B._nextUint32(),x=B._nextUint32(),W=B._nextUint32(),T=[];for(let V=0;V<s;V++)T.push({imageFlags:B._nextUint32(),rgbSliceByteOffset:B._nextUint32(),rgbSliceByteLength:B._nextUint32(),alphaSliceByteOffset:B._nextUint32(),alphaSliceByteLength:B._nextUint32()});const k=c+B._offset,_=k+w,U=_+E,O=U+x,Y=new Uint8Array(t.buffer,t.byteOffset+k,w),z=new Uint8Array(t.buffer,t.byteOffset+_,E),N=new Uint8Array(t.buffer,t.byteOffset+U,x),L=new Uint8Array(t.buffer,t.byteOffset+O,W);return n.globalData={endpointCount:G,selectorCount:R,imageDescs:T,endpointsData:Y,selectorsData:z,tablesData:N,extendedData:L},n}let yB,Tl,CS;const BB={env:{emscripten_notify_memory_growth:function(t){CS=new Uint8Array(Tl.exports.memory.buffer)}}};class Zce{init(){return yB||(yB=typeof fetch<"u"?fetch("data:application/wasm;base64,"+ZN).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,BB)).then(this._init):WebAssembly.instantiate(Buffer.from(ZN,"base64"),BB).then(this._init),yB)}_init(e){Tl=e.instance,BB.env.emscripten_notify_memory_growth(0)}decode(e,n=0){if(!Tl)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,r=Tl.exports.malloc(i);CS.set(e,r),n=n||Number(Tl.exports.ZSTD_findDecompressedSize(r,i));const s=Tl.exports.malloc(n),o=Tl.exports.ZSTD_decompress(s,n,r,i),a=CS.slice(s,s+o);return Tl.exports.free(r),Tl.exports.free(s),a}}const ZN="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var n={},i=Object.defineProperty,r=i(n,n,n)&&i}catch{}return r}(),e=function(n){if(this==null)throw TypeError();var i=String(this),r=i.length,s=n?Number(n):0;if(s!=s&&(s=0),!(s<0||s>=r)){var o=i.charCodeAt(s),a;return o>=55296&&o<=56319&&r>s+1&&(a=i.charCodeAt(s+1),a>=56320&&a<=57343)?(o-55296)*1024+a-56320+65536:o}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function xX(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var Ece=new xX,Wce=new xX,ZX=new Uint8Array(30),EX=new Uint16Array(30),Nce=new Uint8Array(30),Mce=new Uint16Array(30);function WX(t,e,n,i){var r,s;for(r=0;r<n;++r)t[r]=0;for(r=0;r<30-n;++r)t[r+n]=r/n|0;for(s=i,r=0;r<30;++r)e[r]=s,s+=1<<t[r]}function Tce(t,e){var n;for(n=0;n<7;++n)t.table[n]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,n=0;n<24;++n)t.trans[n]=256+n;for(n=0;n<144;++n)t.trans[24+n]=n;for(n=0;n<8;++n)t.trans[24+144+n]=280+n;for(n=0;n<112;++n)t.trans[24+144+8+n]=144+n;for(n=0;n<5;++n)e.table[n]=0;for(e.table[5]=32,n=0;n<32;++n)e.trans[n]=n}Tce(Ece,Wce);WX(ZX,EX,4,3);WX(Nce,Mce,2,1);ZX[28]=0;EX[28]=258;function Cd(t,e,n,i,r){return Math.pow(1-r,3)*t+3*Math.pow(1-r,2)*r*e+3*(1-r)*Math.pow(r,2)*n+Math.pow(r,3)*i}function Zc(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Zc.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};Zc.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};Zc.prototype.addX=function(t){this.addPoint(t,null)};Zc.prototype.addY=function(t){this.addPoint(null,t)};Zc.prototype.addBezier=function(t,e,n,i,r,s,o,a){var l=[t,e],g=[n,i],c=[r,s],u=[o,a];this.addPoint(t,e),this.addPoint(o,a);for(var I=0;I<=1;I++){var h=6*l[I]-12*g[I]+6*c[I],C=-3*l[I]+9*g[I]-9*c[I]+3*u[I],b=3*g[I]-3*l[I];if(C===0){if(h===0)continue;var m=-b/h;0<m&&m<1&&(I===0&&this.addX(Cd(l[I],g[I],c[I],u[I],m)),I===1&&this.addY(Cd(l[I],g[I],c[I],u[I],m)));continue}var f=Math.pow(h,2)-4*b*C;if(!(f<0)){var p=(-h+Math.sqrt(f))/(2*C);0<p&&p<1&&(I===0&&this.addX(Cd(l[I],g[I],c[I],u[I],p)),I===1&&this.addY(Cd(l[I],g[I],c[I],u[I],p)));var v=(-h-Math.sqrt(f))/(2*C);0<v&&v<1&&(I===0&&this.addX(Cd(l[I],g[I],c[I],u[I],v)),I===1&&this.addY(Cd(l[I],g[I],c[I],u[I],v)))}}};Zc.prototype.addQuad=function(t,e,n,i,r,s){var o=t+.6666666666666666*(n-t),a=e+2/3*(i-e),l=o+1/3*(r-t),g=a+1/3*(s-e);this.addBezier(t,e,o,a,l,g,r,s)};function Ji(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Ji.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};Ji.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};Ji.prototype.curveTo=Ji.prototype.bezierCurveTo=function(t,e,n,i,r,s){this.commands.push({type:"C",x1:t,y1:e,x2:n,y2:i,x:r,y:s})};Ji.prototype.quadTo=Ji.prototype.quadraticCurveTo=function(t,e,n,i){this.commands.push({type:"Q",x1:t,y1:e,x:n,y:i})};Ji.prototype.close=Ji.prototype.closePath=function(){this.commands.push({type:"Z"})};Ji.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Zc){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};Ji.prototype.getBoundingBox=function(){for(var t=new Zc,e=0,n=0,i=0,r=0,s=0;s<this.commands.length;s++){var o=this.commands[s];switch(o.type){case"M":t.addPoint(o.x,o.y),e=i=o.x,n=r=o.y;break;case"L":t.addPoint(o.x,o.y),i=o.x,r=o.y;break;case"Q":t.addQuad(i,r,o.x1,o.y1,o.x,o.y),i=o.x,r=o.y;break;case"C":t.addBezier(i,r,o.x1,o.y1,o.x2,o.y2,o.x,o.y),i=o.x,r=o.y;break;case"Z":i=e,r=n;break;default:throw new Error("Unexpected path command "+o.type)}}return t.isEmpty()&&t.addPoint(0,0),t};Ji.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var n=this.commands[e];n.type==="M"?t.moveTo(n.x,n.y):n.type==="L"?t.lineTo(n.x,n.y):n.type==="C"?t.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):n.type==="Q"?t.quadraticCurveTo(n.x1,n.y1,n.x,n.y):n.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};Ji.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(o){return Math.round(o)===o?""+Math.round(o):o.toFixed(t)}function n(){for(var o=arguments,a="",l=0;l<arguments.length;l+=1){var g=o[l];g>=0&&l>0&&(a+=" "),a+=e(g)}return a}for(var i="",r=0;r<this.commands.length;r+=1){var s=this.commands[r];s.type==="M"?i+="M"+n(s.x,s.y):s.type==="L"?i+="L"+n(s.x,s.y):s.type==="C"?i+="C"+n(s.x1,s.y1,s.x2,s.y2,s.x,s.y):s.type==="Q"?i+="Q"+n(s.x1,s.y1,s.x,s.y):s.type==="Z"&&(i+="Z")}return i};Ji.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};Ji.prototype.toDOMElement=function(t){var e=this.toPathData(t),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n};function NX(t){throw new Error(t)}function EN(t,e){t||NX(e)}var kt={fail:NX,argument:EN,assert:EN},WN=32768,NN=2147483648,GA={},rt={},Ft={};function Ga(t){return function(){return t}}rt.BYTE=function(t){return kt.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};Ft.BYTE=Ga(1);rt.CHAR=function(t){return[t.charCodeAt(0)]};Ft.CHAR=Ga(1);rt.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],n=0;n<t.length;n+=1)e[n]=t.charCodeAt(n);return e};Ft.CHARARRAY=function(t){return typeof t>"u"?0:t.length};rt.USHORT=function(t){return[t>>8&255,t&255]};Ft.USHORT=Ga(2);rt.SHORT=function(t){return t>=WN&&(t=-(2*WN-t)),[t>>8&255,t&255]};Ft.SHORT=Ga(2);rt.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};Ft.UINT24=Ga(3);rt.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};Ft.ULONG=Ga(4);rt.LONG=function(t){return t>=NN&&(t=-(2*NN-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};Ft.LONG=Ga(4);rt.FIXED=rt.ULONG;Ft.FIXED=Ft.ULONG;rt.FWORD=rt.SHORT;Ft.FWORD=Ft.SHORT;rt.UFWORD=rt.USHORT;Ft.UFWORD=Ft.USHORT;rt.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};Ft.LONGDATETIME=Ga(8);rt.TAG=function(t){return kt.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};Ft.TAG=Ga(4);rt.Card8=rt.BYTE;Ft.Card8=Ft.BYTE;rt.Card16=rt.USHORT;Ft.Card16=Ft.USHORT;rt.OffSize=rt.BYTE;Ft.OffSize=Ft.BYTE;rt.SID=rt.USHORT;Ft.SID=Ft.USHORT;rt.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?rt.NUMBER16(t):rt.NUMBER32(t)};Ft.NUMBER=function(t){return rt.NUMBER(t).length};rt.NUMBER16=function(t){return[28,t>>8&255,t&255]};Ft.NUMBER16=Ga(3);rt.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};Ft.NUMBER32=Ga(5);rt.REAL=function(t){var e=t.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(n){var i=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));e=(Math.round(t*i)/i).toString()}for(var r="",s=0,o=e.length;s<o;s+=1){var a=e[s];a==="e"?r+=e[++s]==="-"?"c":"b":a==="."?r+="a":a==="-"?r+="e":r+=a}r+=r.length&1?"f":"ff";for(var l=[30],g=0,c=r.length;g<c;g+=2)l.push(parseInt(r.substr(g,2),16));return l};Ft.REAL=function(t){return rt.REAL(t).length};rt.NAME=rt.CHARARRAY;Ft.NAME=Ft.CHARARRAY;rt.STRING=rt.CHARARRAY;Ft.STRING=Ft.CHARARRAY;GA.UTF8=function(t,e,n){for(var i=[],r=n,s=0;s<r;s++,e+=1)i[s]=t.getUint8(e);return String.fromCharCode.apply(null,i)};GA.UTF16=function(t,e,n){for(var i=[],r=n/2,s=0;s<r;s++,e+=2)i[s]=t.getUint16(e);return String.fromCharCode.apply(null,i)};rt.UTF16=function(t){for(var e=[],n=0;n<t.length;n+=1){var i=t.charCodeAt(n);e[e.length]=i>>8&255,e[e.length]=i&255}return e};Ft.UTF16=function(t){return t.length*2};var fS={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};GA.MACSTRING=function(t,e,n,i){var r=fS[i];if(r!==void 0){for(var s="",o=0;o<n;o++){var a=t.getUint8(e+o);a<=127?s+=String.fromCharCode(a):s+=r[a&127]}return s}};var g2=typeof WeakMap=="function"&&new WeakMap,c2,Fce=function(t){if(!c2){c2={};for(var e in fS)c2[e]=new String(e)}var n=c2[t];if(n!==void 0){if(g2){var i=g2.get(n);if(i!==void 0)return i}var r=fS[t];if(r!==void 0){for(var s={},o=0;o<r.length;o++)s[r.charCodeAt(o)]=o+128;return g2&&g2.set(n,s),s}}};rt.MACSTRING=function(t,e){var n=Fce(e);if(n!==void 0){for(var i=[],r=0;r<t.length;r++){var s=t.charCodeAt(r);if(s>=128&&(s=n[s],s===void 0))return;i[r]=s}return i}};Ft.MACSTRING=function(t,e){var n=rt.MACSTRING(t,e);return n!==void 0?n.length:0};function pS(t){return t>=-128&&t<=127}function Vce(t,e,n){for(var i=0,r=t.length;e<r&&i<64&&t[e]===0;)++e,++i;return n.push(128|i-1),e}function Lce(t,e,n){for(var i=0,r=t.length,s=e;s<r&&i<64;){var o=t[s];if(!pS(o)||o===0&&s+1<r&&t[s+1]===0)break;++s,++i}n.push(i-1);for(var a=e;a<s;++a)n.push(t[a]+256&255);return s}function kce(t,e,n){for(var i=0,r=t.length,s=e;s<r&&i<64;){var o=t[s];if(o===0||pS(o)&&s+1<r&&pS(t[s+1]))break;++s,++i}n.push(64|i-1);for(var a=e;a<s;++a){var l=t[a];n.push(l+65536>>8&255,l+256&255)}return s}rt.VARDELTAS=function(t){for(var e=0,n=[];e<t.length;){var i=t[e];i===0?e=Vce(t,e,n):i>=-128&&i<=127?e=Lce(t,e,n):e=kce(t,e,n)}return n};rt.INDEX=function(t){for(var e=1,n=[e],i=[],r=0;r<t.length;r+=1){var s=rt.OBJECT(t[r]);Array.prototype.push.apply(i,s),e+=s.length,n.push(e)}if(i.length===0)return[0,0];for(var o=[],a=1+Math.floor(Math.log(e)/Math.log(2))/8|0,l=[void 0,rt.BYTE,rt.USHORT,rt.UINT24,rt.ULONG][a],g=0;g<n.length;g+=1){var c=l(n[g]);Array.prototype.push.apply(o,c)}return Array.prototype.concat(rt.Card16(t.length),rt.OffSize(a),o,i)};Ft.INDEX=function(t){return rt.INDEX(t).length};rt.DICT=function(t){for(var e=[],n=Object.keys(t),i=n.length,r=0;r<i;r+=1){var s=parseInt(n[r],0),o=t[s];e=e.concat(rt.OPERAND(o.value,o.type)),e=e.concat(rt.OPERATOR(s))}return e};Ft.DICT=function(t){return rt.DICT(t).length};rt.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};rt.OPERAND=function(t,e){var n=[];if(Array.isArray(e))for(var i=0;i<e.length;i+=1)kt.argument(t.length===e.length,"Not enough arguments given for type"+e),n=n.concat(rt.OPERAND(t[i],e[i]));else if(e==="SID")n=n.concat(rt.NUMBER(t));else if(e==="offset")n=n.concat(rt.NUMBER32(t));else if(e==="number")n=n.concat(rt.NUMBER(t));else if(e==="real")n=n.concat(rt.REAL(t));else throw new Error("Unknown operand type "+e);return n};rt.OP=rt.BYTE;Ft.OP=Ft.BYTE;var u2=typeof WeakMap=="function"&&new WeakMap;rt.CHARSTRING=function(t){if(u2){var e=u2.get(t);if(e!==void 0)return e}for(var n=[],i=t.length,r=0;r<i;r+=1){var s=t[r];n=n.concat(rt[s.type](s.value))}return u2&&u2.set(t,n),n};Ft.CHARSTRING=function(t){return rt.CHARSTRING(t).length};rt.OBJECT=function(t){var e=rt[t.type];return kt.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};Ft.OBJECT=function(t){var e=Ft[t.type];return kt.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};rt.TABLE=function(t){for(var e=[],n=t.fields.length,i=[],r=[],s=0;s<n;s+=1){var o=t.fields[s],a=rt[o.type];kt.argument(a!==void 0,"No encoding function for field type "+o.type+" ("+o.name+")");var l=t[o.name];l===void 0&&(l=o.value);var g=a(l);o.type==="TABLE"?(r.push(e.length),e=e.concat([0,0]),i.push(g)):e=e.concat(g)}for(var c=0;c<i.length;c+=1){var u=r[c],I=e.length;kt.argument(I<65536,"Table "+t.tableName+" too big."),e[u]=I>>8,e[u+1]=I&255,e=e.concat(i[c])}return e};Ft.TABLE=function(t){for(var e=0,n=t.fields.length,i=0;i<n;i+=1){var r=t.fields[i],s=Ft[r.type];kt.argument(s!==void 0,"No sizeOf function for field type "+r.type+" ("+r.name+")");var o=t[r.name];o===void 0&&(o=r.value),e+=s(o),r.type==="TABLE"&&(e+=2)}return e};rt.RECORD=rt.TABLE;Ft.RECORD=Ft.TABLE;rt.LITERAL=function(t){return t};Ft.LITERAL=function(t){return t.length};function ar(t,e,n){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var i=0;i<e.length;i+=1){var r=e[i];this[r.name]=r.value}if(this.tableName=t,this.fields=e,n)for(var s=Object.keys(n),o=0;o<s.length;o+=1){var a=s[o],l=n[a];this[a]!==void 0&&(this[a]=l)}}ar.prototype.encode=function(){return rt.TABLE(this)};ar.prototype.sizeOf=function(){return Ft.TABLE(this)};function Qf(t,e,n){n===void 0&&(n=e.length);var i=new Array(e.length+1);i[0]={name:t+"Count",type:"USHORT",value:n};for(var r=0;r<e.length;r++)i[r+1]={name:t+r,type:"USHORT",value:e[r]};return i}function mS(t,e,n){var i=e.length,r=new Array(i+1);r[0]={name:t+"Count",type:"USHORT",value:i};for(var s=0;s<i;s++)r[s+1]={name:t+s,type:"TABLE",value:n(e[s],s)};return r}function Jf(t,e,n){var i=e.length,r=[];r[0]={name:t+"Count",type:"USHORT",value:i};for(var s=0;s<i;s++)r=r.concat(n(e[s],s));return r}function bb(t){t.format===1?ar.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Qf("glyph",t.glyphs))):t.format===2?ar.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Jf("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):kt.assert(!1,"Coverage format must be 1 or 2.")}bb.prototype=Object.create(ar.prototype);bb.prototype.constructor=bb;function vb(t){ar.call(this,"scriptListTable",Jf("scriptRecord",t,function(e,n){var i=e.script,r=i.defaultLangSys;return kt.assert(!!r,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+n,type:"TAG",value:e.tag},{name:"script"+n,type:"TABLE",value:new ar("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new ar("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(Qf("featureIndex",r.featureIndexes)))}].concat(Jf("langSys",i.langSysRecords,function(s,o){var a=s.langSys;return[{name:"langSysTag"+o,type:"TAG",value:s.tag},{name:"langSys"+o,type:"TABLE",value:new ar("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:a.reqFeatureIndex}].concat(Qf("featureIndex",a.featureIndexes)))}]})))}]}))}vb.prototype=Object.create(ar.prototype);vb.prototype.constructor=vb;function yb(t){ar.call(this,"featureListTable",Jf("featureRecord",t,function(e,n){var i=e.feature;return[{name:"featureTag"+n,type:"TAG",value:e.tag},{name:"feature"+n,type:"TABLE",value:new ar("featureTable",[{name:"featureParams",type:"USHORT",value:i.featureParams}].concat(Qf("lookupListIndex",i.lookupListIndexes)))}]}))}yb.prototype=Object.create(ar.prototype);yb.prototype.constructor=yb;function Bb(t,e){ar.call(this,"lookupListTable",mS("lookup",t,function(n){var i=e[n.lookupType];return kt.assert(!!i,"Unable to write GSUB lookup type "+n.lookupType+" tables."),new ar("lookupTable",[{name:"lookupType",type:"USHORT",value:n.lookupType},{name:"lookupFlag",type:"USHORT",value:n.lookupFlag}].concat(mS("subtable",n.subtables,i)))}))}Bb.prototype=Object.create(ar.prototype);Bb.prototype.constructor=Bb;var It={Table:ar,Record:ar,Coverage:bb,ScriptList:vb,FeatureList:yb,LookupList:Bb,ushortList:Qf,tableList:mS,recordList:Jf};function MN(t,e){return t.getUint8(e)}function Gb(t,e){return t.getUint16(e,!1)}function Hce(t,e){return t.getInt16(e,!1)}function Dx(t,e){return t.getUint32(e,!1)}function MX(t,e){var n=t.getInt16(e,!1),i=t.getUint16(e+2,!1);return n+i/65535}function _ce(t,e){for(var n="",i=e;i<e+4;i+=1)n+=String.fromCharCode(t.getInt8(i));return n}function Xce(t,e,n){for(var i=0,r=0;r<n;r+=1)i<<=8,i+=t.getUint8(e+r);return i}function Yce(t,e,n){for(var i=[],r=e;r<n;r+=1)i.push(t.getUint8(r));return i}function Kce(t){for(var e="",n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return e}var zce={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Ne(t,e){this.data=t,this.offset=e,this.relativeOffset=0}Ne.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};Ne.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};Ne.prototype.parseCard8=Ne.prototype.parseByte;Ne.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};Ne.prototype.parseCard16=Ne.prototype.parseUShort;Ne.prototype.parseSID=Ne.prototype.parseUShort;Ne.prototype.parseOffset16=Ne.prototype.parseUShort;Ne.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};Ne.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};Ne.prototype.parseULong=function(){var t=Dx(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};Ne.prototype.parseOffset32=Ne.prototype.parseULong;Ne.prototype.parseFixed=function(){var t=MX(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};Ne.prototype.parseString=function(t){var e=this.data,n=this.offset+this.relativeOffset,i="";this.relativeOffset+=t;for(var r=0;r<t;r++)i+=String.fromCharCode(e.getUint8(n+r));return i};Ne.prototype.parseTag=function(){return this.parseString(4)};Ne.prototype.parseLongDateTime=function(){var t=Dx(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};Ne.prototype.parseVersion=function(t){var e=Gb(this.data,this.offset+this.relativeOffset),n=Gb(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+n/t/10};Ne.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=zce[t]*e};Ne.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getUint32(i),i+=4;return this.relativeOffset+=t*4,e};Ne.prototype.parseOffset16List=Ne.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getUint16(i),i+=2;return this.relativeOffset+=t*2,e};Ne.prototype.parseShortList=function(t){for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getInt16(i),i+=2;return this.relativeOffset+=t*2,e};Ne.prototype.parseByteList=function(t){for(var e=new Array(t),n=this.data,i=this.offset+this.relativeOffset,r=0;r<t;r++)e[r]=n.getUint8(i++);return this.relativeOffset+=t,e};Ne.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),i=0;i<t;i++)n[i]=e.call(this);return n};Ne.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var n=new Array(t),i=0;i<t;i++)n[i]=e.call(this);return n};Ne.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),i=Object.keys(e),r=0;r<t;r++){for(var s={},o=0;o<i.length;o++){var a=i[o],l=e[a];s[a]=l.call(this)}n[r]=s}return n};Ne.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var n=new Array(t),i=Object.keys(e),r=0;r<t;r++){for(var s={},o=0;o<i.length;o++){var a=i[o],l=e[a];s[a]=l.call(this)}n[r]=s}return n};Ne.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),n={},i=0;i<e.length;i++){var r=e[i],s=t[r];n[r]=s.call(this)}return n};Ne.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};Ne.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),n=new Array(e),i=0;i<e;i++)n[i]=this.parseValueRecord(t);return n};Ne.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new Ne(this.data,this.offset+e).parseStruct(t)};Ne.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new Ne(this.data,this.offset+e).parseStruct(t)};Ne.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),n=e.length,i=this.relativeOffset,r=new Array(n),s=0;s<n;s++){var o=e[s];if(o===0){r[s]=void 0;continue}if(this.relativeOffset=o,t){for(var a=this.parseOffset16List(),l=new Array(a.length),g=0;g<a.length;g++)this.relativeOffset=o+a[g],l[g]=t.call(this);r[s]=l}else r[s]=this.parseUShortList()}return this.relativeOffset=i,r};Ne.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),n=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(n)};if(e===2){for(var i=new Array(n),r=0;r<n;r++)i[r]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:i}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};Ne.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:Ne.uShort,end:Ne.uShort,classId:Ne.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};Ne.list=function(t,e){return function(){return this.parseList(t,e)}};Ne.list32=function(t,e){return function(){return this.parseList32(t,e)}};Ne.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};Ne.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};Ne.pointer=function(t){return function(){return this.parsePointer(t)}};Ne.pointer32=function(t){return function(){return this.parsePointer32(t)}};Ne.tag=Ne.prototype.parseTag;Ne.byte=Ne.prototype.parseByte;Ne.uShort=Ne.offset16=Ne.prototype.parseUShort;Ne.uShortList=Ne.prototype.parseUShortList;Ne.uLong=Ne.offset32=Ne.prototype.parseULong;Ne.uLongList=Ne.prototype.parseULongList;Ne.struct=Ne.prototype.parseStruct;Ne.coverage=Ne.prototype.parseCoverage;Ne.classDef=Ne.prototype.parseClassDef;var TN={reserved:Ne.uShort,reqFeatureIndex:Ne.uShort,featureIndexes:Ne.uShortList};Ne.prototype.parseScriptList=function(){return this.parsePointer(Ne.recordList({tag:Ne.tag,script:Ne.pointer({defaultLangSys:Ne.pointer(TN),langSysRecords:Ne.recordList({tag:Ne.tag,langSys:Ne.pointer(TN)})})}))||[]};Ne.prototype.parseFeatureList=function(){return this.parsePointer(Ne.recordList({tag:Ne.tag,feature:Ne.pointer({featureParams:Ne.offset16,lookupListIndexes:Ne.uShortList})}))||[]};Ne.prototype.parseLookupList=function(t){return this.parsePointer(Ne.list(Ne.pointer(function(){var e=this.parseUShort();kt.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var n=this.parseUShort(),i=n&16;return{lookupType:e,lookupFlag:n,subtables:this.parseList(Ne.pointer(t[e])),markFilteringSet:i?this.parseUShort():void 0}})))||[]};Ne.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();kt.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var n=this.parseRecordList32({conditionSetOffset:Ne.offset32,featureTableSubstitutionOffset:Ne.offset32});return n})||[]};var Dt={getByte:MN,getCard8:MN,getUShort:Gb,getCard16:Gb,getShort:Hce,getULong:Dx,getFixed:MX,getTag:_ce,getOffset:Xce,getBytes:Yce,bytesToString:Kce,Parser:Ne};function Uce(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var n;t.groupCount=n=e.parseULong(),t.glyphIndexMap={};for(var i=0;i<n;i+=1)for(var r=e.parseULong(),s=e.parseULong(),o=e.parseULong(),a=r;a<=s;a+=1)t.glyphIndexMap[a]=o,o++}function Dce(t,e,n,i,r){t.length=e.parseUShort(),t.language=e.parseUShort();var s;t.segCount=s=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var o=new Dt.Parser(n,i+r+14),a=new Dt.Parser(n,i+r+16+s*2),l=new Dt.Parser(n,i+r+16+s*4),g=new Dt.Parser(n,i+r+16+s*6),c=i+r+16+s*8,u=0;u<s-1;u+=1)for(var I=void 0,h=o.parseUShort(),C=a.parseUShort(),b=l.parseShort(),m=g.parseUShort(),f=C;f<=h;f+=1)m!==0?(c=g.offset+g.relativeOffset-2,c+=m,c+=(f-C)*2,I=Dt.getUShort(n,c),I!==0&&(I=I+b&65535)):I=f+b&65535,t.glyphIndexMap[f]=I}function Pce(t,e){var n={};n.version=Dt.getUShort(t,e),kt.argument(n.version===0,"cmap table version should be 0."),n.numTables=Dt.getUShort(t,e+2);for(var i=-1,r=n.numTables-1;r>=0;r-=1){var s=Dt.getUShort(t,e+4+r*8),o=Dt.getUShort(t,e+4+r*8+2);if(s===3&&(o===0||o===1||o===10)||s===0&&(o===0||o===1||o===2||o===3||o===4)){i=Dt.getULong(t,e+4+r*8+4);break}}if(i===-1)throw new Error("No valid cmap sub-tables found.");var a=new Dt.Parser(t,e+i);if(n.format=a.parseUShort(),n.format===12)Uce(n,a);else if(n.format===4)Dce(n,a,t,e,i);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+n.format+").");return n}function Oce(t,e,n){t.segments.push({end:e,start:e,delta:-(e-n),offset:0,glyphIndex:n})}function Qce(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Jce(t){var e=!0,n;for(n=t.length-1;n>0;n-=1){var i=t.get(n);if(i.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var r=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(r=r.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),r=r.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var s=new It.Table("cmap",r);for(s.segments=[],n=0;n<t.length;n+=1){for(var o=t.get(n),a=0;a<o.unicodes.length;a+=1)Oce(s,o.unicodes[a],n);s.segments=s.segments.sort(function(p,v){return p.start-v.start})}Qce(s);var l=s.segments.length,g=0,c=[],u=[],I=[],h=[],C=[],b=[];for(n=0;n<l;n+=1){var m=s.segments[n];m.end<=65535&&m.start<=65535?(c=c.concat({name:"end_"+n,type:"USHORT",value:m.end}),u=u.concat({name:"start_"+n,type:"USHORT",value:m.start}),I=I.concat({name:"idDelta_"+n,type:"SHORT",value:m.delta}),h=h.concat({name:"idRangeOffset_"+n,type:"USHORT",value:m.offset}),m.glyphId!==void 0&&(C=C.concat({name:"glyph_"+n,type:"USHORT",value:m.glyphId}))):g+=1,!e&&m.glyphIndex!==void 0&&(b=b.concat({name:"cmap12Start_"+n,type:"ULONG",value:m.start}),b=b.concat({name:"cmap12End_"+n,type:"ULONG",value:m.end}),b=b.concat({name:"cmap12Glyph_"+n,type:"ULONG",value:m.glyphIndex}))}if(s.segCountX2=(l-g)*2,s.searchRange=Math.pow(2,Math.floor(Math.log(l-g)/Math.log(2)))*2,s.entrySelector=Math.log(s.searchRange/2)/Math.log(2),s.rangeShift=s.segCountX2-s.searchRange,s.fields=s.fields.concat(c),s.fields.push({name:"reservedPad",type:"USHORT",value:0}),s.fields=s.fields.concat(u),s.fields=s.fields.concat(I),s.fields=s.fields.concat(h),s.fields=s.fields.concat(C),s.cmap4Length=14+c.length*2+2+u.length*2+I.length*2+h.length*2+C.length*2,!e){var f=16+b.length*4;s.cmap12Offset=12+2*2+4+s.cmap4Length,s.fields=s.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:f},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:b.length/3}]),s.fields=s.fields.concat(b)}return s}var jce={parse:Pce,make:Jce},i3=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],qce=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],$ce=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],FN=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function TX(t){this.font=t}TX.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),n=this.font.glyphs;if(n){for(var i=0;i<n.length;i+=1)for(var r=n.get(i),s=0;s<r.unicodes.length;s+=1)if(r.unicodes[s]===e)return i}return null};function Sb(t,e){this.encoding=t,this.charset=e}Sb.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),n=this.encoding[e];return this.charset.indexOf(n)};function eue(t,e,n,i,r){t.beginPath(),t.moveTo(e,n),t.lineTo(i,r),t.stroke()}var su={line:eue};function tue(t,e){var n=e||new Ji;return{configurable:!0,get:function(){return typeof n=="function"&&(n=n()),n},set:function(i){n=i}}}function Yo(t){this.bindConstructorValues(t)}Yo.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",tue(this,t.path))};Yo.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};Yo.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Yo.prototype.getPath=function(t,e,n,i,r){t=t!==void 0?t:0,e=e!==void 0?e:0,n=n!==void 0?n:72;var s,o;i||(i={});var a=i.xScale,l=i.yScale;if(i.hinting&&r&&r.hinting&&(o=this.path&&r.hinting.exec(this,n)),o)s=r.hinting.getCommands(o),t=Math.round(t),e=Math.round(e),a=l=1;else{s=this.path.commands;var g=1/(this.path.unitsPerEm||1e3)*n;a===void 0&&(a=g),l===void 0&&(l=g)}for(var c=new Ji,u=0;u<s.length;u+=1){var I=s[u];I.type==="M"?c.moveTo(t+I.x*a,e+-I.y*l):I.type==="L"?c.lineTo(t+I.x*a,e+-I.y*l):I.type==="Q"?c.quadraticCurveTo(t+I.x1*a,e+-I.y1*l,t+I.x*a,e+-I.y*l):I.type==="C"?c.curveTo(t+I.x1*a,e+-I.y1*l,t+I.x2*a,e+-I.y2*l,t+I.x*a,e+-I.y*l):I.type==="Z"&&c.closePath()}return c};Yo.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],n=0;n<this.points.length;n+=1){var i=this.points[n];e.push(i),i.lastPointOfContour&&(t.push(e),e=[])}return kt.argument(e.length===0,"There are still points left in the current contour."),t};Yo.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],n=[],i=0;i<t.length;i+=1){var r=t[i];r.type!=="Z"&&(e.push(r.x),n.push(r.y)),(r.type==="Q"||r.type==="C")&&(e.push(r.x1),n.push(r.y1)),r.type==="C"&&(e.push(r.x2),n.push(r.y2))}var s={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s};Yo.prototype.draw=function(t,e,n,i,r){this.getPath(e,n,i,r).draw(t)};Yo.prototype.drawPoints=function(t,e,n,i){function r(u,I,h,C){t.beginPath();for(var b=0;b<u.length;b+=1)t.moveTo(I+u[b].x*C,h+u[b].y*C),t.arc(I+u[b].x*C,h+u[b].y*C,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,n=n!==void 0?n:0,i=i!==void 0?i:24;for(var s=1/this.path.unitsPerEm*i,o=[],a=[],l=this.path,g=0;g<l.commands.length;g+=1){var c=l.commands[g];c.x!==void 0&&o.push({x:c.x,y:-c.y}),c.x1!==void 0&&a.push({x:c.x1,y:-c.y1}),c.x2!==void 0&&a.push({x:c.x2,y:-c.y2})}t.fillStyle="blue",r(o,e,n,s),t.fillStyle="red",r(a,e,n,s)};Yo.prototype.drawMetrics=function(t,e,n,i){var r;e=e!==void 0?e:0,n=n!==void 0?n:0,i=i!==void 0?i:24,r=1/this.path.unitsPerEm*i,t.lineWidth=1,t.strokeStyle="black",su.line(t,e,-1e4,e,1e4),su.line(t,-1e4,n,1e4,n);var s=this.xMin||0,o=this.yMin||0,a=this.xMax||0,l=this.yMax||0,g=this.advanceWidth||0;t.strokeStyle="blue",su.line(t,e+s*r,-1e4,e+s*r,1e4),su.line(t,e+a*r,-1e4,e+a*r,1e4),su.line(t,-1e4,n+-o*r,1e4,n+-o*r),su.line(t,-1e4,n+-l*r,1e4,n+-l*r),t.strokeStyle="green",su.line(t,e+g*r,-1e4,e+g*r,1e4)};function I2(t,e,n){Object.defineProperty(t,e,{get:function(){return t.path,t[n]},set:function(i){t[n]=i},enumerable:!0,configurable:!0})}function Px(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];i.path.unitsPerEm=t.unitsPerEm,this.glyphs[n]=i}this.length=e&&e.length||0}Px.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],n=this.font._IndexToUnicodeMap[t];if(n)for(var i=0;i<n.unicodes.length;i++)e.addUnicode(n.unicodes[i]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Px.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function nue(t,e){return new Yo({index:e,font:t})}function iue(t,e,n,i,r,s){return function(){var o=new Yo({index:e,font:t});return o.path=function(){n(o,i,r);var a=s(t.glyphs,o);return a.unitsPerEm=t.unitsPerEm,a},I2(o,"xMin","_xMin"),I2(o,"xMax","_xMax"),I2(o,"yMin","_yMin"),I2(o,"yMax","_yMax"),o}}function rue(t,e,n,i){return function(){var r=new Yo({index:e,font:t});return r.path=function(){var s=n(t,r,i);return s.unitsPerEm=t.unitsPerEm,s},r}}var $a={GlyphSet:Px,glyphLoader:nue,ttfGlyphLoader:iue,cffGlyphLoader:rue};function FX(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(!FX(t[n],e[n]))return!1;return!0}else return!1}function bS(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Fg(t,e,n){var i=[],r=[],s=Dt.getCard16(t,e),o,a;if(s!==0){var l=Dt.getByte(t,e+2);o=e+(s+1)*l+2;for(var g=e+3,c=0;c<s+1;c+=1)i.push(Dt.getOffset(t,g,l)),g+=l;a=o+i[s]}else a=e+2;for(var u=0;u<i.length-1;u+=1){var I=Dt.getBytes(t,o+i[u],o+i[u+1]);n&&(I=n(I)),r.push(I)}return{objects:r,startOffset:e,endOffset:a}}function sue(t,e){var n=[],i=Dt.getCard16(t,e),r,s;if(i!==0){var o=Dt.getByte(t,e+2);r=e+(i+1)*o+2;for(var a=e+3,l=0;l<i+1;l+=1)n.push(Dt.getOffset(t,a,o)),a+=o;s=r+n[i]}else s=e+2;return{offsets:n,startOffset:e,endOffset:s}}function oue(t,e,n,i,r){var s=Dt.getCard16(n,i),o=0;if(s!==0){var a=Dt.getByte(n,i+2);o=i+(s+1)*a+2}var l=Dt.getBytes(n,o+e[t],o+e[t+1]);return r&&(l=r(l)),l}function aue(t){for(var e="",n=15,i=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var r=t.parseByte(),s=r>>4,o=r&15;if(s===n||(e+=i[s],o===n))break;e+=i[o]}return parseFloat(e)}function lue(t,e){var n,i,r,s;if(e===28)return n=t.parseByte(),i=t.parseByte(),n<<8|i;if(e===29)return n=t.parseByte(),i=t.parseByte(),r=t.parseByte(),s=t.parseByte(),n<<24|i<<16|r<<8|s;if(e===30)return aue(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return n=t.parseByte(),(e-247)*256+n+108;if(e>=251&&e<=254)return n=t.parseByte(),-(e-251)*256-n-108;throw new Error("Invalid b0 "+e)}function gue(t){for(var e={},n=0;n<t.length;n+=1){var i=t[n][0],r=t[n][1],s=void 0;if(r.length===1?s=r[0]:s=r,e.hasOwnProperty(i)&&!isNaN(e[i]))throw new Error("Object "+e+" already has key "+i);e[i]=s}return e}function VX(t,e,n){e=e!==void 0?e:0;var i=new Dt.Parser(t,e),r=[],s=[];for(n=n!==void 0?n:t.length;i.relativeOffset<n;){var o=i.parseByte();o<=21?(o===12&&(o=1200+i.parseByte()),r.push([o,s]),s=[]):s.push(lue(i,o))}return gue(r)}function HC(t,e){return e<=390?e=i3[e]:e=t[e-391],e}function LX(t,e,n){for(var i={},r,s=0;s<e.length;s+=1){var o=e[s];if(Array.isArray(o.type)){var a=[];a.length=o.type.length;for(var l=0;l<o.type.length;l++)r=t[o.op]!==void 0?t[o.op][l]:void 0,r===void 0&&(r=o.value!==void 0&&o.value[l]!==void 0?o.value[l]:null),o.type[l]==="SID"&&(r=HC(n,r)),a[l]=r;i[o.name]=a}else r=t[o.op],r===void 0&&(r=o.value!==void 0?o.value:null),o.type==="SID"&&(r=HC(n,r)),i[o.name]=r}return i}function cue(t,e){var n={};return n.formatMajor=Dt.getCard8(t,e),n.formatMinor=Dt.getCard8(t,e+1),n.size=Dt.getCard8(t,e+2),n.offsetSize=Dt.getCard8(t,e+3),n.startOffset=e,n.endOffset=e+4,n}var kX=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],HX=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function uue(t,e){var n=VX(t,0,t.byteLength);return LX(n,kX,e)}function _X(t,e,n,i){var r=VX(t,e,n);return LX(r,HX,i)}function VN(t,e,n,i){for(var r=[],s=0;s<n.length;s+=1){var o=new DataView(new Uint8Array(n[s]).buffer),a=uue(o,i);a._subrs=[],a._subrsBias=0,a._defaultWidthX=0,a._nominalWidthX=0;var l=a.private[0],g=a.private[1];if(l!==0&&g!==0){var c=_X(t,g+e,l,i);if(a._defaultWidthX=c.defaultWidthX,a._nominalWidthX=c.nominalWidthX,c.subrs!==0){var u=g+c.subrs,I=Fg(t,u+e);a._subrs=I.objects,a._subrsBias=bS(a._subrs)}a._privateDict=c}r.push(a)}return r}function Iue(t,e,n,i){var r,s,o=new Dt.Parser(t,e);n-=1;var a=[".notdef"],l=o.parseCard8();if(l===0)for(var g=0;g<n;g+=1)r=o.parseSID(),a.push(HC(i,r));else if(l===1)for(;a.length<=n;){r=o.parseSID(),s=o.parseCard8();for(var c=0;c<=s;c+=1)a.push(HC(i,r)),r+=1}else if(l===2)for(;a.length<=n;){r=o.parseSID(),s=o.parseCard16();for(var u=0;u<=s;u+=1)a.push(HC(i,r)),r+=1}else throw new Error("Unknown charset format "+l);return a}function due(t,e,n){var i,r={},s=new Dt.Parser(t,e),o=s.parseCard8();if(o===0)for(var a=s.parseCard8(),l=0;l<a;l+=1)i=s.parseCard8(),r[i]=l;else if(o===1){var g=s.parseCard8();i=1;for(var c=0;c<g;c+=1)for(var u=s.parseCard8(),I=s.parseCard8(),h=u;h<=u+I;h+=1)r[h]=i,i+=1}else throw new Error("Unknown encoding format "+o);return new Sb(r,n)}function LN(t,e,n){var i,r,s,o,a=new Ji,l=[],g=0,c=!1,u=!1,I=0,h=0,C,b,m,f;if(t.isCIDFont){var p=t.tables.cff.topDict._fdSelect[e.index],v=t.tables.cff.topDict._fdArray[p];C=v._subrs,b=v._subrsBias,m=v._defaultWidthX,f=v._nominalWidthX}else C=t.tables.cff.topDict._subrs,b=t.tables.cff.topDict._subrsBias,m=t.tables.cff.topDict._defaultWidthX,f=t.tables.cff.topDict._nominalWidthX;var B=m;function G(E,x){u&&a.closePath(),a.moveTo(E,x),u=!0}function R(){var E;E=l.length%2!==0,E&&!c&&(B=l.shift()+f),g+=l.length>>1,l.length=0,c=!0}function w(E){for(var x,W,T,k,_,U,O,Y,z,N,L,V,M=0;M<E.length;){var X=E[M];switch(M+=1,X){case 1:R();break;case 3:R();break;case 4:l.length>1&&!c&&(B=l.shift()+f,c=!0),h+=l.pop(),G(I,h);break;case 5:for(;l.length>0;)I+=l.shift(),h+=l.shift(),a.lineTo(I,h);break;case 6:for(;l.length>0&&(I+=l.shift(),a.lineTo(I,h),l.length!==0);)h+=l.shift(),a.lineTo(I,h);break;case 7:for(;l.length>0&&(h+=l.shift(),a.lineTo(I,h),l.length!==0);)I+=l.shift(),a.lineTo(I,h);break;case 8:for(;l.length>0;)i=I+l.shift(),r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),I=s+l.shift(),h=o+l.shift(),a.curveTo(i,r,s,o,I,h);break;case 10:_=l.pop()+b,U=C[_],U&&w(U);break;case 11:return;case 12:switch(X=E[M],M+=1,X){case 35:i=I+l.shift(),r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),O=s+l.shift(),Y=o+l.shift(),z=O+l.shift(),N=Y+l.shift(),L=z+l.shift(),V=N+l.shift(),I=L+l.shift(),h=V+l.shift(),l.shift(),a.curveTo(i,r,s,o,O,Y),a.curveTo(z,N,L,V,I,h);break;case 34:i=I+l.shift(),r=h,s=i+l.shift(),o=r+l.shift(),O=s+l.shift(),Y=o,z=O+l.shift(),N=o,L=z+l.shift(),V=h,I=L+l.shift(),a.curveTo(i,r,s,o,O,Y),a.curveTo(z,N,L,V,I,h);break;case 36:i=I+l.shift(),r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),O=s+l.shift(),Y=o,z=O+l.shift(),N=o,L=z+l.shift(),V=N+l.shift(),I=L+l.shift(),a.curveTo(i,r,s,o,O,Y),a.curveTo(z,N,L,V,I,h);break;case 37:i=I+l.shift(),r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),O=s+l.shift(),Y=o+l.shift(),z=O+l.shift(),N=Y+l.shift(),L=z+l.shift(),V=N+l.shift(),Math.abs(L-I)>Math.abs(V-h)?I=L+l.shift():h=V+l.shift(),a.curveTo(i,r,s,o,O,Y),a.curveTo(z,N,L,V,I,h);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+X),l.length=0}break;case 14:l.length>0&&!c&&(B=l.shift()+f,c=!0),u&&(a.closePath(),u=!1);break;case 18:R();break;case 19:case 20:R(),M+=g+7>>3;break;case 21:l.length>2&&!c&&(B=l.shift()+f,c=!0),h+=l.pop(),I+=l.pop(),G(I,h);break;case 22:l.length>1&&!c&&(B=l.shift()+f,c=!0),I+=l.pop(),G(I,h);break;case 23:R();break;case 24:for(;l.length>2;)i=I+l.shift(),r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),I=s+l.shift(),h=o+l.shift(),a.curveTo(i,r,s,o,I,h);I+=l.shift(),h+=l.shift(),a.lineTo(I,h);break;case 25:for(;l.length>6;)I+=l.shift(),h+=l.shift(),a.lineTo(I,h);i=I+l.shift(),r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),I=s+l.shift(),h=o+l.shift(),a.curveTo(i,r,s,o,I,h);break;case 26:for(l.length%2&&(I+=l.shift());l.length>0;)i=I,r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),I=s,h=o+l.shift(),a.curveTo(i,r,s,o,I,h);break;case 27:for(l.length%2&&(h+=l.shift());l.length>0;)i=I+l.shift(),r=h,s=i+l.shift(),o=r+l.shift(),I=s+l.shift(),h=o,a.curveTo(i,r,s,o,I,h);break;case 28:x=E[M],W=E[M+1],l.push((x<<24|W<<16)>>16),M+=2;break;case 29:_=l.pop()+t.gsubrsBias,U=t.gsubrs[_],U&&w(U);break;case 30:for(;l.length>0&&(i=I,r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),I=s+l.shift(),h=o+(l.length===1?l.shift():0),a.curveTo(i,r,s,o,I,h),l.length!==0);)i=I+l.shift(),r=h,s=i+l.shift(),o=r+l.shift(),h=o+l.shift(),I=s+(l.length===1?l.shift():0),a.curveTo(i,r,s,o,I,h);break;case 31:for(;l.length>0&&(i=I+l.shift(),r=h,s=i+l.shift(),o=r+l.shift(),h=o+l.shift(),I=s+(l.length===1?l.shift():0),a.curveTo(i,r,s,o,I,h),l.length!==0);)i=I,r=h+l.shift(),s=i+l.shift(),o=r+l.shift(),I=s+l.shift(),h=o+(l.length===1?l.shift():0),a.curveTo(i,r,s,o,I,h);break;default:X<32?console.log("Glyph "+e.index+": unknown operator "+X):X<247?l.push(X-139):X<251?(x=E[M],M+=1,l.push((X-247)*256+x+108)):X<255?(x=E[M],M+=1,l.push(-(X-251)*256-x-108)):(x=E[M],W=E[M+1],T=E[M+2],k=E[M+3],M+=4,l.push((x<<24|W<<16|T<<8|k)/65536))}}}return w(n),e.advanceWidth=B,a}function Aue(t,e,n,i){var r=[],s,o=new Dt.Parser(t,e),a=o.parseCard8();if(a===0)for(var l=0;l<n;l++){if(s=o.parseCard8(),s>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+i+")");r.push(s)}else if(a===3){var g=o.parseCard16(),c=o.parseCard16();if(c!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var u,I=0;I<g;I++){if(s=o.parseCard8(),u=o.parseCard16(),s>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+i+")");if(u>n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+u);for(;c<u;c++)r.push(s);c=u}if(u!==n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+u)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+a);return r}function hue(t,e,n,i){n.tables.cff={};var r=cue(t,e),s=Fg(t,r.endOffset,Dt.bytesToString),o=Fg(t,s.endOffset),a=Fg(t,o.endOffset,Dt.bytesToString),l=Fg(t,a.endOffset);n.gsubrs=l.objects,n.gsubrsBias=bS(n.gsubrs);var g=VN(t,e,o.objects,a.objects);if(g.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+g.length);var c=g[0];if(n.tables.cff.topDict=c,c._privateDict&&(n.defaultWidthX=c._privateDict.defaultWidthX,n.nominalWidthX=c._privateDict.nominalWidthX),c.ros[0]!==void 0&&c.ros[1]!==void 0&&(n.isCIDFont=!0),n.isCIDFont){var u=c.fdArray,I=c.fdSelect;if(u===0||I===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");u+=e;var h=Fg(t,u),C=VN(t,e,h.objects,a.objects);c._fdArray=C,I+=e,c._fdSelect=Aue(t,I,n.numGlyphs,C.length)}var b=e+c.private[1],m=_X(t,b,c.private[0],a.objects);if(n.defaultWidthX=m.defaultWidthX,n.nominalWidthX=m.nominalWidthX,m.subrs!==0){var f=b+m.subrs,p=Fg(t,f);n.subrs=p.objects,n.subrsBias=bS(n.subrs)}else n.subrs=[],n.subrsBias=0;var v;i.lowMemory?(v=sue(t,e+c.charStrings),n.nGlyphs=v.offsets.length):(v=Fg(t,e+c.charStrings),n.nGlyphs=v.objects.length);var B=Iue(t,e+c.charset,n.nGlyphs,a.objects);if(c.encoding===0?n.cffEncoding=new Sb(qce,B):c.encoding===1?n.cffEncoding=new Sb($ce,B):n.cffEncoding=due(t,e+c.encoding,B),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new $a.GlyphSet(n),i.lowMemory)n._push=function(w){var E=oue(w,v.offsets,t,e+c.charStrings);n.glyphs.push(w,$a.cffGlyphLoader(n,w,LN,E))};else for(var G=0;G<n.nGlyphs;G+=1){var R=v.objects[G];n.glyphs.push(G,$a.cffGlyphLoader(n,G,LN,R))}}function XX(t,e){var n,i=i3.indexOf(t);return i>=0&&(n=i),i=e.indexOf(t),i>=0?n=i+i3.length:(n=i3.length+e.length,e.push(t)),n}function Cue(){return new It.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function fue(t){var e=new It.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var n=0;n<t.length;n+=1)e.names.push({name:"name_"+n,type:"NAME",value:t[n]});return e}function YX(t,e,n){for(var i={},r=0;r<t.length;r+=1){var s=t[r],o=e[s.name];o!==void 0&&!FX(o,s.value)&&(s.type==="SID"&&(o=XX(o,n)),i[s.op]={name:s.name,type:s.type,value:o})}return i}function kN(t,e){var n=new It.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=YX(kX,t,e),n}function HN(t){var e=new It.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function pue(t){var e=new It.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var n=0;n<t.length;n+=1)e.strings.push({name:"string_"+n,type:"STRING",value:t[n]});return e}function mue(){return new It.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function bue(t,e){for(var n=new It.Record("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<t.length;i+=1){var r=t[i],s=XX(r,e);n.fields.push({name:"glyph_"+i,type:"SID",value:s})}return n}function vue(t){var e=[],n=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var i=0,r=0,s=0;s<n.commands.length;s+=1){var o=void 0,a=void 0,l=n.commands[s];if(l.type==="Q"){var g=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(g*i+c*l.x1),y1:Math.round(g*r+c*l.y1),x2:Math.round(g*l.x+c*l.x1),y2:Math.round(g*l.y+c*l.y1)}}if(l.type==="M")o=Math.round(l.x-i),a=Math.round(l.y-r),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(l.x),r=Math.round(l.y);else if(l.type==="L")o=Math.round(l.x-i),a=Math.round(l.y-r),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rlineto",type:"OP",value:5}),i=Math.round(l.x),r=Math.round(l.y);else if(l.type==="C"){var u=Math.round(l.x1-i),I=Math.round(l.y1-r),h=Math.round(l.x2-l.x1),C=Math.round(l.y2-l.y1);o=Math.round(l.x-l.x2),a=Math.round(l.y-l.y2),e.push({name:"dx1",type:"NUMBER",value:u}),e.push({name:"dy1",type:"NUMBER",value:I}),e.push({name:"dx2",type:"NUMBER",value:h}),e.push({name:"dy2",type:"NUMBER",value:C}),e.push({name:"dx",type:"NUMBER",value:o}),e.push({name:"dy",type:"NUMBER",value:a}),e.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(l.x),r=Math.round(l.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function yue(t){for(var e=new It.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<t.length;n+=1){var i=t.get(n),r=vue(i);e.charStrings.push({name:i.name,type:"CHARSTRING",value:r})}return e}function Bue(t,e){var n=new It.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=YX(HX,t,e),n}function Gue(t,e){for(var n=new It.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/e.unitsPerEm,r={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},o=[],a,l=1;l<t.length;l+=1)a=t.get(l),o.push(a.name);var g=[];n.header=Cue(),n.nameIndex=fue([e.postScriptName]);var c=kN(r,g);n.topDictIndex=HN(c),n.globalSubrIndex=mue(),n.charsets=bue(o,g),n.charStringsIndex=yue(t),n.privateDict=Bue(s,g),n.stringIndex=pue(g);var u=n.header.sizeOf()+n.nameIndex.sizeOf()+n.topDictIndex.sizeOf()+n.stringIndex.sizeOf()+n.globalSubrIndex.sizeOf();return r.charset=u,r.encoding=0,r.charStrings=r.charset+n.charsets.sizeOf(),r.private[1]=r.charStrings+n.charStringsIndex.sizeOf(),c=kN(r,g),n.topDictIndex=HN(c),n}var Sue={parse:hue,make:Gue};function wue(t,e){var n={},i=new Dt.Parser(t,e);return n.version=i.parseVersion(),n.fontRevision=Math.round(i.parseFixed()*1e3)/1e3,n.checkSumAdjustment=i.parseULong(),n.magicNumber=i.parseULong(),kt.argument(n.magicNumber===1594834165,"Font header has wrong magic number."),n.flags=i.parseUShort(),n.unitsPerEm=i.parseUShort(),n.created=i.parseLongDateTime(),n.modified=i.parseLongDateTime(),n.xMin=i.parseShort(),n.yMin=i.parseShort(),n.xMax=i.parseShort(),n.yMax=i.parseShort(),n.macStyle=i.parseUShort(),n.lowestRecPPEM=i.parseUShort(),n.fontDirectionHint=i.parseShort(),n.indexToLocFormat=i.parseShort(),n.glyphDataFormat=i.parseShort(),n}function Rue(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,n=e;return t.createdTimestamp&&(n=t.createdTimestamp+2082844800),new It.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var xue={parse:wue,make:Rue};function Zue(t,e){var n={},i=new Dt.Parser(t,e);return n.version=i.parseVersion(),n.ascender=i.parseShort(),n.descender=i.parseShort(),n.lineGap=i.parseShort(),n.advanceWidthMax=i.parseUShort(),n.minLeftSideBearing=i.parseShort(),n.minRightSideBearing=i.parseShort(),n.xMaxExtent=i.parseShort(),n.caretSlopeRise=i.parseShort(),n.caretSlopeRun=i.parseShort(),n.caretOffset=i.parseShort(),i.relativeOffset+=8,n.metricDataFormat=i.parseShort(),n.numberOfHMetrics=i.parseUShort(),n}function Eue(t){return new It.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var Wue={parse:Zue,make:Eue};function Nue(t,e,n,i,r){for(var s,o,a=new Dt.Parser(t,e),l=0;l<i;l+=1){l<n&&(s=a.parseUShort(),o=a.parseShort());var g=r.get(l);g.advanceWidth=s,g.leftSideBearing=o}}function Mue(t,e,n,i,r){t._hmtxTableData={};for(var s,o,a=new Dt.Parser(e,n),l=0;l<r;l+=1)l<i&&(s=a.parseUShort(),o=a.parseShort()),t._hmtxTableData[l]={advanceWidth:s,leftSideBearing:o}}function Tue(t,e,n,i,r,s,o){o.lowMemory?Mue(t,e,n,i,r):Nue(e,n,i,r,s)}function Fue(t){for(var e=new It.Table("hmtx",[]),n=0;n<t.length;n+=1){var i=t.get(n),r=i.advanceWidth||0,s=i.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:r}),e.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:s})}return e}var Vue={parse:Tue,make:Fue};function Lue(t){for(var e=new It.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),n="",i=12+t.length*4,r=0;r<t.length;++r){var s=n.indexOf(t[r]);s<0&&(s=n.length,n+=t[r]),e.fields.push({name:"offset "+r,type:"USHORT",value:i+s}),e.fields.push({name:"length "+r,type:"USHORT",value:t[r].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),e}function kue(t,e){var n=new Dt.Parser(t,e),i=n.parseULong();kt.argument(i===1,"Unsupported ltag table version."),n.skip("uLong",1);for(var r=n.parseULong(),s=[],o=0;o<r;o++){for(var a="",l=e+n.parseUShort(),g=n.parseUShort(),c=l;c<l+g;++c)a+=String.fromCharCode(t.getInt8(c));s.push(a)}return s}var Hue={make:Lue,parse:kue};function _ue(t,e){var n={},i=new Dt.Parser(t,e);return n.version=i.parseVersion(),n.numGlyphs=i.parseUShort(),n.version===1&&(n.maxPoints=i.parseUShort(),n.maxContours=i.parseUShort(),n.maxCompositePoints=i.parseUShort(),n.maxCompositeContours=i.parseUShort(),n.maxZones=i.parseUShort(),n.maxTwilightPoints=i.parseUShort(),n.maxStorage=i.parseUShort(),n.maxFunctionDefs=i.parseUShort(),n.maxInstructionDefs=i.parseUShort(),n.maxStackElements=i.parseUShort(),n.maxSizeOfInstructions=i.parseUShort(),n.maxComponentElements=i.parseUShort(),n.maxComponentDepth=i.parseUShort()),n}function Xue(t){return new It.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Yue={parse:_ue,make:Xue},KX=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],zX={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Kue={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},UX={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function zue(t,e,n){switch(t){case 0:if(e===65535)return"und";if(n)return n[e];break;case 1:return zX[e];case 3:return UX[e]}}var vS="utf-16",Uue={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Due={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function DX(t,e,n){switch(t){case 0:return vS;case 1:return Due[n]||Uue[e];case 3:if(e===1||e===10)return vS;break}}function Pue(t,e,n){for(var i={},r=new Dt.Parser(t,e),s=r.parseUShort(),o=r.parseUShort(),a=r.offset+r.parseUShort(),l=0;l<o;l++){var g=r.parseUShort(),c=r.parseUShort(),u=r.parseUShort(),I=r.parseUShort(),h=KX[I]||I,C=r.parseUShort(),b=r.parseUShort(),m=zue(g,u,n),f=DX(g,c,u);if(f!==void 0&&m!==void 0){var p=void 0;if(f===vS?p=GA.UTF16(t,a+b,C):p=GA.MACSTRING(t,a+b,C,f),p){var v=i[h];v===void 0&&(v=i[h]={}),v[m]=p}}}return s===1&&r.parseUShort(),i}function GB(t){var e={};for(var n in t)e[t[n]]=parseInt(n);return e}function _N(t,e,n,i,r,s){return new It.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:r},{name:"offset",type:"USHORT",value:s}])}function Oue(t,e){var n=t.length,i=e.length-n+1;e:for(var r=0;r<i;r++)for(;r<i;r++){for(var s=0;s<n;s++)if(e[r+s]!==t[s])continue e;return r}return-1}function XN(t,e){var n=Oue(t,e);if(n<0){n=e.length;for(var i=0,r=t.length;i<r;++i)e.push(t[i])}return n}function Que(t,e){var n,i=[],r={},s=GB(KX);for(var o in t){var a=s[o];if(a===void 0&&(a=o),n=parseInt(a),isNaN(n))throw new Error('Name table entry "'+o+'" does not exist, see nameTableNames for complete list.');r[n]=t[o],i.push(n)}for(var l=GB(zX),g=GB(UX),c=[],u=[],I=0;I<i.length;I++){n=i[I];var h=r[n];for(var C in h){var b=h[C],m=1,f=l[C],p=Kue[f],v=DX(m,p,f),B=rt.MACSTRING(b,v);B===void 0&&(m=0,f=e.indexOf(C),f<0&&(f=e.length,e.push(C)),p=4,B=rt.UTF16(b));var G=XN(B,u);c.push(_N(m,p,f,n,B.length,G));var R=g[C];if(R!==void 0){var w=rt.UTF16(b),E=XN(w,u);c.push(_N(3,1,R,n,w.length,E))}}}c.sort(function(T,k){return T.platformID-k.platformID||T.encodingID-k.encodingID||T.languageID-k.languageID||T.nameID-k.nameID});for(var x=new It.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+c.length*12}]),W=0;W<c.length;W++)x.fields.push({name:"record_"+W,type:"RECORD",value:c[W]});return x.fields.push({name:"strings",type:"LITERAL",value:u}),x}var Jue={parse:Pue,make:Que},yS=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function jue(t){for(var e=0;e<yS.length;e+=1){var n=yS[e];if(t>=n.begin&&t<n.end)return e}return-1}function que(t,e){var n={},i=new Dt.Parser(t,e);n.version=i.parseUShort(),n.xAvgCharWidth=i.parseShort(),n.usWeightClass=i.parseUShort(),n.usWidthClass=i.parseUShort(),n.fsType=i.parseUShort(),n.ySubscriptXSize=i.parseShort(),n.ySubscriptYSize=i.parseShort(),n.ySubscriptXOffset=i.parseShort(),n.ySubscriptYOffset=i.parseShort(),n.ySuperscriptXSize=i.parseShort(),n.ySuperscriptYSize=i.parseShort(),n.ySuperscriptXOffset=i.parseShort(),n.ySuperscriptYOffset=i.parseShort(),n.yStrikeoutSize=i.parseShort(),n.yStrikeoutPosition=i.parseShort(),n.sFamilyClass=i.parseShort(),n.panose=[];for(var r=0;r<10;r++)n.panose[r]=i.parseByte();return n.ulUnicodeRange1=i.parseULong(),n.ulUnicodeRange2=i.parseULong(),n.ulUnicodeRange3=i.parseULong(),n.ulUnicodeRange4=i.parseULong(),n.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),n.fsSelection=i.parseUShort(),n.usFirstCharIndex=i.parseUShort(),n.usLastCharIndex=i.parseUShort(),n.sTypoAscender=i.parseShort(),n.sTypoDescender=i.parseShort(),n.sTypoLineGap=i.parseShort(),n.usWinAscent=i.parseUShort(),n.usWinDescent=i.parseUShort(),n.version>=1&&(n.ulCodePageRange1=i.parseULong(),n.ulCodePageRange2=i.parseULong()),n.version>=2&&(n.sxHeight=i.parseShort(),n.sCapHeight=i.parseShort(),n.usDefaultChar=i.parseUShort(),n.usBreakChar=i.parseUShort(),n.usMaxContent=i.parseUShort()),n}function $ue(t){return new It.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var YN={parse:que,make:$ue,unicodeRanges:yS,getUnicodeRange:jue};function eIe(t,e){var n={},i=new Dt.Parser(t,e);switch(n.version=i.parseVersion(),n.italicAngle=i.parseFixed(),n.underlinePosition=i.parseShort(),n.underlineThickness=i.parseShort(),n.isFixedPitch=i.parseULong(),n.minMemType42=i.parseULong(),n.maxMemType42=i.parseULong(),n.minMemType1=i.parseULong(),n.maxMemType1=i.parseULong(),n.version){case 1:n.names=FN.slice();break;case 2:n.numberOfGlyphs=i.parseUShort(),n.glyphNameIndex=new Array(n.numberOfGlyphs);for(var r=0;r<n.numberOfGlyphs;r++)n.glyphNameIndex[r]=i.parseUShort();n.names=[];for(var s=0;s<n.numberOfGlyphs;s++)if(n.glyphNameIndex[s]>=FN.length){var o=i.parseChar();n.names.push(i.parseString(o))}break;case 2.5:n.numberOfGlyphs=i.parseUShort(),n.offset=new Array(n.numberOfGlyphs);for(var a=0;a<n.numberOfGlyphs;a++)n.offset[a]=i.parseChar();break}return n}function tIe(){return new It.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var nIe={parse:eIe,make:tIe},fa=new Array(9);fa[1]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:1,coverage:this.parsePointer(Ne.coverage),deltaGlyphId:this.parseUShort()};if(n===2)return{substFormat:2,coverage:this.parsePointer(Ne.coverage),substitute:this.parseOffset16List()};kt.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};fa[2]=function(){var e=this.parseUShort();return kt.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ne.coverage),sequences:this.parseListOfLists()}};fa[3]=function(){var e=this.parseUShort();return kt.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ne.coverage),alternateSets:this.parseListOfLists()}};fa[4]=function(){var e=this.parseUShort();return kt.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ne.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var aA={sequenceIndex:Ne.uShort,lookupListIndex:Ne.uShort};fa[5]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:n,coverage:this.parsePointer(Ne.coverage),ruleSets:this.parseListOfLists(function(){var s=this.parseUShort(),o=this.parseUShort();return{input:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(o,aA)}})};if(n===2)return{substFormat:n,coverage:this.parsePointer(Ne.coverage),classDef:this.parsePointer(Ne.classDef),classSets:this.parseListOfLists(function(){var s=this.parseUShort(),o=this.parseUShort();return{classes:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(o,aA)}})};if(n===3){var i=this.parseUShort(),r=this.parseUShort();return{substFormat:n,coverages:this.parseList(i,Ne.pointer(Ne.coverage)),lookupRecords:this.parseRecordList(r,aA)}}kt.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};fa[6]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:1,coverage:this.parsePointer(Ne.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(aA)}})};if(n===2)return{substFormat:2,coverage:this.parsePointer(Ne.coverage),backtrackClassDef:this.parsePointer(Ne.classDef),inputClassDef:this.parsePointer(Ne.classDef),lookaheadClassDef:this.parsePointer(Ne.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(aA)}})};if(n===3)return{substFormat:3,backtrackCoverage:this.parseList(Ne.pointer(Ne.coverage)),inputCoverage:this.parseList(Ne.pointer(Ne.coverage)),lookaheadCoverage:this.parseList(Ne.pointer(Ne.coverage)),lookupRecords:this.parseRecordList(aA)};kt.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};fa[7]=function(){var e=this.parseUShort();kt.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var n=this.parseUShort(),i=new Ne(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:n,extension:fa[n].call(i)}};fa[8]=function(){var e=this.parseUShort();return kt.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ne.coverage),backtrackCoverage:this.parseList(Ne.pointer(Ne.coverage)),lookaheadCoverage:this.parseList(Ne.pointer(Ne.coverage)),substitutes:this.parseUShortList()}};function iIe(t,e){e=e||0;var n=new Ne(t,e),i=n.parseVersion(1);return kt.argument(i===1||i===1.1,"Unsupported GSUB table version."),i===1?{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(fa)}:{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(fa),variations:n.parseFeatureVariationsList()}}var PA=new Array(9);PA[1]=function(e){return e.substFormat===1?new It.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new It.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new It.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new It.Coverage(e.coverage)}].concat(It.ushortList("substitute",e.substitute)))};PA[2]=function(e){return kt.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new It.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new It.Coverage(e.coverage)}].concat(It.tableList("seqSet",e.sequences,function(n){return new It.Table("sequenceSetTable",It.ushortList("sequence",n))})))};PA[3]=function(e){return kt.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new It.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new It.Coverage(e.coverage)}].concat(It.tableList("altSet",e.alternateSets,function(n){return new It.Table("alternateSetTable",It.ushortList("alternate",n))})))};PA[4]=function(e){return kt.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new It.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new It.Coverage(e.coverage)}].concat(It.tableList("ligSet",e.ligatureSets,function(n){return new It.Table("ligatureSetTable",It.tableList("ligature",n,function(i){return new It.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:i.ligGlyph}].concat(It.ushortList("component",i.components,i.components.length+1)))}))})))};PA[6]=function(e){if(e.substFormat===1){var n=new It.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new It.Coverage(e.coverage)}].concat(It.tableList("chainRuleSet",e.chainRuleSets,function(s){return new It.Table("chainRuleSetTable",It.tableList("chainRule",s,function(o){var a=It.ushortList("backtrackGlyph",o.backtrack,o.backtrack.length).concat(It.ushortList("inputGlyph",o.input,o.input.length+1)).concat(It.ushortList("lookaheadGlyph",o.lookahead,o.lookahead.length)).concat(It.ushortList("substitution",[],o.lookupRecords.length));return o.lookupRecords.forEach(function(l,g){a=a.concat({name:"sequenceIndex"+g,type:"USHORT",value:l.sequenceIndex}).concat({name:"lookupListIndex"+g,type:"USHORT",value:l.lookupListIndex})}),new It.Table("chainRuleTable",a)}))})));return n}else if(e.substFormat===2)kt.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var i=[{name:"substFormat",type:"USHORT",value:e.substFormat}];i.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(s,o){i.push({name:"backtrackCoverage"+o,type:"TABLE",value:new It.Coverage(s)})}),i.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(s,o){i.push({name:"inputCoverage"+o,type:"TABLE",value:new It.Coverage(s)})}),i.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(s,o){i.push({name:"lookaheadCoverage"+o,type:"TABLE",value:new It.Coverage(s)})}),i.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(s,o){i=i.concat({name:"sequenceIndex"+o,type:"USHORT",value:s.sequenceIndex}).concat({name:"lookupListIndex"+o,type:"USHORT",value:s.lookupListIndex})});var r=new It.Table("chainContextTable",i);return r}kt.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function rIe(t){return new It.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new It.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new It.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new It.LookupList(t.lookups,PA)}])}var sIe={parse:iIe,make:rIe};function oIe(t,e){var n=new Dt.Parser(t,e),i=n.parseULong();kt.argument(i===1,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var r=n.parseULong(),s={},o=0;o<r;o++){var a=n.parseTag(),l=n.parseULong(),g=n.parseULong(),c=GA.UTF8(t,e+l,g);s[a]=c}return s}function aIe(t){var e=Object.keys(t).length,n="",i=16+e*12,r=new It.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:i},{name:"numTags",type:"ULONG",value:e}]);for(var s in t){var o=n.length;n+=t[s],r.fields.push({name:"tag "+s,type:"TAG",value:s}),r.fields.push({name:"offset "+s,type:"ULONG",value:i+o}),r.fields.push({name:"length "+s,type:"ULONG",value:t[s].length})}return r.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),r}var lIe={parse:oIe,make:aIe};function KN(t){return Math.log(t)/Math.log(2)|0}function Ox(t){for(;t.length%4!==0;)t.push(0);for(var e=0,n=0;n<t.length;n+=4)e+=(t[n]<<24)+(t[n+1]<<16)+(t[n+2]<<8)+t[n+3];return e%=Math.pow(2,32),e}function zN(t,e,n,i){return new It.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:n!==void 0?n:0},{name:"length",type:"ULONG",value:i!==void 0?i:0}])}function PX(t){var e=new It.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var n=Math.pow(2,KN(e.numTables));e.searchRange=16*n,e.entrySelector=KN(n),e.rangeShift=e.numTables*16-e.searchRange;for(var i=[],r=[],s=e.sizeOf()+zN().sizeOf()*e.numTables;s%4!==0;)s+=1,r.push({name:"padding",type:"BYTE",value:0});for(var o=0;o<t.length;o+=1){var a=t[o];kt.argument(a.tableName.length===4,"Table name"+a.tableName+" is invalid.");var l=a.sizeOf(),g=zN(a.tableName,Ox(a.encode()),s,l);for(i.push({name:g.tag+" Table Record",type:"RECORD",value:g}),r.push({name:a.tableName+" table",type:"RECORD",value:a}),s+=l,kt.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!==0;)s+=1,r.push({name:"padding",type:"BYTE",value:0})}return i.sort(function(c,u){return c.value.tag>u.value.tag?1:-1}),e.fields=e.fields.concat(i),e.fields=e.fields.concat(r),e}function UN(t,e,n){for(var i=0;i<e.length;i+=1){var r=t.charToGlyphIndex(e[i]);if(r>0){var s=t.glyphs.get(r);return s.getMetrics()}}return n}function gIe(t){for(var e=0,n=0;n<t.length;n+=1)e+=t[n];return e/t.length}function cIe(t){for(var e=[],n=[],i=[],r=[],s=[],o=[],a=[],l,g=0,c=0,u=0,I=0,h=0,C=0;C<t.glyphs.length;C+=1){var b=t.glyphs.get(C),m=b.unicode|0;if(isNaN(b.advanceWidth))throw new Error("Glyph "+b.name+" ("+C+"): advanceWidth is not a number.");(l>m||l===void 0)&&m>0&&(l=m),g<m&&(g=m);var f=YN.getUnicodeRange(m);if(f<32)c|=1<<f;else if(f<64)u|=1<<f-32;else if(f<96)I|=1<<f-64;else if(f<123)h|=1<<f-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(b.name!==".notdef"){var p=b.getMetrics();e.push(p.xMin),n.push(p.yMin),i.push(p.xMax),r.push(p.yMax),o.push(p.leftSideBearing),a.push(p.rightSideBearing),s.push(b.advanceWidth)}}var v={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,r),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:gIe(s),minLeftSideBearing:Math.min.apply(null,o),maxLeftSideBearing:Math.max.apply(null,o),minRightSideBearing:Math.min.apply(null,a)};v.ascender=t.ascender,v.descender=t.descender;var B=xue.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:v.xMin,yMin:v.yMin,xMax:v.xMax,yMax:v.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),G=Wue.make({ascender:v.ascender,descender:v.descender,advanceWidthMax:v.advanceWidthMax,minLeftSideBearing:v.minLeftSideBearing,minRightSideBearing:v.minRightSideBearing,xMaxExtent:v.maxLeftSideBearing+(v.xMax-v.xMin),numberOfHMetrics:t.glyphs.length}),R=Yue.make(t.glyphs.length),w=YN.make(Object.assign({xAvgCharWidth:Math.round(v.advanceWidthAvg),usFirstCharIndex:l,usLastCharIndex:g,ulUnicodeRange1:c,ulUnicodeRange2:u,ulUnicodeRange3:I,ulUnicodeRange4:h,sTypoAscender:v.ascender,sTypoDescender:v.descender,sTypoLineGap:0,usWinAscent:v.yMax,usWinDescent:Math.abs(v.yMin),ulCodePageRange1:1,sxHeight:UN(t,"xyvw",{yMax:Math.round(v.ascender/2)}).yMax,sCapHeight:UN(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",v).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),E=Vue.make(t.glyphs),x=jce.make(t.glyphs),W=t.getEnglishName("fontFamily"),T=t.getEnglishName("fontSubfamily"),k=W+" "+T,_=t.getEnglishName("postScriptName");_||(_=W.replace(/\s/g,"")+"-"+T);var U={};for(var O in t.names)U[O]=t.names[O];U.uniqueID||(U.uniqueID={en:t.getEnglishName("manufacturer")+":"+k}),U.postScriptName||(U.postScriptName={en:_}),U.preferredFamily||(U.preferredFamily=t.names.fontFamily),U.preferredSubfamily||(U.preferredSubfamily=t.names.fontSubfamily);var Y=[],z=Jue.make(U,Y),N=Y.length>0?Hue.make(Y):void 0,L=nIe.make(),V=Sue.make(t.glyphs,{version:t.getEnglishName("version"),fullName:k,familyName:W,weightName:T,postScriptName:_,unitsPerEm:t.unitsPerEm,fontBBox:[0,v.yMin,v.ascender,v.advanceWidthMax]}),M=t.metas&&Object.keys(t.metas).length>0?lIe.make(t.metas):void 0,X=[B,G,R,w,z,x,L,V,E];N&&X.push(N),t.tables.gsub&&X.push(sIe.make(t.tables.gsub)),M&&X.push(M);for(var J=PX(X),re=J.encode(),se=Ox(re),le=J.fields,ae=!1,ce=0;ce<le.length;ce+=1)if(le[ce].name==="head table"){le[ce].value.checkSumAdjustment=2981146554-se,ae=!0;break}if(!ae)throw new Error("Could not find head table with checkSum to adjust.");return J}var uIe={make:PX,fontToTable:cIe,computeCheckSum:Ox};function SB(t,e){for(var n=0,i=t.length-1;n<=i;){var r=n+i>>>1,s=t[r].tag;if(s===e)return r;s<e?n=r+1:i=r-1}return-n-1}function DN(t,e){for(var n=0,i=t.length-1;n<=i;){var r=n+i>>>1,s=t[r];if(s===e)return r;s<e?n=r+1:i=r-1}return-n-1}function PN(t,e){for(var n,i=0,r=t.length-1;i<=r;){var s=i+r>>>1;n=t[s];var o=n.start;if(o===e)return n;o<e?i=s+1:r=s-1}if(i>0)return n=t[i-1],e>n.end?0:n}function M0(t,e){this.font=t,this.tableName=e}M0.prototype={searchTag:SB,binSearch:DN,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,n=0;n<t.scripts.length;n++){var i=t.scripts[n].tag;if(i==="DFLT")return i;i==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var n=this.getTable(e);if(n){t=t||"DFLT";var i=n.scripts,r=SB(n.scripts,t);if(r>=0)return i[r].script;if(e){var s={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-r,0,s),s.script}}},getLangSysTable:function(t,e,n){var i=this.getScriptTable(t,n);if(i){if(!e||e==="dflt"||e==="DFLT")return i.defaultLangSys;var r=SB(i.langSysRecords,e);if(r>=0)return i.langSysRecords[r].langSys;if(n){var s={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-r,0,s),s.langSys}}},getFeatureTable:function(t,e,n,i){var r=this.getLangSysTable(t,e,i);if(r){for(var s,o=r.featureIndexes,a=this.font.tables[this.tableName].features,l=0;l<o.length;l++)if(s=a[o[l]],s.tag===n)return s.feature;if(i){var g=a.length;return kt.assert(g===0||n>=a[g-1].tag,"Features must be added in alphabetical order."),s={tag:n,feature:{params:0,lookupListIndexes:[]}},a.push(s),o.push(g),s.feature}}},getLookupTables:function(t,e,n,i,r){var s=this.getFeatureTable(t,e,n,r),o=[];if(s){for(var a,l=s.lookupListIndexes,g=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)a=g[l[c]],a.lookupType===i&&o.push(a);if(o.length===0&&r){a={lookupType:i,lookupFlag:0,subtables:[],markFilteringSet:void 0};var u=g.length;return g.push(a),l.push(u),[a]}}return o},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var n=PN(t.ranges,e);return n?n.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var n=DN(t.glyphs,e);return n>=0?n:-1;case 2:var i=PN(t.ranges,e);return i?i.index+e-i.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],n=t.ranges,i=0;i<n.length;i++)for(var r=n[i],s=r.start,o=r.end,a=s;a<=o;a++)e.push(a);return e}};function T0(t){M0.call(this,t,"gpos")}T0.prototype=M0.prototype;T0.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};T0.prototype.getKerningValue=function(t,e,n){for(var i=0;i<t.length;i++)for(var r=t[i].subtables,s=0;s<r.length;s++){var o=r[s],a=this.getCoverageIndex(o.coverage,e);if(!(a<0))switch(o.posFormat){case 1:for(var l=o.pairSets[a],g=0;g<l.length;g++){var c=l[g];if(c.secondGlyph===n)return c.value1&&c.value1.xAdvance||0}break;case 2:var u=this.getGlyphClass(o.classDef1,e),I=this.getGlyphClass(o.classDef2,n),h=o.classRecords[u][I];return h.value1&&h.value1.xAdvance||0}}return 0};T0.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function lo(t){M0.call(this,t,"gsub")}function IIe(t,e){var n=t.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Qx(t,e,n){for(var i=t.subtables,r=0;r<i.length;r++){var s=i[r];if(s.substFormat===e)return s}if(n)return i.push(n),n}lo.prototype=M0.prototype;lo.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};lo.prototype.getSingle=function(t,e,n){for(var i=[],r=this.getLookupTables(e,n,t,1),s=0;s<r.length;s++)for(var o=r[s].subtables,a=0;a<o.length;a++){var l=o[a],g=this.expandCoverage(l.coverage),c=void 0;if(l.substFormat===1){var u=l.deltaGlyphId;for(c=0;c<g.length;c++){var I=g[c];i.push({sub:I,by:I+u})}}else{var h=l.substitute;for(c=0;c<g.length;c++)i.push({sub:g[c],by:h[c]})}}return i};lo.prototype.getMultiple=function(t,e,n){for(var i=[],r=this.getLookupTables(e,n,t,2),s=0;s<r.length;s++)for(var o=r[s].subtables,a=0;a<o.length;a++){var l=o[a],g=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<g.length;c++){var u=g[c],I=l.sequences[c];i.push({sub:u,by:I})}}return i};lo.prototype.getAlternates=function(t,e,n){for(var i=[],r=this.getLookupTables(e,n,t,3),s=0;s<r.length;s++)for(var o=r[s].subtables,a=0;a<o.length;a++)for(var l=o[a],g=this.expandCoverage(l.coverage),c=l.alternateSets,u=0;u<g.length;u++)i.push({sub:g[u],by:c[u]});return i};lo.prototype.getLigatures=function(t,e,n){for(var i=[],r=this.getLookupTables(e,n,t,4),s=0;s<r.length;s++)for(var o=r[s].subtables,a=0;a<o.length;a++)for(var l=o[a],g=this.expandCoverage(l.coverage),c=l.ligatureSets,u=0;u<g.length;u++)for(var I=g[u],h=c[u],C=0;C<h.length;C++){var b=h[C];i.push({sub:[I].concat(b.components),by:b.ligGlyph})}return i};lo.prototype.addSingle=function(t,e,n,i){var r=this.getLookupTables(n,i,t,1,!0)[0],s=Qx(r,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});kt.assert(s.coverage.format===1,"Single: unable to modify coverage table format "+s.coverage.format);var o=e.sub,a=this.binSearch(s.coverage.glyphs,o);a<0&&(a=-1-a,s.coverage.glyphs.splice(a,0,o),s.substitute.splice(a,0,0)),s.substitute[a]=e.by};lo.prototype.addMultiple=function(t,e,n,i){kt.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var r=this.getLookupTables(n,i,t,2,!0)[0],s=Qx(r,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});kt.assert(s.coverage.format===1,"Multiple: unable to modify coverage table format "+s.coverage.format);var o=e.sub,a=this.binSearch(s.coverage.glyphs,o);a<0&&(a=-1-a,s.coverage.glyphs.splice(a,0,o),s.sequences.splice(a,0,0)),s.sequences[a]=e.by};lo.prototype.addAlternate=function(t,e,n,i){var r=this.getLookupTables(n,i,t,3,!0)[0],s=Qx(r,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});kt.assert(s.coverage.format===1,"Alternate: unable to modify coverage table format "+s.coverage.format);var o=e.sub,a=this.binSearch(s.coverage.glyphs,o);a<0&&(a=-1-a,s.coverage.glyphs.splice(a,0,o),s.alternateSets.splice(a,0,0)),s.alternateSets[a]=e.by};lo.prototype.addLigature=function(t,e,n,i){var r=this.getLookupTables(n,i,t,4,!0)[0],s=r.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},r.subtables[0]=s),kt.assert(s.coverage.format===1,"Ligature: unable to modify coverage table format "+s.coverage.format);var o=e.sub[0],a=e.sub.slice(1),l={ligGlyph:e.by,components:a},g=this.binSearch(s.coverage.glyphs,o);if(g>=0){for(var c=s.ligatureSets[g],u=0;u<c.length;u++)if(IIe(c[u].components,a))return;c.push(l)}else g=-1-g,s.coverage.glyphs.splice(g,0,o),s.ligatureSets.splice(g,0,[l])};lo.prototype.getFeature=function(t,e,n){if(/ss\d\d/.test(t))return this.getSingle(t,e,n);switch(t){case"aalt":case"salt":return this.getSingle(t,e,n).concat(this.getAlternates(t,e,n));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,n);case"ccmp":return this.getMultiple(t,e,n).concat(this.getLigatures(t,e,n));case"stch":return this.getMultiple(t,e,n)}};lo.prototype.add=function(t,e,n,i){if(/ss\d\d/.test(t))return this.addSingle(t,e,n,i);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,n,i):this.addAlternate(t,e,n,i);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,n,i);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,n,i):this.addLigature(t,e,n,i)}};function dIe(){return typeof window<"u"}function AIe(t){for(var e=new Buffer(t.byteLength),n=new Uint8Array(t),i=0;i<e.length;++i)e[i]=n[i];return e}function jh(t,e){if(!t)throw e}function ON(t,e,n,i,r){var s;return(e&i)>0?(s=t.parseByte(),e&r||(s=-s),s=n+s):(e&r)>0?s=n:s=n+t.parseShort(),s}function OX(t,e,n){var i=new Dt.Parser(e,n);t.numberOfContours=i.parseShort(),t._xMin=i.parseShort(),t._yMin=i.parseShort(),t._xMax=i.parseShort(),t._yMax=i.parseShort();var r,s;if(t.numberOfContours>0){for(var o=t.endPointIndices=[],a=0;a<t.numberOfContours;a+=1)o.push(i.parseUShort());t.instructionLength=i.parseUShort(),t.instructions=[];for(var l=0;l<t.instructionLength;l+=1)t.instructions.push(i.parseByte());var g=o[o.length-1]+1;r=[];for(var c=0;c<g;c+=1)if(s=i.parseByte(),r.push(s),(s&8)>0)for(var u=i.parseByte(),I=0;I<u;I+=1)r.push(s),c+=1;if(kt.argument(r.length===g,"Bad flags."),o.length>0){var h=[],C;if(g>0){for(var b=0;b<g;b+=1)s=r[b],C={},C.onCurve=!!(s&1),C.lastPointOfContour=o.indexOf(b)>=0,h.push(C);for(var m=0,f=0;f<g;f+=1)s=r[f],C=h[f],C.x=ON(i,s,m,2,16),m=C.x;for(var p=0,v=0;v<g;v+=1)s=r[v],C=h[v],C.y=ON(i,s,p,4,32),p=C.y}t.points=h}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var B=!0;B;){r=i.parseUShort();var G={glyphIndex:i.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(r&1)>0?(r&2)>0?(G.dx=i.parseShort(),G.dy=i.parseShort()):G.matchedPoints=[i.parseUShort(),i.parseUShort()]:(r&2)>0?(G.dx=i.parseChar(),G.dy=i.parseChar()):G.matchedPoints=[i.parseByte(),i.parseByte()],(r&8)>0?G.xScale=G.yScale=i.parseF2Dot14():(r&64)>0?(G.xScale=i.parseF2Dot14(),G.yScale=i.parseF2Dot14()):(r&128)>0&&(G.xScale=i.parseF2Dot14(),G.scale01=i.parseF2Dot14(),G.scale10=i.parseF2Dot14(),G.yScale=i.parseF2Dot14()),t.components.push(G),B=!!(r&32)}if(r&256){t.instructionLength=i.parseUShort(),t.instructions=[];for(var R=0;R<t.instructionLength;R+=1)t.instructions.push(i.parseByte())}}}function wB(t,e){for(var n=[],i=0;i<t.length;i+=1){var r=t[i],s={x:e.xScale*r.x+e.scale01*r.y+e.dx,y:e.scale10*r.x+e.yScale*r.y+e.dy,onCurve:r.onCurve,lastPointOfContour:r.lastPointOfContour};n.push(s)}return n}function hIe(t){for(var e=[],n=[],i=0;i<t.length;i+=1){var r=t[i];n.push(r),r.lastPointOfContour&&(e.push(n),n=[])}return kt.argument(n.length===0,"There are still points left in the current contour."),e}function QX(t){var e=new Ji;if(!t)return e;for(var n=hIe(t),i=0;i<n.length;++i){var r=n[i],s=null,o=r[r.length-1],a=r[0];if(o.onCurve)e.moveTo(o.x,o.y);else if(a.onCurve)e.moveTo(a.x,a.y);else{var l={x:(o.x+a.x)*.5,y:(o.y+a.y)*.5};e.moveTo(l.x,l.y)}for(var g=0;g<r.length;++g)if(s=o,o=a,a=r[(g+1)%r.length],o.onCurve)e.lineTo(o.x,o.y);else{var c=a;s.onCurve||((o.x+s.x)*.5,(o.y+s.y)*.5),a.onCurve||(c={x:(o.x+a.x)*.5,y:(o.y+a.y)*.5}),e.quadraticCurveTo(o.x,o.y,c.x,c.y)}e.closePath()}return e}function JX(t,e){if(e.isComposite)for(var n=0;n<e.components.length;n+=1){var i=e.components[n],r=t.get(i.glyphIndex);if(r.getPath(),r.points){var s=void 0;if(i.matchedPoints===void 0)s=wB(r.points,i);else{if(i.matchedPoints[0]>e.points.length-1||i.matchedPoints[1]>r.points.length-1)throw Error("Matched points out of range in "+e.name);var o=e.points[i.matchedPoints[0]],a=r.points[i.matchedPoints[1]],l={xScale:i.xScale,scale01:i.scale01,scale10:i.scale10,yScale:i.yScale,dx:0,dy:0};a=wB([a],l)[0],l.dx=o.x-a.x,l.dy=o.y-a.y,s=wB(r.points,l)}e.points=e.points.concat(s)}}return QX(e.points)}function CIe(t,e,n,i){for(var r=new $a.GlyphSet(i),s=0;s<n.length-1;s+=1){var o=n[s],a=n[s+1];o!==a?r.push(s,$a.ttfGlyphLoader(i,s,OX,t,e+o,JX)):r.push(s,$a.glyphLoader(i,s))}return r}function fIe(t,e,n,i){var r=new $a.GlyphSet(i);return i._push=function(s){var o=n[s],a=n[s+1];o!==a?r.push(s,$a.ttfGlyphLoader(i,s,OX,t,e+o,JX)):r.push(s,$a.glyphLoader(i,s))},r}function pIe(t,e,n,i,r){return r.lowMemory?fIe(t,e,n,i):CIe(t,e,n,i)}var mIe={getPath:QX,parse:pIe},jX,lI,qX,BS;function $X(t){this.font=t,this.getCommands=function(e){return mIe.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function bIe(t){return t}function eY(t){return Math.sign(t)*Math.round(Math.abs(t))}function vIe(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function yIe(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function BIe(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function GIe(t){return Math.sign(t)*Math.floor(Math.abs(t))}var tY=function(t){var e=this.srPeriod,n=this.srPhase,i=this.srThreshold,r=1;return t<0&&(t=-t,r=-1),t+=i-n,t=Math.trunc(t/e)*e,t+=n,t<0?n*r:t*r},Pa={x:1,y:0,axis:"x",distance:function(t,e,n,i){return(n?t.xo:t.x)-(i?e.xo:e.x)},interpolate:function(t,e,n,i){var r,s,o,a,l,g,c;if(!i||i===this){if(r=t.xo-e.xo,s=t.xo-n.xo,l=e.x-e.xo,g=n.x-n.xo,o=Math.abs(r),a=Math.abs(s),c=o+a,c===0){t.x=t.xo+(l+g)/2;return}t.x=t.xo+(l*a+g*o)/c;return}if(r=i.distance(t,e,!0,!0),s=i.distance(t,n,!0,!0),l=i.distance(e,e,!1,!0),g=i.distance(n,n,!1,!0),o=Math.abs(r),a=Math.abs(s),c=o+a,c===0){Pa.setRelative(t,t,(l+g)/2,i,!0);return}Pa.setRelative(t,t,(l*a+g*o)/c,i,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,n,i,r){if(!i||i===this){t.x=(r?e.xo:e.x)+n;return}var s=r?e.xo:e.x,o=r?e.yo:e.y,a=s+n*i.x,l=o+n*i.y;t.x=a+(t.y-l)/i.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},Ul={x:0,y:1,axis:"y",distance:function(t,e,n,i){return(n?t.yo:t.y)-(i?e.yo:e.y)},interpolate:function(t,e,n,i){var r,s,o,a,l,g,c;if(!i||i===this){if(r=t.yo-e.yo,s=t.yo-n.yo,l=e.y-e.yo,g=n.y-n.yo,o=Math.abs(r),a=Math.abs(s),c=o+a,c===0){t.y=t.yo+(l+g)/2;return}t.y=t.yo+(l*a+g*o)/c;return}if(r=i.distance(t,e,!0,!0),s=i.distance(t,n,!0,!0),l=i.distance(e,e,!1,!0),g=i.distance(n,n,!1,!0),o=Math.abs(r),a=Math.abs(s),c=o+a,c===0){Ul.setRelative(t,t,(l+g)/2,i,!0);return}Ul.setRelative(t,t,(l*a+g*o)/c,i,!0)},normalSlope:0,setRelative:function(t,e,n,i,r){if(!i||i===this){t.y=(r?e.yo:e.y)+n;return}var s=r?e.xo:e.x,o=r?e.yo:e.y,a=s+n*i.x,l=o+n*i.y;t.y=l+i.normalSlope*(t.x-a)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(Pa);Object.freeze(Ul);function F0(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}F0.prototype.distance=function(t,e,n,i){return this.x*Pa.distance(t,e,n,i)+this.y*Ul.distance(t,e,n,i)};F0.prototype.interpolate=function(t,e,n,i){var r,s,o,a,l,g,c;if(o=i.distance(t,e,!0,!0),a=i.distance(t,n,!0,!0),r=i.distance(e,e,!1,!0),s=i.distance(n,n,!1,!0),l=Math.abs(o),g=Math.abs(a),c=l+g,c===0){this.setRelative(t,t,(r+s)/2,i,!0);return}this.setRelative(t,t,(r*g+s*l)/c,i,!0)};F0.prototype.setRelative=function(t,e,n,i,r){i=i||this;var s=r?e.xo:e.x,o=r?e.yo:e.y,a=s+n*i.x,l=o+n*i.y,g=i.normalSlope,c=this.slope,u=t.x,I=t.y;t.x=(c*u-g*a+l-I)/(c-g),t.y=c*(t.x-u)+I};F0.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function V0(t,e){var n=Math.sqrt(t*t+e*e);return t/=n,e/=n,t===1&&e===0?Pa:t===0&&e===1?Ul:new F0(t,e)}function Ql(t,e,n,i){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=n,this.onCurve=i,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Ql.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};Ql.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var jf=Object.freeze(new Ql(0,0)),SIe={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function zg(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Pa,this.round=eY}}$X.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var n=this.font,i=this._prepState;if(!i||i.ppem!==e){var r=this._fpgmState;if(!r){zg.prototype=SIe,r=this._fpgmState=new zg("fpgm",n.tables.fpgm),r.funcs=[],r.font=n,Xe.DEBUG&&(console.log("---EXEC FPGM---"),r.step=-1);try{lI(r)}catch(g){console.log("Hinting error in FPGM:"+g),this._errorState=3;return}}zg.prototype=r,i=this._prepState=new zg("prep",n.tables.prep),i.ppem=e;var s=n.tables.cvt;if(s)for(var o=i.cvt=new Array(s.length),a=e/n.unitsPerEm,l=0;l<s.length;l++)o[l]=s[l]*a;else i.cvt=[];Xe.DEBUG&&(console.log("---EXEC PREP---"),i.step=-1);try{lI(i)}catch(g){this._errorState<2&&console.log("Hinting error in PREP:"+g),this._errorState=2}}if(!(this._errorState>1))try{return qX(t,i)}catch(g){this._errorState<1&&(console.log("Hinting error:"+g),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};qX=function(t,e){var n=e.ppem/e.font.unitsPerEm,i=n,r=t.components,s,o,a;if(zg.prototype=e,!r)a=new zg("glyf",t.instructions),Xe.DEBUG&&(console.log("---EXEC GLYPH---"),a.step=-1),BS(t,a,n,i),o=a.gZone;else{var l=e.font;o=[],s=[];for(var g=0;g<r.length;g++){var c=r[g],u=l.glyphs.get(c.glyphIndex);a=new zg("glyf",u.instructions),Xe.DEBUG&&(console.log("---EXEC COMP "+g+"---"),a.step=-1),BS(u,a,n,i);for(var I=Math.round(c.dx*n),h=Math.round(c.dy*i),C=a.gZone,b=a.contours,m=0;m<C.length;m++){var f=C[m];f.xTouched=f.yTouched=!1,f.xo=f.x=f.x+I,f.yo=f.y=f.y+h}var p=o.length;o.push.apply(o,C);for(var v=0;v<b.length;v++)s.push(b[v]+p)}t.instructions&&!a.inhibitGridFit&&(a=new zg("glyf",t.instructions),a.gZone=a.z0=a.z1=a.z2=o,a.contours=s,o.push(new Ql(0,0),new Ql(Math.round(t.advanceWidth*n),0)),Xe.DEBUG&&(console.log("---EXEC COMPOSITE---"),a.step=-1),lI(a),o.length-=2)}return o};BS=function(t,e,n,i){for(var r=t.points||[],s=r.length,o=e.gZone=e.z0=e.z1=e.z2=[],a=e.contours=[],l,g=0;g<s;g++)l=r[g],o[g]=new Ql(l.x*n,l.y*i,l.lastPointOfContour,l.onCurve);for(var c,u,I=0;I<s;I++)l=o[I],c||(c=l,a.push(I)),l.lastPointOfContour?(l.nextPointOnContour=c,c.prevPointOnContour=l,c=void 0):(u=o[I+1],l.nextPointOnContour=u,u.prevPointOnContour=l);if(!e.inhibitGridFit){if(Xe.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var h=0;h<s;h++)console.log(h,o[h].x,o[h].y)}if(o.push(new Ql(0,0),new Ql(Math.round(t.advanceWidth*n),0)),lI(e),o.length-=2,Xe.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var C=0;C<s;C++)console.log(C,o[C].x,o[C].y)}}};lI=function(t){var e=t.prog;if(e){var n=e.length,i;for(t.ip=0;t.ip<n;t.ip++){if(Xe.DEBUG&&t.step++,i=jX[e[t.ip]],!i)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));i(t)}}};function ny(t){for(var e=t.tZone=new Array(t.gZone.length),n=0;n<e.length;n++)e[n]=new Ql(0,0)}function nY(t,e){var n=t.prog,i=t.ip,r=1,s;do if(s=n[++i],s===88)r++;else if(s===89)r--;else if(s===64)i+=n[i+1]+1;else if(s===65)i+=2*n[i+1]+1;else if(s>=176&&s<=183)i+=s-176+1;else if(s>=184&&s<=191)i+=(s-184+1)*2;else if(e&&r===1&&s===27)break;while(r>0);t.ip=i}function QN(t,e){Xe.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function JN(t,e){Xe.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function jN(t,e){Xe.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function qN(t,e){var n=e.stack,i=n.pop(),r=n.pop(),s=e.z2[i],o=e.z1[r];Xe.DEBUG&&console.log("SPVTL["+t+"]",i,r);var a,l;t?(a=s.y-o.y,l=o.x-s.x):(a=o.x-s.x,l=o.y-s.y),e.pv=e.dpv=V0(a,l)}function $N(t,e){var n=e.stack,i=n.pop(),r=n.pop(),s=e.z2[i],o=e.z1[r];Xe.DEBUG&&console.log("SFVTL["+t+"]",i,r);var a,l;t?(a=s.y-o.y,l=o.x-s.x):(a=o.x-s.x,l=o.y-s.y),e.fv=V0(a,l)}function wIe(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"SPVFS[]",n,i),t.pv=t.dpv=V0(i,n)}function RIe(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"SPVFS[]",n,i),t.fv=V0(i,n)}function xIe(t){var e=t.stack,n=t.pv;Xe.DEBUG&&console.log(t.step,"GPV[]"),e.push(n.x*16384),e.push(n.y*16384)}function ZIe(t){var e=t.stack,n=t.fv;Xe.DEBUG&&console.log(t.step,"GFV[]"),e.push(n.x*16384),e.push(n.y*16384)}function EIe(t){t.fv=t.pv,Xe.DEBUG&&console.log(t.step,"SFVTPV[]")}function WIe(t){var e=t.stack,n=e.pop(),i=e.pop(),r=e.pop(),s=e.pop(),o=e.pop(),a=t.z0,l=t.z1,g=a[n],c=a[i],u=l[r],I=l[s],h=t.z2[o];Xe.DEBUG&&console.log("ISECT[], ",n,i,r,s,o);var C=g.x,b=g.y,m=c.x,f=c.y,p=u.x,v=u.y,B=I.x,G=I.y,R=(C-m)*(v-G)-(b-f)*(p-B),w=C*f-b*m,E=p*G-v*B;h.x=(w*(p-B)-E*(C-m))/R,h.y=(w*(v-G)-E*(b-f))/R}function NIe(t){t.rp0=t.stack.pop(),Xe.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function MIe(t){t.rp1=t.stack.pop(),Xe.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function TIe(t){t.rp2=t.stack.pop(),Xe.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function FIe(t){var e=t.stack.pop();switch(Xe.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||ny(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function VIe(t){var e=t.stack.pop();switch(Xe.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||ny(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function LIe(t){var e=t.stack.pop();switch(Xe.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||ny(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function kIe(t){var e=t.stack.pop();switch(Xe.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||ny(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function HIe(t){t.loop=t.stack.pop(),Xe.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function _Ie(t){Xe.DEBUG&&console.log(t.step,"RTG[]"),t.round=eY}function XIe(t){Xe.DEBUG&&console.log(t.step,"RTHG[]"),t.round=yIe}function YIe(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function KIe(t){Xe.DEBUG&&console.log(t.step,"ELSE[]"),nY(t,!1)}function zIe(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function UIe(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function DIe(t){var e=t.stack;Xe.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function RB(t){Xe.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function PIe(t){Xe.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function OIe(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"SWAP[]"),e.push(n),e.push(i)}function QIe(t){var e=t.stack;Xe.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function JIe(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"LOOPCALL[]",n,i);var r=t.ip,s=t.prog;t.prog=t.funcs[n];for(var o=0;o<i;o++)lI(t),Xe.DEBUG&&console.log(++t.step,o+1<i?"next loopcall":"done loopcall",o);t.ip=r,t.prog=s}function jIe(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"CALL[]",e);var n=t.ip,i=t.prog;t.prog=t.funcs[e],lI(t),t.ip=n,t.prog=i,Xe.DEBUG&&console.log(++t.step,"returning from",e)}function qIe(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"CINDEX[]",n),e.push(e[e.length-n])}function $Ie(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"MINDEX[]",n),e.push(e.splice(e.length-n,1)[0])}function ede(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,n=t.prog,i=t.ip,r=e.pop(),s=i;for(Xe.DEBUG&&console.log(t.step,"FDEF[]",r);n[++i]!==45;);t.ip=i,t.funcs[r]=n.slice(s+1,i)}function eM(t,e){var n=e.stack.pop(),i=e.z0[n],r=e.fv,s=e.pv;Xe.DEBUG&&console.log(e.step,"MDAP["+t+"]",n);var o=s.distance(i,jf);t&&(o=e.round(o)),r.setRelative(i,jf,o,s),r.touch(i),e.rp0=e.rp1=n}function tM(t,e){var n=e.z2,i=n.length-2,r,s,o;Xe.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var a=0;a<i;a++)r=n[a],!t.touched(r)&&(s=r.prevTouched(t),s!==r&&(o=r.nextTouched(t),s===o&&t.setRelative(r,r,t.distance(s,s,!1,!0),t,!0),t.interpolate(r,s,o,t)))}function nM(t,e){for(var n=e.stack,i=t?e.rp1:e.rp2,r=(t?e.z0:e.z1)[i],s=e.fv,o=e.pv,a=e.loop,l=e.z2;a--;){var g=n.pop(),c=l[g],u=o.distance(r,r,!1,!0);s.setRelative(c,c,u,o),s.touch(c),Xe.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-a)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",g)}e.loop=1}function iM(t,e){var n=e.stack,i=t?e.rp1:e.rp2,r=(t?e.z0:e.z1)[i],s=e.fv,o=e.pv,a=n.pop(),l=e.z2[e.contours[a]],g=l;Xe.DEBUG&&console.log(e.step,"SHC["+t+"]",a);var c=o.distance(r,r,!1,!0);do g!==r&&s.setRelative(g,g,c,o),g=g.nextPointOnContour;while(g!==l)}function rM(t,e){var n=e.stack,i=t?e.rp1:e.rp2,r=(t?e.z0:e.z1)[i],s=e.fv,o=e.pv,a=n.pop();Xe.DEBUG&&console.log(e.step,"SHZ["+t+"]",a);var l;switch(a){case 0:l=e.tZone;break;case 1:l=e.gZone;break;default:throw new Error("Invalid zone")}for(var g,c=o.distance(r,r,!1,!0),u=l.length-2,I=0;I<u;I++)g=l[I],s.setRelative(g,g,c,o)}function tde(t){for(var e=t.stack,n=t.loop,i=t.fv,r=e.pop()/64,s=t.z2;n--;){var o=e.pop(),a=s[o];Xe.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-n)+": ":"")+"SHPIX[]",o,r),i.setRelative(a,a,r),i.touch(a)}t.loop=1}function nde(t){for(var e=t.stack,n=t.rp1,i=t.rp2,r=t.loop,s=t.z0[n],o=t.z1[i],a=t.fv,l=t.dpv,g=t.z2;r--;){var c=e.pop(),u=g[c];Xe.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"IP[]",c,n,"<->",i),a.interpolate(u,s,o,l),a.touch(u)}t.loop=1}function sM(t,e){var n=e.stack,i=n.pop()/64,r=n.pop(),s=e.z1[r],o=e.z0[e.rp0],a=e.fv,l=e.pv;a.setRelative(s,o,i,l),a.touch(s),Xe.DEBUG&&console.log(e.step,"MSIRP["+t+"]",i,r),e.rp1=e.rp0,e.rp2=r,t&&(e.rp0=r)}function ide(t){for(var e=t.stack,n=t.rp0,i=t.z0[n],r=t.loop,s=t.fv,o=t.pv,a=t.z1;r--;){var l=e.pop(),g=a[l];Xe.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"ALIGNRP[]",l),s.setRelative(g,i,0,o),s.touch(g)}t.loop=1}function rde(t){Xe.DEBUG&&console.log(t.step,"RTDG[]"),t.round=vIe}function oM(t,e){var n=e.stack,i=n.pop(),r=n.pop(),s=e.z0[r],o=e.fv,a=e.pv,l=e.cvt[i];Xe.DEBUG&&console.log(e.step,"MIAP["+t+"]",i,"(",l,")",r);var g=a.distance(s,jf);t&&(Math.abs(g-l)<e.cvCutIn&&(g=l),g=e.round(g)),o.setRelative(s,jf,g,a),e.zp0===0&&(s.xo=s.x,s.yo=s.y),o.touch(s),e.rp0=e.rp1=r}function sde(t){var e=t.prog,n=t.ip,i=t.stack,r=e[++n];Xe.DEBUG&&console.log(t.step,"NPUSHB[]",r);for(var s=0;s<r;s++)i.push(e[++n]);t.ip=n}function ode(t){var e=t.ip,n=t.prog,i=t.stack,r=n[++e];Xe.DEBUG&&console.log(t.step,"NPUSHW[]",r);for(var s=0;s<r;s++){var o=n[++e]<<8|n[++e];o&32768&&(o=-((o^65535)+1)),i.push(o)}t.ip=e}function ade(t){var e=t.stack,n=t.store;n||(n=t.store=[]);var i=e.pop(),r=e.pop();Xe.DEBUG&&console.log(t.step,"WS",i,r),n[r]=i}function lde(t){var e=t.stack,n=t.store,i=e.pop();Xe.DEBUG&&console.log(t.step,"RS",i);var r=n&&n[i]||0;e.push(r)}function gde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"WCVTP",n,i),t.cvt[i]=n/64}function cde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"RCVT",n),e.push(t.cvt[n]*64)}function aM(t,e){var n=e.stack,i=n.pop(),r=e.z2[i];Xe.DEBUG&&console.log(e.step,"GC["+t+"]",i),n.push(e.dpv.distance(r,jf,t,!1)*64)}function lM(t,e){var n=e.stack,i=n.pop(),r=n.pop(),s=e.z1[i],o=e.z0[r],a=e.dpv.distance(o,s,t,t);Xe.DEBUG&&console.log(e.step,"MD["+t+"]",i,r,"->",a),e.stack.push(Math.round(a*64))}function ude(t){Xe.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function Ide(t){Xe.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function dde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"LT[]",n,i),e.push(i<n?1:0)}function Ade(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"LTEQ[]",n,i),e.push(i<=n?1:0)}function hde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"GT[]",n,i),e.push(i>n?1:0)}function Cde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"GTEQ[]",n,i),e.push(i>=n?1:0)}function fde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"EQ[]",n,i),e.push(n===i?1:0)}function pde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"NEQ[]",n,i),e.push(n!==i?1:0)}function mde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"ODD[]",n),e.push(Math.trunc(n)%2?1:0)}function bde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"EVEN[]",n),e.push(Math.trunc(n)%2?0:1)}function vde(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"IF[]",e),e||(nY(t,!0),Xe.DEBUG&&console.log(t.step,"EIF[]"))}function yde(t){Xe.DEBUG&&console.log(t.step,"EIF[]")}function Bde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"AND[]",n,i),e.push(n&&i?1:0)}function Gde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"OR[]",n,i),e.push(n||i?1:0)}function Sde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"NOT[]",n),e.push(n?0:1)}function xB(t,e){var n=e.stack,i=n.pop(),r=e.fv,s=e.pv,o=e.ppem,a=e.deltaBase+(t-1)*16,l=e.deltaShift,g=e.z0;Xe.DEBUG&&console.log(e.step,"DELTAP["+t+"]",i,n);for(var c=0;c<i;c++){var u=n.pop(),I=n.pop(),h=a+((I&240)>>4);if(h===o){var C=(I&15)-8;C>=0&&C++,Xe.DEBUG&&console.log(e.step,"DELTAPFIX",u,"by",C*l);var b=g[u];r.setRelative(b,b,C*l,s)}}}function wde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"SDB[]",n),t.deltaBase=n}function Rde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"SDS[]",n),t.deltaShift=Math.pow(.5,n)}function xde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"ADD[]",n,i),e.push(i+n)}function Zde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"SUB[]",n,i),e.push(i-n)}function Ede(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"DIV[]",n,i),e.push(i*64/n)}function Wde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"MUL[]",n,i),e.push(i*n/64)}function Nde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"ABS[]",n),e.push(Math.abs(n))}function Mde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"NEG[]",n),e.push(-n)}function Tde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"FLOOR[]",n),e.push(Math.floor(n/64)*64)}function Fde(t){var e=t.stack,n=e.pop();Xe.DEBUG&&console.log(t.step,"CEILING[]",n),e.push(Math.ceil(n/64)*64)}function d2(t,e){var n=e.stack,i=n.pop();Xe.DEBUG&&console.log(e.step,"ROUND[]"),n.push(e.round(i/64)*64)}function Vde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"WCVTF[]",n,i),t.cvt[i]=n*t.ppem/t.font.unitsPerEm}function ZB(t,e){var n=e.stack,i=n.pop(),r=e.ppem,s=e.deltaBase+(t-1)*16,o=e.deltaShift;Xe.DEBUG&&console.log(e.step,"DELTAC["+t+"]",i,n);for(var a=0;a<i;a++){var l=n.pop(),g=n.pop(),c=s+((g&240)>>4);if(c===r){var u=(g&15)-8;u>=0&&u++;var I=u*o;Xe.DEBUG&&console.log(e.step,"DELTACFIX",l,"by",I),e.cvt[l]+=I}}}function Lde(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=tY;var n;switch(e&192){case 0:n=.5;break;case 64:n=1;break;case 128:n=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=n,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*n;break;case 32:t.srPhase=.5*n;break;case 48:t.srPhase=.75*n;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*n}function kde(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=tY;var n;switch(e&192){case 0:n=Math.sqrt(2)/2;break;case 64:n=Math.sqrt(2);break;case 128:n=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=n,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*n;break;case 32:t.srPhase=.5*n;break;case 48:t.srPhase=.75*n;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*n}function Hde(t){Xe.DEBUG&&console.log(t.step,"ROFF[]"),t.round=bIe}function _de(t){Xe.DEBUG&&console.log(t.step,"RUTG[]"),t.round=BIe}function Xde(t){Xe.DEBUG&&console.log(t.step,"RDTG[]"),t.round=GIe}function Yde(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function gM(t,e){var n=e.stack,i=n.pop(),r=n.pop(),s=e.z2[i],o=e.z1[r];Xe.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",i,r);var a,l;t?(a=s.y-o.y,l=o.x-s.x):(a=o.x-s.x,l=o.y-s.y),e.dpv=V0(a,l)}function Kde(t){var e=t.stack,n=e.pop(),i=0;Xe.DEBUG&&console.log(t.step,"GETINFO[]",n),n&1&&(i=35),n&32&&(i|=4096),e.push(i)}function zde(t){var e=t.stack,n=e.pop(),i=e.pop(),r=e.pop();Xe.DEBUG&&console.log(t.step,"ROLL[]"),e.push(i),e.push(n),e.push(r)}function Ude(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"MAX[]",n,i),e.push(Math.max(i,n))}function Dde(t){var e=t.stack,n=e.pop(),i=e.pop();Xe.DEBUG&&console.log(t.step,"MIN[]",n,i),e.push(Math.min(i,n))}function Pde(t){var e=t.stack.pop();Xe.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Ode(t){var e=t.stack.pop(),n=t.stack.pop();switch(Xe.DEBUG&&console.log(t.step,"INSTCTRL[]",e,n),e){case 1:t.inhibitGridFit=!!n;return;case 2:t.ignoreCvt=!!n;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Wg(t,e){var n=e.stack,i=e.prog,r=e.ip;Xe.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var s=0;s<t;s++)n.push(i[++r]);e.ip=r}function Ng(t,e){var n=e.ip,i=e.prog,r=e.stack;Xe.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var s=0;s<t;s++){var o=i[++n]<<8|i[++n];o&32768&&(o=-((o^65535)+1)),r.push(o)}e.ip=n}function ct(t,e,n,i,r,s){var o=s.stack,a=t&&o.pop(),l=o.pop(),g=s.rp0,c=s.z0[g],u=s.z1[l],I=s.minDis,h=s.fv,C=s.dpv,b,m,f,p;m=b=C.distance(u,c,!0,!0),f=m>=0?1:-1,m=Math.abs(m),t&&(p=s.cvt[a],i&&Math.abs(m-p)<s.cvCutIn&&(m=p)),n&&m<I&&(m=I),i&&(m=s.round(m)),h.setRelative(u,c,f*m,C),h.touch(u),Xe.DEBUG&&console.log(s.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(n?">":"_")+(i?"R":"_")+(r===0?"Gr":r===1?"Bl":r===2?"Wh":"")+"]",t?a+"("+s.cvt[a]+","+p+")":"",l,"(d =",b,"->",f*m,")"),s.rp1=s.rp0,s.rp2=l,e&&(s.rp0=l)}jX=[QN.bind(void 0,Ul),QN.bind(void 0,Pa),JN.bind(void 0,Ul),JN.bind(void 0,Pa),jN.bind(void 0,Ul),jN.bind(void 0,Pa),qN.bind(void 0,0),qN.bind(void 0,1),$N.bind(void 0,0),$N.bind(void 0,1),wIe,RIe,xIe,ZIe,EIe,WIe,NIe,MIe,TIe,FIe,VIe,LIe,kIe,HIe,_Ie,XIe,YIe,KIe,zIe,UIe,void 0,void 0,DIe,RB,PIe,OIe,QIe,qIe,$Ie,void 0,void 0,void 0,JIe,jIe,ede,void 0,eM.bind(void 0,0),eM.bind(void 0,1),tM.bind(void 0,Ul),tM.bind(void 0,Pa),nM.bind(void 0,0),nM.bind(void 0,1),iM.bind(void 0,0),iM.bind(void 0,1),rM.bind(void 0,0),rM.bind(void 0,1),tde,nde,sM.bind(void 0,0),sM.bind(void 0,1),ide,rde,oM.bind(void 0,0),oM.bind(void 0,1),sde,ode,ade,lde,gde,cde,aM.bind(void 0,0),aM.bind(void 0,1),void 0,lM.bind(void 0,0),lM.bind(void 0,1),ude,void 0,Ide,void 0,void 0,dde,Ade,hde,Cde,fde,pde,mde,bde,vde,yde,Bde,Gde,Sde,xB.bind(void 0,1),wde,Rde,xde,Zde,Ede,Wde,Nde,Mde,Tde,Fde,d2.bind(void 0,0),d2.bind(void 0,1),d2.bind(void 0,2),d2.bind(void 0,3),void 0,void 0,void 0,void 0,Vde,xB.bind(void 0,2),xB.bind(void 0,3),ZB.bind(void 0,1),ZB.bind(void 0,2),ZB.bind(void 0,3),Lde,kde,void 0,void 0,Hde,void 0,_de,Xde,RB,RB,void 0,void 0,void 0,void 0,void 0,Yde,gM.bind(void 0,0),gM.bind(void 0,1),Kde,void 0,zde,Ude,Dde,Pde,Ode,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Wg.bind(void 0,1),Wg.bind(void 0,2),Wg.bind(void 0,3),Wg.bind(void 0,4),Wg.bind(void 0,5),Wg.bind(void 0,6),Wg.bind(void 0,7),Wg.bind(void 0,8),Ng.bind(void 0,1),Ng.bind(void 0,2),Ng.bind(void 0,3),Ng.bind(void 0,4),Ng.bind(void 0,5),Ng.bind(void 0,6),Ng.bind(void 0,7),Ng.bind(void 0,8),ct.bind(void 0,0,0,0,0,0),ct.bind(void 0,0,0,0,0,1),ct.bind(void 0,0,0,0,0,2),ct.bind(void 0,0,0,0,0,3),ct.bind(void 0,0,0,0,1,0),ct.bind(void 0,0,0,0,1,1),ct.bind(void 0,0,0,0,1,2),ct.bind(void 0,0,0,0,1,3),ct.bind(void 0,0,0,1,0,0),ct.bind(void 0,0,0,1,0,1),ct.bind(void 0,0,0,1,0,2),ct.bind(void 0,0,0,1,0,3),ct.bind(void 0,0,0,1,1,0),ct.bind(void 0,0,0,1,1,1),ct.bind(void 0,0,0,1,1,2),ct.bind(void 0,0,0,1,1,3),ct.bind(void 0,0,1,0,0,0),ct.bind(void 0,0,1,0,0,1),ct.bind(void 0,0,1,0,0,2),ct.bind(void 0,0,1,0,0,3),ct.bind(void 0,0,1,0,1,0),ct.bind(void 0,0,1,0,1,1),ct.bind(void 0,0,1,0,1,2),ct.bind(void 0,0,1,0,1,3),ct.bind(void 0,0,1,1,0,0),ct.bind(void 0,0,1,1,0,1),ct.bind(void 0,0,1,1,0,2),ct.bind(void 0,0,1,1,0,3),ct.bind(void 0,0,1,1,1,0),ct.bind(void 0,0,1,1,1,1),ct.bind(void 0,0,1,1,1,2),ct.bind(void 0,0,1,1,1,3),ct.bind(void 0,1,0,0,0,0),ct.bind(void 0,1,0,0,0,1),ct.bind(void 0,1,0,0,0,2),ct.bind(void 0,1,0,0,0,3),ct.bind(void 0,1,0,0,1,0),ct.bind(void 0,1,0,0,1,1),ct.bind(void 0,1,0,0,1,2),ct.bind(void 0,1,0,0,1,3),ct.bind(void 0,1,0,1,0,0),ct.bind(void 0,1,0,1,0,1),ct.bind(void 0,1,0,1,0,2),ct.bind(void 0,1,0,1,0,3),ct.bind(void 0,1,0,1,1,0),ct.bind(void 0,1,0,1,1,1),ct.bind(void 0,1,0,1,1,2),ct.bind(void 0,1,0,1,1,3),ct.bind(void 0,1,1,0,0,0),ct.bind(void 0,1,1,0,0,1),ct.bind(void 0,1,1,0,0,2),ct.bind(void 0,1,1,0,0,3),ct.bind(void 0,1,1,0,1,0),ct.bind(void 0,1,1,0,1,1),ct.bind(void 0,1,1,0,1,2),ct.bind(void 0,1,1,0,1,3),ct.bind(void 0,1,1,1,0,0),ct.bind(void 0,1,1,1,0,1),ct.bind(void 0,1,1,1,0,2),ct.bind(void 0,1,1,1,0,3),ct.bind(void 0,1,1,1,1,0),ct.bind(void 0,1,1,1,1,1),ct.bind(void 0,1,1,1,1,2),ct.bind(void 0,1,1,1,1,3)];function OA(t){this.char=t,this.state={},this.activeState=null}function Jx(t,e,n){this.contextName=n,this.startIndex=t,this.endOffset=e}function Qde(t,e,n){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=n}function pa(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function iy(t){this.eventId=t,this.subscribers=[]}function Jde(t){var e=this,n=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];n.forEach(function(r){Object.defineProperty(e.events,r,{value:new iy(r)})}),t&&n.forEach(function(r){var s=t[r];typeof s=="function"&&e.events[r].subscribe(s)});var i=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];i.forEach(function(r){e.events[r].subscribe(e.updateContextsRanges)})}function bi(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Jde.call(this,t)}OA.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};OA.prototype.getState=function(t){return this.state[t]||null};bi.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};bi.prototype.composeRUD=function(t){var e=this,n=!0,i=t.map(function(s){return e[s[0]].apply(e,s.slice(1).concat(n))}),r=function(s){return typeof s=="object"&&s.hasOwnProperty("FAIL")};if(i.every(r))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:i.filter(r)};this.dispatch("composeRUD",[i.filter(function(s){return!r(s)})])};bi.prototype.replaceRange=function(t,e,n,i){e=e!==null?e:this.tokens.length;var r=n.every(function(o){return o instanceof OA});if(!isNaN(t)&&this.inboundIndex(t)&&r){var s=this.tokens.splice.apply(this.tokens,[t,e].concat(n));return i||this.dispatch("replaceToken",[t,e,n]),[s,n]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};bi.prototype.replaceToken=function(t,e,n){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof OA){var i=this.tokens.splice(t,1,e);return n||this.dispatch("replaceToken",[t,e]),[i[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};bi.prototype.removeRange=function(t,e,n){e=isNaN(e)?this.tokens.length:e;var i=this.tokens.splice(t,e);return n||this.dispatch("removeRange",[i,t,e]),i};bi.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var n=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[n,t]),n}else return{FAIL:"removeToken: invalid token index."}};bi.prototype.insertToken=function(t,e,n){var i=t.every(function(r){return r instanceof OA});return i?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),n||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};bi.prototype.registerModifier=function(t,e,n){this.events.newToken.subscribe(function(i,r){var s=[i,r],o=e===null||e.apply(this,s)===!0,a=[i,r];if(o){var l=n.apply(this,a);i.setState(t,l)}}),this.registeredModifiers.push(t)};iy.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};iy.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};pa.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};pa.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};bi.prototype.rangeToText=function(t){if(t instanceof Jx)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};bi.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};bi.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};bi.prototype.on=function(t,e){var n=this.events[t];return n?n.subscribe(e):null};bi.prototype.dispatch=function(t,e){var n=this,i=this.events[t];i instanceof iy&&i.subscribers.forEach(function(r){r.apply(n,e||[])})};bi.prototype.registerContextChecker=function(t,e,n){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof n!="function")return{FAIL:"missing context end check."};var i=new Qde(t,e,n);return this.registeredContexts[t]=i,this.contextCheckers.push(i),i};bi.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};bi.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};bi.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];n.ranges=[]}};bi.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(i){return i.char}),e=0;e<t.length;e++){var n=new pa(t,e);this.runContextCheck(n)}this.dispatch("updateContextsRanges",[this.registeredContexts])};bi.prototype.setEndOffset=function(t,e){var n=this.getContext(e).openRange.startIndex,i=new Jx(n,t,e),r=this.getContext(e).ranges;return i.rangeId=e+"."+r.length,r.push(i),this.getContext(e).openRange=null,i};bi.prototype.runContextCheck=function(t){var e=this,n=t.index;this.contextCheckers.forEach(function(i){var r=i.contextName,s=e.getContext(r).openRange;if(!s&&i.checkStart(t)&&(s=new Jx(n,null,r),e.getContext(r).openRange=s,e.dispatch("contextStart",[r,n])),s&&i.checkEnd(t)){var o=n-s.startIndex+1,a=e.setEndOffset(o,r);e.dispatch("contextEnd",[r,a])}})};bi.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var n=0;n<e.length;n++){var i=e[n],r=new pa(e,n);this.dispatch("next",[r]),this.runContextCheck(r);var s=new OA(i);this.tokens.push(s),this.dispatch("newToken",[s,r])}return this.dispatch("end",[this.tokens]),this.tokens};function lc(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function iY(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function pc(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function r3(t){return/[A-z]/.test(t)}function jde(t){return/\s/.test(t)}function go(t){this.font=t,this.features={}}function Bu(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function L0(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var n=e.ranges,i=0;i<n.length;i++){var r=n[i];if(t>=r.start&&t<=r.end){var s=t-r.start;return r.index+s}}break;default:return-1}return-1}function qde(t,e){var n=L0(t,e.coverage);return n===-1?null:t+e.deltaGlyphId}function $de(t,e){var n=L0(t,e.coverage);return n===-1?null:e.substitute[n]}function EB(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i],s=e.current;s=Array.isArray(s)?s[0]:s;var o=L0(s,r);o!==-1&&n.push(o)}return n.length!==t.length?-1:n}function eAe(t,e){var n=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<n)return[];var i=EB(e.inputCoverage,t);if(i===-1)return[];var r=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var s=t.lookahead.slice(r);s.length&&pc(s[0].char);)s.shift();var o=new pa(s,0),a=EB(e.lookaheadCoverage,o),l=[].concat(t.backtrack);for(l.reverse();l.length&&pc(l[0].char);)l.shift();if(l.length<e.backtrackCoverage.length)return[];var g=new pa(l,0),c=EB(e.backtrackCoverage,g),u=i.length===e.inputCoverage.length&&a.length===e.lookaheadCoverage.length&&c.length===e.backtrackCoverage.length,I=[];if(u)for(var h=0;h<e.lookupRecords.length;h++)for(var C=e.lookupRecords[h],b=C.lookupListIndex,m=this.getLookupByIndex(b),f=0;f<m.subtables.length;f++){var p=m.subtables[f],v=this.getLookupMethod(m,p),B=this.getSubstitutionType(m,p);if(B==="12")for(var G=0;G<i.length;G++){var R=t.get(G),w=v(R);w&&I.push(w)}}return I}function tAe(t,e){var n=t.current,i=L0(n,e.coverage);if(i===-1)return null;for(var r,s=e.ligatureSets[i],o=0;o<s.length;o++){r=s[o];for(var a=0;a<r.components.length;a++){var l=t.lookahead[a],g=r.components[a];if(l!==g)break;if(a===r.components.length-1)return r}}return null}function nAe(t,e){var n=L0(t,e.coverage);return n===-1?null:e.sequences[n]}go.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var n=t[e];if(n.tag==="DFLT")return n.script.defaultLangSys.featureIndexes}return[]};go.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var n=this.font.tables.gsub.scripts,i=0;i<n.length;i++){var r=n[i];if(r.tag===t&&r.script.defaultLangSys)return r.script.defaultLangSys.featureIndexes;var s=r.langSysRecords;if(s)for(var o=0;o<s.length;o++){var a=s[o];if(a.tag===t){var l=a.langSys;return l.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};go.prototype.mapTagsToFeatures=function(t,e){for(var n={},i=0;i<t.length;i++){var r=t[i].tag,s=t[i].feature;n[r]=s}this.features[e].tags=n};go.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var n=this.getScriptFeaturesIndexes(t);if(!n)return null;var i=this.font.tables.gsub;return e=n.map(function(r){return i.features[r]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};go.prototype.getSubstitutionType=function(t,e){var n=t.lookupType.toString(),i=e.substFormat.toString();return n+i};go.prototype.getLookupMethod=function(t,e){var n=this,i=this.getSubstitutionType(t,e);switch(i){case"11":return function(r){return qde.apply(n,[r,e])};case"12":return function(r){return $de.apply(n,[r,e])};case"63":return function(r){return eAe.apply(n,[r,e])};case"41":return function(r){return tAe.apply(n,[r,e])};case"21":return function(r){return nAe.apply(n,[r,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};go.prototype.lookupFeature=function(t){var e=t.contextParams,n=e.index,i=this.getFeature({tag:t.tag,script:t.script});if(!i)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var r=this.getFeatureLookups(i),s=[].concat(e.context),o=0;o<r.length;o++)for(var a=r[o],l=this.getLookupSubtables(a),g=0;g<l.length;g++){var c=l[g],u=this.getSubstitutionType(a,c),I=this.getLookupMethod(a,c),h=void 0;switch(u){case"11":h=I(e.current),h&&s.splice(n,1,new Bu({id:11,tag:t.tag,substitution:h}));break;case"12":h=I(e.current),h&&s.splice(n,1,new Bu({id:12,tag:t.tag,substitution:h}));break;case"63":h=I(e),Array.isArray(h)&&h.length&&s.splice(n,1,new Bu({id:63,tag:t.tag,substitution:h}));break;case"41":h=I(e),h&&s.splice(n,1,new Bu({id:41,tag:t.tag,substitution:h}));break;case"21":h=I(e.current),h&&s.splice(n,1,new Bu({id:21,tag:t.tag,substitution:h}));break}e=new pa(s,n),!(Array.isArray(h)&&!h.length)&&(h=null)}return s.length?s:null};go.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var n=this.features[t.script].some(function(i){return i.tag===t.tag});return e&&n};go.prototype.getLookupSubtables=function(t){return t.subtables||null};go.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};go.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};go.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var n=this.features[e.script];return n?n.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function iAe(t){var e=t.current,n=t.get(-1);return n===null&&lc(e)||!lc(n)&&lc(e)}function rAe(t){var e=t.get(1);return e===null||!lc(e)}var sAe={startCheck:iAe,endCheck:rAe};function oAe(t){var e=t.current,n=t.get(-1);return(lc(e)||pc(e))&&!lc(n)}function aAe(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!lc(e)&&!pc(e)):var n=jde(e);if(!n)return!0;if(n){var i=!1;if(i=t.lookahead.some(function(r){return lc(r)||pc(r)}),!i)return!0}break;default:return!1}}var lAe={startCheck:oAe,endCheck:aAe};function gAe(t,e,n){e[n].setState(t.tag,t.substitution)}function cAe(t,e,n){e[n].setState(t.tag,t.substitution)}function uAe(t,e,n){t.substitution.forEach(function(i,r){var s=e[n+r];s.setState(t.tag,i)})}function IAe(t,e,n){var i=e[n];i.setState(t.tag,t.substitution.ligGlyph);for(var r=t.substitution.components.length,s=0;s<r;s++)i=e[n+s+1],i.setState("deleted",!0)}var cM={11:gAe,12:cAe,63:uAe,41:IAe};function jx(t,e,n){t instanceof Bu&&cM[t.id]&&cM[t.id](t,e,n)}function dAe(t){for(var e=[].concat(t.backtrack),n=e.length-1;n>=0;n--){var i=e[n],r=iY(i),s=pc(i);if(!r&&!s)return!0;if(r)return!1}return!1}function AAe(t){if(iY(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var n=t.lookahead[e],i=pc(n);if(!i)return!0}return!1}function hAe(t){var e=this,n="arab",i=this.featuresTags[n],r=this.tokenizer.getRangeTokens(t);if(r.length!==1){var s=new pa(r.map(function(a){return a.getState("glyphIndex")}),0),o=new pa(r.map(function(a){return a.char}),0);r.forEach(function(a,l){if(!pc(a.char)){s.setCurrentIndex(l),o.setCurrentIndex(l);var g=0;dAe(o)&&(g|=1),AAe(o)&&(g|=2);var c;switch(g){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi";break}if(i.indexOf(c)!==-1){var u=e.query.lookupFeature({tag:c,script:n,contextParams:s});if(u instanceof Error)return console.info(u.message);u.forEach(function(I,h){I instanceof Bu&&(jx(I,r,h),s.context[h]=I.substitution)})}}})}}function uM(t,e){var n=t.map(function(i){return i.activeState.value});return new pa(n,e||0)}function CAe(t){var e=this,n="arab",i=this.tokenizer.getRangeTokens(t),r=uM(i);r.context.forEach(function(s,o){r.setCurrentIndex(o);var a=e.query.lookupFeature({tag:"rlig",script:n,contextParams:r});a.length&&(a.forEach(function(l){return jx(l,i,o)}),r=uM(i))})}function fAe(t){var e=t.current,n=t.get(-1);return n===null&&r3(e)||!r3(n)&&r3(e)}function pAe(t){var e=t.get(1);return e===null||!r3(e)}var mAe={startCheck:fAe,endCheck:pAe};function IM(t,e){var n=t.map(function(i){return i.activeState.value});return new pa(n,e||0)}function bAe(t){var e=this,n="latn",i=this.tokenizer.getRangeTokens(t),r=IM(i);r.context.forEach(function(s,o){r.setCurrentIndex(o);var a=e.query.lookupFeature({tag:"liga",script:n,contextParams:r});a.length&&(a.forEach(function(l){return jx(l,i,o)}),r=IM(i))})}function Sa(t){this.baseDir=t||"ltr",this.tokenizer=new bi,this.featuresTags={}}Sa.prototype.setText=function(t){this.text=t};Sa.prototype.contextChecks={latinWordCheck:mAe,arabicWordCheck:sAe,arabicSentenceCheck:lAe};function WB(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function vAe(){return WB.call(this,"latinWord"),WB.call(this,"arabicWord"),WB.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function yAe(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(n){var i=t.tokenizer.getRangeTokens(n);t.tokenizer.replaceRange(n.startIndex,n.endOffset,i.reverse())})}Sa.prototype.registerFeatures=function(t,e){var n=this,i=e.filter(function(r){return n.query.supports({script:t,tag:r})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(i):this.featuresTags[t]=i};Sa.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new go(t));for(var n=0;n<e.length;n++){var i=e[n];this.query.supports({script:i.script})&&this.registerFeatures(i.script,i.tags)}};Sa.prototype.registerModifier=function(t,e,n){this.tokenizer.registerModifier(t,e,n)};function qx(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function BAe(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){qx.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){hAe.call(t,i)})}}function GAe(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var n=this.featuresTags[e];if(n.indexOf("rlig")!==-1){qx.call(this);var i=this.tokenizer.getContextRanges("arabicWord");i.forEach(function(r){CAe.call(t,r)})}}}function SAe(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var n=this.featuresTags[e];if(n.indexOf("liga")!==-1){qx.call(this);var i=this.tokenizer.getContextRanges("latinWord");i.forEach(function(r){bAe.call(t,r)})}}}Sa.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};Sa.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(BAe.call(this),GAe.call(this)),this.checkContextReady("latinWord")&&SAe.call(this),this.checkContextReady("arabicSentence")&&yAe.call(this)};Sa.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),vAe.call(this),this.applyFeaturesToContexts())};Sa.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};Sa.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],n=0;n<this.tokenizer.tokens.length;n++){var i=this.tokenizer.tokens[n];if(!i.state.deleted){var r=i.activeState.value;e.push(Array.isArray(r)?r[0]:r)}}return e};function Yn(t){t=t||{},t.tables=t.tables||{},t.empty||(jh(t.familyName,"When creating a new Font object, familyName is required."),jh(t.styleName,"When creating a new Font object, styleName is required."),jh(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),jh(t.ascender,"When creating a new Font object, ascender is required."),jh(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new $a.GlyphSet(this,t.glyphs||[]),this.encoding=new TX(this),this.position=new T0(this),this.substitution=new lo(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new $X(this)}})}Yn.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Yn.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Yn.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n};Yn.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(n){return t[n]})}:e})};Yn.prototype.stringToGlyphs=function(t,e){var n=this,i=new Sa,r=function(u){return n.charToGlyphIndex(u.char)};i.registerModifier("glyphIndex",null,r);var s=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;i.applyFeatures(this,s);for(var o=i.getTextGlyphs(t),a=o.length,l=new Array(a),g=this.glyphs.get(0),c=0;c<a;c+=1)l[c]=this.glyphs.get(o[c])||g;return l};Yn.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Yn.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n};Yn.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Yn.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var n=this.position.defaultKerningTables;return n?this.position.getKerningValue(n,t,e):this.kerningPairs[t+","+e]||0};Yn.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Yn.prototype.forEachGlyph=function(t,e,n,i,r,s){e=e!==void 0?e:0,n=n!==void 0?n:0,i=i!==void 0?i:72,r=Object.assign({},this.defaultRenderOptions,r);var o=1/this.unitsPerEm*i,a=this.stringToGlyphs(t,r),l;if(r.kerning){var g=r.script||this.position.getDefaultScriptName();l=this.position.getKerningTables(g,r.language)}for(var c=0;c<a.length;c+=1){var u=a[c];if(s.call(this,u,e,n,i,r),u.advanceWidth&&(e+=u.advanceWidth*o),r.kerning&&c<a.length-1){var I=l?this.position.getKerningValue(l,u.index,a[c+1].index):this.getKerningValue(u,a[c+1]);e+=I*o}r.letterSpacing?e+=r.letterSpacing*i:r.tracking&&(e+=r.tracking/1e3*i)}return e};Yn.prototype.getPath=function(t,e,n,i,r){var s=new Ji;return this.forEachGlyph(t,e,n,i,r,function(o,a,l,g){var c=o.getPath(a,l,g,r,this);s.extend(c)}),s};Yn.prototype.getPaths=function(t,e,n,i,r){var s=[];return this.forEachGlyph(t,e,n,i,r,function(o,a,l,g){var c=o.getPath(a,l,g,r,this);s.push(c)}),s};Yn.prototype.getAdvanceWidth=function(t,e,n){return this.forEachGlyph(t,0,0,e,n,function(){})};Yn.prototype.draw=function(t,e,n,i,r,s){this.getPath(e,n,i,r,s).draw(t)};Yn.prototype.drawPoints=function(t,e,n,i,r,s){this.forEachGlyph(e,n,i,r,s,function(o,a,l,g){o.drawPoints(t,a,l,g)})};Yn.prototype.drawMetrics=function(t,e,n,i,r,s){this.forEachGlyph(e,n,i,r,s,function(o,a,l,g){o.drawMetrics(t,a,l,g)})};Yn.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Yn.prototype.validate=function(){var t=this;function e(i,r){}function n(i){var r=t.getEnglishName(i);r&&r.trim().length>0}n("fontFamily"),n("weightName"),n("manufacturer"),n("copyright"),n("version"),this.unitsPerEm>0};Yn.prototype.toTables=function(){return uIe.fontToTable(this)};Yn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Yn.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),n=new ArrayBuffer(e.length),i=new Uint8Array(n),r=0;r<e.length;r++)i[r]=e[r];return n};Yn.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),n=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+n+".otf";var i=this.toArrayBuffer();if(dIe())if(window.URL=window.URL||window.webkitURL,window.URL){var r=new DataView(i),s=new Blob([r],{type:"font/opentype"}),o=document.createElement("a");o.href=window.URL.createObjectURL(s),o.download=t;var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!1),o.dispatchEvent(a)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=require("fs"),g=AIe(i);l.writeFileSync(t,g)}};Yn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Yn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Yn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var ug=new Array(10);ug[1]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{posFormat:1,coverage:this.parsePointer(Ne.coverage),value:this.parseValueRecord()};if(n===2)return{posFormat:2,coverage:this.parsePointer(Ne.coverage),values:this.parseValueRecordList()};kt.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};ug[2]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();kt.assert(n===1||n===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var i=this.parsePointer(Ne.coverage),r=this.parseUShort(),s=this.parseUShort();if(n===1)return{posFormat:n,coverage:i,valueFormat1:r,valueFormat2:s,pairSets:this.parseList(Ne.pointer(Ne.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(r),value2:this.parseValueRecord(s)}})))};if(n===2){var o=this.parsePointer(Ne.classDef),a=this.parsePointer(Ne.classDef),l=this.parseUShort(),g=this.parseUShort();return{posFormat:n,coverage:i,valueFormat1:r,valueFormat2:s,classDef1:o,classDef2:a,class1Count:l,class2Count:g,classRecords:this.parseList(l,Ne.list(g,function(){return{value1:this.parseValueRecord(r),value2:this.parseValueRecord(s)}}))}}};ug[3]=function(){return{error:"GPOS Lookup 3 not supported"}};ug[4]=function(){return{error:"GPOS Lookup 4 not supported"}};ug[5]=function(){return{error:"GPOS Lookup 5 not supported"}};ug[6]=function(){return{error:"GPOS Lookup 6 not supported"}};ug[7]=function(){return{error:"GPOS Lookup 7 not supported"}};ug[8]=function(){return{error:"GPOS Lookup 8 not supported"}};ug[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);var wAe=Object.defineProperty,RAe=(t,e,n)=>e in t?wAe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Oe=(t,e,n)=>(RAe(t,typeof e!="symbol"?e+"":e,n),n);new et;const rY=class{parse(t,e={decodeSpeed:5,encodeSpeed:5,encoderMethod:rY.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1}){if(t instanceof Lt&&t.isBufferGeometry)throw new Error("DRACOExporter: The first parameter of parse() is now an instance of Mesh or Points.");if(DracoEncoderModule===void 0)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");const n=t.geometry,i=DracoEncoderModule(),r=new i.Encoder;let s,o;if(!n.isBufferGeometry)throw new Error("THREE.DRACOExporter.parse(geometry, options): geometry is not a THREE.BufferGeometry instance.");if(t instanceof pn&&t.isMesh){s=new i.MeshBuilder,o=new i.Mesh;const I=n.getAttribute("position");s.AddFloatAttributeToMesh(o,i.POSITION,I.count,I.itemSize,I.array);const h=n.getIndex();if(h!==null)s.AddFacesToMesh(o,h.count/3,h.array);else{const C=new(I.count>65535?Uint32Array:Uint16Array)(I.count);for(let b=0;b<C.length;b++)C[b]=b;s.AddFacesToMesh(o,I.count,C)}if(e.exportNormals){const C=n.getAttribute("normal");C!==void 0&&s.AddFloatAttributeToMesh(o,i.NORMAL,C.count,C.itemSize,C.array)}if(e.exportUvs){const C=n.getAttribute("uv");C!==void 0&&s.AddFloatAttributeToMesh(o,i.TEX_COORD,C.count,C.itemSize,C.array)}if(e.exportColor){const C=n.getAttribute("color");C!==void 0&&s.AddFloatAttributeToMesh(o,i.COLOR,C.count,C.itemSize,C.array)}}else if(t instanceof fx&&t.isPoints){s=new i.PointCloudBuilder,o=new i.PointCloud;const I=n.getAttribute("position");if(s.AddFloatAttribute(o,i.POSITION,I.count,I.itemSize,I.array),e.exportColor){const h=n.getAttribute("color");h!==void 0&&s.AddFloatAttribute(o,i.COLOR,h.count,h.itemSize,h.array)}}else throw new Error("DRACOExporter: Unsupported object type.");const a=new i.DracoInt8Array,l=e.encodeSpeed!==void 0?e.encodeSpeed:5,g=e.decodeSpeed!==void 0?e.decodeSpeed:5;if(r.SetSpeedOptions(l,g),e.encoderMethod!==void 0&&r.SetEncodingMethod(e.encoderMethod),e.quantization!==void 0)for(let I=0;I<5;I++)e.quantization[I]!==void 0&&r.SetAttributeQuantization(I,e.quantization[I]);let c;if(t instanceof pn&&t.isMesh?c=r.EncodeMeshToDracoBuffer(o,a):c=r.EncodePointCloudToDracoBuffer(o,!0,a),i.destroy(o),c===0)throw new Error("THREE.DRACOExporter: Draco encoding failed.");const u=new Int8Array(new ArrayBuffer(c));for(let I=0;I<c;I++)u[I]=a.GetValue(I);return i.destroy(a),i.destroy(r),i.destroy(s),u}};let al=rY;Oe(al,"MESH_EDGEBREAKER_ENCODING",1);Oe(al,"MESH_SEQUENTIAL_ENCODING",0);Oe(al,"POINT_CLOUD",0);Oe(al,"TRIANGULAR_MESH",1);Oe(al,"INVALID",-1);Oe(al,"POSITION",0);Oe(al,"NORMAL",1);Oe(al,"COLOR",2);Oe(al,"TEX_COORD",3);Oe(al,"GENERIC",4);const sY=class extends pn{constructor(t,e={}){super(t),this.isReflector=!0,this.type="Reflector",this.camera=new Zn;const n=this,i=e.color!==void 0?new et(e.color):new et(8355711),r=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||sY.ReflectorShader,l=e.multisample!==void 0?e.multisample:4,g=new Ds,c=new P,u=new P,I=new P,h=new dt,C=new P(0,0,-1),b=new en,m=new P,f=new P,p=new en,v=new dt,B=this.camera,G=new En(r,s,{samples:l,type:Ri}),R=new an({uniforms:Pn.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});R.uniforms.tDiffuse.value=G.texture,R.uniforms.color.value=i,R.uniforms.textureMatrix.value=v,this.material=R,this.onBeforeRender=function(w,E,x){if(u.setFromMatrixPosition(n.matrixWorld),I.setFromMatrixPosition(x.matrixWorld),h.extractRotation(n.matrixWorld),c.set(0,0,1),c.applyMatrix4(h),m.subVectors(u,I),m.dot(c)>0)return;m.reflect(c).negate(),m.add(u),h.extractRotation(x.matrixWorld),C.set(0,0,-1),C.applyMatrix4(h),C.add(I),f.subVectors(u,C),f.reflect(c).negate(),f.add(u),B.position.copy(m),B.up.set(0,1,0),B.up.applyMatrix4(h),B.up.reflect(c),B.lookAt(f),B.far=x.far,B.updateMatrixWorld(),B.projectionMatrix.copy(x.projectionMatrix),v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(B.projectionMatrix),v.multiply(B.matrixWorldInverse),v.multiply(n.matrixWorld),g.setFromNormalAndCoplanarPoint(c,u),g.applyMatrix4(B.matrixWorldInverse),b.set(g.normal.x,g.normal.y,g.normal.z,g.constant);const W=B.projectionMatrix;p.x=(Math.sign(b.x)+W.elements[8])/W.elements[0],p.y=(Math.sign(b.y)+W.elements[9])/W.elements[5],p.z=-1,p.w=(1+W.elements[10])/W.elements[14],b.multiplyScalar(2/b.dot(p)),W.elements[2]=b.x,W.elements[6]=b.y,W.elements[10]=b.z+1-o,W.elements[14]=b.w,n.visible=!1;const T=w.getRenderTarget(),k=w.xr.enabled,_=w.shadowMap.autoUpdate,U=w.toneMapping;let O=!1;"outputColorSpace"in w?O=w.outputColorSpace==="srgb":O=w.outputEncoding===3001,w.xr.enabled=!1,w.shadowMap.autoUpdate=!1,"outputColorSpace"in w?w.outputColorSpace="linear-srgb":w.outputEncoding=3e3,w.toneMapping=Wo,w.setRenderTarget(G),w.state.buffers.depth.setMask(!0),w.autoClear===!1&&w.clear(),w.render(E,B),w.xr.enabled=k,w.shadowMap.autoUpdate=_,w.toneMapping=U,"outputColorSpace"in w?w.outputColorSpace=O?"srgb":"srgb-linear":w.outputEncoding=O?3001:3e3,w.setRenderTarget(T);const Y=x.viewport;Y!==void 0&&w.state.viewport(Y),n.visible=!0},this.getRenderTarget=function(){return G},this.dispose=function(){G.dispose(),n.material.dispose()}}};let GS=sY;Oe(GS,"ReflectorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${parseInt(gg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

		}`});const oY=class extends pn{constructor(t,e={}){super(t),this.isRefractor=!0,this.type="Refractor",this.camera=new Zn;const n=this,i=e.color!==void 0?new et(e.color):new et(8355711),r=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||oY.RefractorShader,l=e.multisample!==void 0?e.multisample:4,g=this.camera;g.matrixAutoUpdate=!1,g.userData.refractor=!0;const c=new Ds,u=new dt,I=new En(r,s,{samples:l,type:Ri});this.material=new an({uniforms:Pn.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=I.texture,this.material.uniforms.textureMatrix.value=u;const h=function(){const p=new P,v=new P,B=new dt,G=new P,R=new P;return function(E){return p.setFromMatrixPosition(n.matrixWorld),v.setFromMatrixPosition(E.matrixWorld),G.subVectors(p,v),B.extractRotation(n.matrixWorld),R.set(0,0,1),R.applyMatrix4(B),G.dot(R)<0}}(),C=function(){const p=new P,v=new P,B=new gr,G=new P;return function(){n.matrixWorld.decompose(v,B,G),p.set(0,0,1).applyQuaternion(B).normalize(),p.negate(),c.setFromNormalAndCoplanarPoint(p,v)}}(),b=function(){const p=new Ds,v=new en,B=new en;return function(R){g.matrixWorld.copy(R.matrixWorld),g.matrixWorldInverse.copy(g.matrixWorld).invert(),g.projectionMatrix.copy(R.projectionMatrix),g.far=R.far,p.copy(c),p.applyMatrix4(g.matrixWorldInverse),v.set(p.normal.x,p.normal.y,p.normal.z,p.constant);const w=g.projectionMatrix;B.x=(Math.sign(v.x)+w.elements[8])/w.elements[0],B.y=(Math.sign(v.y)+w.elements[9])/w.elements[5],B.z=-1,B.w=(1+w.elements[10])/w.elements[14],v.multiplyScalar(2/v.dot(B)),w.elements[2]=v.x,w.elements[6]=v.y,w.elements[10]=v.z+1-o,w.elements[14]=v.w}}();function m(p){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(p.projectionMatrix),u.multiply(p.matrixWorldInverse),u.multiply(n.matrixWorld)}function f(p,v,B){n.visible=!1;const G=p.getRenderTarget(),R=p.xr.enabled,w=p.shadowMap.autoUpdate,E=p.toneMapping;let x=!1;"outputColorSpace"in p?x=p.outputColorSpace==="srgb":x=p.outputEncoding===3001,p.xr.enabled=!1,p.shadowMap.autoUpdate=!1,"outputColorSpace"in p?p.outputColorSpace="linear-srgb":p.outputEncoding=3e3,p.toneMapping=Wo,p.setRenderTarget(I),p.autoClear===!1&&p.clear(),p.render(v,g),p.xr.enabled=R,p.shadowMap.autoUpdate=w,p.toneMapping=E,p.setRenderTarget(G),"outputColorSpace"in p?p.outputColorSpace=x?"srgb":"srgb-linear":p.outputEncoding=x?3001:3e3;const W=B.viewport;W!==void 0&&p.state.viewport(W),n.visible=!0}this.onBeforeRender=function(p,v,B){B.userData.refractor!==!0&&h(B)&&(C(),m(B),b(B),f(p,v,B))},this.getRenderTarget=function(){return I},this.dispose=function(){I.dispose(),n.material.dispose()}}};let SS=oY;Oe(SS,"RefractorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${parseInt(gg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

		}`});const xAe=new Lt,wS=class extends pn{constructor(){super(wS.Geometry,new to({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const t=new P,e=new P,n=new ja(new Uint8Array(16*16*3),16,16,fi);n.minFilter=Vt,n.magFilter=Vt,n.wrapS=Ci,n.wrapT=Ci;const i=new ja(new Uint8Array(16*16*3),16,16,fi);i.minFilter=Vt,i.magFilter=Vt,i.wrapS=Ci,i.wrapT=Ci;const r=wS.Geometry,s=new kC({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),o=new kC({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),a=new pn(r,s),l=[],g=aY.Shader,c=new kC({uniforms:{map:{value:null},occlusionMap:{value:i},color:{value:new et(16777215)},scale:{value:new xe},screenPosition:{value:new P}},vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:Bf,transparent:!0,depthWrite:!1}),u=new pn(r,c);this.addElement=function(m){l.push(m)};const I=new xe,h=new xe,C=new G_,b=new en;this.onBeforeRender=function(m,f,p){m.getCurrentViewport(b);const v=b.w/b.z,B=b.z/2,G=b.w/2;let R=16/b.w;if(I.set(R*v,R),C.min.set(b.x,b.y),C.max.set(b.x+(b.z-16),b.y+(b.w-16)),e.setFromMatrixPosition(this.matrixWorld),e.applyMatrix4(p.matrixWorldInverse),!(e.z>0)&&(t.copy(e).applyMatrix4(p.projectionMatrix),h.x=b.x+t.x*B+B-8,h.y=b.y+t.y*G+G-8,C.containsPoint(h))){m.copyFramebufferToTexture(h,n);let w=s.uniforms;w.scale.value=I,w.screenPosition.value=t,m.renderBufferDirect(p,null,r,s,a,null),m.copyFramebufferToTexture(h,i),w=o.uniforms,w.scale.value=I,w.screenPosition.value=t,m.renderBufferDirect(p,null,r,o,a,null);const E=-t.x*2,x=-t.y*2;for(let W=0,T=l.length;W<T;W++){const k=l[W],_=c.uniforms;_.color.value.copy(k.color),_.map.value=k.texture,_.screenPosition.value.x=t.x+E*k.distance,_.screenPosition.value.y=t.y+x*k.distance,R=k.size/b.w;const U=b.w/b.z;_.scale.value.set(R*U,R),c.uniformsNeedUpdate=!0,m.renderBufferDirect(p,null,r,c,u,null)}}},this.dispose=function(){s.dispose(),o.dispose(),c.dispose(),n.dispose(),i.dispose();for(let m=0,f=l.length;m<f;m++)l[m].texture.dispose()}}};let ZAe=wS;Oe(ZAe,"Geometry",xAe);class aY{constructor(e,n=1,i=0,r=new et(16777215)){this.texture=e,this.size=n,this.distance=i,this.color=r}}Oe(aY,"Shader",{uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`});class _C{constructor(e=Math){Oe(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),Oe(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),Oe(this,"p",[]),Oe(this,"perm",[]),Oe(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),Oe(this,"dot",(n,i,r)=>n[0]*i+n[1]*r),Oe(this,"dot3",(n,i,r,s)=>n[0]*i+n[1]*r+n[2]*s),Oe(this,"dot4",(n,i,r,s,o)=>n[0]*i+n[1]*r+n[2]*s+n[3]*o),Oe(this,"noise",(n,i)=>{let r,s,o;const a=.5*(Math.sqrt(3)-1),l=(n+i)*a,g=Math.floor(n+l),c=Math.floor(i+l),u=(3-Math.sqrt(3))/6,I=(g+c)*u,h=g-I,C=c-I,b=n-h,m=i-C;let f=0,p=1;b>m&&(f=1,p=0);const v=b-f+u,B=m-p+u,G=b-1+2*u,R=m-1+2*u,w=g&255,E=c&255,x=this.perm[w+this.perm[E]]%12,W=this.perm[w+f+this.perm[E+p]]%12,T=this.perm[w+1+this.perm[E+1]]%12;let k=.5-b*b-m*m;k<0?r=0:(k*=k,r=k*k*this.dot(this.grad3[x],b,m));let _=.5-v*v-B*B;_<0?s=0:(_*=_,s=_*_*this.dot(this.grad3[W],v,B));let U=.5-G*G-R*R;return U<0?o=0:(U*=U,o=U*U*this.dot(this.grad3[T],G,R)),70*(r+s+o)}),Oe(this,"noise3d",(n,i,r)=>{let s,o,a,l;const g=.3333333333333333,c=(n+i+r)*g,u=Math.floor(n+c),I=Math.floor(i+c),h=Math.floor(r+c),C=1/6,b=(u+I+h)*C,m=u-b,f=I-b,p=h-b,v=n-m,B=i-f,G=r-p;let R,w,E,x,W,T;v>=B?B>=G?(R=1,w=0,E=0,x=1,W=1,T=0):v>=G?(R=1,w=0,E=0,x=1,W=0,T=1):(R=0,w=0,E=1,x=1,W=0,T=1):B<G?(R=0,w=0,E=1,x=0,W=1,T=1):v<G?(R=0,w=1,E=0,x=0,W=1,T=1):(R=0,w=1,E=0,x=1,W=1,T=0);const k=v-R+C,_=B-w+C,U=G-E+C,O=v-x+2*C,Y=B-W+2*C,z=G-T+2*C,N=v-1+3*C,L=B-1+3*C,V=G-1+3*C,M=u&255,X=I&255,J=h&255,re=this.perm[M+this.perm[X+this.perm[J]]]%12,se=this.perm[M+R+this.perm[X+w+this.perm[J+E]]]%12,le=this.perm[M+x+this.perm[X+W+this.perm[J+T]]]%12,ae=this.perm[M+1+this.perm[X+1+this.perm[J+1]]]%12;let ce=.6-v*v-B*B-G*G;ce<0?s=0:(ce*=ce,s=ce*ce*this.dot3(this.grad3[re],v,B,G));let Ee=.6-k*k-_*_-U*U;Ee<0?o=0:(Ee*=Ee,o=Ee*Ee*this.dot3(this.grad3[se],k,_,U));let Fe=.6-O*O-Y*Y-z*z;Fe<0?a=0:(Fe*=Fe,a=Fe*Fe*this.dot3(this.grad3[le],O,Y,z));let oe=.6-N*N-L*L-V*V;return oe<0?l=0:(oe*=oe,l=oe*oe*this.dot3(this.grad3[ae],N,L,V)),32*(s+o+a+l)}),Oe(this,"noise4d",(n,i,r,s)=>{const o=this.grad4,a=this.simplex,l=this.perm,g=(Math.sqrt(5)-1)/4,c=(5-Math.sqrt(5))/20;let u,I,h,C,b;const m=(n+i+r+s)*g,f=Math.floor(n+m),p=Math.floor(i+m),v=Math.floor(r+m),B=Math.floor(s+m),G=(f+p+v+B)*c,R=f-G,w=p-G,E=v-G,x=B-G,W=n-R,T=i-w,k=r-E,_=s-x,U=W>T?32:0,O=W>k?16:0,Y=T>k?8:0,z=W>_?4:0,N=T>_?2:0,L=k>_?1:0,V=U+O+Y+z+N+L;let M,X,J,re,se,le,ae,ce,Ee,Fe,oe,D;M=a[V][0]>=3?1:0,X=a[V][1]>=3?1:0,J=a[V][2]>=3?1:0,re=a[V][3]>=3?1:0,se=a[V][0]>=2?1:0,le=a[V][1]>=2?1:0,ae=a[V][2]>=2?1:0,ce=a[V][3]>=2?1:0,Ee=a[V][0]>=1?1:0,Fe=a[V][1]>=1?1:0,oe=a[V][2]>=1?1:0,D=a[V][3]>=1?1:0;const fe=W-M+c,Ce=T-X+c,pe=k-J+c,be=_-re+c,Ue=W-se+2*c,me=T-le+2*c,we=k-ae+2*c,Be=_-ce+2*c,Ae=W-Ee+3*c,De=T-Fe+3*c,Q=k-oe+3*c,K=_-D+3*c,ge=W-1+4*c,Le=T-1+4*c,Re=k-1+4*c,Ze=_-1+4*c,Je=f&255,Ye=p&255,de=v&255,ze=B&255,je=l[Je+l[Ye+l[de+l[ze]]]]%32,Pe=l[Je+M+l[Ye+X+l[de+J+l[ze+re]]]]%32,ke=l[Je+se+l[Ye+le+l[de+ae+l[ze+ce]]]]%32,$=l[Je+Ee+l[Ye+Fe+l[de+oe+l[ze+D]]]]%32,Se=l[Je+1+l[Ye+1+l[de+1+l[ze+1]]]]%32;let Ke=.6-W*W-T*T-k*k-_*_;Ke<0?u=0:(Ke*=Ke,u=Ke*Ke*this.dot4(o[je],W,T,k,_));let q=.6-fe*fe-Ce*Ce-pe*pe-be*be;q<0?I=0:(q*=q,I=q*q*this.dot4(o[Pe],fe,Ce,pe,be));let He=.6-Ue*Ue-me*me-we*we-Be*Be;He<0?h=0:(He*=He,h=He*He*this.dot4(o[ke],Ue,me,we,Be));let ue=.6-Ae*Ae-De*De-Q*Q-K*K;ue<0?C=0:(ue*=ue,C=ue*ue*this.dot4(o[$],Ae,De,Q,K));let _e=.6-ge*ge-Le*Le-Re*Re-Ze*Ze;return _e<0?b=0:(_e*=_e,b=_e*_e*this.dot4(o[Se],ge,Le,Re,Ze)),27*(u+I+h+C+b)});for(let n=0;n<256;n++)this.p[n]=Math.floor(e.random()*256);for(let n=0;n<512;n++)this.perm[n]=this.p[n&255]}}const Or=class extends Lt{constructor(t={}){super(),this.isLightningStrike=!0,this.type="LightningStrike",this.init(Or.copyParameters(t,t)),this.createMesh()}static createRandomGenerator(){const e=[];for(let i=0;i<2053;i++)e.push(Math.random());const n={currentSeed:0,random:function(){const i=e[n.currentSeed];return n.currentSeed=(n.currentSeed+1)%2053,i},getSeed:function(){return n.currentSeed/2053},setSeed:function(i){n.currentSeed=Math.floor(i*2053)%2053}};return n}static copyParameters(t={},e={}){const n=function(i){return e===t?i:i.clone()};return t.sourceOffset=e.sourceOffset!==void 0?n(e.sourceOffset):new P(0,100,0),t.destOffset=e.destOffset!==void 0?n(e.destOffset):new P(0,0,0),t.timeScale=e.timeScale!==void 0?e.timeScale:1,t.roughness=e.roughness!==void 0?e.roughness:.9,t.straightness=e.straightness!==void 0?e.straightness:.7,t.up0=e.up0!==void 0?n(e.up0):new P(0,0,1),t.up1=e.up1!==void 0?n(e.up1):new P(0,0,1),t.radius0=e.radius0!==void 0?e.radius0:1,t.radius1=e.radius1!==void 0?e.radius1:1,t.radius0Factor=e.radius0Factor!==void 0?e.radius0Factor:.5,t.radius1Factor=e.radius1Factor!==void 0?e.radius1Factor:.2,t.minRadius=e.minRadius!==void 0?e.minRadius:.2,t.isEternal=e.isEternal!==void 0?e.isEternal:e.birthTime===void 0||e.deathTime===void 0,t.birthTime=e.birthTime,t.deathTime=e.deathTime,t.propagationTimeFactor=e.propagationTimeFactor!==void 0?e.propagationTimeFactor:.1,t.vanishingTimeFactor=e.vanishingTimeFactor!==void 0?e.vanishingTimeFactor:.9,t.subrayPeriod=e.subrayPeriod!==void 0?e.subrayPeriod:4,t.subrayDutyCycle=e.subrayDutyCycle!==void 0?e.subrayDutyCycle:.6,t.maxIterations=e.maxIterations!==void 0?e.maxIterations:9,t.isStatic=e.isStatic!==void 0?e.isStatic:!1,t.ramification=e.ramification!==void 0?e.ramification:5,t.maxSubrayRecursion=e.maxSubrayRecursion!==void 0?e.maxSubrayRecursion:3,t.recursionProbability=e.recursionProbability!==void 0?e.recursionProbability:.6,t.generateUVs=e.generateUVs!==void 0?e.generateUVs:!1,t.randomGenerator=e.randomGenerator,t.noiseSeed=e.noiseSeed,t.onDecideSubrayCreation=e.onDecideSubrayCreation,t.onSubrayCreation=e.onSubrayCreation,t}update(t){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=t&&t<=this.rayParameters.deathTime?(this.updateMesh(t),t<this.subrays[0].endPropagationTime?this.state=Or.RAY_PROPAGATING:t>this.subrays[0].beginVanishingTime?this.state=Or.RAY_VANISHING:this.state=Or.RAY_STEADY,this.visible=!0):(this.visible=!1,t<this.rayParameters.birthTime?this.state=Or.RAY_UNBORN:this.state=Or.RAY_EXTINGUISHED))}init(t){this.rayParameters=t,this.maxIterations=t.maxIterations!==void 0?Math.floor(t.maxIterations):9,t.maxIterations=this.maxIterations,this.isStatic=t.isStatic!==void 0?t.isStatic:!1,t.isStatic=this.isStatic,this.ramification=t.ramification!==void 0?Math.floor(t.ramification):5,t.ramification=this.ramification,this.maxSubrayRecursion=t.maxSubrayRecursion!==void 0?Math.floor(t.maxSubrayRecursion):3,t.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=t.recursionProbability!==void 0?t.recursionProbability:.6,t.recursionProbability=this.recursionProbability,this.generateUVs=t.generateUVs!==void 0?t.generateUVs:!1,t.generateUVs=this.generateUVs,t.randomGenerator!==void 0?(this.randomGenerator=t.randomGenerator,this.seedGenerator=t.randomGenerator,t.noiseSeed!==void 0&&this.seedGenerator.setSeed(t.noiseSeed)):(this.randomGenerator=Or.createRandomGenerator(),this.seedGenerator=Math),t.onDecideSubrayCreation!==void 0?this.onDecideSubrayCreation=t.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),t.onSubrayCreation!==void 0&&(this.onSubrayCreation=t.onSubrayCreation)),this.state=Or.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),t.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let e=0;e<this.maxSubrays;e++)this.subrays.push(this.createSubray());this.raySegments=[];for(let e=0;e<this.maxRaySegments;e++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new _C(this.seedGenerator),this.simplexY=new _C(this.seedGenerator),this.simplexZ=new _C(this.seedGenerator),this.forwards=new P,this.forwardsFill=new P,this.side=new P,this.down=new P,this.middlePos=new P,this.middleLinPos=new P,this.newPos=new P,this.vPos=new P,this.cross1=new P}createMesh(){const t=1<<this.maxIterations,e=3*(t+1)*this.maxSubrays,n=18*t*this.maxSubrays;this.vertices=new Float32Array(e*3),this.indices=new Uint32Array(n),this.generateUVs&&(this.uvs=new Float32Array(e*2)),this.fillMesh(0),this.setIndex(new Zv(this.indices,1)),this.positionAttribute=new ut(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new ut(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=e3,this.positionAttribute.usage=e3,this.generateUVs&&(this.uvsAttribute.usage=e3)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(t){this.fillMesh(t),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(t){const e=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(t,function(i){const r=e.currentSubray;t<r.birthTime||(this.rayParameters.isEternal&&e.currentSubray.recursion==0?(e.createPrism(i),e.onDecideSubrayCreation(i,e)):t<r.endPropagationTime?e.timeFraction>=i.fraction0*r.propagationTimeFactor&&(e.createPrism(i),e.onDecideSubrayCreation(i,e)):t<r.beginVanishingTime?(e.createPrism(i),e.onDecideSubrayCreation(i,e)):(e.timeFraction<=r.vanishingTimeFactor+i.fraction1*(1-r.vanishingTimeFactor)&&e.createPrism(i),e.onDecideSubrayCreation(i,e)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(t,e){t.pos0.copy(e.sourceOffset),t.pos1.copy(e.destOffset),t.up0.copy(e.up0),t.up1.copy(e.up1),t.radius0=e.radius0,t.radius1=e.radius1,t.birthTime=e.birthTime,t.deathTime=e.deathTime,t.timeScale=e.timeScale,t.roughness=e.roughness,t.straightness=e.straightness,t.propagationTimeFactor=e.propagationTimeFactor,t.vanishingTimeFactor=e.vanishingTimeFactor,t.maxIterations=this.maxIterations,t.seed=e.noiseSeed!==void 0?e.noiseSeed:0,t.recursion=0}fractalRay(t,e){this.time=t,this.currentSegmentCallback=e,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let n=0;n<this.numSubrays;n++){const i=this.subrays[n];this.currentSubray=i,this.randomGenerator.setSeed(i.seed),i.endPropagationTime=ac.lerp(i.birthTime,i.deathTime,i.propagationTimeFactor),i.beginVanishingTime=ac.lerp(i.deathTime,i.birthTime,1-i.vanishingTimeFactor);const r=this.randomGenerator.random;i.linPos0.set(r(),r(),r()).multiplyScalar(1e3),i.linPos1.set(r(),r(),r()).multiplyScalar(1e3),this.timeFraction=(t-i.birthTime)/(i.deathTime-i.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;const s=this.getNewSegment();s.iteration=0,s.pos0.copy(i.pos0),s.pos1.copy(i.pos1),s.linPos0.copy(i.linPos0),s.linPos1.copy(i.linPos1),s.up0.copy(i.up0),s.up1.copy(i.up1),s.radius0=i.radius0,s.radius1=i.radius1,s.fraction0=0,s.fraction1=1,s.positionVariationFactor=1-i.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,i.recursion)/(1<<i.maxIterations),this.fractalRayRecursive(s)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(t){if(t.iteration>=this.currentSubray.maxIterations){this.currentSegmentCallback(t);return}this.forwards.subVectors(t.pos1,t.pos0);let e=this.forwards.length();e<1e-6&&(this.forwards.set(0,0,.01),e=this.forwards.length());const n=(t.radius0+t.radius1)*.5,i=(t.fraction0+t.fraction1)*.5,r=this.time*this.currentSubray.timeScale*Math.pow(2,t.iteration);this.middlePos.lerpVectors(t.pos0,t.pos1,.5),this.middleLinPos.lerpVectors(t.linPos0,t.linPos1,.5);const s=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(s.x,s.y,s.z,r),this.simplexY.noise4d(s.x,s.y,s.z,r),this.simplexZ.noise4d(s.x,s.y,s.z,r)),this.newPos.multiplyScalar(t.positionVariationFactor*e),this.newPos.add(this.middlePos);const o=this.getNewSegment();o.pos0.copy(t.pos0),o.pos1.copy(this.newPos),o.linPos0.copy(t.linPos0),o.linPos1.copy(this.middleLinPos),o.up0.copy(t.up0),o.up1.copy(t.up1),o.radius0=t.radius0,o.radius1=n,o.fraction0=t.fraction0,o.fraction1=i,o.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,o.iteration=t.iteration+1;const a=this.getNewSegment();a.pos0.copy(this.newPos),a.pos1.copy(t.pos1),a.linPos0.copy(this.middleLinPos),a.linPos1.copy(t.linPos1),this.cross1.crossVectors(t.up0,this.forwards.normalize()),a.up0.crossVectors(this.forwards,this.cross1).normalize(),a.up1.copy(t.up1),a.radius0=n,a.radius1=t.radius1,a.fraction0=i,a.fraction1=t.fraction1,a.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,a.iteration=t.iteration+1,this.fractalRayRecursive(o),this.fractalRayRecursive(a)}createPrism(t){this.forwardsFill.subVectors(t.pos1,t.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(t.pos0,t.up0,this.forwardsFill,t.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(t.pos1,t.up0,this.forwardsFill,t.radius1,t.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(t,e,n,i){this.side.crossVectors(e,n).multiplyScalar(i*Or.COS30DEG),this.down.copy(e).multiplyScalar(-i*Or.SIN30DEG);const r=this.vPos,s=this.vertices;r.copy(t).sub(this.side).add(this.down),s[this.currentCoordinate++]=r.x,s[this.currentCoordinate++]=r.y,s[this.currentCoordinate++]=r.z,r.copy(t).add(this.side).add(this.down),s[this.currentCoordinate++]=r.x,s[this.currentCoordinate++]=r.y,s[this.currentCoordinate++]=r.z,r.copy(e).multiplyScalar(i).add(t),s[this.currentCoordinate++]=r.x,s[this.currentCoordinate++]=r.y,s[this.currentCoordinate++]=r.z,this.currentVertex+=3}createTriangleVerticesWithUVs(t,e,n,i,r){this.side.crossVectors(e,n).multiplyScalar(i*Or.COS30DEG),this.down.copy(e).multiplyScalar(-i*Or.SIN30DEG);const s=this.vPos,o=this.vertices,a=this.uvs;s.copy(t).sub(this.side).add(this.down),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,a[this.currentUVCoordinate++]=r,a[this.currentUVCoordinate++]=0,s.copy(t).add(this.side).add(this.down),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,a[this.currentUVCoordinate++]=r,a[this.currentUVCoordinate++]=.5,s.copy(e).multiplyScalar(i).add(t),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,a[this.currentUVCoordinate++]=r,a[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(t){const e=this.indices;t=this.currentVertex-6,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+5,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+5,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+5}createDefaultSubrayCreationCallbacks(){const t=this.randomGenerator.random;this.onDecideSubrayCreation=function(s,o){const a=o.currentSubray,l=o.rayParameters.subrayPeriod,g=o.rayParameters.subrayDutyCycle,c=o.rayParameters.isEternal&&a.recursion==0?-t()*l:ac.lerp(a.birthTime,a.endPropagationTime,s.fraction0)-t()*l,u=o.time-c,I=Math.floor(u/l),h=t()*(I+1),C=u%l<=g*l;let b=0;if(C&&(b=o.subrayProbability),a.recursion<o.maxSubrayRecursion&&o.numSubrays<o.maxSubrays&&t()<b){const m=o.addNewSubray(),f=o.randomGenerator.getSeed();m.seed=h,o.randomGenerator.setSeed(h),m.recursion=a.recursion+1,m.maxIterations=Math.max(1,a.maxIterations-1),m.linPos0.set(t(),t(),t()).multiplyScalar(1e3),m.linPos1.set(t(),t(),t()).multiplyScalar(1e3),m.up0.copy(a.up0),m.up1.copy(a.up1),m.radius0=s.radius0*o.rayParameters.radius0Factor,m.radius1=Math.min(o.rayParameters.minRadius,s.radius1*o.rayParameters.radius1Factor),m.birthTime=c+I*l,m.deathTime=m.birthTime+l*g,!o.rayParameters.isEternal&&a.recursion==0&&(m.birthTime=Math.max(m.birthTime,a.birthTime),m.deathTime=Math.min(m.deathTime,a.deathTime)),m.timeScale=a.timeScale*2,m.roughness=a.roughness,m.straightness=a.straightness,m.propagationTimeFactor=a.propagationTimeFactor,m.vanishingTimeFactor=a.vanishingTimeFactor,o.onSubrayCreation(s,a,m,o),o.randomGenerator.setSeed(f)}};const e=new P,n=new P,i=new P,r=new P;this.onSubrayCreation=function(s,o,a,l){l.subrayCylinderPosition(s,o,a,.5,.6,.2)},this.subrayConePosition=function(s,o,a,l,g,c){a.pos0.copy(s.pos0),e.subVectors(o.pos1,o.pos0),n.copy(e).normalize(),e.multiplyScalar(s.fraction0+(1-s.fraction0)*(t()*l));const u=e.length();i.crossVectors(o.up0,n);const I=2*Math.PI*t();i.multiplyScalar(Math.cos(I)),r.copy(o.up0).multiplyScalar(Math.sin(I)),a.pos1.copy(i).add(r).multiplyScalar(u*g*(c+t()*(1-c))).add(e).add(o.pos0)},this.subrayCylinderPosition=function(s,o,a,l,g,c){a.pos0.copy(s.pos0),e.subVectors(o.pos1,o.pos0),n.copy(e).normalize(),e.multiplyScalar(s.fraction0+(1-s.fraction0)*((2*t()-1)*l));const u=e.length();i.crossVectors(o.up0,n);const I=2*Math.PI*t();i.multiplyScalar(Math.cos(I)),r.copy(o.up0).multiplyScalar(Math.sin(I)),a.pos1.copy(i).add(r).multiplyScalar(u*g*(c+t()*(1-c))).add(e).add(o.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new P,pos1:new P,linPos0:new P,linPos1:new P,up0:new P,up1:new P,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new P,pos1:new P,linPos0:new P,linPos1:new P,up0:new P,up1:new P,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(t){return super.copy(t),this.init(Or.copyParameters({},t.rayParameters)),this}clone(){return new this.constructor(Or.copyParameters({},this.rayParameters))}};let Ec=Or;Oe(Ec,"RAY_INITIALIZED",0);Oe(Ec,"RAY_UNBORN",1);Oe(Ec,"RAY_PROPAGATING",2);Oe(Ec,"RAY_STEADY",3);Oe(Ec,"RAY_VANISHING",4);Oe(Ec,"RAY_EXTINGUISHED",5);Oe(Ec,"COS30DEG",Math.cos(30*Math.PI/180));Oe(Ec,"SIN30DEG",Math.sin(30*Math.PI/180));const hu=class extends pn{constructor(t,e={}){super(t),this.isReflectorForSSRPass=!0,this.type="ReflectorForSSRPass";const n=this,i=e.color!==void 0?new et(e.color):new et(8355711),r=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||hu.ReflectorShader,l=e.useDepthTexture===!0,g=new P(0,1,0),c=new P,u=new P;n.needsUpdate=!1,n.maxDistance=hu.ReflectorShader.uniforms.maxDistance.value,n.opacity=hu.ReflectorShader.uniforms.opacity.value,n.color=i,n.resolution=e.resolution||new xe(window.innerWidth,window.innerHeight),n._distanceAttenuation=hu.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(n,"distanceAttenuation",{get(){return n._distanceAttenuation},set(T){n._distanceAttenuation!==T&&(n._distanceAttenuation=T,n.material.defines.DISTANCE_ATTENUATION=T,n.material.needsUpdate=!0)}}),n._fresnel=hu.ReflectorShader.defines.FRESNEL,Object.defineProperty(n,"fresnel",{get(){return n._fresnel},set(T){n._fresnel!==T&&(n._fresnel=T,n.material.defines.FRESNEL=T,n.material.needsUpdate=!0)}});const I=new P,h=new P,C=new P,b=new dt,m=new P(0,0,-1),f=new P,p=new P,v=new dt,B=new Zn;let G;l&&(G=new zA,G.type=mI,G.minFilter=Vt,G.magFilter=Vt);const R={depthTexture:l?G:null,type:Ri},w=new En(r,s,R),E=new an({transparent:l,defines:Object.assign({},hu.ReflectorShader.defines,{useDepthTexture:l}),uniforms:Pn.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});E.uniforms.tDiffuse.value=w.texture,E.uniforms.color.value=n.color,E.uniforms.textureMatrix.value=v,l&&(E.uniforms.tDepth.value=w.depthTexture),this.material=E;const W=[new Ds(new P(0,1,0),o)];this.doRender=function(T,k,_){if(E.uniforms.maxDistance.value=n.maxDistance,E.uniforms.color.value=n.color,E.uniforms.opacity.value=n.opacity,c.copy(_.position).normalize(),u.copy(c).reflect(g),E.uniforms.fresnelCoe.value=(c.dot(u)+1)/2,h.setFromMatrixPosition(n.matrixWorld),C.setFromMatrixPosition(_.matrixWorld),b.extractRotation(n.matrixWorld),I.set(0,0,1),I.applyMatrix4(b),f.subVectors(h,C),f.dot(I)>0)return;f.reflect(I).negate(),f.add(h),b.extractRotation(_.matrixWorld),m.set(0,0,-1),m.applyMatrix4(b),m.add(C),p.subVectors(h,m),p.reflect(I).negate(),p.add(h),B.position.copy(f),B.up.set(0,1,0),B.up.applyMatrix4(b),B.up.reflect(I),B.lookAt(p),B.far=_.far,B.updateMatrixWorld(),B.projectionMatrix.copy(_.projectionMatrix),E.uniforms.virtualCameraNear.value=_.near,E.uniforms.virtualCameraFar.value=_.far,E.uniforms.virtualCameraMatrixWorld.value=B.matrixWorld,E.uniforms.virtualCameraProjectionMatrix.value=_.projectionMatrix,E.uniforms.virtualCameraProjectionMatrixInverse.value=_.projectionMatrixInverse,E.uniforms.resolution.value=n.resolution,v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(B.projectionMatrix),v.multiply(B.matrixWorldInverse),v.multiply(n.matrixWorld);const U=T.getRenderTarget(),O=T.xr.enabled,Y=T.shadowMap.autoUpdate,z=T.clippingPlanes;T.xr.enabled=!1,T.shadowMap.autoUpdate=!1,T.clippingPlanes=W,T.setRenderTarget(w),T.state.buffers.depth.setMask(!0),T.autoClear===!1&&T.clear(),T.render(k,B),T.xr.enabled=O,T.shadowMap.autoUpdate=Y,T.clippingPlanes=z,T.setRenderTarget(U);const N=_.viewport;N!==void 0&&T.state.viewport(N)},this.getRenderTarget=function(){return w}}};let EAe=hu;Oe(EAe,"ReflectorShader",{defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new dt},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new dt},virtualCameraMatrixWorld:{value:new dt},virtualCameraProjectionMatrixInverse:{value:new dt},resolution:{value:new xe}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;
		uniform float maxDistance;
		uniform float opacity;
		uniform float fresnelCoe;
		uniform float virtualCameraNear;
		uniform float virtualCameraFar;
		uniform mat4 virtualCameraProjectionMatrix;
		uniform mat4 virtualCameraProjectionMatrixInverse;
		uniform mat4 virtualCameraMatrixWorld;
		uniform vec2 resolution;
		varying vec4 vUv;
		#include <packing>
		float blendOverlay( float base, float blend ) {
			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );
		}
		vec3 blendOverlay( vec3 base, vec3 blend ) {
			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			return perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view
		}
		void main() {
			vec4 base = texture2DProj( tDiffuse, vUv );
			#ifdef useDepthTexture
				vec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;
				uv.x=1.-uv.x;
				float depth = texture2DProj( tDepth, vUv ).r;
				float viewZ = getViewZ( depth );
				float clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];
				vec3 viewPosition=getViewPosition( uv, depth, clipW );
				vec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;
				if(worldPosition.y>maxDistance) discard;
				float op=opacity;
				#ifdef DISTANCE_ATTENUATION
					float ratio=1.-(worldPosition.y/maxDistance);
					float attenuation=ratio*ratio;
					op=opacity*attenuation;
				#endif
				#ifdef FRESNEL
					op*=fresnelCoe;
				#endif
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), op );
			#else
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );
			#endif
		}
	`});const s3={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new P},up:{value:new P(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${parseInt(gg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},lY=new an({name:"SkyShader",fragmentShader:s3.fragmentShader,vertexShader:s3.vertexShader,uniforms:Pn.clone(s3.uniforms),side:fr,depthWrite:!1});class gY extends pn{constructor(){super(new wc(1,1,1),lY)}}Oe(gY,"SkyShader",s3);Oe(gY,"material",lY);const cY=class extends pn{constructor(t,e={}){super(t),this.isWater=!0,this.type="Water";const n=this,i=e.color!==void 0?new et(e.color):new et(16777215),r=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.flowDirection||new xe(1,0),l=e.flowSpeed||.03,g=e.reflectivity||.02,c=e.scale||1,u=e.shader||cY.WaterShader,I=e.encoding!==void 0?e.encoding:3e3,h=e.flowMap||void 0,C=e.normalMap0,b=e.normalMap1,m=.15,f=m*.5,p=new dt,v=new ey;if(GS===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(SS===void 0){console.error("THREE.Water: Required component Refractor not found.");return}const B=new GS(t,{textureWidth:r,textureHeight:s,clipBias:o,encoding:I}),G=new SS(t,{textureWidth:r,textureHeight:s,clipBias:o,encoding:I});B.matrixAutoUpdate=!1,G.matrixAutoUpdate=!1,this.material=new an({uniforms:Pn.merge([it.fog,u.uniforms]),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!0,fog:!0}),h!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:h}):this.material.uniforms.flowDirection={type:"v2",value:a},C.wrapS=C.wrapT=ng,b.wrapS=b.wrapT=ng,this.material.uniforms.tReflectionMap.value=B.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=G.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=C,this.material.uniforms.tNormalMap1.value=b,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=g,this.material.uniforms.textureMatrix.value=p,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=f,this.material.uniforms.config.value.z=f,this.material.uniforms.config.value.w=c;function R(E){p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(E.projectionMatrix),p.multiply(E.matrixWorldInverse),p.multiply(n.matrixWorld)}function w(){const E=v.getDelta(),x=n.material.uniforms.config;x.value.x+=l*E,x.value.y=x.value.x+f,x.value.x>=m?(x.value.x=0,x.value.y=f):x.value.y>=m&&(x.value.y=x.value.y-m)}this.onBeforeRender=function(E,x,W){R(W),w(),n.visible=!1,B.matrixWorld.copy(n.matrixWorld),G.matrixWorld.copy(n.matrixWorld),B.onBeforeRender(E,x,W),G.onBeforeRender(E,x,W),n.visible=!0}}};let WAe=cY;Oe(WAe,"WaterShader",{uniforms:{color:{value:null},reflectivity:{value:0},tReflectionMap:{value:null},tRefractionMap:{value:null},tNormalMap0:{value:null},tNormalMap1:{value:null},textureMatrix:{value:null},config:{value:new en}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <${parseInt(gg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
			#include <fog_fragment>

		}`});const NB={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","	float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","	gl_FragColor = vec4( vec3( depth ), opacity );","}"].join(`
`)},A2=new bI,dM=new Ds,NAe=Math.cos(70*ac.DEG2RAD),AM=(t,e)=>(t%e+e)%e;let MAe=class extends sl{constructor(e,n){super(),Oe(this,"object"),Oe(this,"domElement"),Oe(this,"enabled",!0),Oe(this,"target",new P),Oe(this,"minDistance",0),Oe(this,"maxDistance",1/0),Oe(this,"minZoom",0),Oe(this,"maxZoom",1/0),Oe(this,"minPolarAngle",0),Oe(this,"maxPolarAngle",Math.PI),Oe(this,"minAzimuthAngle",-1/0),Oe(this,"maxAzimuthAngle",1/0),Oe(this,"enableDamping",!1),Oe(this,"dampingFactor",.05),Oe(this,"enableZoom",!0),Oe(this,"zoomSpeed",1),Oe(this,"enableRotate",!0),Oe(this,"rotateSpeed",1),Oe(this,"enablePan",!0),Oe(this,"panSpeed",1),Oe(this,"screenSpacePanning",!0),Oe(this,"keyPanSpeed",7),Oe(this,"zoomToCursor",!1),Oe(this,"autoRotate",!1),Oe(this,"autoRotateSpeed",2),Oe(this,"reverseOrbit",!1),Oe(this,"reverseHorizontalOrbit",!1),Oe(this,"reverseVerticalOrbit",!1),Oe(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Oe(this,"mouseButtons",{LEFT:Iu.ROTATE,MIDDLE:Iu.DOLLY,RIGHT:Iu.PAN}),Oe(this,"touches",{ONE:du.ROTATE,TWO:du.DOLLY_PAN}),Oe(this,"target0"),Oe(this,"position0"),Oe(this,"zoom0"),Oe(this,"_domElementKeyEvents",null),Oe(this,"getPolarAngle"),Oe(this,"getAzimuthalAngle"),Oe(this,"setPolarAngle"),Oe(this,"setAzimuthalAngle"),Oe(this,"getDistance"),Oe(this,"listenToKeyEvents"),Oe(this,"stopListenToKeyEvents"),Oe(this,"saveState"),Oe(this,"reset"),Oe(this,"update"),Oe(this,"connect"),Oe(this,"dispose"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=$=>{let Se=AM($,2*Math.PI),Ke=c.phi;Ke<0&&(Ke+=2*Math.PI),Se<0&&(Se+=2*Math.PI);let q=Math.abs(Se-Ke);2*Math.PI-q<q&&(Se<Ke?Se+=2*Math.PI:Ke+=2*Math.PI),u.phi=Se-Ke,i.update()},this.setAzimuthalAngle=$=>{let Se=AM($,2*Math.PI),Ke=c.theta;Ke<0&&(Ke+=2*Math.PI),Se<0&&(Se+=2*Math.PI);let q=Math.abs(Se-Ke);2*Math.PI-q<q&&(Se<Ke?Se+=2*Math.PI:Ke+=2*Math.PI),u.theta=Se-Ke,i.update()},this.getDistance=()=>i.object.position.distanceTo(i.target),this.listenToKeyEvents=$=>{$.addEventListener("keydown",Ze),this._domElementKeyEvents=$},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Ze),this._domElementKeyEvents=null},this.saveState=()=>{i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=()=>{i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(r),i.update(),l=a.NONE},this.update=(()=>{const $=new P,Se=new P(0,1,0),Ke=new gr().setFromUnitVectors(e.up,Se),q=Ke.clone().invert(),He=new P,ue=new gr,_e=2*Math.PI;return function(){const At=i.object.position;Ke.setFromUnitVectors(e.up,Se),q.copy(Ke).invert(),$.copy(At).sub(i.target),$.applyQuaternion(Ke),c.setFromVector3($),i.autoRotate&&l===a.NONE&&U(k()),i.enableDamping?(c.theta+=u.theta*i.dampingFactor,c.phi+=u.phi*i.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let vt=i.minAzimuthAngle,Et=i.maxAzimuthAngle;isFinite(vt)&&isFinite(Et)&&(vt<-Math.PI?vt+=_e:vt>Math.PI&&(vt-=_e),Et<-Math.PI?Et+=_e:Et>Math.PI&&(Et-=_e),vt<=Et?c.theta=Math.max(vt,Math.min(Et,c.theta)):c.theta=c.theta>(vt+Et)/2?Math.max(vt,c.theta):Math.min(Et,c.theta)),c.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,c.phi)),c.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),i.zoomToCursor&&x||i.object.isOrthographicCamera?c.radius=X(c.radius):c.radius=X(c.radius*I),$.setFromSpherical(c),$.applyQuaternion(q),At.copy(i.target).add($),i.object.lookAt(i.target),i.enableDamping===!0?(u.theta*=1-i.dampingFactor,u.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(u.set(0,0,0),h.set(0,0,0));let Kt=!1;if(i.zoomToCursor&&x){let zt=null;if(i.object instanceof Zn&&i.object.isPerspectiveCamera){const Ht=$.length();zt=X(Ht*I);const Tt=Ht-zt;i.object.position.addScaledVector(w,Tt),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const Ht=new P(E.x,E.y,0);Ht.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/I)),i.object.updateProjectionMatrix(),Kt=!0;const Tt=new P(E.x,E.y,0);Tt.unproject(i.object),i.object.position.sub(Tt).add(Ht),i.object.updateMatrixWorld(),zt=$.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;zt!==null&&(i.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(zt).add(i.object.position):(A2.origin.copy(i.object.position),A2.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(A2.direction))<NAe?e.lookAt(i.target):(dM.setFromNormalAndCoplanarPoint(i.object.up,i.target),A2.intersectPlane(dM,i.target))))}else i.object instanceof Zo&&i.object.isOrthographicCamera&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/I)),i.object.updateProjectionMatrix(),Kt=!0);return I=1,x=!1,Kt||He.distanceToSquared(i.object.position)>g||8*(1-ue.dot(i.object.quaternion))>g?(i.dispatchEvent(r),He.copy(i.object.position),ue.copy(i.object.quaternion),Kt=!1,!0):!1}})(),this.connect=$=>{$===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=$,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",de),i.domElement.addEventListener("pointerdown",Ae),i.domElement.addEventListener("pointercancel",K),i.domElement.addEventListener("wheel",Re)},this.dispose=()=>{var $,Se,Ke,q,He,ue;($=i.domElement)==null||$.removeEventListener("contextmenu",de),(Se=i.domElement)==null||Se.removeEventListener("pointerdown",Ae),(Ke=i.domElement)==null||Ke.removeEventListener("pointercancel",K),(q=i.domElement)==null||q.removeEventListener("wheel",Re),(He=i.domElement)==null||He.ownerDocument.removeEventListener("pointermove",De),(ue=i.domElement)==null||ue.ownerDocument.removeEventListener("pointerup",Q),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",Ze)};const i=this,r={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const g=1e-6,c=new lS,u=new lS;let I=1;const h=new P,C=new xe,b=new xe,m=new xe,f=new xe,p=new xe,v=new xe,B=new xe,G=new xe,R=new xe,w=new P,E=new xe;let x=!1;const W=[],T={};function k(){return 2*Math.PI/60/60*i.autoRotateSpeed}function _(){return Math.pow(.95,i.zoomSpeed)}function U($){i.reverseOrbit||i.reverseHorizontalOrbit?u.theta+=$:u.theta-=$}function O($){i.reverseOrbit||i.reverseVerticalOrbit?u.phi+=$:u.phi-=$}const Y=(()=>{const $=new P;return function(Ke,q){$.setFromMatrixColumn(q,0),$.multiplyScalar(-Ke),h.add($)}})(),z=(()=>{const $=new P;return function(Ke,q){i.screenSpacePanning===!0?$.setFromMatrixColumn(q,1):($.setFromMatrixColumn(q,0),$.crossVectors(i.object.up,$)),$.multiplyScalar(Ke),h.add($)}})(),N=(()=>{const $=new P;return function(Ke,q){const He=i.domElement;if(He&&i.object instanceof Zn&&i.object.isPerspectiveCamera){const ue=i.object.position;$.copy(ue).sub(i.target);let _e=$.length();_e*=Math.tan(i.object.fov/2*Math.PI/180),Y(2*Ke*_e/He.clientHeight,i.object.matrix),z(2*q*_e/He.clientHeight,i.object.matrix)}else He&&i.object instanceof Zo&&i.object.isOrthographicCamera?(Y(Ke*(i.object.right-i.object.left)/i.object.zoom/He.clientWidth,i.object.matrix),z(q*(i.object.top-i.object.bottom)/i.object.zoom/He.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}})();function L($){i.object instanceof Zn&&i.object.isPerspectiveCamera||i.object instanceof Zo&&i.object.isOrthographicCamera?I/=$:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function V($){i.object instanceof Zn&&i.object.isPerspectiveCamera||i.object instanceof Zo&&i.object.isOrthographicCamera?I*=$:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function M($){if(!i.zoomToCursor||!i.domElement)return;x=!0;const Se=i.domElement.getBoundingClientRect(),Ke=$.clientX-Se.left,q=$.clientY-Se.top,He=Se.width,ue=Se.height;E.x=Ke/He*2-1,E.y=-(q/ue)*2+1,w.set(E.x,E.y,1).unproject(i.object).sub(i.object.position).normalize()}function X($){return Math.max(i.minDistance,Math.min(i.maxDistance,$))}function J($){C.set($.clientX,$.clientY)}function re($){M($),B.set($.clientX,$.clientY)}function se($){f.set($.clientX,$.clientY)}function le($){b.set($.clientX,$.clientY),m.subVectors(b,C).multiplyScalar(i.rotateSpeed);const Se=i.domElement;Se&&(U(2*Math.PI*m.x/Se.clientHeight),O(2*Math.PI*m.y/Se.clientHeight)),C.copy(b),i.update()}function ae($){G.set($.clientX,$.clientY),R.subVectors(G,B),R.y>0?L(_()):R.y<0&&V(_()),B.copy(G),i.update()}function ce($){p.set($.clientX,$.clientY),v.subVectors(p,f).multiplyScalar(i.panSpeed),N(v.x,v.y),f.copy(p),i.update()}function Ee($){M($),$.deltaY<0?V(_()):$.deltaY>0&&L(_()),i.update()}function Fe($){let Se=!1;switch($.code){case i.keys.UP:N(0,i.keyPanSpeed),Se=!0;break;case i.keys.BOTTOM:N(0,-i.keyPanSpeed),Se=!0;break;case i.keys.LEFT:N(i.keyPanSpeed,0),Se=!0;break;case i.keys.RIGHT:N(-i.keyPanSpeed,0),Se=!0;break}Se&&($.preventDefault(),i.update())}function oe(){if(W.length==1)C.set(W[0].pageX,W[0].pageY);else{const $=.5*(W[0].pageX+W[1].pageX),Se=.5*(W[0].pageY+W[1].pageY);C.set($,Se)}}function D(){if(W.length==1)f.set(W[0].pageX,W[0].pageY);else{const $=.5*(W[0].pageX+W[1].pageX),Se=.5*(W[0].pageY+W[1].pageY);f.set($,Se)}}function fe(){const $=W[0].pageX-W[1].pageX,Se=W[0].pageY-W[1].pageY,Ke=Math.sqrt($*$+Se*Se);B.set(0,Ke)}function Ce(){i.enableZoom&&fe(),i.enablePan&&D()}function pe(){i.enableZoom&&fe(),i.enableRotate&&oe()}function be($){if(W.length==1)b.set($.pageX,$.pageY);else{const Ke=ke($),q=.5*($.pageX+Ke.x),He=.5*($.pageY+Ke.y);b.set(q,He)}m.subVectors(b,C).multiplyScalar(i.rotateSpeed);const Se=i.domElement;Se&&(U(2*Math.PI*m.x/Se.clientHeight),O(2*Math.PI*m.y/Se.clientHeight)),C.copy(b)}function Ue($){if(W.length==1)p.set($.pageX,$.pageY);else{const Se=ke($),Ke=.5*($.pageX+Se.x),q=.5*($.pageY+Se.y);p.set(Ke,q)}v.subVectors(p,f).multiplyScalar(i.panSpeed),N(v.x,v.y),f.copy(p)}function me($){const Se=ke($),Ke=$.pageX-Se.x,q=$.pageY-Se.y,He=Math.sqrt(Ke*Ke+q*q);G.set(0,He),R.set(0,Math.pow(G.y/B.y,i.zoomSpeed)),L(R.y),B.copy(G)}function we($){i.enableZoom&&me($),i.enablePan&&Ue($)}function Be($){i.enableZoom&&me($),i.enableRotate&&be($)}function Ae($){var Se,Ke;i.enabled!==!1&&(W.length===0&&((Se=i.domElement)==null||Se.ownerDocument.addEventListener("pointermove",De),(Ke=i.domElement)==null||Ke.ownerDocument.addEventListener("pointerup",Q)),ze($),$.pointerType==="touch"?Je($):ge($))}function De($){i.enabled!==!1&&($.pointerType==="touch"?Ye($):Le($))}function Q($){var Se,Ke,q;je($),W.length===0&&((Se=i.domElement)==null||Se.releasePointerCapture($.pointerId),(Ke=i.domElement)==null||Ke.ownerDocument.removeEventListener("pointermove",De),(q=i.domElement)==null||q.ownerDocument.removeEventListener("pointerup",Q)),i.dispatchEvent(o),l=a.NONE}function K($){je($)}function ge($){let Se;switch($.button){case 0:Se=i.mouseButtons.LEFT;break;case 1:Se=i.mouseButtons.MIDDLE;break;case 2:Se=i.mouseButtons.RIGHT;break;default:Se=-1}switch(Se){case Iu.DOLLY:if(i.enableZoom===!1)return;re($),l=a.DOLLY;break;case Iu.ROTATE:if($.ctrlKey||$.metaKey||$.shiftKey){if(i.enablePan===!1)return;se($),l=a.PAN}else{if(i.enableRotate===!1)return;J($),l=a.ROTATE}break;case Iu.PAN:if($.ctrlKey||$.metaKey||$.shiftKey){if(i.enableRotate===!1)return;J($),l=a.ROTATE}else{if(i.enablePan===!1)return;se($),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(s)}function Le($){if(i.enabled!==!1)switch(l){case a.ROTATE:if(i.enableRotate===!1)return;le($);break;case a.DOLLY:if(i.enableZoom===!1)return;ae($);break;case a.PAN:if(i.enablePan===!1)return;ce($);break}}function Re($){i.enabled===!1||i.enableZoom===!1||l!==a.NONE&&l!==a.ROTATE||($.preventDefault(),i.dispatchEvent(s),Ee($),i.dispatchEvent(o))}function Ze($){i.enabled===!1||i.enablePan===!1||Fe($)}function Je($){switch(Pe($),W.length){case 1:switch(i.touches.ONE){case du.ROTATE:if(i.enableRotate===!1)return;oe(),l=a.TOUCH_ROTATE;break;case du.PAN:if(i.enablePan===!1)return;D(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(i.touches.TWO){case du.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Ce(),l=a.TOUCH_DOLLY_PAN;break;case du.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;pe(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(s)}function Ye($){switch(Pe($),l){case a.TOUCH_ROTATE:if(i.enableRotate===!1)return;be($),i.update();break;case a.TOUCH_PAN:if(i.enablePan===!1)return;Ue($),i.update();break;case a.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;we($),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Be($),i.update();break;default:l=a.NONE}}function de($){i.enabled!==!1&&$.preventDefault()}function ze($){W.push($)}function je($){delete T[$.pointerId];for(let Se=0;Se<W.length;Se++)if(W[Se].pointerId==$.pointerId){W.splice(Se,1);return}}function Pe($){let Se=T[$.pointerId];Se===void 0&&(Se=new xe,T[$.pointerId]=Se),Se.set($.pageX,$.pageY)}function ke($){const Se=$.pointerId===W[0].pointerId?W[1]:W[0];return T[Se.pointerId]}n!==void 0&&this.connect(n),this.update()}};class ry{constructor(){Oe(this,"enabled",!0),Oe(this,"needsSwap",!0),Oe(this,"clear",!1),Oe(this,"renderToScreen",!1)}setSize(e,n){}render(e,n,i,r,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}class sy{constructor(e){Oe(this,"camera",new Zo(-1,1,1,-1,0,1)),Oe(this,"geometry",new cg(2,2)),Oe(this,"mesh"),this.mesh=new pn(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}const el={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	gl_FragColor = opacity * texel;","}"].join(`
`)},qh={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new xe},cameraProjectionMatrix:{value:new dt},cameraInverseProjectionMatrix:{value:new dt},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","	return texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","	#if PERSPECTIVE_CAMERA == 1","		float fragCoordZ = texture2D( tDepth, screenPosition ).x;","		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","	#else","		return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","		return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","		return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","	clipPosition *= clipW; // unprojection.","	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","	float depth = getDepth( vUv );","	float viewZ = getViewZ( depth );","	vec3 viewPosition = getViewPosition( vUv, depth, viewZ );","	vec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","	vec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","	vec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","	vec3 bitangent = cross( viewNormal, tangent );","	mat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","		vec3 sampleVector = kernelMatrix * kernel[ i ];","		vec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","		vec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","		samplePointNDC /= samplePointNDC.w;","		vec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","		float realDepth = getLinearDepth( samplePointUv );","		float sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","		float delta = sampleDepth - realDepth;","		if ( delta > minDistance && delta < maxDistance ) {","			occlusion += 1.0;","		}","	}","	occlusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","	gl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join(`
`)},h2={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","	#if PERSPECTIVE_CAMERA == 1","		float fragCoordZ = texture2D( tDepth, screenPosition ).x;","		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","	#else","		return texture2D( tDepth, screenPosition ).x;","	#endif","}","void main() {","	float depth = getLinearDepth( vUv );","	gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join(`
`)},C2={uniforms:{tDiffuse:{value:null},resolution:{value:new xe}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","	vec2 texelSize = ( 1.0 / resolution );","	float result = 0.0;","	for ( int i = - 2; i <= 2; i ++ ) {","		for ( int j = - 2; j <= 2; j ++ ) {","			vec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","			result += texture2D( tDiffuse, vUv + offset ).r;","		}","	}","	gl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join(`
`)},Cu=class extends ry{constructor(t,e,n,i){super(),this.width=n!==void 0?n:512,this.height=i!==void 0?i:512,this.clear=!0,this.camera=e,this.scene=t,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();const r=new zA;r.format=hc,r.type=Ol,this.beautyRenderTarget=new En(this.width,this.height),this.normalRenderTarget=new En(this.width,this.height,{minFilter:Vt,magFilter:Vt,depthTexture:r}),this.ssaoRenderTarget=new En(this.width,this.height),this.blurRenderTarget=this.ssaoRenderTarget.clone(),qh===void 0&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new an({defines:Object.assign({},qh.defines),uniforms:Pn.clone(qh.uniforms),vertexShader:qh.vertexShader,fragmentShader:qh.fragmentShader,blending:tn}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new Z0,this.normalMaterial.blending=tn,this.blurMaterial=new an({defines:Object.assign({},C2.defines),uniforms:Pn.clone(C2.uniforms),vertexShader:C2.vertexShader,fragmentShader:C2.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new an({defines:Object.assign({},h2.defines),uniforms:Pn.clone(h2.uniforms),vertexShader:h2.vertexShader,fragmentShader:h2.fragmentShader,blending:tn}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new an({uniforms:Pn.clone(el.uniforms),vertexShader:el.vertexShader,fragmentShader:el.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:Bv,blendDst:bA,blendEquation:Os,blendSrcAlpha:yv,blendDstAlpha:bA,blendEquationAlpha:Os}),this.fsQuad=new sy(null),this.originalClearColor=new et}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(t.capabilities.isWebGL2===!1&&(this.noiseTexture.format=tx),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.output){case Cu.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Cu.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Cu.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Cu.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case Cu.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Cu.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=Gf,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(t,e,n,i,r){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,i!=null&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderOverride(t,e,n,i,r){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,i=e.clearColor||i,r=e.clearAlpha||r,i!=null&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}setSize(t,e){this.width=t,this.height=e,this.beautyRenderTarget.setSize(t,e),this.ssaoRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.ssaoMaterial.uniforms.resolution.value.set(t,e),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e)}generateSampleKernel(){const t=this.kernelSize,e=this.kernel;for(let n=0;n<t;n++){const i=new P;i.x=Math.random()*2-1,i.y=Math.random()*2-1,i.z=Math.random(),i.normalize();let r=n/t;r=ac.lerp(.1,1,r*r),i.multiplyScalar(r),e.push(i)}}generateRandomKernelRotations(){_C===void 0&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");const n=new _C,i=4*4,r=new Float32Array(i);for(let s=0;s<i;s++){const o=Math.random()*2-1,a=Math.random()*2-1,l=0;r[s]=n.noise3d(o,a,l)}this.noiseTexture=new ja(r,4,4,Eu,es),this.noiseTexture.wrapS=ng,this.noiseTexture.wrapT=ng,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse(function(n){e.set(n,n.visible),(n.isPoints||n.isLine)&&(n.visible=!1)})}restoreVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse(function(n){const i=e.get(n);n.visible=i}),e.clear()}};let TAe=Cu;Oe(TAe,"OUTPUT",{Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5});const FAe={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new et(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	vec3 luma = vec3( 0.299, 0.587, 0.114 );","	float v = dot( texel.xyz, luma );","	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","	gl_FragColor = mix( outputColor, texel, alpha );","}"].join(`
`)},RS=class extends ry{constructor(t,e,n,i){super(),this.strength=e!==void 0?e:1,this.radius=n,this.threshold=i,this.resolution=t!==void 0?new xe(t.x,t.y):new xe(256,256),this.clearColor=new et(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let r=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new En(r,s,{type:Ri}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let c=0;c<this.nMips;c++){const u=new En(r,s,{type:Ri});u.texture.name="UnrealBloomPass.h"+c,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);const I=new En(r,s,{type:Ri});I.texture.name="UnrealBloomPass.v"+c,I.texture.generateMipmaps=!1,this.renderTargetsVertical.push(I),r=Math.round(r/2),s=Math.round(s/2)}const o=FAe;this.highPassUniforms=Pn.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new an({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const a=[3,5,7,9,11];r=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let c=0;c<this.nMips;c++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(a[c])),this.separableBlurMaterials[c].uniforms.texSize.value=new xe(r,s),r=Math.round(r/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const l=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=l,this.bloomTintColors=[new P(1,1,1),new P(1,1,1),new P(1,1,1),new P(1,1,1),new P(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const g=el;this.copyUniforms=Pn.clone(g.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new an({uniforms:this.copyUniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:Bf,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new et,this.oldClearAlpha=1,this.basic=new to,this.fsQuad=new sy(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(let t=0;t<this.separableBlurMaterials.length;t++)this.separableBlurMaterials[t].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(t,e){let n=Math.round(t/2),i=Math.round(e/2);this.renderTargetBright.setSize(n,i);for(let r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(n,i),this.renderTargetsVertical[r].setSize(n,i),this.separableBlurMaterials[r].uniforms.texSize.value=new xe(n,i),n=Math.round(n/2),i=Math.round(i/2)}render(t,e,n,i,r){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const s=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),r&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let o=this.renderTargetBright;for(let a=0;a<this.nMips;a++)this.fsQuad.material=this.separableBlurMaterials[a],this.separableBlurMaterials[a].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[a].uniforms.direction.value=RS.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[a]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurMaterials[a].uniforms.direction.value=RS.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[a]),t.clear(),this.fsQuad.render(t),o=this.renderTargetsVertical[a];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=s}getSeperableBlurMaterial(t){return new an({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new xe(.5,.5)},direction:{value:new xe(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(t){return new an({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let uY=RS;Oe(uY,"BlurDirectionX",new xe(1,0));Oe(uY,"BlurDirectionY",new xe(0,1));const f2={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new xe(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new dt},cameraInverseProjectionMatrix:{value:new dt},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","	#if DIFFUSE_TEXTURE == 1","	return texture2D( tDiffuse, vUv );","	#else","	return vec4( 1.0 );","	#endif","}","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","	clipPosition *= clipW; // unprojection.","	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","	#if NORMAL_TEXTURE == 1","	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","	#else","	return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","	#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","	vec3 viewDelta = sampleViewPosition - centerViewPosition;","	float viewDistance = length( viewDelta );","	float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","	return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","	// precompute some variables require in getOcclusion.","	scaleDividedByCameraFar = scale / cameraFar;","	minResolutionMultipliedByCameraFar = minResolution * cameraFar;","	vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","	// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","	float angle = rand( vUv + randomSeed ) * PI2;","	vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","	vec2 radiusStep = radius;","	float occlusionSum = 0.0;","	float weightSum = 0.0;","	for( int i = 0; i < NUM_SAMPLES; i ++ ) {","		vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","		radius += radiusStep;","		angle += ANGLE_STEP;","		float sampleDepth = getDepth( sampleUv );","		if( sampleDepth >= ( 1.0 - EPSILON ) ) {","			continue;","		}","		float sampleViewZ = getViewZ( sampleDepth );","		vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","		occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","		weightSum += 1.0;","	}","	if( weightSum == 0.0 ) discard;","	return occlusionSum * ( intensity / weightSum );","}","void main() {","	float centerDepth = getDepth( vUv );","	if( centerDepth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = getViewZ( centerDepth );","	vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","	float ambientOcclusion = getAmbientOcclusion( viewPosition );","	gl_FragColor = getDefaultColor( vUv );","	gl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join(`
`)},Mg={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new xe(512,512)},sampleUvOffsets:{value:[new xe(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","	vUv = uv;","	vInvSize = 1.0 / size;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","void main() {","	float depth = getDepth( vUv );","	if( depth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = -getViewZ( depth );","	bool rBreak = false, lBreak = false;","	float weightSum = sampleWeights[0];","	vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","	for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","		float sampleWeight = sampleWeights[i];","		vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","		vec2 sampleUv = vUv + sampleUvOffset;","		float viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","		if( ! rBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","		sampleUv = vUv - sampleUvOffset;","		viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","		if( ! lBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","	}","	gl_FragColor = diffuseSum / weightSum;","}"].join(`
`)},wb={createSampleWeights:(t,e)=>{const n=(r,s)=>Math.exp(-(r*r)/(2*(s*s)))/(Math.sqrt(2*Math.PI)*s),i=[];for(let r=0;r<=t;r++)i.push(n(r,e));return i},createSampleOffsets:(t,e)=>{const n=[];for(let i=0;i<=t;i++)n.push(e.clone().multiplyScalar(i));return n},configure:(t,e,n,i)=>{t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=wb.createSampleOffsets(e,i),t.uniforms.sampleWeights.value=wb.createSampleWeights(e,n),t.needsUpdate=!0}};class VAe extends ry{constructor(e,n,i=!1,r=!1,s=new xe(256,256)){super(),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=i,this.supportsNormalTexture=r,this.originalClearColor=new et,this._oldClearColor=new et,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new xe(s.x,s.y),this.saoRenderTarget=new En(this.resolution.x,this.resolution.y,{type:Ri}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new En(this.resolution.x,this.resolution.y,{minFilter:Vt,magFilter:Vt,type:Ri}),this.depthRenderTarget=this.normalRenderTarget.clone();let o;this.supportsDepthTextureExtension&&(o=new zA,o.type=mI,this.beautyRenderTarget.depthTexture=o,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new S0,this.depthMaterial.depthPacking=Rv,this.depthMaterial.blending=tn,this.normalMaterial=new Z0,this.normalMaterial.blending=tn,this.saoMaterial=new an({defines:Object.assign({},f2.defines),fragmentShader:f2.fragmentShader,vertexShader:f2.vertexShader,uniforms:Pn.clone(f2.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=tn,this.vBlurMaterial=new an({uniforms:Pn.clone(Mg.uniforms),defines:Object.assign({},Mg.defines),vertexShader:Mg.vertexShader,fragmentShader:Mg.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=tn,this.hBlurMaterial=new an({uniforms:Pn.clone(Mg.uniforms),defines:Object.assign({},Mg.defines),vertexShader:Mg.vertexShader,fragmentShader:Mg.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=tn,this.materialCopy=new an({uniforms:Pn.clone(el.uniforms),vertexShader:el.vertexShader,fragmentShader:el.fragmentShader,blending:tn}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=Gf,this.materialCopy.blendSrc=Bv,this.materialCopy.blendDst=bA,this.materialCopy.blendEquation=Os,this.materialCopy.blendSrcAlpha=yv,this.materialCopy.blendDstAlpha=bA,this.materialCopy.blendEquationAlpha=Os,this.depthCopy=new an({uniforms:Pn.clone(NB.uniforms),vertexShader:NB.vertexShader,fragmentShader:NB.fragmentShader,blending:tn}),this.fsQuad=new sy(null)}render(e,n,i){if(this.renderToScreen&&(this.materialCopy.blending=tn,this.materialCopy.uniforms.tDiffuse.value=i.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),this.params.output===1)return;e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const r=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const s=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=s,this.hBlurMaterial.uniforms.depthCutoff.value=s,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(wb.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new xe(0,1)),wb.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new xe(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let o=this.materialCopy;this.params.output===3?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,o=this.depthCopy):this.params.output===4?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===0?o.blending=Gf:o.blending=tn,this.renderPass(e,o,this.renderToScreen?null:i),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=r}renderPass(e,n,i,r,s){e.getClearColor(this.originalClearColor);const o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,r!=null&&(e.setClearColor(r),e.setClearAlpha(s||0),e.clear()),this.fsQuad.material=n,this.fsQuad.render(e),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)}renderOverride(e,n,i,r,s){e.getClearColor(this.originalClearColor);const o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,r=n.clearColor||r,s=n.clearAlpha||s,r!=null&&(e.setClearColor(r),e.setClearAlpha(s||0),e.clear()),this.scene.overrideMaterial=n,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)}setSize(e,n){this.beautyRenderTarget.setSize(e,n),this.saoRenderTarget.setSize(e,n),this.blurIntermediateRenderTarget.setSize(e,n),this.normalRenderTarget.setSize(e,n),this.depthRenderTarget.setSize(e,n),this.saoMaterial.uniforms.size.value.set(e,n),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,n),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,n),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.depthRenderTarget.dispose(),this.depthMaterial.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.depthCopy.dispose(),this.fsQuad.dispose()}}Oe(VAe,"OUTPUT",{Beauty:1,Default:0,SAO:2,Depth:3,Normal:4});const Ya={defines:{MAX_STEP:0,isPerspectiveCamera:!0,isDistanceAttenuation:!0,isFresnel:!0,isInfiniteThick:!1,isSelective:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new xe},cameraProjectionMatrix:{value:new dt},cameraInverseProjectionMatrix:{value:new dt},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},surfDist:{value:.007},thickTolerance:{value:.03}},vertexShader:`

    varying vec2 vUv;

    void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float surfDist;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		uniform float thickTolerance;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef isPerspectiveCamera
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef isSelective
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef isPerspectiveCamera
				vec3 viewIncidenceDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#else
				vec3 viewIncidenceDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidenceDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef isPerspectiveCamera
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<MAX_STEP;i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef isPerspectiveCamera
					// https://www.comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
					float sD=surfDist*cW;
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
					float sD=surfDist;
				#endif
				if(viewReflectRayZ-sD>vZ) continue;

				#ifdef isInfiniteThick
					if(viewReflectRayZ+thickTolerance*clipW<vP.z) break;
				#endif
				float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

				float op=opacity;

				if(away<sD){
					vec3 vN=getViewNormal( uv );
					if(dot(viewReflectDir,vN)>=0.) continue;
					float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
					if(distance>maxDistance) break;
					#ifdef isDistanceAttenuation
						float ratio=1.-(distance/maxDistance);
						float attenuation=ratio*ratio;
						op=opacity*attenuation;
					#endif
					#ifdef isFresnel
						float fresnel=(dot(viewIncidenceDir,viewReflectDir)+1.)/2.;
						op*=fresnel;
					#endif
					vec4 reflectColor=texture2D(tDiffuse,uv);
					gl_FragColor.xyz=reflectColor.xyz;
					gl_FragColor.a=op;
					break;
				}
			}
		}
	`},p2={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDepth;

    uniform float cameraNear;
    uniform float cameraFar;

    varying vec2 vUv;

    #include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

    void main() {

    	float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
    	gl_FragColor = vec4( vec3( d ), 1.0 );

    }

  `},Tg={uniforms:{tDiffuse:{value:null},resolution:{value:new xe},opacity:{value:.5}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    varying vec2 vUv;
    void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

    	vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`},fu=class extends ry{constructor({renderer:t,scene:e,camera:n,width:i,height:r,selects:s,bouncing:o=!1,groundReflector:a}){super(),this.width=i!==void 0?i:512,this.height=r!==void 0?r:512,this.clear=!0,this.renderer=t,this.scene=e,this.camera=n,this.groundReflector=a,this.opacity=Ya.uniforms.opacity.value,this.output=0,this.maxDistance=Ya.uniforms.maxDistance.value,this.thickness=Ya.uniforms.thickness.value,this.tempColor=new et,this._selects=s,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(g){this._selects!==g&&(this._selects=g,Array.isArray(g)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=o,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(g){this._bouncing!==g&&(this._bouncing=g,g?this.ssrMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture:this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=Ya.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(g){this._distanceAttenuation!==g&&(this._distanceAttenuation=g,this.ssrMaterial.defines.DISTANCE_ATTENUATION=g,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=Ya.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(g){this._fresnel!==g&&(this._fresnel=g,this.ssrMaterial.defines.FRESNEL=g,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=Ya.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(g){this._infiniteThick!==g&&(this._infiniteThick=g,this.ssrMaterial.defines.INFINITE_THICK=g,this.ssrMaterial.needsUpdate=!0)}});const l=new zA;l.type=mI,l.minFilter=Vt,l.magFilter=Vt,this.beautyRenderTarget=new En(this.width,this.height,{minFilter:Vt,magFilter:Vt,type:Ri,depthTexture:l,depthBuffer:!0}),this.prevRenderTarget=new En(this.width,this.height,{minFilter:Vt,magFilter:Vt}),this.normalRenderTarget=new En(this.width,this.height,{minFilter:Vt,magFilter:Vt,type:Ri}),this.metalnessRenderTarget=new En(this.width,this.height,{minFilter:Vt,magFilter:Vt,type:Ri}),this.ssrRenderTarget=new En(this.width,this.height,{minFilter:Vt,magFilter:Vt}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new an({defines:Object.assign({},Ya.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:Pn.clone(Ya.uniforms),vertexShader:Ya.vertexShader,fragmentShader:Ya.fragmentShader,blending:tn}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new Z0,this.normalMaterial.blending=tn,this.metalnessOnMaterial=new to({color:"white"}),this.metalnessOffMaterial=new to({color:"black"}),this.blurMaterial=new an({defines:Object.assign({},Tg.defines),uniforms:Pn.clone(Tg.uniforms),vertexShader:Tg.vertexShader,fragmentShader:Tg.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new an({defines:Object.assign({},Tg.defines),uniforms:Pn.clone(Tg.uniforms),vertexShader:Tg.vertexShader,fragmentShader:Tg.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new an({defines:Object.assign({},p2.defines),uniforms:Pn.clone(p2.uniforms),vertexShader:p2.vertexShader,fragmentShader:p2.fragmentShader,blending:tn}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new an({uniforms:Pn.clone(el.uniforms),vertexShader:el.vertexShader,fragmentShader:el.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:Sf,blendDst:wf,blendEquation:Os,blendSrcAlpha:Sf,blendDstAlpha:wf,blendEquationAlpha:Os}),this.fsQuad=new sy(null),this.originalClearColor=new et}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(t.setRenderTarget(this.beautyRenderTarget),t.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),t.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(t,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(t,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.renderPass(t,this.blurMaterial2,this.blurRenderTarget2)),this.output){case fu.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=Ja,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=Ja,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e));break;case fu.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=Ja,this.renderPass(t,this.copyMaterial,this.prevRenderTarget));break;case fu.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case fu.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case fu.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case fu.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=tn,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}renderPass(t,e,n,i,r){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,i!=null&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderOverride(t,e,n,i,r){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,i=e.clearColor||i,r=e.clearAlpha||r,i!=null&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderMetalness(t,e,n,i,r){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,i=e.clearColor||i,r=e.clearAlpha||r,i!=null&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.scene.traverseVisible(a=>{a._SSRPassBackupMaterial=a.material,this._selects.includes(a)?a.material=this.metalnessOnMaterial:a.material=this.metalnessOffMaterial}),t.render(this.scene,this.camera),this.scene.traverseVisible(a=>{a.material=a._SSRPassBackupMaterial}),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}setSize(t,e){this.width=t,this.height=e,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(t*t+e*e),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(t,e),this.prevRenderTarget.setSize(t,e),this.ssrRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.metalnessRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.blurRenderTarget2.setSize(t,e),this.ssrMaterial.uniforms.resolution.value.set(t,e),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e),this.blurMaterial2.uniforms.resolution.value.set(t,e)}};let LAe=fu;Oe(LAe,"OUTPUT",{Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7});const xS=class{static createButton(t,e={}){const n=document.createElement("button");function i(){let a=null;async function l(c){c.addEventListener("end",g),await t.xr.setSession(c),n.textContent="EXIT VR",a=c}function g(){a.removeEventListener("end",g),n.textContent="ENTER VR",a=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=()=>{n.style.opacity="1.0"},n.onmouseleave=()=>{n.style.opacity="0.5"},n.onclick=()=>{var c;if(a===null){const u=[e.optionalFeatures,"local-floor","bounded-floor","hand-tracking"].flat().filter(Boolean);(c=navigator.xr)==null||c.requestSession("immersive-vr",{...e,optionalFeatures:u}).then(l)}else a.end()}}function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function s(){r(),n.textContent="VR NOT SUPPORTED"}function o(a){a.style.position="absolute",a.style.bottom="20px",a.style.padding="12px 6px",a.style.border="1px solid #fff",a.style.borderRadius="4px",a.style.background="rgba(0,0,0,0.1)",a.style.color="#fff",a.style.font="normal 13px sans-serif",a.style.textAlign="center",a.style.opacity="0.5",a.style.outline="none",a.style.zIndex="999"}if("xr"in navigator)return o(n),n.id="VRButton",n.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(a=>{a?i():s(),a&&xS.xrSessionIsGranted&&n.click()}),n;{const a=document.createElement("a");return window.isSecureContext===!1?(a.href=document.location.href.replace(/^http:/,"https:"),a.innerHTML="WEBXR NEEDS HTTPS"):(a.href="https://immersiveweb.dev/",a.innerHTML="WEBXR NOT AVAILABLE"),a.style.left="calc(50% - 90px)",a.style.width="180px",a.style.textDecoration="none",o(a),a}}static registerSessionGrantedListener(){"xr"in navigator&&navigator.xr.addEventListener("sessiongranted",()=>{xS.xrSessionIsGranted=!0})}};let kAe=xS;Oe(kAe,"xrSessionIsGranted",!1);class IY{constructor(e){Oe(this,"data"),this.data=e}generateShapes(e,n=100,i){const r=[],s={letterSpacing:0,lineHeight:1,...i},o=HAe(e,n,this.data,s);for(let a=0,l=o.length;a<l;a++)Array.prototype.push.apply(r,o[a].toShapes(!1));return r}}Oe(IY,"isFont");Oe(IY,"type");function HAe(t,e,n,i){const r=Array.from(t),s=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,a=[];let l=0,g=0;for(let c=0;c<r.length;c++){const u=r[c];if(u===`
`)l=0,g-=o*i.lineHeight;else{const I=_Ae(u,s,l,g,n);I&&(l+=I.offsetX+i.letterSpacing,a.push(I.path))}}return a}function _Ae(t,e,n,i,r){const s=r.glyphs[t]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");return}const o=new w_;let a,l,g,c,u,I,h,C;if(s.o){const b=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let m=0,f=b.length;m<f;)switch(b[m++]){case"m":a=parseInt(b[m++])*e+n,l=parseInt(b[m++])*e+i,o.moveTo(a,l);break;case"l":a=parseInt(b[m++])*e+n,l=parseInt(b[m++])*e+i,o.lineTo(a,l);break;case"q":g=parseInt(b[m++])*e+n,c=parseInt(b[m++])*e+i,u=parseInt(b[m++])*e+n,I=parseInt(b[m++])*e+i,o.quadraticCurveTo(u,I,g,c);break;case"b":g=parseInt(b[m++])*e+n,c=parseInt(b[m++])*e+i,u=parseInt(b[m++])*e+n,I=parseInt(b[m++])*e+i,h=parseInt(b[m++])*e+n,C=parseInt(b[m++])*e+i,o.bezierCurveTo(u,I,h,C,g,c);break}}return{offsetX:s.ha*e,path:o}}class XAe extends ei{constructor(e=null,n=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=Vt,this.minFilter=Vt,this.wrapR=Ci,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var YAe=typeof global=="object"&&global&&global.Object===Object&&global;const dY=YAe;var KAe=typeof self=="object"&&self&&self.Object===Object&&self,zAe=dY||KAe||Function("return this")();const ll=zAe;var UAe=ll.Symbol;const Vo=UAe;var AY=Object.prototype,DAe=AY.hasOwnProperty,PAe=AY.toString,$h=Vo?Vo.toStringTag:void 0;function OAe(t){var e=DAe.call(t,$h),n=t[$h];try{t[$h]=void 0;var i=!0}catch{}var r=PAe.call(t);return i&&(e?t[$h]=n:delete t[$h]),r}var QAe=Object.prototype,JAe=QAe.toString;function jAe(t){return JAe.call(t)}var qAe="[object Null]",$Ae="[object Undefined]",hM=Vo?Vo.toStringTag:void 0;function Wc(t){return t==null?t===void 0?$Ae:qAe:hM&&hM in Object(t)?OAe(t):jAe(t)}function ma(t){return t!=null&&typeof t=="object"}var ehe="[object Symbol]";function oy(t){return typeof t=="symbol"||ma(t)&&Wc(t)==ehe}function k0(t,e){for(var n=-1,i=t==null?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}var the=Array.isArray;const un=the;var nhe=1/0,CM=Vo?Vo.prototype:void 0,fM=CM?CM.toString:void 0;function hY(t){if(typeof t=="string")return t;if(un(t))return k0(t,hY)+"";if(oy(t))return fM?fM.call(t):"";var e=t+"";return e=="0"&&1/t==-nhe?"-0":e}var ihe=/\s/;function rhe(t){for(var e=t.length;e--&&ihe.test(t.charAt(e)););return e}var she=/^\s+/;function ohe(t){return t&&t.slice(0,rhe(t)+1).replace(she,"")}function Lo(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var pM=0/0,ahe=/^[-+]0x[0-9a-f]+$/i,lhe=/^0b[01]+$/i,ghe=/^0o[0-7]+$/i,che=parseInt;function uhe(t){if(typeof t=="number")return t;if(oy(t))return pM;if(Lo(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Lo(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=ohe(t);var n=lhe.test(t);return n||ghe.test(t)?che(t.slice(2),n?2:8):ahe.test(t)?pM:+t}var mM=1/0,Ihe=17976931348623157e292;function dhe(t){if(!t)return t===0?t:0;if(t=uhe(t),t===mM||t===-mM){var e=t<0?-1:1;return e*Ihe}return t===t?t:0}function H0(t){var e=dhe(t),n=e%1;return e===e?n?e-n:e:0}function SA(t){return t}var Ahe="[object AsyncFunction]",hhe="[object Function]",Che="[object GeneratorFunction]",fhe="[object Proxy]";function Ig(t){if(!Lo(t))return!1;var e=Wc(t);return e==hhe||e==Che||e==Ahe||e==fhe}var phe=ll["__core-js_shared__"];const MB=phe;var bM=function(){var t=/[^.]+$/.exec(MB&&MB.keys&&MB.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function mhe(t){return!!bM&&bM in t}var bhe=Function.prototype,vhe=bhe.toString;function SI(t){if(t!=null){try{return vhe.call(t)}catch{}try{return t+""}catch{}}return""}var yhe=/[\\^$.*+?()[\]{}|]/g,Bhe=/^\[object .+?Constructor\]$/,Ghe=Function.prototype,She=Object.prototype,whe=Ghe.toString,Rhe=She.hasOwnProperty,xhe=RegExp("^"+whe.call(Rhe).replace(yhe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Zhe(t){if(!Lo(t)||mhe(t))return!1;var e=Ig(t)?xhe:Bhe;return e.test(SI(t))}function Ehe(t,e){return t==null?void 0:t[e]}function wI(t,e){var n=Ehe(t,e);return Zhe(n)?n:void 0}var Whe=wI(ll,"WeakMap");const ZS=Whe;var vM=Object.create,Nhe=function(){function t(){}return function(e){if(!Lo(e))return{};if(vM)return vM(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const Mhe=Nhe;function The(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Hi(){}function Fhe(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}var Vhe=800,Lhe=16,khe=Date.now;function Hhe(t){var e=0,n=0;return function(){var i=khe(),r=Lhe-(i-n);if(n=i,r>0){if(++e>=Vhe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function _he(t){return function(){return t}}var Xhe=function(){try{var t=wI(Object,"defineProperty");return t({},"",{}),t}catch{}}();const Rb=Xhe;var Yhe=Rb?function(t,e){return Rb(t,"toString",{configurable:!0,enumerable:!1,value:_he(e),writable:!0})}:SA;const Khe=Yhe;var zhe=Hhe(Khe);const Uhe=zhe;function CY(t,e){for(var n=-1,i=t==null?0:t.length;++n<i&&e(t[n],n,t)!==!1;);return t}function fY(t,e,n,i){for(var r=t.length,s=n+(i?1:-1);i?s--:++s<r;)if(e(t[s],s,t))return s;return-1}function Dhe(t){return t!==t}function Phe(t,e,n){for(var i=n-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}function $x(t,e,n){return e===e?Phe(t,e,n):fY(t,Dhe,n)}function pY(t,e){var n=t==null?0:t.length;return!!n&&$x(t,e,0)>-1}var Ohe=9007199254740991,Qhe=/^(?:0|[1-9]\d*)$/;function ay(t,e){var n=typeof t;return e=e??Ohe,!!e&&(n=="number"||n!="symbol"&&Qhe.test(t))&&t>-1&&t%1==0&&t<e}function eZ(t,e,n){e=="__proto__"&&Rb?Rb(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function _0(t,e){return t===e||t!==t&&e!==e}var Jhe=Object.prototype,jhe=Jhe.hasOwnProperty;function ly(t,e,n){var i=t[e];(!(jhe.call(t,e)&&_0(i,n))||n===void 0&&!(e in t))&&eZ(t,e,n)}function X0(t,e,n,i){var r=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=i?i(n[a],t[a],a,n,t):void 0;l===void 0&&(l=t[a]),r?eZ(n,a,l):ly(n,a,l)}return n}var yM=Math.max;function qhe(t,e,n){return e=yM(e===void 0?t.length-1:e,0),function(){for(var i=arguments,r=-1,s=yM(i.length-e,0),o=Array(s);++r<s;)o[r]=i[e+r];r=-1;for(var a=Array(e+1);++r<e;)a[r]=i[r];return a[e]=n(o),The(t,this,a)}}function tZ(t,e){return Uhe(qhe(t,e,SA),t+"")}var $he=9007199254740991;function nZ(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=$he}function gl(t){return t!=null&&nZ(t.length)&&!Ig(t)}function gy(t,e,n){if(!Lo(n))return!1;var i=typeof e;return(i=="number"?gl(n)&&ay(e,n.length):i=="string"&&e in n)?_0(n[e],t):!1}function eCe(t){return tZ(function(e,n){var i=-1,r=n.length,s=r>1?n[r-1]:void 0,o=r>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(r--,s):void 0,o&&gy(n[0],n[1],o)&&(s=r<3?void 0:s,r=1),e=Object(e);++i<r;){var a=n[i];a&&t(e,a,i,s)}return e})}var tCe=Object.prototype;function Y0(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||tCe;return t===n}function nCe(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}var iCe="[object Arguments]";function BM(t){return ma(t)&&Wc(t)==iCe}var mY=Object.prototype,rCe=mY.hasOwnProperty,sCe=mY.propertyIsEnumerable,oCe=BM(function(){return arguments}())?BM:function(t){return ma(t)&&rCe.call(t,"callee")&&!sCe.call(t,"callee")};const cy=oCe;function aCe(){return!1}var bY=typeof Xe=="object"&&Xe&&!Xe.nodeType&&Xe,GM=bY&&typeof js=="object"&&js&&!js.nodeType&&js,lCe=GM&&GM.exports===bY,SM=lCe?ll.Buffer:void 0,gCe=SM?SM.isBuffer:void 0,cCe=gCe||aCe;const qf=cCe;var uCe="[object Arguments]",ICe="[object Array]",dCe="[object Boolean]",ACe="[object Date]",hCe="[object Error]",CCe="[object Function]",fCe="[object Map]",pCe="[object Number]",mCe="[object Object]",bCe="[object RegExp]",vCe="[object Set]",yCe="[object String]",BCe="[object WeakMap]",GCe="[object ArrayBuffer]",SCe="[object DataView]",wCe="[object Float32Array]",RCe="[object Float64Array]",xCe="[object Int8Array]",ZCe="[object Int16Array]",ECe="[object Int32Array]",WCe="[object Uint8Array]",NCe="[object Uint8ClampedArray]",MCe="[object Uint16Array]",TCe="[object Uint32Array]",Un={};Un[wCe]=Un[RCe]=Un[xCe]=Un[ZCe]=Un[ECe]=Un[WCe]=Un[NCe]=Un[MCe]=Un[TCe]=!0;Un[uCe]=Un[ICe]=Un[GCe]=Un[dCe]=Un[SCe]=Un[ACe]=Un[hCe]=Un[CCe]=Un[fCe]=Un[pCe]=Un[mCe]=Un[bCe]=Un[vCe]=Un[yCe]=Un[BCe]=!1;function FCe(t){return ma(t)&&nZ(t.length)&&!!Un[Wc(t)]}function K0(t){return function(e){return t(e)}}var vY=typeof Xe=="object"&&Xe&&!Xe.nodeType&&Xe,XC=vY&&typeof js=="object"&&js&&!js.nodeType&&js,VCe=XC&&XC.exports===vY,TB=VCe&&dY.process,LCe=function(){try{var t=XC&&XC.require&&XC.require("util").types;return t||TB&&TB.binding&&TB.binding("util")}catch{}}();const mc=LCe;var wM=mc&&mc.isTypedArray,kCe=wM?K0(wM):FCe;const iZ=kCe;var HCe=Object.prototype,_Ce=HCe.hasOwnProperty;function yY(t,e){var n=un(t),i=!n&&cy(t),r=!n&&!i&&qf(t),s=!n&&!i&&!r&&iZ(t),o=n||i||r||s,a=o?nCe(t.length,String):[],l=a.length;for(var g in t)(e||_Ce.call(t,g))&&!(o&&(g=="length"||r&&(g=="offset"||g=="parent")||s&&(g=="buffer"||g=="byteLength"||g=="byteOffset")||ay(g,l)))&&a.push(g);return a}function BY(t,e){return function(n){return t(e(n))}}var XCe=BY(Object.keys,Object);const YCe=XCe;var KCe=Object.prototype,zCe=KCe.hasOwnProperty;function GY(t){if(!Y0(t))return YCe(t);var e=[];for(var n in Object(t))zCe.call(t,n)&&n!="constructor"&&e.push(n);return e}function no(t){return gl(t)?yY(t):GY(t)}var UCe=Object.prototype,DCe=UCe.hasOwnProperty,PCe=eCe(function(t,e){if(Y0(e)||gl(e)){X0(e,no(e),t);return}for(var n in e)DCe.call(e,n)&&ly(t,n,e[n])});const io=PCe;function OCe(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var QCe=Object.prototype,JCe=QCe.hasOwnProperty;function jCe(t){if(!Lo(t))return OCe(t);var e=Y0(t),n=[];for(var i in t)i=="constructor"&&(e||!JCe.call(t,i))||n.push(i);return n}function uy(t){return gl(t)?yY(t,!0):jCe(t)}var qCe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$Ce=/^\w*$/;function rZ(t,e){if(un(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||oy(t)?!0:$Ce.test(t)||!qCe.test(t)||e!=null&&t in Object(e)}var efe=wI(Object,"create");const $f=efe;function tfe(){this.__data__=$f?$f(null):{},this.size=0}function nfe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ife="__lodash_hash_undefined__",rfe=Object.prototype,sfe=rfe.hasOwnProperty;function ofe(t){var e=this.__data__;if($f){var n=e[t];return n===ife?void 0:n}return sfe.call(e,t)?e[t]:void 0}var afe=Object.prototype,lfe=afe.hasOwnProperty;function gfe(t){var e=this.__data__;return $f?e[t]!==void 0:lfe.call(e,t)}var cfe="__lodash_hash_undefined__";function ufe(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=$f&&e===void 0?cfe:e,this}function gI(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}gI.prototype.clear=tfe;gI.prototype.delete=nfe;gI.prototype.get=ofe;gI.prototype.has=gfe;gI.prototype.set=ufe;function Ife(){this.__data__=[],this.size=0}function Iy(t,e){for(var n=t.length;n--;)if(_0(t[n][0],e))return n;return-1}var dfe=Array.prototype,Afe=dfe.splice;function hfe(t){var e=this.__data__,n=Iy(e,t);if(n<0)return!1;var i=e.length-1;return n==i?e.pop():Afe.call(e,n,1),--this.size,!0}function Cfe(t){var e=this.__data__,n=Iy(e,t);return n<0?void 0:e[n][1]}function ffe(t){return Iy(this.__data__,t)>-1}function pfe(t,e){var n=this.__data__,i=Iy(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}function dg(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}dg.prototype.clear=Ife;dg.prototype.delete=hfe;dg.prototype.get=Cfe;dg.prototype.has=ffe;dg.prototype.set=pfe;var mfe=wI(ll,"Map");const e0=mfe;function bfe(){this.size=0,this.__data__={hash:new gI,map:new(e0||dg),string:new gI}}function vfe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function dy(t,e){var n=t.__data__;return vfe(e)?n[typeof e=="string"?"string":"hash"]:n.map}function yfe(t){var e=dy(this,t).delete(t);return this.size-=e?1:0,e}function Bfe(t){return dy(this,t).get(t)}function Gfe(t){return dy(this,t).has(t)}function Sfe(t,e){var n=dy(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}function Ag(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}Ag.prototype.clear=bfe;Ag.prototype.delete=yfe;Ag.prototype.get=Bfe;Ag.prototype.has=Gfe;Ag.prototype.set=Sfe;var wfe="Expected a function";function sZ(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(wfe);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var o=t.apply(this,i);return n.cache=s.set(r,o)||s,o};return n.cache=new(sZ.Cache||Ag),n}sZ.Cache=Ag;var Rfe=500;function xfe(t){var e=sZ(t,function(i){return n.size===Rfe&&n.clear(),i}),n=e.cache;return e}var Zfe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Efe=/\\(\\)?/g,Wfe=xfe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Zfe,function(n,i,r,s){e.push(r?s.replace(Efe,"$1"):i||n)}),e});const Nfe=Wfe;function Mfe(t){return t==null?"":hY(t)}function Ay(t,e){return un(t)?t:rZ(t,e)?[t]:Nfe(Mfe(t))}var Tfe=1/0;function z0(t){if(typeof t=="string"||oy(t))return t;var e=t+"";return e=="0"&&1/t==-Tfe?"-0":e}function oZ(t,e){e=Ay(e,t);for(var n=0,i=e.length;t!=null&&n<i;)t=t[z0(e[n++])];return n&&n==i?t:void 0}function Ffe(t,e,n){var i=t==null?void 0:oZ(t,e);return i===void 0?n:i}function aZ(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}var RM=Vo?Vo.isConcatSpreadable:void 0;function Vfe(t){return un(t)||cy(t)||!!(RM&&t&&t[RM])}function hy(t,e,n,i,r){var s=-1,o=t.length;for(n||(n=Vfe),r||(r=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?hy(a,e-1,n,i,r):aZ(r,a):i||(r[r.length]=a)}return r}function ua(t){var e=t==null?0:t.length;return e?hy(t,1):[]}var Lfe=BY(Object.getPrototypeOf,Object);const SY=Lfe;function wY(t,e,n){var i=-1,r=t.length;e<0&&(e=-e>r?0:r+e),n=n>r?r:n,n<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=t[i+e];return s}function kfe(t,e,n,i){var r=-1,s=t==null?0:t.length;for(i&&s&&(n=t[++r]);++r<s;)n=e(n,t[r],r,t);return n}function Hfe(){this.__data__=new dg,this.size=0}function _fe(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Xfe(t){return this.__data__.get(t)}function Yfe(t){return this.__data__.has(t)}var Kfe=200;function zfe(t,e){var n=this.__data__;if(n instanceof dg){var i=n.__data__;if(!e0||i.length<Kfe-1)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ag(i)}return n.set(t,e),this.size=n.size,this}function tl(t){var e=this.__data__=new dg(t);this.size=e.size}tl.prototype.clear=Hfe;tl.prototype.delete=_fe;tl.prototype.get=Xfe;tl.prototype.has=Yfe;tl.prototype.set=zfe;function Ufe(t,e){return t&&X0(e,no(e),t)}function Dfe(t,e){return t&&X0(e,uy(e),t)}var RY=typeof Xe=="object"&&Xe&&!Xe.nodeType&&Xe,xM=RY&&typeof js=="object"&&js&&!js.nodeType&&js,Pfe=xM&&xM.exports===RY,ZM=Pfe?ll.Buffer:void 0,EM=ZM?ZM.allocUnsafe:void 0;function Ofe(t,e){if(e)return t.slice();var n=t.length,i=EM?EM(n):new t.constructor(n);return t.copy(i),i}function lZ(t,e){for(var n=-1,i=t==null?0:t.length,r=0,s=[];++n<i;){var o=t[n];e(o,n,t)&&(s[r++]=o)}return s}function xY(){return[]}var Qfe=Object.prototype,Jfe=Qfe.propertyIsEnumerable,WM=Object.getOwnPropertySymbols,jfe=WM?function(t){return t==null?[]:(t=Object(t),lZ(WM(t),function(e){return Jfe.call(t,e)}))}:xY;const gZ=jfe;function qfe(t,e){return X0(t,gZ(t),e)}var $fe=Object.getOwnPropertySymbols,e0e=$fe?function(t){for(var e=[];t;)aZ(e,gZ(t)),t=SY(t);return e}:xY;const ZY=e0e;function t0e(t,e){return X0(t,ZY(t),e)}function EY(t,e,n){var i=e(t);return un(t)?i:aZ(i,n(t))}function ES(t){return EY(t,no,gZ)}function WY(t){return EY(t,uy,ZY)}var n0e=wI(ll,"DataView");const WS=n0e;var i0e=wI(ll,"Promise");const NS=i0e;var r0e=wI(ll,"Set");const lA=r0e;var NM="[object Map]",s0e="[object Object]",MM="[object Promise]",TM="[object Set]",FM="[object WeakMap]",VM="[object DataView]",o0e=SI(WS),a0e=SI(e0),l0e=SI(NS),g0e=SI(lA),c0e=SI(ZS),pu=Wc;(WS&&pu(new WS(new ArrayBuffer(1)))!=VM||e0&&pu(new e0)!=NM||NS&&pu(NS.resolve())!=MM||lA&&pu(new lA)!=TM||ZS&&pu(new ZS)!=FM)&&(pu=function(t){var e=Wc(t),n=e==s0e?t.constructor:void 0,i=n?SI(n):"";if(i)switch(i){case o0e:return VM;case a0e:return NM;case l0e:return MM;case g0e:return TM;case c0e:return FM}return e});const wA=pu;var u0e=Object.prototype,I0e=u0e.hasOwnProperty;function d0e(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&I0e.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var A0e=ll.Uint8Array;const xb=A0e;function cZ(t){var e=new t.constructor(t.byteLength);return new xb(e).set(new xb(t)),e}function h0e(t,e){var n=e?cZ(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var C0e=/\w*$/;function f0e(t){var e=new t.constructor(t.source,C0e.exec(t));return e.lastIndex=t.lastIndex,e}var LM=Vo?Vo.prototype:void 0,kM=LM?LM.valueOf:void 0;function p0e(t){return kM?Object(kM.call(t)):{}}function m0e(t,e){var n=e?cZ(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var b0e="[object Boolean]",v0e="[object Date]",y0e="[object Map]",B0e="[object Number]",G0e="[object RegExp]",S0e="[object Set]",w0e="[object String]",R0e="[object Symbol]",x0e="[object ArrayBuffer]",Z0e="[object DataView]",E0e="[object Float32Array]",W0e="[object Float64Array]",N0e="[object Int8Array]",M0e="[object Int16Array]",T0e="[object Int32Array]",F0e="[object Uint8Array]",V0e="[object Uint8ClampedArray]",L0e="[object Uint16Array]",k0e="[object Uint32Array]";function H0e(t,e,n){var i=t.constructor;switch(e){case x0e:return cZ(t);case b0e:case v0e:return new i(+t);case Z0e:return h0e(t,n);case E0e:case W0e:case N0e:case M0e:case T0e:case F0e:case V0e:case L0e:case k0e:return m0e(t,n);case y0e:return new i;case B0e:case w0e:return new i(t);case G0e:return f0e(t);case S0e:return new i;case R0e:return p0e(t)}}function _0e(t){return typeof t.constructor=="function"&&!Y0(t)?Mhe(SY(t)):{}}var X0e="[object Map]";function Y0e(t){return ma(t)&&wA(t)==X0e}var HM=mc&&mc.isMap,K0e=HM?K0(HM):Y0e;const z0e=K0e;var U0e="[object Set]";function D0e(t){return ma(t)&&wA(t)==U0e}var _M=mc&&mc.isSet,P0e=_M?K0(_M):D0e;const O0e=P0e;var Q0e=1,J0e=2,j0e=4,NY="[object Arguments]",q0e="[object Array]",$0e="[object Boolean]",epe="[object Date]",tpe="[object Error]",MY="[object Function]",npe="[object GeneratorFunction]",ipe="[object Map]",rpe="[object Number]",TY="[object Object]",spe="[object RegExp]",ope="[object Set]",ape="[object String]",lpe="[object Symbol]",gpe="[object WeakMap]",cpe="[object ArrayBuffer]",upe="[object DataView]",Ipe="[object Float32Array]",dpe="[object Float64Array]",Ape="[object Int8Array]",hpe="[object Int16Array]",Cpe="[object Int32Array]",fpe="[object Uint8Array]",ppe="[object Uint8ClampedArray]",mpe="[object Uint16Array]",bpe="[object Uint32Array]",Vn={};Vn[NY]=Vn[q0e]=Vn[cpe]=Vn[upe]=Vn[$0e]=Vn[epe]=Vn[Ipe]=Vn[dpe]=Vn[Ape]=Vn[hpe]=Vn[Cpe]=Vn[ipe]=Vn[rpe]=Vn[TY]=Vn[spe]=Vn[ope]=Vn[ape]=Vn[lpe]=Vn[fpe]=Vn[ppe]=Vn[mpe]=Vn[bpe]=!0;Vn[tpe]=Vn[MY]=Vn[gpe]=!1;function o3(t,e,n,i,r,s){var o,a=e&Q0e,l=e&J0e,g=e&j0e;if(n&&(o=r?n(t,i,r,s):n(t)),o!==void 0)return o;if(!Lo(t))return t;var c=un(t);if(c){if(o=d0e(t),!a)return Fhe(t,o)}else{var u=wA(t),I=u==MY||u==npe;if(qf(t))return Ofe(t,a);if(u==TY||u==NY||I&&!r){if(o=l||I?{}:_0e(t),!a)return l?t0e(t,Dfe(o,t)):qfe(t,Ufe(o,t))}else{if(!Vn[u])return r?t:{};o=H0e(t,u,a)}}s||(s=new tl);var h=s.get(t);if(h)return h;s.set(t,o),O0e(t)?t.forEach(function(m){o.add(o3(m,e,n,m,t,s))}):z0e(t)&&t.forEach(function(m,f){o.set(f,o3(m,e,n,f,t,s))});var C=g?l?WY:ES:l?uy:no,b=c?void 0:C(t);return CY(b||t,function(m,f){b&&(f=m,m=t[f]),ly(o,f,o3(m,e,n,f,t,s))}),o}var vpe=4;function Vr(t){return o3(t,vpe)}function U0(t){for(var e=-1,n=t==null?0:t.length,i=0,r=[];++e<n;){var s=t[e];s&&(r[i++]=s)}return r}var ype="__lodash_hash_undefined__";function Bpe(t){return this.__data__.set(t,ype),this}function Gpe(t){return this.__data__.has(t)}function RA(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ag;++e<n;)this.add(t[e])}RA.prototype.add=RA.prototype.push=Bpe;RA.prototype.has=Gpe;function FY(t,e){for(var n=-1,i=t==null?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}function uZ(t,e){return t.has(e)}var Spe=1,wpe=2;function VY(t,e,n,i,r,s){var o=n&Spe,a=t.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var g=s.get(t),c=s.get(e);if(g&&c)return g==e&&c==t;var u=-1,I=!0,h=n&wpe?new RA:void 0;for(s.set(t,e),s.set(e,t);++u<a;){var C=t[u],b=e[u];if(i)var m=o?i(b,C,u,e,t,s):i(C,b,u,t,e,s);if(m!==void 0){if(m)continue;I=!1;break}if(h){if(!FY(e,function(f,p){if(!uZ(h,p)&&(C===f||r(C,f,n,i,s)))return h.push(p)})){I=!1;break}}else if(!(C===b||r(C,b,n,i,s))){I=!1;break}}return s.delete(t),s.delete(e),I}function Rpe(t){var e=-1,n=Array(t.size);return t.forEach(function(i,r){n[++e]=[r,i]}),n}function IZ(t){var e=-1,n=Array(t.size);return t.forEach(function(i){n[++e]=i}),n}var xpe=1,Zpe=2,Epe="[object Boolean]",Wpe="[object Date]",Npe="[object Error]",Mpe="[object Map]",Tpe="[object Number]",Fpe="[object RegExp]",Vpe="[object Set]",Lpe="[object String]",kpe="[object Symbol]",Hpe="[object ArrayBuffer]",_pe="[object DataView]",XM=Vo?Vo.prototype:void 0,FB=XM?XM.valueOf:void 0;function Xpe(t,e,n,i,r,s,o){switch(n){case _pe:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Hpe:return!(t.byteLength!=e.byteLength||!s(new xb(t),new xb(e)));case Epe:case Wpe:case Tpe:return _0(+t,+e);case Npe:return t.name==e.name&&t.message==e.message;case Fpe:case Lpe:return t==e+"";case Mpe:var a=Rpe;case Vpe:var l=i&xpe;if(a||(a=IZ),t.size!=e.size&&!l)return!1;var g=o.get(t);if(g)return g==e;i|=Zpe,o.set(t,e);var c=VY(a(t),a(e),i,r,s,o);return o.delete(t),c;case kpe:if(FB)return FB.call(t)==FB.call(e)}return!1}var Ype=1,Kpe=Object.prototype,zpe=Kpe.hasOwnProperty;function Upe(t,e,n,i,r,s){var o=n&Ype,a=ES(t),l=a.length,g=ES(e),c=g.length;if(l!=c&&!o)return!1;for(var u=l;u--;){var I=a[u];if(!(o?I in e:zpe.call(e,I)))return!1}var h=s.get(t),C=s.get(e);if(h&&C)return h==e&&C==t;var b=!0;s.set(t,e),s.set(e,t);for(var m=o;++u<l;){I=a[u];var f=t[I],p=e[I];if(i)var v=o?i(p,f,I,e,t,s):i(f,p,I,t,e,s);if(!(v===void 0?f===p||r(f,p,n,i,s):v)){b=!1;break}m||(m=I=="constructor")}if(b&&!m){var B=t.constructor,G=e.constructor;B!=G&&"constructor"in t&&"constructor"in e&&!(typeof B=="function"&&B instanceof B&&typeof G=="function"&&G instanceof G)&&(b=!1)}return s.delete(t),s.delete(e),b}var Dpe=1,YM="[object Arguments]",KM="[object Array]",m2="[object Object]",Ppe=Object.prototype,zM=Ppe.hasOwnProperty;function Ope(t,e,n,i,r,s){var o=un(t),a=un(e),l=o?KM:wA(t),g=a?KM:wA(e);l=l==YM?m2:l,g=g==YM?m2:g;var c=l==m2,u=g==m2,I=l==g;if(I&&qf(t)){if(!qf(e))return!1;o=!0,c=!1}if(I&&!c)return s||(s=new tl),o||iZ(t)?VY(t,e,n,i,r,s):Xpe(t,e,l,n,i,r,s);if(!(n&Dpe)){var h=c&&zM.call(t,"__wrapped__"),C=u&&zM.call(e,"__wrapped__");if(h||C){var b=h?t.value():t,m=C?e.value():e;return s||(s=new tl),r(b,m,n,i,s)}}return I?(s||(s=new tl),Upe(t,e,n,i,r,s)):!1}function dZ(t,e,n,i,r){return t===e?!0:t==null||e==null||!ma(t)&&!ma(e)?t!==t&&e!==e:Ope(t,e,n,i,dZ,r)}var Qpe=1,Jpe=2;function jpe(t,e,n,i){var r=n.length,s=r,o=!i;if(t==null)return!s;for(t=Object(t);r--;){var a=n[r];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++r<s;){a=n[r];var l=a[0],g=t[l],c=a[1];if(o&&a[2]){if(g===void 0&&!(l in t))return!1}else{var u=new tl;if(i)var I=i(g,c,l,t,e,u);if(!(I===void 0?dZ(c,g,Qpe|Jpe,i,u):I))return!1}}return!0}function LY(t){return t===t&&!Lo(t)}function qpe(t){for(var e=no(t),n=e.length;n--;){var i=e[n],r=t[i];e[n]=[i,r,LY(r)]}return e}function kY(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function $pe(t){var e=qpe(t);return e.length==1&&e[0][2]?kY(e[0][0],e[0][1]):function(n){return n===t||jpe(n,t,e)}}function eme(t,e){return t!=null&&e in Object(t)}function HY(t,e,n){e=Ay(e,t);for(var i=-1,r=e.length,s=!1;++i<r;){var o=z0(e[i]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++i!=r?s:(r=t==null?0:t.length,!!r&&nZ(r)&&ay(o,r)&&(un(t)||cy(t)))}function tme(t,e){return t!=null&&HY(t,e,eme)}var nme=1,ime=2;function rme(t,e){return rZ(t)&&LY(e)?kY(z0(t),e):function(n){var i=Ffe(n,t);return i===void 0&&i===e?tme(n,t):dZ(e,i,nme|ime)}}function sme(t){return function(e){return e==null?void 0:e[t]}}function ome(t){return function(e){return oZ(e,t)}}function ame(t){return rZ(t)?sme(z0(t)):ome(t)}function cl(t){return typeof t=="function"?t:t==null?SA:typeof t=="object"?un(t)?rme(t[0],t[1]):$pe(t):ame(t)}function lme(t,e,n,i){for(var r=-1,s=t==null?0:t.length;++r<s;){var o=t[r];e(i,o,n(o),t)}return i}function gme(t){return function(e,n,i){for(var r=-1,s=Object(e),o=i(e),a=o.length;a--;){var l=o[t?a:++r];if(n(s[l],l,s)===!1)break}return e}}var cme=gme();const ume=cme;function Ime(t,e){return t&&ume(t,e,no)}function dme(t,e){return function(n,i){if(n==null)return n;if(!gl(n))return t(n,i);for(var r=n.length,s=e?r:-1,o=Object(n);(e?s--:++s<r)&&i(o[s],s,o)!==!1;);return n}}var Ame=dme(Ime);const RI=Ame;function hme(t,e,n,i){return RI(t,function(r,s,o){e(i,r,n(r),o)}),i}function Cme(t,e){return function(n,i){var r=un(n)?lme:hme,s=e?e():{};return r(n,t,cl(i),s)}}var _Y=Object.prototype,fme=_Y.hasOwnProperty,pme=tZ(function(t,e){t=Object(t);var n=-1,i=e.length,r=i>2?e[2]:void 0;for(r&&gy(e[0],e[1],r)&&(i=1);++n<i;)for(var s=e[n],o=uy(s),a=-1,l=o.length;++a<l;){var g=o[a],c=t[g];(c===void 0||_0(c,_Y[g])&&!fme.call(t,g))&&(t[g]=s[g])}return t});const AZ=pme;function UM(t){return ma(t)&&gl(t)}function XY(t,e,n){for(var i=-1,r=t==null?0:t.length;++i<r;)if(n(e,t[i]))return!0;return!1}var mme=200;function bme(t,e,n,i){var r=-1,s=pY,o=!0,a=t.length,l=[],g=e.length;if(!a)return l;n&&(e=k0(e,K0(n))),i?(s=XY,o=!1):e.length>=mme&&(s=uZ,o=!1,e=new RA(e));e:for(;++r<a;){var c=t[r],u=n==null?c:n(c);if(c=i||c!==0?c:0,o&&u===u){for(var I=g;I--;)if(e[I]===u)continue e;l.push(c)}else s(e,u,i)||l.push(c)}return l}var vme=tZ(function(t,e){return UM(t)?bme(t,hy(e,1,UM,!0)):[]});const Cy=vme;function xA(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ar(t,e,n){var i=t==null?0:t.length;return i?(e=n||e===void 0?1:H0(e),wY(t,e<0?0:e,i)):[]}function t0(t,e,n){var i=t==null?0:t.length;return i?(e=n||e===void 0?1:H0(e),e=i-e,wY(t,0,e<0?0:e)):[]}function yme(t){return typeof t=="function"?t:SA}function Nt(t,e){var n=un(t)?CY:RI;return n(t,yme(e))}function Bme(t,e){for(var n=-1,i=t==null?0:t.length;++n<i;)if(!e(t[n],n,t))return!1;return!0}function Gme(t,e){var n=!0;return RI(t,function(i,r,s){return n=!!e(i,r,s),n}),n}function Ia(t,e,n){var i=un(t)?Bme:Gme;return n&&gy(t,e,n)&&(e=void 0),i(t,cl(e))}function YY(t,e){var n=[];return RI(t,function(i,r,s){e(i,r,s)&&n.push(i)}),n}function Ko(t,e){var n=un(t)?lZ:YY;return n(t,cl(e))}function Sme(t){return function(e,n,i){var r=Object(e);if(!gl(e)){var s=cl(n);e=no(e),n=function(a){return s(r[a],a,r)}}var o=t(e,n,i);return o>-1?r[s?e[o]:o]:void 0}}var wme=Math.max;function Rme(t,e,n){var i=t==null?0:t.length;if(!i)return-1;var r=n==null?0:H0(n);return r<0&&(r=wme(i+r,0)),fY(t,cl(e),r)}var xme=Sme(Rme);const ZA=xme;function ba(t){return t&&t.length?t[0]:void 0}function Zme(t,e){var n=-1,i=gl(t)?Array(t.length):[];return RI(t,function(r,s,o){i[++n]=e(r,s,o)}),i}function mt(t,e){var n=un(t)?k0:Zme;return n(t,cl(e))}function No(t,e){return hy(mt(t,e),1)}var Eme=Object.prototype,Wme=Eme.hasOwnProperty,Nme=Cme(function(t,e,n){Wme.call(t,n)?t[n].push(e):eZ(t,n,[e])});const Mme=Nme;var Tme=Object.prototype,Fme=Tme.hasOwnProperty;function Vme(t,e){return t!=null&&Fme.call(t,e)}function Rt(t,e){return t!=null&&HY(t,e,Vme)}var Lme="[object String]";function Ws(t){return typeof t=="string"||!un(t)&&ma(t)&&Wc(t)==Lme}function kme(t,e){return k0(e,function(n){return t[n]})}function Xi(t){return t==null?[]:kme(t,no(t))}var Hme=Math.max;function as(t,e,n,i){t=gl(t)?t:Xi(t),n=n&&!i?H0(n):0;var r=t.length;return n<0&&(n=Hme(r+n,0)),Ws(t)?n<=r&&t.indexOf(e,n)>-1:!!r&&$x(t,e,n)>-1}var _me=Math.max;function DM(t,e,n){var i=t==null?0:t.length;if(!i)return-1;var r=n==null?0:H0(n);return r<0&&(r=_me(i+r,0)),$x(t,e,r)}var Xme="[object Map]",Yme="[object Set]",Kme=Object.prototype,zme=Kme.hasOwnProperty;function Xn(t){if(t==null)return!0;if(gl(t)&&(un(t)||typeof t=="string"||typeof t.splice=="function"||qf(t)||iZ(t)||cy(t)))return!t.length;var e=wA(t);if(e==Xme||e==Yme)return!t.size;if(Y0(t))return!GY(t).length;for(var n in t)if(zme.call(t,n))return!1;return!0}var Ume="[object RegExp]";function Dme(t){return ma(t)&&Wc(t)==Ume}var PM=mc&&mc.isRegExp,Pme=PM?K0(PM):Dme;const ig=Pme;function rg(t){return t===void 0}var Ome="Expected a function";function Qme(t){if(typeof t!="function")throw new TypeError(Ome);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Jme(t,e,n,i){if(!Lo(t))return t;e=Ay(e,t);for(var r=-1,s=e.length,o=s-1,a=t;a!=null&&++r<s;){var l=z0(e[r]),g=n;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(r!=o){var c=a[l];g=i?i(c,l,a):void 0,g===void 0&&(g=Lo(c)?c:ay(e[r+1])?[]:{})}ly(a,l,g),a=a[l]}return t}function jme(t,e,n){for(var i=-1,r=e.length,s={};++i<r;){var o=e[i],a=oZ(t,o);n(a,o)&&Jme(s,Ay(o,t),a)}return s}function wa(t,e){if(t==null)return{};var n=k0(WY(t),function(i){return[i]});return e=cl(e),jme(t,n,function(i,r){return e(i,r[0])})}function qme(t,e,n,i,r){return r(t,function(s,o,a){n=i?(i=!1,s):e(n,s,o,a)}),n}function ro(t,e,n){var i=un(t)?kfe:qme,r=arguments.length<3;return i(t,cl(e),n,r,RI)}function fy(t,e){var n=un(t)?lZ:YY;return n(t,Qme(cl(e)))}function $me(t,e){var n;return RI(t,function(i,r,s){return n=e(i,r,s),!n}),!!n}function KY(t,e,n){var i=un(t)?FY:$me;return n&&gy(t,e,n)&&(e=void 0),i(t,cl(e))}var e2e=1/0,t2e=lA&&1/IZ(new lA([,-0]))[1]==e2e?function(t){return new lA(t)}:Hi;const n2e=t2e;var i2e=200;function r2e(t,e,n){var i=-1,r=pY,s=t.length,o=!0,a=[],l=a;if(n)o=!1,r=XY;else if(s>=i2e){var g=e?null:n2e(t);if(g)return IZ(g);o=!1,r=uZ,l=new RA}else l=e?[]:a;e:for(;++i<s;){var c=t[i],u=e?e(c):c;if(c=n||c!==0?c:0,o&&u===u){for(var I=l.length;I--;)if(l[I]===u)continue e;e&&l.push(u),a.push(c)}else r(l,u,n)||(l!==a&&l.push(u),a.push(c))}return a}function hZ(t){return t&&t.length?r2e(t):[]}function MS(t){console&&console.error&&console.error(`Error: ${t}`)}function zY(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function UY(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function DY(t){function e(){}e.prototype=t;const n=new e;function i(){return typeof n.bar}return i(),i(),t}function s2e(t){return o2e(t)?t.LABEL:t.name}function o2e(t){return Ws(t.LABEL)&&t.LABEL!==""}class ul{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Nt(this.definition,n=>{n.accept(e)})}}class so extends ul{constructor(e){super([]),this.idx=1,io(this,wa(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class QA extends ul{constructor(e){super(e.definition),this.orgText="",io(this,wa(e,n=>n!==void 0))}}class Ns extends ul{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,io(this,wa(e,n=>n!==void 0))}}class xs extends ul{constructor(e){super(e.definition),this.idx=1,io(this,wa(e,n=>n!==void 0))}}class Il extends ul{constructor(e){super(e.definition),this.idx=1,io(this,wa(e,n=>n!==void 0))}}class dl extends ul{constructor(e){super(e.definition),this.idx=1,io(this,wa(e,n=>n!==void 0))}}class Ui extends ul{constructor(e){super(e.definition),this.idx=1,io(this,wa(e,n=>n!==void 0))}}class Ra extends ul{constructor(e){super(e.definition),this.idx=1,io(this,wa(e,n=>n!==void 0))}}class xa extends ul{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,io(this,wa(e,n=>n!==void 0))}}class ai{constructor(e){this.idx=1,io(this,wa(e,n=>n!==void 0))}accept(e){e.visit(this)}}function a2e(t){return mt(t,a3)}function a3(t){function e(n){return mt(n,a3)}if(t instanceof so){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Ws(t.label)&&(n.label=t.label),n}else{if(t instanceof Ns)return{type:"Alternative",definition:e(t.definition)};if(t instanceof xs)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Il)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof dl)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:a3(new ai({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ra)return{type:"RepetitionWithSeparator",idx:t.idx,separator:a3(new ai({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ui)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof xa)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof ai){const n={type:"Terminal",name:t.terminalType.name,label:s2e(t.terminalType),idx:t.idx};Ws(t.label)&&(n.terminalLabel=t.label);const i=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=ig(i)?i.source:i),n}else{if(t instanceof QA)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class JA{visit(e){const n=e;switch(n.constructor){case so:return this.visitNonTerminal(n);case Ns:return this.visitAlternative(n);case xs:return this.visitOption(n);case Il:return this.visitRepetitionMandatory(n);case dl:return this.visitRepetitionMandatoryWithSeparator(n);case Ra:return this.visitRepetitionWithSeparator(n);case Ui:return this.visitRepetition(n);case xa:return this.visitAlternation(n);case ai:return this.visitTerminal(n);case QA:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function l2e(t){return t instanceof Ns||t instanceof xs||t instanceof Ui||t instanceof Il||t instanceof dl||t instanceof Ra||t instanceof ai||t instanceof QA}function Zb(t,e=[]){return t instanceof xs||t instanceof Ui||t instanceof Ra?!0:t instanceof xa?KY(t.definition,i=>Zb(i,e)):t instanceof so&&as(e,t)?!1:t instanceof ul?(t instanceof so&&e.push(t),Ia(t.definition,i=>Zb(i,e))):!1}function g2e(t){return t instanceof xa}function za(t){if(t instanceof so)return"SUBRULE";if(t instanceof xs)return"OPTION";if(t instanceof xa)return"OR";if(t instanceof Il)return"AT_LEAST_ONE";if(t instanceof dl)return"AT_LEAST_ONE_SEP";if(t instanceof Ra)return"MANY_SEP";if(t instanceof Ui)return"MANY";if(t instanceof ai)return"CONSUME";throw Error("non exhaustive match")}class py{walk(e,n=[]){Nt(e.definition,(i,r)=>{const s=Ar(e.definition,r+1);if(i instanceof so)this.walkProdRef(i,s,n);else if(i instanceof ai)this.walkTerminal(i,s,n);else if(i instanceof Ns)this.walkFlat(i,s,n);else if(i instanceof xs)this.walkOption(i,s,n);else if(i instanceof Il)this.walkAtLeastOne(i,s,n);else if(i instanceof dl)this.walkAtLeastOneSep(i,s,n);else if(i instanceof Ra)this.walkManySep(i,s,n);else if(i instanceof Ui)this.walkMany(i,s,n);else if(i instanceof xa)this.walkOr(i,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,i){}walkProdRef(e,n,i){}walkFlat(e,n,i){const r=n.concat(i);this.walk(e,r)}walkOption(e,n,i){const r=n.concat(i);this.walk(e,r)}walkAtLeastOne(e,n,i){const r=[new xs({definition:e.definition})].concat(n,i);this.walk(e,r)}walkAtLeastOneSep(e,n,i){const r=OM(e,n,i);this.walk(e,r)}walkMany(e,n,i){const r=[new xs({definition:e.definition})].concat(n,i);this.walk(e,r)}walkManySep(e,n,i){const r=OM(e,n,i);this.walk(e,r)}walkOr(e,n,i){const r=n.concat(i);Nt(e.definition,s=>{const o=new Ns({definition:[s]});this.walk(o,r)})}}function OM(t,e,n){return[new xs({definition:[new ai({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function D0(t){if(t instanceof so)return D0(t.referencedRule);if(t instanceof ai)return I2e(t);if(l2e(t))return c2e(t);if(g2e(t))return u2e(t);throw Error("non exhaustive match")}function c2e(t){let e=[];const n=t.definition;let i=0,r=n.length>i,s,o=!0;for(;r&&o;)s=n[i],o=Zb(s),e=e.concat(D0(s)),i=i+1,r=n.length>i;return hZ(e)}function u2e(t){const e=mt(t.definition,n=>D0(n));return hZ(ua(e))}function I2e(t){return[t.terminalType]}const PY="_~IN~_";class d2e extends py{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,i){}walkProdRef(e,n,i){const r=h2e(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(i),o=new Ns({definition:s}),a=D0(o);this.follows[r]=a}}function A2e(t){const e={};return Nt(t,n=>{const i=new d2e(n).startWalking();io(e,i)}),e}function h2e(t,e){return t.name+e+PY}function Mt(t){return t.charCodeAt(0)}function VB(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function eC(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function fd(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function C2e(){throw Error("Internal Error - Should never get here!")}function QM(t){return t.type==="Character"}const Eb=[];for(let t=Mt("0");t<=Mt("9");t++)Eb.push(t);const Wb=[Mt("_")].concat(Eb);for(let t=Mt("a");t<=Mt("z");t++)Wb.push(t);for(let t=Mt("A");t<=Mt("Z");t++)Wb.push(t);const JM=[Mt(" "),Mt("\f"),Mt(`
`),Mt("\r"),Mt("	"),Mt("\v"),Mt("	"),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt(" "),Mt("\u2028"),Mt("\u2029"),Mt(" "),Mt(" "),Mt("　"),Mt("\uFEFF")],f2e=/[0-9a-fA-F]/,b2=/[0-9]/,p2e=/[1-9]/;class m2e{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const i={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":eC(i,"global");break;case"i":eC(i,"ignoreCase");break;case"m":eC(i,"multiLine");break;case"u":eC(i,"unicode");break;case"y":eC(i,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:i,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}fd(n);const i=this.disjunction();return this.consumeChar(")"),{type:n,value:i,loc:this.loc(e)}}return C2e()}quantifier(e=!1){let n;const i=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const r=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:r,atMost:r};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:r,atMost:s}):n={atLeast:r,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;fd(n);break}if(!(e===!0&&n===void 0)&&fd(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(i),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),fd(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Mt(`
`),Mt("\r"),Mt("\u2028"),Mt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Eb;break;case"D":e=Eb,n=!0;break;case"s":e=JM;break;case"S":e=JM,n=!0;break;case"w":e=Wb;break;case"W":e=Wb,n=!0;break}if(fd(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Mt("\f");break;case"n":e=Mt(`
`);break;case"r":e=Mt("\r");break;case"t":e=Mt("	");break;case"v":e=Mt("\v");break}if(fd(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Mt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Mt(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Mt(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const i=this.classAtom();if(i.type,QM(i)&&this.isRangeDash()){this.consumeChar("-");const r=this.classAtom();if(r.type,QM(r)){if(r.value<i.value)throw Error("Range out of order in character class");e.push({from:i.value,to:r.value})}else VB(i.value,e),e.push(Mt("-")),VB(r.value,e)}else VB(i.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Mt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const i={type:"Group",capturing:e,value:n};return e&&(i.idx=this.groupIdx),i}positiveInteger(){let e=this.popChar();if(p2e.test(e)===!1)throw Error("Expecting a positive integer");for(;b2.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(b2.test(e)===!1)throw Error("Expecting an integer");for(;b2.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Mt(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return b2.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let r=0;r<e;r++){const s=this.popChar();if(f2e.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class CZ{visitChildren(e){for(const n in e){const i=e[n];e.hasOwnProperty(n)&&(i.type!==void 0?this.visit(i):Array.isArray(i)&&i.forEach(r=>{this.visit(r)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let l3={};const b2e=new m2e;function my(t){const e=t.toString();if(l3.hasOwnProperty(e))return l3[e];{const n=b2e.pattern(e);return l3[e]=n,n}}function v2e(){l3={}}const OY="Complement Sets are not supported for first char optimization",Nb=`Unable to use "first char" lexer optimizations:
`;function y2e(t,e=!1){try{const n=my(t);return TS(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===OY)e&&zY(`${Nb}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let i="";e&&(i=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),MS(`${Nb}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+i)}}return[]}function TS(t,e,n){switch(t.type){case"Disjunction":for(let r=0;r<t.value.length;r++)TS(t.value[r],e,n);break;case"Alternative":const i=t.value;for(let r=0;r<i.length;r++){const s=i[r];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":v2(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(OY);Nt(o.value,l=>{if(typeof l=="number")v2(l,e,n);else{const g=l;if(n===!0)for(let c=g.from;c<=g.to;c++)v2(c,e,n);else{for(let c=g.from;c<=g.to&&c<dC;c++)v2(c,e,n);if(g.to>=dC){const c=g.from>=dC?g.from:dC,u=g.to,I=bc(c),h=bc(u);for(let C=I;C<=h;C++)e[C]=C}}}});break;case"Group":TS(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&FS(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Xi(e)}function v2(t,e,n){const i=bc(t);e[i]=i,n===!0&&B2e(t,e)}function B2e(t,e){const n=String.fromCharCode(t),i=n.toUpperCase();if(i!==n){const r=bc(i.charCodeAt(0));e[r]=r}else{const r=n.toLowerCase();if(r!==n){const s=bc(r.charCodeAt(0));e[s]=s}}}function jM(t,e){return ZA(t.value,n=>{if(typeof n=="number")return as(e,n);{const i=n;return ZA(e,r=>i.from<=r&&r<=i.to)!==void 0}})}function FS(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?un(t.value)?Ia(t.value,FS):FS(t.value):!1}class G2e extends CZ{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){as(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?jM(e,this.targetCharCodes)===void 0&&(this.found=!0):jM(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function fZ(t,e){if(e instanceof RegExp){const n=my(e),i=new G2e(t);return i.visit(n),i.found}else return ZA(e,n=>as(t,n.charCodeAt(0)))!==void 0}const cI="PATTERN",IC="defaultMode",y2="modes";let QY=typeof new RegExp("(?:)").sticky=="boolean";function S2e(t,e){e=AZ(e,{useSticky:QY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(p,v)=>v()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{O2e()});let i;n("Reject Lexer.NA",()=>{i=fy(t,p=>p[cI]===Mo.NA)});let r=!1,s;n("Transform Patterns",()=>{r=!1,s=mt(i,p=>{const v=p[cI];if(ig(v)){const B=v.source;return B.length===1&&B!=="^"&&B!=="$"&&B!=="."&&!v.ignoreCase?B:B.length===2&&B[0]==="\\"&&!as(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],B[1])?B[1]:e.useSticky?$M(v):qM(v)}else{if(Ig(v))return r=!0,{exec:v};if(typeof v=="object")return r=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const B=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),G=new RegExp(B);return e.useSticky?$M(G):qM(G)}}else throw Error("non exhaustive match")}})});let o,a,l,g,c;n("misc mapping",()=>{o=mt(i,p=>p.tokenTypeIdx),a=mt(i,p=>{const v=p.GROUP;if(v!==Mo.SKIPPED){if(Ws(v))return v;if(rg(v))return!1;throw Error("non exhaustive match")}}),l=mt(i,p=>{const v=p.LONGER_ALT;if(v)return un(v)?mt(v,G=>DM(i,G)):[DM(i,v)]}),g=mt(i,p=>p.PUSH_MODE),c=mt(i,p=>Rt(p,"POP_MODE"))});let u;n("Line Terminator Handling",()=>{const p=qY(e.lineTerminatorCharacters);u=mt(i,v=>!1),e.positionTracking!=="onlyOffset"&&(u=mt(i,v=>Rt(v,"LINE_BREAKS")?!!v.LINE_BREAKS:jY(v,p)===!1&&fZ(p,v.PATTERN)))});let I,h,C,b;n("Misc Mapping #2",()=>{I=mt(i,JY),h=mt(s,U2e),C=ro(i,(p,v)=>{const B=v.GROUP;return Ws(B)&&B!==Mo.SKIPPED&&(p[B]=[]),p},{}),b=mt(s,(p,v)=>({pattern:s[v],longerAlt:l[v],canLineTerminator:u[v],isCustom:I[v],short:h[v],group:a[v],push:g[v],pop:c[v],tokenTypeIdx:o[v],tokenType:i[v]}))});let m=!0,f=[];return e.safeMode||n("First Char Optimization",()=>{f=ro(i,(p,v,B)=>{if(typeof v.PATTERN=="string"){const G=v.PATTERN.charCodeAt(0),R=bc(G);LB(p,R,b[B])}else if(un(v.START_CHARS_HINT)){let G;Nt(v.START_CHARS_HINT,R=>{const w=typeof R=="string"?R.charCodeAt(0):R,E=bc(w);G!==E&&(G=E,LB(p,E,b[B]))})}else if(ig(v.PATTERN))if(v.PATTERN.unicode)m=!1,e.ensureOptimizations&&MS(`${Nb}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const G=y2e(v.PATTERN,e.ensureOptimizations);Xn(G)&&(m=!1),Nt(G,R=>{LB(p,R,b[B])})}else e.ensureOptimizations&&MS(`${Nb}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),m=!1;return p},[])}),{emptyGroups:C,patternIdxToConfig:b,charCodeToPatternIdxToConfig:f,hasCustom:r,canBeOptimized:m}}function w2e(t,e){let n=[];const i=x2e(t);n=n.concat(i.errors);const r=Z2e(i.valid),s=r.valid;return n=n.concat(r.errors),n=n.concat(R2e(s)),n=n.concat(L2e(s)),n=n.concat(k2e(s,e)),n=n.concat(H2e(s)),n}function R2e(t){let e=[];const n=Ko(t,i=>ig(i[cI]));return e=e.concat(W2e(n)),e=e.concat(T2e(n)),e=e.concat(F2e(n)),e=e.concat(V2e(n)),e=e.concat(N2e(n)),e}function x2e(t){const e=Ko(t,r=>!Rt(r,cI)),n=mt(e,r=>({message:"Token Type: ->"+r.name+"<- missing static 'PATTERN' property",type:pi.MISSING_PATTERN,tokenTypes:[r]})),i=Cy(t,e);return{errors:n,valid:i}}function Z2e(t){const e=Ko(t,r=>{const s=r[cI];return!ig(s)&&!Ig(s)&&!Rt(s,"exec")&&!Ws(s)}),n=mt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:pi.INVALID_PATTERN,tokenTypes:[r]})),i=Cy(t,e);return{errors:n,valid:i}}const E2e=/[^\\][$]/;function W2e(t){class e extends CZ{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Ko(t,r=>{const s=r.PATTERN;try{const o=my(s),a=new e;return a.visit(o),a.found}catch{return E2e.test(s.source)}});return mt(n,r=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+r.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:pi.EOI_ANCHOR_FOUND,tokenTypes:[r]}))}function N2e(t){const e=Ko(t,i=>i.PATTERN.test(""));return mt(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' must not match an empty string",type:pi.EMPTY_MATCH_PATTERN,tokenTypes:[i]}))}const M2e=/[^\\[][\^]|^\^/;function T2e(t){class e extends CZ{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Ko(t,r=>{const s=r.PATTERN;try{const o=my(s),a=new e;return a.visit(o),a.found}catch{return M2e.test(s.source)}});return mt(n,r=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+r.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:pi.SOI_ANCHOR_FOUND,tokenTypes:[r]}))}function F2e(t){const e=Ko(t,i=>{const r=i[cI];return r instanceof RegExp&&(r.multiline||r.global)});return mt(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:pi.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[i]}))}function V2e(t){const e=[];let n=mt(t,s=>ro(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!as(e,a)&&a.PATTERN!==Mo.NA&&(e.push(a),o.push(a)),o),[]));n=U0(n);const i=Ko(n,s=>s.length>1);return mt(i,s=>{const o=mt(s,l=>l.name);return{message:`The same RegExp pattern ->${ba(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:pi.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function L2e(t){const e=Ko(t,i=>{if(!Rt(i,"GROUP"))return!1;const r=i.GROUP;return r!==Mo.SKIPPED&&r!==Mo.NA&&!Ws(r)});return mt(e,i=>({message:"Token Type: ->"+i.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:pi.INVALID_GROUP_TYPE_FOUND,tokenTypes:[i]}))}function k2e(t,e){const n=Ko(t,r=>r.PUSH_MODE!==void 0&&!as(e,r.PUSH_MODE));return mt(n,r=>({message:`Token Type: ->${r.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${r.PUSH_MODE}<-which does not exist`,type:pi.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[r]}))}function H2e(t){const e=[],n=ro(t,(i,r,s)=>{const o=r.PATTERN;return o===Mo.NA||(Ws(o)?i.push({str:o,idx:s,tokenType:r}):ig(o)&&X2e(o)&&i.push({str:o.source,idx:s,tokenType:r})),i},[]);return Nt(t,(i,r)=>{Nt(n,({str:s,idx:o,tokenType:a})=>{if(r<o&&_2e(s,i.PATTERN)){const l=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${i.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:l,type:pi.UNREACHABLE_PATTERN,tokenTypes:[i,a]})}})}),e}function _2e(t,e){if(ig(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Ig(e))return e(t,0,[],{});if(Rt(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function X2e(t){return ZA([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function qM(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function $M(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function Y2e(t,e,n){const i=[];return Rt(t,IC)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+IC+`> property in its definition
`,type:pi.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Rt(t,y2)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+y2+`> property in its definition
`,type:pi.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Rt(t,y2)&&Rt(t,IC)&&!Rt(t.modes,t.defaultMode)&&i.push({message:`A MultiMode Lexer cannot be initialized with a ${IC}: <${t.defaultMode}>which does not exist
`,type:pi.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Rt(t,y2)&&Nt(t.modes,(r,s)=>{Nt(r,(o,a)=>{if(rg(o))i.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:pi.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Rt(o,"LONGER_ALT")){const l=un(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Nt(l,g=>{!rg(g)&&!as(r,g)&&i.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${g.name}> on token <${o.name}> outside of mode <${s}>
`,type:pi.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),i}function K2e(t,e,n){const i=[];let r=!1;const s=U0(ua(Xi(t.modes))),o=fy(s,l=>l[cI]===Mo.NA),a=qY(n);return e&&Nt(o,l=>{const g=jY(l,a);if(g!==!1){const u={message:P2e(l,g),type:g.issue,tokenType:l};i.push(u)}else Rt(l,"LINE_BREAKS")?l.LINE_BREAKS===!0&&(r=!0):fZ(a,l.PATTERN)&&(r=!0)}),e&&!r&&i.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:pi.NO_LINE_BREAKS_FLAGS}),i}function z2e(t){const e={},n=no(t);return Nt(n,i=>{const r=t[i];if(un(r))e[i]=[];else throw Error("non exhaustive match")}),e}function JY(t){const e=t.PATTERN;if(ig(e))return!1;if(Ig(e))return!0;if(Rt(e,"exec"))return!0;if(Ws(e))return!1;throw Error("non exhaustive match")}function U2e(t){return Ws(t)&&t.length===1?t.charCodeAt(0):!1}const D2e={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const i=t.charCodeAt(n);if(i===10)return this.lastIndex=n+1,!0;if(i===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function jY(t,e){if(Rt(t,"LINE_BREAKS"))return!1;if(ig(t.PATTERN)){try{fZ(e,t.PATTERN)}catch(n){return{issue:pi.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Ws(t.PATTERN))return!1;if(JY(t))return{issue:pi.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function P2e(t,e){if(e.issue===pi.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===pi.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function qY(t){return mt(t,n=>Ws(n)?n.charCodeAt(0):n)}function LB(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const dC=256;let g3=[];function bc(t){return t<dC?t:g3[t]}function O2e(){if(Xn(g3)){g3=new Array(65536);for(let t=0;t<65536;t++)g3[t]=t>255?255+~~(t/255):t}}function P0(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Mb(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let e7=1;const $Y={};function O0(t){const e=Q2e(t);J2e(e),q2e(e),j2e(e),Nt(e,n=>{n.isParent=n.categoryMatches.length>0})}function Q2e(t){let e=Vr(t),n=t,i=!0;for(;i;){n=U0(ua(mt(n,s=>s.CATEGORIES)));const r=Cy(n,e);e=e.concat(r),Xn(r)?i=!1:n=r}return e}function J2e(t){Nt(t,e=>{tK(e)||($Y[e7]=e,e.tokenTypeIdx=e7++),t7(e)&&!un(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),t7(e)||(e.CATEGORIES=[]),$2e(e)||(e.categoryMatches=[]),e3e(e)||(e.categoryMatchesMap={})})}function j2e(t){Nt(t,e=>{e.categoryMatches=[],Nt(e.categoryMatchesMap,(n,i)=>{e.categoryMatches.push($Y[i].tokenTypeIdx)})})}function q2e(t){Nt(t,e=>{eK([],e)})}function eK(t,e){Nt(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Nt(e.CATEGORIES,n=>{const i=t.concat(e);as(i,n)||eK(i,n)})}function tK(t){return Rt(t,"tokenTypeIdx")}function t7(t){return Rt(t,"CATEGORIES")}function $2e(t){return Rt(t,"categoryMatches")}function e3e(t){return Rt(t,"categoryMatchesMap")}function t3e(t){return Rt(t,"tokenTypeIdx")}const n3e={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,i,r){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var pi;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(pi||(pi={}));const AC={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:n3e,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(AC);class Mo{constructor(e,n=AC){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(r,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${r}>`);const{time:a,value:l}=UY(s),g=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&g(`${o}<-- <${r}> time: ${a}ms`),this.traceInitIndent--,l}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=io({},AC,n);const i=this.config.traceInitPerf;i===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof i=="number"&&(this.traceInitMaxIdent=i,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let r,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===AC.lineTerminatorsPattern)this.config.lineTerminatorsPattern=D2e;else if(this.config.lineTerminatorCharacters===AC.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),un(e)?r={modes:{defaultMode:Vr(e)},defaultMode:IC}:(s=!1,r=Vr(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Y2e(r,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(K2e(r,this.trackStartLines,this.config.lineTerminatorCharacters))})),r.modes=r.modes?r.modes:{},Nt(r.modes,(a,l)=>{r.modes[l]=fy(a,g=>rg(g))});const o=no(r.modes);if(Nt(r.modes,(a,l)=>{this.TRACE_INIT(`Mode: <${l}> processing`,()=>{if(this.modes.push(l),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(w2e(a,o))}),Xn(this.lexerDefinitionErrors)){O0(a);let g;this.TRACE_INIT("analyzeTokenTypes",()=>{g=S2e(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[l]=g.patternIdxToConfig,this.charCodeToPatternIdxToConfig[l]=g.charCodeToPatternIdxToConfig,this.emptyGroups=io({},this.emptyGroups,g.emptyGroups),this.hasCustom=g.hasCustom||this.hasCustom,this.canModeBeOptimized[l]=g.canBeOptimized}})}),this.defaultMode=r.defaultMode,!Xn(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const l=mt(this.lexerDefinitionErrors,g=>g.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+l)}Nt(this.lexerDefinitionWarning,a=>{zY(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(QY?(this.chopInput=SA,this.match=this.matchWithTest):(this.updateLastIndex=Hi,this.match=this.matchWithExec),s&&(this.handleModes=Hi),this.trackStartLines===!1&&(this.computeNewColumn=SA),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Hi),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=ro(this.canModeBeOptimized,(l,g,c)=>(g===!1&&l.push(c),l),[]);if(n.ensureOptimizations&&!Xn(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{v2e()}),this.TRACE_INIT("toFastProperties",()=>{DY(this)})})}tokenize(e,n=this.defaultMode){if(!Xn(this.lexerDefinitionErrors)){const r=mt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+r)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let i,r,s,o,a,l,g,c,u,I,h,C,b,m,f;const p=e,v=p.length;let B=0,G=0;const R=this.hasCustom?0:Math.floor(e.length/10),w=new Array(R),E=[];let x=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const T=z2e(this.emptyGroups),k=this.trackStartLines,_=this.config.lineTerminatorsPattern;let U=0,O=[],Y=[];const z=[],N=[];Object.freeze(N);let L;function V(){return O}function M(le){const ae=bc(le),ce=Y[ae];return ce===void 0?N:ce}const X=le=>{if(z.length===1&&le.tokenType.PUSH_MODE===void 0){const ae=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(le);E.push({offset:le.startOffset,line:le.startLine,column:le.startColumn,length:le.image.length,message:ae})}else{z.pop();const ae=xA(z);O=this.patternIdxToConfig[ae],Y=this.charCodeToPatternIdxToConfig[ae],U=O.length;const ce=this.canModeBeOptimized[ae]&&this.config.safeMode===!1;Y&&ce?L=M:L=V}};function J(le){z.push(le),Y=this.charCodeToPatternIdxToConfig[le],O=this.patternIdxToConfig[le],U=O.length,U=O.length;const ae=this.canModeBeOptimized[le]&&this.config.safeMode===!1;Y&&ae?L=M:L=V}J.call(this,n);let re;const se=this.config.recoveryEnabled;for(;B<v;){l=null;const le=p.charCodeAt(B),ae=L(le),ce=ae.length;for(i=0;i<ce;i++){re=ae[i];const Ee=re.pattern;g=null;const Fe=re.short;if(Fe!==!1?le===Fe&&(l=Ee):re.isCustom===!0?(f=Ee.exec(p,B,w,T),f!==null?(l=f[0],f.payload!==void 0&&(g=f.payload)):l=null):(this.updateLastIndex(Ee,B),l=this.match(Ee,e,B)),l!==null){if(a=re.longerAlt,a!==void 0){const oe=a.length;for(s=0;s<oe;s++){const D=O[a[s]],fe=D.pattern;if(c=null,D.isCustom===!0?(f=fe.exec(p,B,w,T),f!==null?(o=f[0],f.payload!==void 0&&(c=f.payload)):o=null):(this.updateLastIndex(fe,B),o=this.match(fe,e,B)),o&&o.length>l.length){l=o,g=c,re=D;break}}}break}}if(l!==null){if(u=l.length,I=re.group,I!==void 0&&(h=re.tokenTypeIdx,C=this.createTokenInstance(l,B,h,re.tokenType,x,W,u),this.handlePayload(C,g),I===!1?G=this.addToken(w,G,C):T[I].push(C)),e=this.chopInput(e,u),B=B+u,W=this.computeNewColumn(W,u),k===!0&&re.canLineTerminator===!0){let Ee=0,Fe,oe;_.lastIndex=0;do Fe=_.test(l),Fe===!0&&(oe=_.lastIndex-1,Ee++);while(Fe===!0);Ee!==0&&(x=x+Ee,W=u-oe,this.updateTokenEndLineColumnLocation(C,I,oe,Ee,x,W,u))}this.handleModes(re,X,J,C)}else{const Ee=B,Fe=x,oe=W;let D=se===!1;for(;D===!1&&B<v;)for(e=this.chopInput(e,1),B++,r=0;r<U;r++){const fe=O[r],Ce=fe.pattern,pe=fe.short;if(pe!==!1?p.charCodeAt(B)===pe&&(D=!0):fe.isCustom===!0?D=Ce.exec(p,B,w,T)!==null:(this.updateLastIndex(Ce,B),D=Ce.exec(e)!==null),D===!0)break}if(b=B-Ee,W=this.computeNewColumn(W,b),m=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(p,Ee,b,Fe,oe),E.push({offset:Ee,line:Fe,column:oe,length:b,message:m}),se===!1)break}}return this.hasCustom||(w.length=G),{tokens:w,groups:T,errors:E}}handleModes(e,n,i,r){if(e.pop===!0){const s=e.push;n(r),s!==void 0&&i.call(this,s)}else e.push!==void 0&&i.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,i,r,s,o,a){let l,g;n!==void 0&&(l=i===a-1,g=l?-1:0,r===1&&l===!0||(e.endLine=s+g,e.endColumn=o-1+-g))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,i,r){return{image:e,startOffset:n,tokenTypeIdx:i,tokenType:r}}createStartOnlyToken(e,n,i,r,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:i,tokenType:r}}createFullToken(e,n,i,r,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:i,tokenType:r}}addTokenUsingPush(e,n,i){return e.push(i),n}addTokenUsingMemberAccess(e,n,i){return e[n]=i,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,i){return e.test(n)===!0?n.substring(i,e.lastIndex):null}matchWithExec(e,n){const i=e.exec(n);return i!==null?i[0]:null}}Mo.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Mo.NA=/NOT_APPLICABLE/;function YC(t){return nK(t)?t.LABEL:t.name}function nK(t){return Ws(t.LABEL)&&t.LABEL!==""}const i3e="parent",n7="categories",i7="label",r7="group",s7="push_mode",o7="pop_mode",a7="longer_alt",l7="line_breaks",g7="start_chars_hint";function iK(t){return r3e(t)}function r3e(t){const e=t.pattern,n={};if(n.name=t.name,rg(e)||(n.PATTERN=e),Rt(t,i3e))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Rt(t,n7)&&(n.CATEGORIES=t[n7]),O0([n]),Rt(t,i7)&&(n.LABEL=t[i7]),Rt(t,r7)&&(n.GROUP=t[r7]),Rt(t,o7)&&(n.POP_MODE=t[o7]),Rt(t,s7)&&(n.PUSH_MODE=t[s7]),Rt(t,a7)&&(n.LONGER_ALT=t[a7]),Rt(t,l7)&&(n.LINE_BREAKS=t[l7]),Rt(t,g7)&&(n.START_CHARS_HINT=t[g7]),n}const uI=iK({name:"EOF",pattern:Mo.NA});O0([uI]);function pZ(t,e,n,i,r,s,o,a){return{image:e,startOffset:n,endOffset:i,startLine:r,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function s3e(t,e){return P0(t,e)}const rK={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:i}){return`Expecting ${nK(t)?`--> ${YC(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:i,ruleName:r}){const s="Expecting: ",a=`
but found: '`+ba(e).image+"'";if(i)return s+i+a;{const l=ro(t,(I,h)=>I.concat(h),[]),g=mt(l,I=>`[${mt(I,h=>YC(h)).join(", ")}]`),u=`one of these possible Token sequences:
${mt(g,(I,h)=>`  ${h+1}. ${I}`).join(`
`)}`;return s+u+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:i}){const r="Expecting: ",o=`
but found: '`+ba(e).image+"'";if(n)return r+n+o;{const l=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${mt(t,g=>`[${mt(g,c=>YC(c)).join(",")}]`).join(" ,")}>`;return r+l+o}}};Object.freeze(rK);const o3e={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Fu={buildDuplicateFoundError(t,e){function n(c){return c instanceof ai?c.terminalType.name:c instanceof so?c.nonTerminalName:""}const i=t.name,r=ba(e),s=r.idx,o=za(r),a=n(r),l=s>0;let g=`->${o}${l?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${i}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return g=g.replace(/[ \t]+/g," "),g=g.replace(/\s\s+/g,`
`),g},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=mt(t.prefixPath,r=>YC(r)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=mt(t.prefixPath,r=>YC(r)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let i=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return i=i+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,i},buildEmptyRepetitionError(t){let e=za(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=mt(t.leftRecursionPath,s=>s.name),i=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${i}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof QA?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function a3e(t,e){const n=new l3e(t,e);return n.resolveRefs(),n.errors}class l3e extends JA{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Nt(Xi(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const i=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:i,type:is.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class g3e extends py{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Vr(this.path.ruleStack).reverse(),this.occurrenceStack=Vr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,i){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const r=n.concat(i);this.updateExpectedNext(),this.walk(e.referencedRule,r)}}updateExpectedNext(){Xn(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class c3e extends g3e{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,i){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const r=n.concat(i),s=new Ns({definition:r});this.possibleTokTypes=D0(s),this.found=!0}}}class by extends py{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class u3e extends by{walkMany(e,n,i){if(e.idx===this.occurrence){const r=ba(n.concat(i));this.result.isEndOfRule=r===void 0,r instanceof ai&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)}else super.walkMany(e,n,i)}}class c7 extends by{walkManySep(e,n,i){if(e.idx===this.occurrence){const r=ba(n.concat(i));this.result.isEndOfRule=r===void 0,r instanceof ai&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)}else super.walkManySep(e,n,i)}}class I3e extends by{walkAtLeastOne(e,n,i){if(e.idx===this.occurrence){const r=ba(n.concat(i));this.result.isEndOfRule=r===void 0,r instanceof ai&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)}else super.walkAtLeastOne(e,n,i)}}class u7 extends by{walkAtLeastOneSep(e,n,i){if(e.idx===this.occurrence){const r=ba(n.concat(i));this.result.isEndOfRule=r===void 0,r instanceof ai&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)}else super.walkAtLeastOneSep(e,n,i)}}function VS(t,e,n=[]){n=Vr(n);let i=[],r=0;function s(a){return a.concat(Ar(t,r+1))}function o(a){const l=VS(s(a),e,n);return i.concat(l)}for(;n.length<e&&r<t.length;){const a=t[r];if(a instanceof Ns)return o(a.definition);if(a instanceof so)return o(a.definition);if(a instanceof xs)i=o(a.definition);else if(a instanceof Il){const l=a.definition.concat([new Ui({definition:a.definition})]);return o(l)}else if(a instanceof dl){const l=[new Ns({definition:a.definition}),new Ui({definition:[new ai({terminalType:a.separator})].concat(a.definition)})];return o(l)}else if(a instanceof Ra){const l=a.definition.concat([new Ui({definition:[new ai({terminalType:a.separator})].concat(a.definition)})]);i=o(l)}else if(a instanceof Ui){const l=a.definition.concat([new Ui({definition:a.definition})]);i=o(l)}else{if(a instanceof xa)return Nt(a.definition,l=>{Xn(l.definition)===!1&&(i=o(l.definition))}),i;if(a instanceof ai)n.push(a.terminalType);else throw Error("non exhaustive match")}r++}return i.push({partialPath:n,suffixDef:Ar(t,r)}),i}function sK(t,e,n,i){const r="EXIT_NONE_TERMINAL",s=[r],o="EXIT_ALTERNATIVE";let a=!1;const l=e.length,g=l-i-1,c=[],u=[];for(u.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Xn(u);){const I=u.pop();if(I===o){a&&xA(u).idx<=g&&u.pop();continue}const h=I.def,C=I.idx,b=I.ruleStack,m=I.occurrenceStack;if(Xn(h))continue;const f=h[0];if(f===r){const p={idx:C,def:Ar(h),ruleStack:t0(b),occurrenceStack:t0(m)};u.push(p)}else if(f instanceof ai)if(C<l-1){const p=C+1,v=e[p];if(n(v,f.terminalType)){const B={idx:p,def:Ar(h),ruleStack:b,occurrenceStack:m};u.push(B)}}else if(C===l-1)c.push({nextTokenType:f.terminalType,nextTokenOccurrence:f.idx,ruleStack:b,occurrenceStack:m}),a=!0;else throw Error("non exhaustive match");else if(f instanceof so){const p=Vr(b);p.push(f.nonTerminalName);const v=Vr(m);v.push(f.idx);const B={idx:C,def:f.definition.concat(s,Ar(h)),ruleStack:p,occurrenceStack:v};u.push(B)}else if(f instanceof xs){const p={idx:C,def:Ar(h),ruleStack:b,occurrenceStack:m};u.push(p),u.push(o);const v={idx:C,def:f.definition.concat(Ar(h)),ruleStack:b,occurrenceStack:m};u.push(v)}else if(f instanceof Il){const p=new Ui({definition:f.definition,idx:f.idx}),v=f.definition.concat([p],Ar(h)),B={idx:C,def:v,ruleStack:b,occurrenceStack:m};u.push(B)}else if(f instanceof dl){const p=new ai({terminalType:f.separator}),v=new Ui({definition:[p].concat(f.definition),idx:f.idx}),B=f.definition.concat([v],Ar(h)),G={idx:C,def:B,ruleStack:b,occurrenceStack:m};u.push(G)}else if(f instanceof Ra){const p={idx:C,def:Ar(h),ruleStack:b,occurrenceStack:m};u.push(p),u.push(o);const v=new ai({terminalType:f.separator}),B=new Ui({definition:[v].concat(f.definition),idx:f.idx}),G=f.definition.concat([B],Ar(h)),R={idx:C,def:G,ruleStack:b,occurrenceStack:m};u.push(R)}else if(f instanceof Ui){const p={idx:C,def:Ar(h),ruleStack:b,occurrenceStack:m};u.push(p),u.push(o);const v=new Ui({definition:f.definition,idx:f.idx}),B=f.definition.concat([v],Ar(h)),G={idx:C,def:B,ruleStack:b,occurrenceStack:m};u.push(G)}else if(f instanceof xa)for(let p=f.definition.length-1;p>=0;p--){const v=f.definition[p],B={idx:C,def:v.definition.concat(Ar(h)),ruleStack:b,occurrenceStack:m};u.push(B),u.push(o)}else if(f instanceof Ns)u.push({idx:C,def:f.definition.concat(Ar(h)),ruleStack:b,occurrenceStack:m});else if(f instanceof QA)u.push(d3e(f,C,b,m));else throw Error("non exhaustive match")}return c}function d3e(t,e,n,i){const r=Vr(n);r.push(t.name);const s=Vr(i);return s.push(1),{idx:e,def:t.definition,ruleStack:r,occurrenceStack:s}}var hi;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(hi||(hi={}));function oK(t){if(t instanceof xs||t==="Option")return hi.OPTION;if(t instanceof Ui||t==="Repetition")return hi.REPETITION;if(t instanceof Il||t==="RepetitionMandatory")return hi.REPETITION_MANDATORY;if(t instanceof dl||t==="RepetitionMandatoryWithSeparator")return hi.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Ra||t==="RepetitionWithSeparator")return hi.REPETITION_WITH_SEPARATOR;if(t instanceof xa||t==="Alternation")return hi.ALTERNATION;throw Error("non exhaustive match")}function A3e(t,e,n,i,r,s){const o=mZ(t,e,n),a=gK(o)?Mb:P0;return s(o,i,a,r)}function h3e(t,e,n,i,r,s){const o=bZ(t,e,r,n),a=gK(o)?Mb:P0;return s(o[0],a,i)}function C3e(t,e,n,i){const r=t.length,s=Ia(t,o=>Ia(o,a=>a.length===1));if(e)return function(o){const a=mt(o,l=>l.GATE);for(let l=0;l<r;l++){const g=t[l],c=g.length,u=a[l];if(!(u!==void 0&&u.call(this)===!1))e:for(let I=0;I<c;I++){const h=g[I],C=h.length;for(let b=0;b<C;b++){const m=this.LA(b+1);if(n(m,h[b])===!1)continue e}return l}}};if(s&&!i){const o=mt(t,l=>ua(l)),a=ro(o,(l,g,c)=>(Nt(g,u=>{Rt(l,u.tokenTypeIdx)||(l[u.tokenTypeIdx]=c),Nt(u.categoryMatches,I=>{Rt(l,I)||(l[I]=c)})}),l),{});return function(){const l=this.LA(1);return a[l.tokenTypeIdx]}}else return function(){for(let o=0;o<r;o++){const a=t[o],l=a.length;e:for(let g=0;g<l;g++){const c=a[g],u=c.length;for(let I=0;I<u;I++){const h=this.LA(I+1);if(n(h,c[I])===!1)continue e}return o}}}}function f3e(t,e,n){const i=Ia(t,s=>s.length===1),r=t.length;if(i&&!n){const s=ua(t);if(s.length===1&&Xn(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=ro(s,(a,l,g)=>(a[l.tokenTypeIdx]=!0,Nt(l.categoryMatches,c=>{a[c]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<r;s++){const o=t[s],a=o.length;for(let l=0;l<a;l++){const g=this.LA(l+1);if(e(g,o[l])===!1)continue e}return!0}return!1}}class p3e extends py{constructor(e,n,i){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=i}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,i,r){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=i.concat(r),!0):!1}walkOption(e,n,i){this.checkIsTarget(e,hi.OPTION,n,i)||super.walkOption(e,n,i)}walkAtLeastOne(e,n,i){this.checkIsTarget(e,hi.REPETITION_MANDATORY,n,i)||super.walkOption(e,n,i)}walkAtLeastOneSep(e,n,i){this.checkIsTarget(e,hi.REPETITION_MANDATORY_WITH_SEPARATOR,n,i)||super.walkOption(e,n,i)}walkMany(e,n,i){this.checkIsTarget(e,hi.REPETITION,n,i)||super.walkOption(e,n,i)}walkManySep(e,n,i){this.checkIsTarget(e,hi.REPETITION_WITH_SEPARATOR,n,i)||super.walkOption(e,n,i)}}class aK extends JA{constructor(e,n,i){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=i,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,hi.OPTION)}visitRepetition(e){this.checkIsTarget(e,hi.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,hi.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,hi.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,hi.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,hi.ALTERNATION)}}function I7(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function kB(t){let e=[""];for(let n=0;n<t.length;n++){const i=t[n],r=[];for(let s=0;s<e.length;s++){const o=e[s];r.push(o+"_"+i.tokenTypeIdx);for(let a=0;a<i.categoryMatches.length;a++){const l="_"+i.categoryMatches[a];r.push(o+l)}}e=r}return e}function m3e(t,e,n){for(let i=0;i<t.length;i++){if(i===n)continue;const r=t[i];for(let s=0;s<e.length;s++){const o=e[s];if(r[o]===!0)return!1}}return!0}function lK(t,e){const n=mt(t,o=>VS([o],1)),i=I7(n.length),r=mt(n,o=>{const a={};return Nt(o,l=>{const g=kB(l.partialPath);Nt(g,c=>{a[c]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=I7(a.length);for(let l=0;l<a.length;l++){const g=a[l];for(let c=0;c<g.length;c++){const u=g[c].partialPath,I=g[c].suffixDef,h=kB(u);if(m3e(r,h,l)||Xn(I)||u.length===e){const b=i[l];if(LS(b,u)===!1){b.push(u);for(let m=0;m<h.length;m++){const f=h[m];r[l][f]=!0}}}else{const b=VS(I,o+1,u);s[l]=s[l].concat(b),Nt(b,m=>{const f=kB(m.partialPath);Nt(f,p=>{r[l][p]=!0})})}}}}return i}function mZ(t,e,n,i){const r=new aK(t,hi.ALTERNATION,i);return e.accept(r),lK(r.result,n)}function bZ(t,e,n,i){const r=new aK(t,n);e.accept(r);const s=r.result,a=new p3e(e,t,n).startWalking(),l=new Ns({definition:s}),g=new Ns({definition:a});return lK([l,g],i)}function LS(t,e){e:for(let n=0;n<t.length;n++){const i=t[n];if(i.length===e.length){for(let r=0;r<i.length;r++){const s=e[r],o=i[r];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function b3e(t,e){return t.length<e.length&&Ia(t,(n,i)=>{const r=e[i];return n===r||r.categoryMatchesMap[n.tokenTypeIdx]})}function gK(t){return Ia(t,e=>Ia(e,n=>Ia(n,i=>Xn(i.categoryMatches))))}function v3e(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return mt(e,n=>Object.assign({type:is.CUSTOM_LOOKAHEAD_VALIDATION},n))}function y3e(t,e,n,i){const r=No(t,l=>B3e(l,n)),s=F3e(t,e,n),o=No(t,l=>W3e(l,n)),a=No(t,l=>w3e(l,t,i,n));return r.concat(s,o,a)}function B3e(t,e){const n=new S3e;t.accept(n);const i=n.allProductions,r=Mme(i,G3e),s=wa(r,a=>a.length>1);return mt(Xi(s),a=>{const l=ba(a),g=e.buildDuplicateFoundError(t,a),c=za(l),u={message:g,type:is.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:c,occurrence:l.idx},I=cK(l);return I&&(u.parameter=I),u})}function G3e(t){return`${za(t)}_#_${t.idx}_#_${cK(t)}`}function cK(t){return t instanceof ai?t.terminalType.name:t instanceof so?t.nonTerminalName:""}class S3e extends JA{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function w3e(t,e,n,i){const r=[];if(ro(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=i.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});r.push({message:o,type:is.DUPLICATE_RULE_NAME,ruleName:t.name})}return r}function R3e(t,e,n){const i=[];let r;return as(e,t)||(r=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,i.push({message:r,type:is.INVALID_RULE_OVERRIDE,ruleName:t})),i}function uK(t,e,n,i=[]){const r=[],s=c3(e.definition);if(Xn(s))return[];{const o=t.name;as(s,t)&&r.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:i}),type:is.LEFT_RECURSION,ruleName:o});const l=Cy(s,i.concat([t])),g=No(l,c=>{const u=Vr(i);return u.push(c),uK(t,c,n,u)});return r.concat(g)}}function c3(t){let e=[];if(Xn(t))return e;const n=ba(t);if(n instanceof so)e.push(n.referencedRule);else if(n instanceof Ns||n instanceof xs||n instanceof Il||n instanceof dl||n instanceof Ra||n instanceof Ui)e=e.concat(c3(n.definition));else if(n instanceof xa)e=ua(mt(n.definition,s=>c3(s.definition)));else if(!(n instanceof ai))throw Error("non exhaustive match");const i=Zb(n),r=t.length>1;if(i&&r){const s=Ar(t);return e.concat(c3(s))}else return e}class vZ extends JA{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function x3e(t,e){const n=new vZ;t.accept(n);const i=n.alternations;return No(i,s=>{const o=t0(s.definition);return No(o,(a,l)=>{const g=sK([a],[],P0,1);return Xn(g)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:l}),type:is.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:l+1}]:[]})})}function Z3e(t,e,n){const i=new vZ;t.accept(i);let r=i.alternations;return r=fy(r,o=>o.ignoreAmbiguities===!0),No(r,o=>{const a=o.idx,l=o.maxLookahead||e,g=mZ(a,t,l,o),c=M3e(g,o,t,n),u=T3e(g,o,t,n);return c.concat(u)})}class E3e extends JA{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function W3e(t,e){const n=new vZ;t.accept(n);const i=n.alternations;return No(i,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:is.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function N3e(t,e,n){const i=[];return Nt(t,r=>{const s=new E3e;r.accept(s);const o=s.allProductions;Nt(o,a=>{const l=oK(a),g=a.maxLookahead||e,c=a.idx,I=bZ(c,r,l,g)[0];if(Xn(ua(I))){const h=n.buildEmptyRepetitionError({topLevelRule:r,repetition:a});i.push({message:h,type:is.NO_NON_EMPTY_LOOKAHEAD,ruleName:r.name})}})}),i}function M3e(t,e,n,i){const r=[],s=ro(t,(a,l,g)=>(e.definition[g].ignoreAmbiguities===!0||Nt(l,c=>{const u=[g];Nt(t,(I,h)=>{g!==h&&LS(I,c)&&e.definition[h].ignoreAmbiguities!==!0&&u.push(h)}),u.length>1&&!LS(r,c)&&(r.push(c),a.push({alts:u,path:c}))}),a),[]);return mt(s,a=>{const l=mt(a.alts,c=>c+1);return{message:i.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:l,prefixPath:a.path}),type:is.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function T3e(t,e,n,i){const r=ro(t,(o,a,l)=>{const g=mt(a,c=>({idx:l,path:c}));return o.concat(g)},[]);return U0(No(r,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const l=o.idx,g=o.path,c=Ko(r,I=>e.definition[I.idx].ignoreAmbiguities!==!0&&I.idx<l&&b3e(I.path,g));return mt(c,I=>{const h=[I.idx+1,l+1],C=e.idx===0?"":e.idx;return{message:i.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:I.path}),type:is.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:C,alternatives:h}})}))}function F3e(t,e,n){const i=[],r=mt(e,s=>s.name);return Nt(t,s=>{const o=s.name;if(as(r,o)){const a=n.buildNamespaceConflictError(s);i.push({message:a,type:is.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),i}function V3e(t){const e=AZ(t,{errMsgProvider:o3e}),n={};return Nt(t.rules,i=>{n[i.name]=i}),a3e(n,e.errMsgProvider)}function L3e(t){return t=AZ(t,{errMsgProvider:Fu}),y3e(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const IK="MismatchedTokenException",dK="NoViableAltException",AK="EarlyExitException",hK="NotAllInputParsedException",CK=[IK,dK,AK,hK];Object.freeze(CK);function Tb(t){return as(CK,t.name)}class vy extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class fK extends vy{constructor(e,n,i){super(e,n),this.previousToken=i,this.name=IK}}class k3e extends vy{constructor(e,n,i){super(e,n),this.previousToken=i,this.name=dK}}class H3e extends vy{constructor(e,n){super(e,n),this.name=hK}}class _3e extends vy{constructor(e,n,i){super(e,n),this.previousToken=i,this.name=AK}}const HB={},pK="InRuleRecoveryException";class X3e extends Error{constructor(e){super(e),this.name=pK}}class Y3e{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Rt(e,"recoveryEnabled")?e.recoveryEnabled:vc.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=K3e)}getTokenToInsert(e){const n=pZ(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,i,r){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let l=!1;const g=this.LA(1);let c=this.LA(1);const u=()=>{const I=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:r,actual:g,previous:I,ruleName:this.getCurrRuleFullName()}),C=new fK(h,g,this.LA(0));C.resyncedTokens=t0(a),this.SAVE_ERROR(C)};for(;!l;)if(this.tokenMatcher(c,r)){u();return}else if(i.call(this)){u(),e.apply(this,n);return}else this.tokenMatcher(c,s)?l=!0:(c=this.SKIP_TOKEN(),this.addToResyncTokens(c,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,i){return!(i===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const i=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(i)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const i=this.SKIP_TOKEN();return this.consumeToken(),i}throw new X3e("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||Xn(n))return!1;const i=this.LA(1);return ZA(n,s=>this.tokenMatcher(i,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),i=this.getFollowSetFromFollowKey(n);return as(i,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),i=2;for(;;){const r=ZA(e,s=>s3e(n,s));if(r!==void 0)return r;n=this.LA(i),i++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return HB;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),i=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(i)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return mt(e,(i,r)=>r===0?HB:{ruleName:this.shortRuleNameToFullName(i),idxInCallingRule:n[r],inRule:this.shortRuleNameToFullName(e[r-1])})}flattenFollowSet(){const e=mt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return ua(e)}getFollowSetFromFollowKey(e){if(e===HB)return[uI];const n=e.ruleName+e.idxInCallingRule+PY+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,uI)||n.push(e),n}reSyncTo(e){const n=[];let i=this.LA(1);for(;this.tokenMatcher(i,e)===!1;)i=this.SKIP_TOKEN(),this.addToResyncTokens(i,n);return t0(n)}attemptInRepetitionRecovery(e,n,i,r,s,o,a){}getCurrentGrammarPath(e,n){const i=this.getHumanReadableRuleStack(),r=Vr(this.RULE_OCCURRENCE_STACK);return{ruleStack:i,occurrenceStack:r,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return mt(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function K3e(t,e,n,i,r,s,o){const a=this.getKeyForAutomaticLookahead(i,r);let l=this.firstAfterRepMap[a];if(l===void 0){const I=this.getCurrRuleFullName(),h=this.getGAstProductions()[I];l=new s(h,r).startWalking(),this.firstAfterRepMap[a]=l}let g=l.token,c=l.occurrence;const u=l.isEndOfRule;this.RULE_STACK.length===1&&u&&g===void 0&&(g=uI,c=1),!(g===void 0||c===void 0)&&this.shouldInRepetitionRecoveryBeTried(g,c,o)&&this.tryInRepetitionRecovery(t,e,n,g)}const z3e=4,Nc=8,mK=1<<Nc,bK=2<<Nc,kS=3<<Nc,HS=4<<Nc,_S=5<<Nc,u3=6<<Nc;function _B(t,e,n){return n|e|t}class U3e{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:vc.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(Xn(n)){const i=this.validateEmptyOrAlternatives(e.rules),r=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...i,...r,...s]}return n}validateNoLeftRecursion(e){return No(e,n=>uK(n,n,Fu))}validateEmptyOrAlternatives(e){return No(e,n=>x3e(n,Fu))}validateAmbiguousAlternationAlternatives(e,n){return No(e,i=>Z3e(i,n,Fu))}validateSomeNonEmptyLookaheadPath(e,n){return N3e(e,n,Fu)}buildLookaheadForAlternation(e){return A3e(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,C3e)}buildLookaheadForOptional(e){return h3e(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,oK(e.prodType),f3e)}}class D3e{initLooksAhead(e){this.dynamicTokensEnabled=Rt(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:vc.dynamicTokensEnabled,this.maxLookahead=Rt(e,"maxLookahead")?e.maxLookahead:vc.maxLookahead,this.lookaheadStrategy=Rt(e,"lookaheadStrategy")?e.lookaheadStrategy:new U3e({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Nt(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:i,repetition:r,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:l}=O3e(n);Nt(i,g=>{const c=g.idx===0?"":g.idx;this.TRACE_INIT(`${za(g)}${c}`,()=>{const u=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:g.idx,rule:n,maxLookahead:g.maxLookahead||this.maxLookahead,hasPredicates:g.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),I=_B(this.fullRuleNameToShort[n.name],mK,g.idx);this.setLaFuncCache(I,u)})}),Nt(r,g=>{this.computeLookaheadFunc(n,g.idx,kS,"Repetition",g.maxLookahead,za(g))}),Nt(s,g=>{this.computeLookaheadFunc(n,g.idx,bK,"Option",g.maxLookahead,za(g))}),Nt(o,g=>{this.computeLookaheadFunc(n,g.idx,HS,"RepetitionMandatory",g.maxLookahead,za(g))}),Nt(a,g=>{this.computeLookaheadFunc(n,g.idx,u3,"RepetitionMandatoryWithSeparator",g.maxLookahead,za(g))}),Nt(l,g=>{this.computeLookaheadFunc(n,g.idx,_S,"RepetitionWithSeparator",g.maxLookahead,za(g))})})})}computeLookaheadFunc(e,n,i,r,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:r}),l=_B(this.fullRuleNameToShort[e.name],i,n);this.setLaFuncCache(l,a)})}getKeyForAutomaticLookahead(e,n){const i=this.getLastExplicitRuleShortName();return _B(i,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class P3e extends JA{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const B2=new P3e;function O3e(t){B2.reset(),t.accept(B2);const e=B2.dslMethods;return B2.reset(),e}function d7(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function A7(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function Q3e(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function J3e(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const j3e="name";function vK(t,e){Object.defineProperty(t,j3e,{enumerable:!1,configurable:!0,writable:!1,value:e})}function q3e(t,e){const n=no(t),i=n.length;for(let r=0;r<i;r++){const s=n[r],o=t[s],a=o.length;for(let l=0;l<a;l++){const g=o[l];g.tokenTypeIdx===void 0&&this[g.name](g.children,e)}}}function $3e(t,e){const n=function(){};vK(n,t+"BaseSemantics");const i={visit:function(r,s){if(un(r)&&(r=r[0]),!rg(r))return this[r.name](r.children,s)},validateVisitor:function(){const r=tbe(this,e);if(!Xn(r)){const s=mt(r,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=i,n.prototype.constructor=n,n._RULE_NAMES=e,n}function ebe(t,e,n){const i=function(){};vK(i,t+"BaseSemanticsWithDefaults");const r=Object.create(n.prototype);return Nt(e,s=>{r[s]=q3e}),i.prototype=r,i.prototype.constructor=i,i}var XS;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(XS||(XS={}));function tbe(t,e){return nbe(t,e)}function nbe(t,e){const n=Ko(e,r=>Ig(t[r])===!1),i=mt(n,r=>({msg:`Missing visitor method: <${r}> on ${t.constructor.name} CST Visitor.`,type:XS.MISSING_METHOD,methodName:r}));return U0(i)}class ibe{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Rt(e,"nodeLocationTracking")?e.nodeLocationTracking:vc.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Hi,this.cstFinallyStateUpdate=Hi,this.cstPostTerminal=Hi,this.cstPostNonTerminal=Hi,this.cstPostRule=Hi;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=A7,this.setNodeLocationFromNode=A7,this.cstPostRule=Hi,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Hi,this.setNodeLocationFromNode=Hi,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=d7,this.setNodeLocationFromNode=d7,this.cstPostRule=Hi,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Hi,this.setNodeLocationFromNode=Hi,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Hi,this.setNodeLocationFromNode=Hi,this.cstPostRule=Hi,this.setInitialNodeLocation=Hi;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),i=e.location;i.startOffset<=n.startOffset?(i.endOffset=n.endOffset,i.endLine=n.endLine,i.endColumn=n.endColumn):(i.startOffset=NaN,i.startLine=NaN,i.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),i=e.location;i.startOffset<=n.startOffset?i.endOffset=n.endOffset:i.startOffset=NaN}cstPostTerminal(e,n){const i=this.CST_STACK[this.CST_STACK.length-1];Q3e(i,n,e),this.setNodeLocationFromToken(i.location,n)}cstPostNonTerminal(e,n){const i=this.CST_STACK[this.CST_STACK.length-1];J3e(i,n,e),this.setNodeLocationFromNode(i.location,e.location)}getBaseCstVisitorConstructor(){if(rg(this.baseCstVisitorConstructor)){const e=$3e(this.className,no(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(rg(this.baseCstVisitorWithDefaultsConstructor)){const e=ebe(this.className,no(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class rbe{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Vb}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Vb:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class sbe{ACTION(e){return e.call(this)}consume(e,n,i){return this.consumeInternal(n,e,i)}subrule(e,n,i){return this.subruleInternal(n,e,i)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,i=Lb){if(as(this.definedRulesNames,e)){const o={message:Fu.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:is.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const r=this.defineRule(e,n,i);return this[e]=r,r}OVERRIDE_RULE(e,n,i=Lb){const r=R3e(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(r);const s=this.defineRule(e,n,i);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const i=this.saveRecogState();try{return e.apply(this,n),!0}catch(r){if(Tb(r))return!1;throw r}finally{this.reloadRecogState(i),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return a2e(Xi(this.gastProductionsCache))}}class obe{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Mb,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Rt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(un(e)){if(Xn(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(un(e))this.tokensMap=ro(e,(s,o)=>(s[o.name]=o,s),{});else if(Rt(e,"modes")&&Ia(ua(Xi(e.modes)),t3e)){const s=ua(Xi(e.modes)),o=hZ(s);this.tokensMap=ro(o,(a,l)=>(a[l.name]=l,a),{})}else if(Lo(e))this.tokensMap=Vr(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=uI;const i=Rt(e,"modes")?ua(Xi(e.modes)):Xi(e),r=Ia(i,s=>Xn(s.categoryMatches));this.tokenMatcher=r?Mb:P0,O0(Xi(this.tokensMap))}defineRule(e,n,i){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const r=Rt(i,"resyncEnabled")?i.resyncEnabled:Lb.resyncEnabled,s=Rt(i,"recoveryValueFunc")?i.recoveryValueFunc:Lb.recoveryValueFunc,o=this.ruleShortNameIdx<<z3e+Nc;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...c){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,c);const u=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(u),u}catch(u){return this.invokeRuleCatch(u,r,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...c){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,c)}catch(u){return this.invokeRuleCatch(u,r,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,i){const r=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Tb(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const l=this.CST_STACK[this.CST_STACK.length-1];return l.recoveredNode=!0,l}else return i(e);else{if(this.outputCst){const l=this.CST_STACK[this.CST_STACK.length-1];l.recoveredNode=!0,o.partialCstResult=l}throw o}}else{if(r)return this.moveToTerminatedState(),i(e);throw o}}else throw e}optionInternal(e,n){const i=this.getKeyForAutomaticLookahead(bK,n);return this.optionInternalLogic(e,n,i)}optionInternalLogic(e,n,i){let r=this.getLaFuncFromCache(i),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=r;r=()=>o.call(this)&&a.call(this)}}else s=e;if(r.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const i=this.getKeyForAutomaticLookahead(HS,e);return this.atLeastOneInternalLogic(e,n,i)}atLeastOneInternalLogic(e,n,i){let r=this.getLaFuncFromCache(i),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=r;r=()=>o.call(this)&&a.call(this)}}else s=n;if(r.call(this)===!0){let o=this.doSingleRepetition(s);for(;r.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,hi.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],r,HS,e,I3e)}atLeastOneSepFirstInternal(e,n){const i=this.getKeyForAutomaticLookahead(u3,e);this.atLeastOneSepFirstInternalLogic(e,n,i)}atLeastOneSepFirstInternalLogic(e,n,i){const r=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(i).call(this)===!0){r.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,r,u7],a,u3,e,u7)}else throw this.raiseEarlyExitException(e,hi.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const i=this.getKeyForAutomaticLookahead(kS,e);return this.manyInternalLogic(e,n,i)}manyInternalLogic(e,n,i){let r=this.getLaFuncFromCache(i),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const l=r;r=()=>a.call(this)&&l.call(this)}}else s=n;let o=!0;for(;r.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],r,kS,e,u3e,o)}manySepFirstInternal(e,n){const i=this.getKeyForAutomaticLookahead(_S,e);this.manySepFirstInternalLogic(e,n,i)}manySepFirstInternalLogic(e,n,i){const r=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(i).call(this)===!0){r.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,r,c7],a,_S,e,c7)}}repetitionSepSecondInternal(e,n,i,r,s){for(;i();)this.CONSUME(n),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,i,r,s],i,u3,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const i=this.getKeyForAutomaticLookahead(mK,n),r=un(e)?e:e.DEF,o=this.getLaFuncFromCache(i).call(this,r);if(o!==void 0)return r[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new H3e(n,e))}}subruleInternal(e,n,i){let r;try{const s=i!==void 0?i.ARGS:void 0;return this.subruleIdx=n,r=e.apply(this,s),this.cstPostNonTerminal(r,i!==void 0&&i.LABEL!==void 0?i.LABEL:e.ruleName),r}catch(s){throw this.subruleInternalError(s,i,e.ruleName)}}subruleInternalError(e,n,i){throw Tb(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:i),delete e.partialCstResult),e}consumeInternal(e,n,i){let r;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),r=s):this.consumeInternalError(e,s,i)}catch(s){r=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(i!==void 0&&i.LABEL!==void 0?i.LABEL:e.name,r),r}consumeInternalError(e,n,i){let r;const s=this.LA(0);throw i!==void 0&&i.ERR_MSG?r=i.ERR_MSG:r=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new fK(r,n,s))}consumeInternalRecovery(e,n,i){if(this.recoveryEnabled&&i.name==="MismatchedTokenException"&&!this.isBackTracking()){const r=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,r)}catch(s){throw s.name===pK?i:s}}else throw i}saveRecogState(){const e=this.errors,n=Vr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,i){this.RULE_OCCURRENCE_STACK.push(i),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),uI)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class abe{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Rt(e,"errorMessageProvider")?e.errorMessageProvider:vc.errorMessageProvider}SAVE_ERROR(e){if(Tb(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Vr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Vr(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,i){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],a=bZ(e,s,n,this.maxLookahead)[0],l=[];for(let c=1;c<=this.maxLookahead;c++)l.push(this.LA(c));const g=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:l,previous:this.LA(0),customUserDescription:i,ruleName:r});throw this.SAVE_ERROR(new _3e(g,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const i=this.getCurrRuleFullName(),r=this.getGAstProductions()[i],s=mZ(e,r,this.maxLookahead),o=[];for(let g=1;g<=this.maxLookahead;g++)o.push(this.LA(g));const a=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new k3e(l,this.LA(1),a))}}class lbe{initContentAssist(){}computeContentAssist(e,n){const i=this.gastProductionsCache[e];if(rg(i))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return sK([i],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=ba(e.ruleStack),r=this.getGAstProductions()[n];return new c3e(r,e).startWalking()}}const yy={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(yy);const h7=!0,C7=Math.pow(2,Nc)-1,yK=iK({name:"RECORDING_PHASE_TOKEN",pattern:Mo.NA});O0([yK]);const BK=pZ(yK,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(BK);const gbe={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class cbe{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(i,r){return this.consumeInternalRecord(i,e,r)},this[`SUBRULE${n}`]=function(i,r){return this.subruleInternalRecord(i,e,r)},this[`OPTION${n}`]=function(i){return this.optionInternalRecord(i,e)},this[`OR${n}`]=function(i){return this.orInternalRecord(i,e)},this[`MANY${n}`]=function(i){this.manyInternalRecord(e,i)},this[`MANY_SEP${n}`]=function(i){this.manySepFirstInternalRecord(e,i)},this[`AT_LEAST_ONE${n}`]=function(i){this.atLeastOneInternalRecord(e,i)},this[`AT_LEAST_ONE_SEP${n}`]=function(i){this.atLeastOneSepFirstInternalRecord(e,i)}}this.consume=function(e,n,i){return this.consumeInternalRecord(n,e,i)},this.subrule=function(e,n,i){return this.subruleInternalRecord(n,e,i)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const i=n>0?n:"";delete e[`CONSUME${i}`],delete e[`SUBRULE${i}`],delete e[`OPTION${i}`],delete e[`OR${i}`],delete e[`MANY${i}`],delete e[`MANY_SEP${i}`],delete e[`AT_LEAST_ONE${i}`],delete e[`AT_LEAST_ONE_SEP${i}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Vb}topLevelRuleRecord(e,n){try{const i=new QA({definition:[],name:e});return i.name=e,this.recordingProdStack.push(i),n.call(this),this.recordingProdStack.pop(),i}catch(i){if(i.KNOWN_RECORDER_ERROR!==!0)try{i.message=i.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw i}throw i}}optionInternalRecord(e,n){return tC.call(this,xs,e,n)}atLeastOneInternalRecord(e,n){tC.call(this,Il,n,e)}atLeastOneSepFirstInternalRecord(e,n){tC.call(this,dl,n,e,h7)}manyInternalRecord(e,n){tC.call(this,Ui,n,e)}manySepFirstInternalRecord(e,n){tC.call(this,Ra,n,e,h7)}orInternalRecord(e,n){return ube.call(this,e,n)}subruleInternalRecord(e,n,i){if(Fb(n),!e||Rt(e,"ruleName")===!1){const a=new Error(`<SUBRULE${f7(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const r=xA(this.recordingProdStack),s=e.ruleName,o=new so({idx:n,nonTerminalName:s,label:i==null?void 0:i.LABEL,referencedRule:void 0});return r.definition.push(o),this.outputCst?gbe:yy}consumeInternalRecord(e,n,i){if(Fb(n),!tK(e)){const o=new Error(`<CONSUME${f7(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const r=xA(this.recordingProdStack),s=new ai({idx:n,terminalType:e,label:i==null?void 0:i.LABEL});return r.definition.push(s),BK}}function tC(t,e,n,i=!1){Fb(n);const r=xA(this.recordingProdStack),s=Ig(e)?e:e.DEF,o=new t({definition:[],idx:n});return i&&(o.separator=e.SEP),Rt(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),r.definition.push(o),this.recordingProdStack.pop(),yy}function ube(t,e){Fb(e);const n=xA(this.recordingProdStack),i=un(t)===!1,r=i===!1?t:t.DEF,s=new xa({definition:[],idx:e,ignoreAmbiguities:i&&t.IGNORE_AMBIGUITIES===!0});Rt(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=KY(r,a=>Ig(a.GATE));return s.hasPredicates=o,n.definition.push(s),Nt(r,a=>{const l=new Ns({definition:[]});s.definition.push(l),Rt(a,"IGNORE_AMBIGUITIES")?l.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Rt(a,"GATE")&&(l.ignoreAmbiguities=!0),this.recordingProdStack.push(l),a.ALT.call(this),this.recordingProdStack.pop()}),yy}function f7(t){return t===0?"":`${t}`}function Fb(t){if(t<0||t>C7){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${C7+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class Ibe{initPerformanceTracer(e){if(Rt(e,"traceInitPerf")){const n=e.traceInitPerf,i=typeof n=="number";this.traceInitMaxIdent=i?n:1/0,this.traceInitPerf=i?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=vc.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const i=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${i}--> <${e}>`);const{time:r,value:s}=UY(n),o=r>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${i}<-- <${e}> time: ${r}ms`),this.traceInitIndent--,s}else return n()}}function dbe(t,e){e.forEach(n=>{const i=n.prototype;Object.getOwnPropertyNames(i).forEach(r=>{if(r==="constructor")return;const s=Object.getOwnPropertyDescriptor(i,r);s&&(s.get||s.set)?Object.defineProperty(t.prototype,r,s):t.prototype[r]=n.prototype[r]})})}const Vb=pZ(uI,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Vb);const vc=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:rK,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Lb=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var is;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(is||(is={}));class By{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{DY(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Nt(this.definedRulesNames,r=>{const o=this[r].originalGrammarAction;let a;this.TRACE_INIT(`${r} Rule`,()=>{a=this.topLevelRuleRecord(r,o)}),this.gastProductionsCache[r]=a})}finally{this.disableRecording()}});let i=[];if(this.TRACE_INIT("Grammar Resolving",()=>{i=V3e({rules:Xi(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(i)}),this.TRACE_INIT("Grammar Validations",()=>{if(Xn(i)&&this.skipValidations===!1){const r=L3e({rules:Xi(this.gastProductionsCache),tokenTypes:Xi(this.tokensMap),errMsgProvider:Fu,grammarName:n}),s=v3e({lookaheadStrategy:this.lookaheadStrategy,rules:Xi(this.gastProductionsCache),tokenTypes:Xi(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(r,s)}}),Xn(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const r=A2e(Xi(this.gastProductionsCache));this.resyncFollows=r}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var r,s;(s=(r=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(r,{rules:Xi(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Xi(this.gastProductionsCache))})),!By.DEFER_DEFINITION_ERRORS_HANDLING&&!Xn(this.definitionErrors))throw e=mt(this.definitionErrors,r=>r.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const i=this;if(i.initErrorHandler(n),i.initLexerAdapter(),i.initLooksAhead(n),i.initRecognizerEngine(e,n),i.initRecoverable(n),i.initTreeBuilder(n),i.initContentAssist(),i.initGastRecorder(n),i.initPerformanceTracer(n),Rt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Rt(n,"skipValidations")?n.skipValidations:vc.skipValidations}}By.DEFER_DEFINITION_ERRORS_HANDLING=!1;dbe(By,[Y3e,D3e,ibe,rbe,obe,sbe,abe,lbe,cbe,Ibe]);class Abe{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const n=this.workerCreator();n.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=n}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,n){const i=this.workersResolve[e];if(i&&i(n),this.queue.length){const{resolve:r,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,n){return new Promise(i=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=i,this.workers[r].postMessage(e,n)):this.queue.push({resolve:i,msg:e,transfer:n})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class hbe extends fc{constructor(e,n,i,r,s,o){super(e,n,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Ci}}const XB=new WeakMap;let YB=0,KB;const hC=class extends Lr{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Abe,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new ns(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),n=new ns(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,i]).then(([r,s])=>{const o=hC.BasisWorker.toString(),a=["/* constants */","let _EngineFormat = "+JSON.stringify(hC.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(hC.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(hC.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a])),this.transcoderBinary=s,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),g=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:g},[g]),l})}),YB>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),YB++}return this.transcoderPending}load(t,e,n,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new ns(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(t,s=>{if(XB.has(s))return XB.get(s).promise.then(e).catch(i);this._createTexture(s).then(o=>e?e(o):null).catch(i)},n,i)}_createTextureFrom(t,e){const{mipmaps:n,width:i,height:r,format:s,type:o,error:a,dfdTransferFn:l,dfdFlags:g}=t;if(o==="error")return Promise.reject(a);const c=e.layerCount>1?new hbe(n,i,r,e.layerCount,s,Yi):new fc(n,i,r,s,Yi);return c.minFilter=n.length===1?xn:rl,c.magFilter=xn,c.generateMipmaps=!1,c.needsUpdate=!0,"colorSpace"in c?c.colorSpace=l===hS?"srgb":"srgb-linear":c.encoding=l===hS?3001:3e3,c.premultiplyAlpha=!!(g&Gce),c}async _createTexture(t,e={}){const n=xce(new Uint8Array(t));if(n.vkFormat!==pX)return fbe(n);const i=e,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:i},[t])).then(s=>this._createTextureFrom(s.data,n));return XB.set(t,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),YB--,this}};let Gy=hC;Oe(Gy,"BasisFormat",{ETC1S:0,UASTC_4x4:1});Oe(Gy,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16});Oe(Gy,"EngineFormat",{RGBAFormat:fi,RGBA_ASTC_4x4_Format:Tf,RGBA_BPTC_Format:rA,RGBA_ETC2_EAC_Format:Mf,RGBA_PVRTC_4BPPV1_Format:Wf,RGBA_S3TC_DXT5_Format:iA,RGB_ETC1_Format:Sv,RGB_ETC2_Format:Nf,RGB_PVRTC_4BPPV1_Format:Ef,RGB_S3TC_DXT1_Format:nA});Oe(Gy,"BasisWorker",function(){let t,e,n;const i=_EngineFormat,r=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(C){const b=C.data;switch(b.type){case"init":t=b.config,o(b.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:m,height:f,hasAlpha:p,mipmaps:v,format:B,dfdTransferFn:G,dfdFlags:R}=a(b.buffer),w=[];for(let E=0;E<v.length;++E)w.push(v[E].data.buffer);self.postMessage({type:"transcode",id:b.id,width:m,height:f,hasAlpha:p,mipmaps:v,format:B,dfdTransferFn:G,dfdFlags:R},w)}catch(m){console.error(m),self.postMessage({type:"error",id:b.id,error:m.message})}});break}});function o(C){e=new Promise(b=>{n={wasmBinary:C,onRuntimeInitialized:b},BASIS(n)}).then(()=>{n.initializeBasis(),n.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(C){const b=new n.KTX2File(new Uint8Array(C));function m(){b.close(),b.delete()}if(!b.isValid())throw m(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const f=b.isUASTC()?s.UASTC_4x4:s.ETC1S,p=b.getWidth(),v=b.getHeight(),B=b.getLayers()||1,G=b.getLevels(),R=b.getHasAlpha(),w=b.getDFDTransferFunc(),E=b.getDFDFlags(),{transcoderFormat:x,engineFormat:W}=u(f,p,v,R);if(!p||!v||!G)throw m(),new Error("THREE.KTX2Loader:	Invalid texture");if(!b.startTranscoding())throw m(),new Error("THREE.KTX2Loader: .startTranscoding failed");const T=[];for(let k=0;k<G;k++){const _=[];let U,O;for(let Y=0;Y<B;Y++){const z=b.getImageLevelInfo(k,Y,0);U=z.origWidth<4?z.origWidth:z.width,O=z.origHeight<4?z.origHeight:z.height;const N=new Uint8Array(b.getImageTranscodedSizeInBytes(k,Y,0,x));if(!b.transcodeImage(N,k,Y,0,x,0,-1,-1))throw m(),new Error("THREE.KTX2Loader: .transcodeImage failed.");_.push(N)}T.push({data:h(_),width:U,height:O})}return m(),{width:p,height:v,hasAlpha:R,mipmaps:T,format:W,dfdTransferFn:w,dfdFlags:E}}const l=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],g=l.sort(function(C,b){return C.priorityETC1S-b.priorityETC1S}),c=l.sort(function(C,b){return C.priorityUASTC-b.priorityUASTC});function u(C,b,m,f){let p,v;const B=C===s.ETC1S?g:c;for(let G=0;G<B.length;G++){const R=B[G];if(t[R.if]&&R.basisFormat.includes(C)&&!(f&&R.transcoderFormat.length<2)&&!(R.needsPowerOfTwo&&!(I(b)&&I(m))))return p=R.transcoderFormat[f?1:0],v=R.engineFormat[f?1:0],{transcoderFormat:p,engineFormat:v}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),p=r.RGBA32,v=i.RGBAFormat,{transcoderFormat:p,engineFormat:v}}function I(C){return C<=2?!0:(C&C-1)===0&&C!==0}function h(C){let b=0;for(let p=0;p<C.length;p++){const v=C[p];b+=v.byteLength}const m=new Uint8Array(b);let f=0;for(let p=0;p<C.length;p++){const v=C[p];m.set(v,f),f+=v.byteLength}return m}});const p7={[RX]:fi,[GX]:fi,[vX]:fi,[Ux]:fi,[wX]:Vd,[BX]:Vd,[bX]:Vd,[zx]:Vd,[SX]:Eu,[yX]:Eu,[Kx]:Eu,[mX]:Eu},zB={[RX]:es,[GX]:Ri,[vX]:Yi,[Ux]:Yi,[wX]:es,[BX]:Ri,[bX]:Yi,[zx]:Yi,[SX]:es,[yX]:Ri,[Kx]:Yi,[mX]:Yi},Cbe={[Ux]:3001,[zx]:3001,[Kx]:3001};async function fbe(t){const{vkFormat:e,pixelWidth:n,pixelHeight:i,pixelDepth:r}=t;if(p7[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const s=t.levels[0];let o,a;if(t.supercompressionScheme===fX)o=s.levelData;else if(t.supercompressionScheme===pce)KB||(KB=new Promise(async g=>{const c=new Zce;await c.init(),g(c)})),o=(await KB).decode(s.levelData,s.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");zB[e]===es?a=new Float32Array(o.buffer,o.byteOffset,o.byteLength/Float32Array.BYTES_PER_ELEMENT):zB[e]===Ri?a=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/Uint16Array.BYTES_PER_ELEMENT):a=o;const l=r===0?new ja(a,n,i):new XAe(a,n,i,r);return l.type=zB[e],l.format=p7[e],l.encoding=Cbe[e]||3e3,l.needsUpdate=!0,Promise.resolve(l)}const UB=new WeakMap,CC=class extends Lr{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerLimit=t,this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}load(t,e,n,i){const r=new ns(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const s=new fc;return r.load(t,o=>{if(UB.has(o))return UB.get(o).promise.then(e).catch(i);this._createTexture([o]).then(function(a){s.copy(a),s.needsUpdate=!0,e&&e(s)}).catch(i)},n,i),s}parseInternalAsync(t){const{levels:e}=t,n=new Set;for(let i=0;i<e.length;i++)n.add(e[i].data.buffer);return this._createTexture(Array.from(n),{...t,lowLevel:!0})}_createTexture(t,e={}){let n,i;const r=e;let s=0;for(let a=0;a<t.length;a++)s+=t[a].byteLength;const o=this._allocateWorker(s).then(a=>(n=a,i=this.workerNextTaskID++,new Promise((l,g)=>{n._callbacks[i]={resolve:l,reject:g},n.postMessage({type:"transcode",id:i,buffers:t,taskConfig:r},t)}))).then(a=>{const{mipmaps:l,width:g,height:c,format:u}=a,I=new fc(l,g,c,u,Yi);return I.minFilter=l.length===1?xn:rl,I.magFilter=xn,I.generateMipmaps=!1,I.needsUpdate=!0,I});return o.catch(()=>!0).then(()=>{n&&i&&(n._taskLoad-=s,delete n._callbacks[i])}),UB.set(t[0],{promise:o}),o}_initTranscoder(){if(!this.transcoderPending){const t=new ns(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=new Promise((r,s)=>{t.load("basis_transcoder.js",r,void 0,s)}),n=new ns(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=new Promise((r,s)=>{n.load("basis_transcoder.wasm",r,void 0,s)});this.transcoderPending=Promise.all([e,i]).then(([r,s])=>{const o=CC.BasisWorker.toString(),a=["/* constants */","let _EngineFormat = "+JSON.stringify(CC.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(CC.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(CC.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a])),this.transcoderBinary=s})}return this.transcoderPending}_allocateWorker(t){return this._initTranscoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskLoad=0,n.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),n.onmessage=function(i){const r=i.data;switch(r.type){case"transcode":n._callbacks[r.id].resolve(r);break;case"error":n._callbacks[r.id].reject(r);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,i){return n._taskLoad>i._taskLoad?-1:1});const e=this.workerPool[this.workerPool.length-1];return e._taskLoad+=t,e})}dispose(){for(let t=0;t<this.workerPool.length;t++)this.workerPool[t].terminate();return this.workerPool.length=0,this}};let Sy=CC;Oe(Sy,"BasisFormat",{ETC1S:0,UASTC_4x4:1});Oe(Sy,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16});Oe(Sy,"EngineFormat",{RGBAFormat:fi,RGBA_ASTC_4x4_Format:Tf,RGBA_BPTC_Format:rA,RGBA_ETC2_EAC_Format:Mf,RGBA_PVRTC_4BPPV1_Format:Wf,RGBA_S3TC_DXT5_Format:iA,RGB_ETC1_Format:Sv,RGB_ETC2_Format:Nf,RGB_PVRTC_4BPPV1_Format:Ef,RGB_S3TC_DXT1_Format:nA});Oe(Sy,"BasisWorker",function(){let t,e,n;const i=_EngineFormat,r=_TranscoderFormat,s=_BasisFormat;onmessage=function(p){const v=p.data;switch(v.type){case"init":t=v.config,o(v.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:B,height:G,hasAlpha:R,mipmaps:w,format:E}=v.taskConfig.lowLevel?a(v.taskConfig):l(v.buffers[0]),x=[];for(let W=0;W<w.length;++W)x.push(w[W].data.buffer);self.postMessage({type:"transcode",id:v.id,width:B,height:G,hasAlpha:R,mipmaps:w,format:E},x)}catch(B){console.error(B),self.postMessage({type:"error",id:v.id,error:B.message})}});break}};function o(p){e=new Promise(v=>{n={wasmBinary:p,onRuntimeInitialized:v},BASIS(n)}).then(()=>{n.initializeBasis()})}function a(p){const{basisFormat:v,width:B,height:G,hasAlpha:R}=p,{transcoderFormat:w,engineFormat:E}=I(v,B,G,R),x=n.getBytesPerBlockOrPixel(w);h(n.isFormatSupported(w),"THREE.BasisTextureLoader: Unsupported format.");const W=[];if(v===s.ETC1S){const T=new n.LowLevelETC1SImageTranscoder,{endpointCount:k,endpointsData:_,selectorCount:U,selectorsData:O,tablesData:Y}=p.globalData;try{let z;z=T.decodePalettes(k,_,U,O),h(z,"THREE.BasisTextureLoader: decodePalettes() failed."),z=T.decodeTables(Y),h(z,"THREE.BasisTextureLoader: decodeTables() failed.");for(let N=0;N<p.levels.length;N++){const L=p.levels[N],V=p.globalData.imageDescs[N],M=m(w,L.width,L.height),X=new Uint8Array(M);z=T.transcodeImage(w,X,M/x,L.data,C(w,L.width),b(w,L.height),L.width,L.height,L.index,V.rgbSliceByteOffset,V.rgbSliceByteLength,V.alphaSliceByteOffset,V.alphaSliceByteLength,V.imageFlags,R,!1,0,0),h(z,"THREE.BasisTextureLoader: transcodeImage() failed for level "+L.index+"."),W.push({data:X,width:L.width,height:L.height})}}finally{T.delete()}}else for(let T=0;T<p.levels.length;T++){const k=p.levels[T],_=m(w,k.width,k.height),U=new Uint8Array(_),O=n.transcodeUASTCImage(w,U,_/x,k.data,C(w,k.width),b(w,k.height),k.width,k.height,k.index,0,k.data.byteLength,0,R,!1,0,0,-1,-1);h(O,"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+k.index+"."),W.push({data:U,width:k.width,height:k.height})}return{width:B,height:G,hasAlpha:R,mipmaps:W,format:E}}function l(p){const v=new n.BasisFile(new Uint8Array(p)),B=v.isUASTC()?s.UASTC_4x4:s.ETC1S,G=v.getImageWidth(0,0),R=v.getImageHeight(0,0),w=v.getNumLevels(0),E=v.getHasAlpha();function x(){v.close(),v.delete()}const{transcoderFormat:W,engineFormat:T}=I(B,G,R,E);if(!G||!R||!w)throw x(),new Error("THREE.BasisTextureLoader:	Invalid texture");if(!v.startTranscoding())throw x(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");const k=[];for(let _=0;_<w;_++){const U=v.getImageWidth(0,_),O=v.getImageHeight(0,_),Y=new Uint8Array(v.getImageTranscodedSizeInBytes(0,_,W));if(!v.transcodeImage(Y,0,_,W,0,E))throw x(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");k.push({data:Y,width:U,height:O})}return x(),{width:G,height:R,hasAlpha:E,mipmaps:k,format:T}}const g=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC1],engineFormat:[i.RGB_ETC1_Format,i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=g.sort(function(p,v){return p.priorityETC1S-v.priorityETC1S}),u=g.sort(function(p,v){return p.priorityUASTC-v.priorityUASTC});function I(p,v,B,G){let R,w;const E=p===s.ETC1S?c:u;for(let x=0;x<E.length;x++){const W=E[x];if(t[W.if]&&W.basisFormat.includes(p)&&!(W.needsPowerOfTwo&&!(f(v)&&f(B))))return R=W.transcoderFormat[G?1:0],w=W.engineFormat[G?1:0],{transcoderFormat:R,engineFormat:w}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),R=r.RGBA32,w=i.RGBAFormat,{transcoderFormat:R,engineFormat:w}}function h(p,v){if(!p)throw new Error(v)}function C(p,v){return Math.ceil(v/n.getFormatBlockWidth(p))}function b(p,v){return Math.ceil(v/n.getFormatBlockHeight(p))}function m(p,v,B){const G=n.getBytesPerBlockOrPixel(p);if(n.formatIsUncompressed(p))return v*B*G;if(p===r.PVRTC1_4_RGB||p===r.PVRTC1_4_RGBA){const R=v+3&-4,w=B+3&-4;return(Math.max(8,R)*Math.max(8,w)*4+7)/8}return C(p,v)*b(p,B)*G}function f(p){return p<=2?!0:(p&p-1)===0&&p!==0}});const pbe=H.forwardRef(function({follow:e=!0,lockX:n=!1,lockY:i=!1,lockZ:r=!1,...s},o){const a=H.useRef();return GI(({camera:l})=>{if(!e||!a.current)return;const g=a.current.rotation.clone();l.getWorldQuaternion(a.current.quaternion),n&&(a.current.rotation.x=g.x),i&&(a.current.rotation.y=g.y),r&&(a.current.rotation.z=g.z)}),H.createElement("group",Es({ref:fce([a,o])},s))});function mbe(){var t=Object.create(null);function e(r,s){var o=r.id,a=r.name,l=r.dependencies;l===void 0&&(l=[]);var g=r.init;g===void 0&&(g=function(){});var c=r.getTransferables;if(c===void 0&&(c=null),!t[o])try{l=l.map(function(I){return I&&I.isWorkerModule&&(e(I,function(h){if(h instanceof Error)throw h}),I=t[I.id].value),I}),g=i("<"+a+">.init",g),c&&(c=i("<"+a+">.getTransferables",c));var u=null;typeof g=="function"?u=g.apply(void 0,l):console.error("worker module init function failed to rehydrate"),t[o]={id:o,value:u,getTransferables:c},s(u)}catch(I){I&&I.noLog||console.error(I),s(I)}}function n(r,s){var o,a=r.id,l=r.args;(!t[a]||typeof t[a].value!="function")&&s(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var g=(o=t[a]).value.apply(o,l);g&&typeof g.then=="function"?g.then(c,function(u){return s(u instanceof Error?u:new Error(""+u))}):c(g)}catch(u){s(u)}function c(u){try{var I=t[a].getTransferables&&t[a].getTransferables(u);(!I||!Array.isArray(I)||!I.length)&&(I=void 0),s(u,I)}catch(h){console.error(h),s(h)}}}function i(r,s){var o=void 0;self.troikaDefine=function(l){return o=l};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(l){console.error(l)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var s=r.data,o=s.messageId,a=s.action,l=s.data;try{a==="registerModule"&&e(l,function(g){g instanceof Error?postMessage({messageId:o,success:!1,error:g.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof g=="function"}})}),a==="callModule"&&n(l,function(g,c){g instanceof Error?postMessage({messageId:o,success:!1,error:g.message}):postMessage({messageId:o,success:!0,result:g},c||void 0)})}catch(g){postMessage({messageId:o,success:!1,error:g.stack})}})}function bbe(t){var e=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return e._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,n);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var n=t.dependencies,i=t.init;n=Array.isArray(n)?n.map(function(s){return s&&s._getInitResult?s._getInitResult():s}):[];var r=Promise.all(n).then(function(s){return i.apply(null,s)});return e._getInitResult=function(){return r},r},e}var GK=function(){var t=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),t=!0}catch(n){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+n.message+"]")}return GK=function(){return t},t},vbe=0,ybe=0,DB=!1,KC=Object.create(null),zC=Object.create(null),YS=Object.create(null);function Q0(t){if((!t||typeof t.init!="function")&&!DB)throw new Error("requires `options.init` function");var e=t.dependencies,n=t.init,i=t.getTransferables,r=t.workerId;if(!GK())return bbe(t);r==null&&(r="#default");var s="workerModule"+ ++vbe,o=t.name||s,a=null;e=e&&e.map(function(g){return typeof g=="function"&&!g.workerModuleData&&(DB=!0,g=Q0({workerId:r,name:"<"+o+"> function dependency: "+g.name,init:`function(){return (
`+I3(g)+`
)}`}),DB=!1),g&&g.workerModuleData&&(g=g.workerModuleData),g});function l(){for(var g=[],c=arguments.length;c--;)g[c]=arguments[c];if(!a){a=m7(r,"registerModule",l.workerModuleData);var u=function(){a=null,zC[r].delete(u)};(zC[r]||(zC[r]=new Set)).add(u)}return a.then(function(I){var h=I.isCallable;if(h)return m7(r,"callModule",{id:s,args:g});throw new Error("Worker module function was called but `init` did not return a callable function")})}return l.workerModuleData={isWorkerModule:!0,id:s,name:o,dependencies:e,init:I3(n),getTransferables:i&&I3(i)},l}function Bbe(t){zC[t]&&zC[t].forEach(function(e){e()}),KC[t]&&(KC[t].terminate(),delete KC[t])}function I3(t){var e=t.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function Gbe(t){var e=KC[t];if(!e){var n=I3(mbe);e=KC[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+` **/

;(`+n+")()"],{type:"application/javascript"}))),e.onmessage=function(i){var r=i.data,s=r.messageId,o=YS[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete YS[s],o(r)}}return e}function m7(t,e,n){return new Promise(function(i,r){var s=++ybe;YS[s]=function(o){o.success?i(o.result):r(new Error("Error in worker "+e+" call: "+o.error))},Gbe(t).postMessage({messageId:s,action:e,data:n})})}function SK(){var t=function(e){function n(L,V,M,X,J,re,se,le){var ae=1-se;le.x=ae*ae*L+2*ae*se*M+se*se*J,le.y=ae*ae*V+2*ae*se*X+se*se*re}function i(L,V,M,X,J,re,se,le,ae,ce){var Ee=1-ae;ce.x=Ee*Ee*Ee*L+3*Ee*Ee*ae*M+3*Ee*ae*ae*J+ae*ae*ae*se,ce.y=Ee*Ee*Ee*V+3*Ee*Ee*ae*X+3*Ee*ae*ae*re+ae*ae*ae*le}function r(L,V){for(var M=/([MLQCZ])([^MLQCZ]*)/g,X,J,re,se,le;X=M.exec(L);){var ae=X[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(ce){return parseFloat(ce)});switch(X[1]){case"M":se=J=ae[0],le=re=ae[1];break;case"L":(ae[0]!==se||ae[1]!==le)&&V("L",se,le,se=ae[0],le=ae[1]);break;case"Q":{V("Q",se,le,se=ae[2],le=ae[3],ae[0],ae[1]);break}case"C":{V("C",se,le,se=ae[4],le=ae[5],ae[0],ae[1],ae[2],ae[3]);break}case"Z":(se!==J||le!==re)&&V("L",se,le,J,re);break}}}function s(L,V,M){M===void 0&&(M=16);var X={x:0,y:0};r(L,function(J,re,se,le,ae,ce,Ee,Fe,oe){switch(J){case"L":V(re,se,le,ae);break;case"Q":{for(var D=re,fe=se,Ce=1;Ce<M;Ce++)n(re,se,ce,Ee,le,ae,Ce/(M-1),X),V(D,fe,X.x,X.y),D=X.x,fe=X.y;break}case"C":{for(var pe=re,be=se,Ue=1;Ue<M;Ue++)i(re,se,ce,Ee,Fe,oe,le,ae,Ue/(M-1),X),V(pe,be,X.x,X.y),pe=X.x,be=X.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,g={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function c(L,V){var M=L.getContext?L.getContext("webgl",g):L,X=l.get(M);if(!X){let pe=function(Ae){var De=re[Ae];if(!De&&(De=re[Ae]=M.getExtension(Ae),!De))throw new Error(Ae+" not supported");return De},be=function(Ae,De){var Q=M.createShader(De);return M.shaderSource(Q,Ae),M.compileShader(Q),Q},Ue=function(Ae,De,Q,K){if(!se[Ae]){var ge={},Le={},Re=M.createProgram();M.attachShader(Re,be(De,M.VERTEX_SHADER)),M.attachShader(Re,be(Q,M.FRAGMENT_SHADER)),M.linkProgram(Re),se[Ae]={program:Re,transaction:function(Je){M.useProgram(Re),Je({setUniform:function(de,ze){for(var je=[],Pe=arguments.length-2;Pe-- >0;)je[Pe]=arguments[Pe+2];var ke=Le[ze]||(Le[ze]=M.getUniformLocation(Re,ze));M["uniform"+de].apply(M,[ke].concat(je))},setAttribute:function(de,ze,je,Pe,ke){var $=ge[de];$||($=ge[de]={buf:M.createBuffer(),loc:M.getAttribLocation(Re,de),data:null}),M.bindBuffer(M.ARRAY_BUFFER,$.buf),M.vertexAttribPointer($.loc,ze,M.FLOAT,!1,0,0),M.enableVertexAttribArray($.loc),J?M.vertexAttribDivisor($.loc,Pe):pe("ANGLE_instanced_arrays").vertexAttribDivisorANGLE($.loc,Pe),ke!==$.data&&(M.bufferData(M.ARRAY_BUFFER,ke,je),$.data=ke)}})}}}se[Ae].transaction(K)},me=function(Ae,De){ae++;try{M.activeTexture(M.TEXTURE0+ae);var Q=le[Ae];Q||(Q=le[Ae]=M.createTexture(),M.bindTexture(M.TEXTURE_2D,Q),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.NEAREST),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.NEAREST)),M.bindTexture(M.TEXTURE_2D,Q),De(Q,ae)}finally{ae--}},we=function(Ae,De,Q){var K=M.createFramebuffer();ce.push(K),M.bindFramebuffer(M.FRAMEBUFFER,K),M.activeTexture(M.TEXTURE0+De),M.bindTexture(M.TEXTURE_2D,Ae),M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_2D,Ae,0);try{Q(K)}finally{M.deleteFramebuffer(K),M.bindFramebuffer(M.FRAMEBUFFER,ce[--ce.length-1]||null)}},Be=function(){re={},se={},le={},ae=-1,ce.length=0};var Ee=pe,Fe=be,oe=Ue,D=me,fe=we,Ce=Be,J=typeof WebGL2RenderingContext<"u"&&M instanceof WebGL2RenderingContext,re={},se={},le={},ae=-1,ce=[];M.canvas.addEventListener("webglcontextlost",function(Ae){Be(),Ae.preventDefault()},!1),l.set(M,X={gl:M,isWebGL2:J,getExtension:pe,withProgram:Ue,withTexture:me,withTextureFramebuffer:we,handleContextLoss:Be})}V(X)}function u(L,V,M,X,J,re,se,le){se===void 0&&(se=15),le===void 0&&(le=null),c(L,function(ae){var ce=ae.gl,Ee=ae.withProgram,Fe=ae.withTexture;Fe("copy",function(oe,D){ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,J,re,0,ce.RGBA,ce.UNSIGNED_BYTE,V),Ee("copy",o,a,function(fe){var Ce=fe.setUniform,pe=fe.setAttribute;pe("aUV",2,ce.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Ce("1i","image",D),ce.bindFramebuffer(ce.FRAMEBUFFER,le||null),ce.disable(ce.BLEND),ce.colorMask(se&8,se&4,se&2,se&1),ce.viewport(M,X,J,re),ce.scissor(M,X,J,re),ce.drawArrays(ce.TRIANGLES,0,3)})})})}function I(L,V,M){var X=L.width,J=L.height;c(L,function(re){var se=re.gl,le=new Uint8Array(X*J*4);se.readPixels(0,0,X,J,se.RGBA,se.UNSIGNED_BYTE,le),L.width=V,L.height=M,u(se,le,0,0,X,J)})}var h=Object.freeze({__proto__:null,withWebGLContext:c,renderImageData:u,resizeWebGLCanvasWithoutClearing:I});function C(L,V,M,X,J,re){re===void 0&&(re=1);var se=new Uint8Array(L*V),le=X[2]-X[0],ae=X[3]-X[1],ce=[];s(M,function(pe,be,Ue,me){ce.push({x1:pe,y1:be,x2:Ue,y2:me,minX:Math.min(pe,Ue),minY:Math.min(be,me),maxX:Math.max(pe,Ue),maxY:Math.max(be,me)})}),ce.sort(function(pe,be){return pe.maxX-be.maxX});for(var Ee=0;Ee<L;Ee++)for(var Fe=0;Fe<V;Fe++){var oe=fe(X[0]+le*(Ee+.5)/L,X[1]+ae*(Fe+.5)/V),D=Math.pow(1-Math.abs(oe)/J,re)/2;oe<0&&(D=1-D),D=Math.max(0,Math.min(255,Math.round(D*255))),se[Fe*L+Ee]=D}return se;function fe(pe,be){for(var Ue=1/0,me=1/0,we=ce.length;we--;){var Be=ce[we];if(Be.maxX+me<=pe)break;if(pe+me>Be.minX&&be-me<Be.maxY&&be+me>Be.minY){var Ae=f(pe,be,Be.x1,Be.y1,Be.x2,Be.y2);Ae<Ue&&(Ue=Ae,me=Math.sqrt(Ue))}}return Ce(pe,be)&&(me=-me),me}function Ce(pe,be){for(var Ue=0,me=ce.length;me--;){var we=ce[me];if(we.maxX<=pe)break;var Be=we.y1>be!=we.y2>be&&pe<(we.x2-we.x1)*(be-we.y1)/(we.y2-we.y1)+we.x1;Be&&(Ue+=we.y1<we.y2?1:-1)}return Ue!==0}}function b(L,V,M,X,J,re,se,le,ae,ce){re===void 0&&(re=1),le===void 0&&(le=0),ae===void 0&&(ae=0),ce===void 0&&(ce=0),m(L,V,M,X,J,re,se,null,le,ae,ce)}function m(L,V,M,X,J,re,se,le,ae,ce,Ee){re===void 0&&(re=1),ae===void 0&&(ae=0),ce===void 0&&(ce=0),Ee===void 0&&(Ee=0);for(var Fe=C(L,V,M,X,J,re),oe=new Uint8Array(Fe.length*4),D=0;D<Fe.length;D++)oe[D*4+Ee]=Fe[D];u(se,oe,ae,ce,L,V,1<<3-Ee,le)}function f(L,V,M,X,J,re){var se=J-M,le=re-X,ae=se*se+le*le,ce=ae?Math.max(0,Math.min(1,((L-M)*se+(V-X)*le)/ae)):0,Ee=L-(M+ce*se),Fe=V-(X+ce*le);return Ee*Ee+Fe*Fe}var p=Object.freeze({__proto__:null,generate:C,generateIntoCanvas:b,generateIntoFramebuffer:m}),v="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",B="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",G="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",R=new Float32Array([0,0,2,0,0,2]),w=null,E=!1,x={},W=new WeakMap;function T(L){if(!E&&!O(L))throw new Error("WebGL generation not supported")}function k(L,V,M,X,J,re,se){if(re===void 0&&(re=1),se===void 0&&(se=null),!se&&(se=w,!se)){var le=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!le)throw new Error("OffscreenCanvas or DOM canvas not supported");se=w=le.getContext("webgl",{depth:!1})}T(se);var ae=new Uint8Array(L*V*4);c(se,function(oe){var D=oe.gl,fe=oe.withTexture,Ce=oe.withTextureFramebuffer;fe("readable",function(pe,be){D.texImage2D(D.TEXTURE_2D,0,D.RGBA,L,V,0,D.RGBA,D.UNSIGNED_BYTE,null),Ce(pe,be,function(Ue){U(L,V,M,X,J,re,D,Ue,0,0,0),D.readPixels(0,0,L,V,D.RGBA,D.UNSIGNED_BYTE,ae)})})});for(var ce=new Uint8Array(L*V),Ee=0,Fe=0;Ee<ae.length;Ee+=4)ce[Fe++]=ae[Ee];return ce}function _(L,V,M,X,J,re,se,le,ae,ce){re===void 0&&(re=1),le===void 0&&(le=0),ae===void 0&&(ae=0),ce===void 0&&(ce=0),U(L,V,M,X,J,re,se,null,le,ae,ce)}function U(L,V,M,X,J,re,se,le,ae,ce,Ee){re===void 0&&(re=1),ae===void 0&&(ae=0),ce===void 0&&(ce=0),Ee===void 0&&(Ee=0),T(se);var Fe=[];s(M,function(oe,D,fe,Ce){Fe.push(oe,D,fe,Ce)}),Fe=new Float32Array(Fe),c(se,function(oe){var D=oe.gl,fe=oe.isWebGL2,Ce=oe.getExtension,pe=oe.withProgram,be=oe.withTexture,Ue=oe.withTextureFramebuffer,me=oe.handleContextLoss;if(be("rawDistances",function(we,Be){(L!==we._lastWidth||V!==we._lastHeight)&&D.texImage2D(D.TEXTURE_2D,0,D.RGBA,we._lastWidth=L,we._lastHeight=V,0,D.RGBA,D.UNSIGNED_BYTE,null),pe("main",v,B,function(Ae){var De=Ae.setAttribute,Q=Ae.setUniform,K=!fe&&Ce("ANGLE_instanced_arrays"),ge=!fe&&Ce("EXT_blend_minmax");De("aUV",2,D.STATIC_DRAW,0,R),De("aLineSegment",4,D.DYNAMIC_DRAW,1,Fe),Q.apply(void 0,["4f","uGlyphBounds"].concat(X)),Q("1f","uMaxDistance",J),Q("1f","uExponent",re),Ue(we,Be,function(Le){D.enable(D.BLEND),D.colorMask(!0,!0,!0,!0),D.viewport(0,0,L,V),D.scissor(0,0,L,V),D.blendFunc(D.ONE,D.ONE),D.blendEquationSeparate(D.FUNC_ADD,fe?D.MAX:ge.MAX_EXT),D.clear(D.COLOR_BUFFER_BIT),fe?D.drawArraysInstanced(D.TRIANGLES,0,3,Fe.length/4):K.drawArraysInstancedANGLE(D.TRIANGLES,0,3,Fe.length/4)})}),pe("post",o,G,function(Ae){Ae.setAttribute("aUV",2,D.STATIC_DRAW,0,R),Ae.setUniform("1i","tex",Be),D.bindFramebuffer(D.FRAMEBUFFER,le),D.disable(D.BLEND),D.colorMask(Ee===0,Ee===1,Ee===2,Ee===3),D.viewport(ae,ce,L,V),D.scissor(ae,ce,L,V),D.drawArrays(D.TRIANGLES,0,3)})}),D.isContextLost())throw me(),new Error("webgl context lost")})}function O(L){var V=!L||L===w?x:L.canvas||L,M=W.get(V);if(M===void 0){E=!0;var X=null;try{var J=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],re=k(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,L);M=re&&J.length===re.length&&re.every(function(se,le){return se===J[le]}),M||(X="bad trial run results",console.info(J,re))}catch(se){M=!1,X=se.message}X&&console.warn("WebGL SDF generation not supported:",X),E=!1,W.set(V,M)}return M}var Y=Object.freeze({__proto__:null,generate:k,generateIntoCanvas:_,generateIntoFramebuffer:U,isSupported:O});function z(L,V,M,X,J,re){J===void 0&&(J=Math.max(X[2]-X[0],X[3]-X[1])/2),re===void 0&&(re=1);try{return k.apply(Y,arguments)}catch(se){return console.info("WebGL SDF generation failed, falling back to JS",se),C.apply(p,arguments)}}function N(L,V,M,X,J,re,se,le,ae,ce){J===void 0&&(J=Math.max(X[2]-X[0],X[3]-X[1])/2),re===void 0&&(re=1),le===void 0&&(le=0),ae===void 0&&(ae=0),ce===void 0&&(ce=0);try{return _.apply(Y,arguments)}catch(Ee){return console.info("WebGL SDF generation failed, falling back to JS",Ee),b.apply(p,arguments)}}return e.forEachPathCommand=r,e.generate=z,e.generateIntoCanvas=N,e.javascript=p,e.pathToLineSegments=s,e.webgl=Y,e.webglUtils=h,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return t}function Sbe(){var t=function(e){var n={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},i={},r={};i.L=1,r[1]="L",Object.keys(n).forEach(function(me,we){i[me]=1<<we+1,r[i[me]]=me}),Object.freeze(i);var s=i.LRI|i.RLI|i.FSI,o=i.L|i.R|i.AL,a=i.B|i.S|i.WS|i.ON|i.FSI|i.LRI|i.RLI|i.PDI,l=i.BN|i.RLE|i.LRE|i.RLO|i.LRO|i.PDF,g=i.S|i.WS|i.B|s|i.PDI|l,c=null;function u(){if(!c){c=new Map;var me=function(Be){if(n.hasOwnProperty(Be)){var Ae=0;n[Be].split(",").forEach(function(De){var Q=De.split("+"),K=Q[0],ge=Q[1];K=parseInt(K,36),ge=ge?parseInt(ge,36):0,c.set(Ae+=K,i[Be]);for(var Le=0;Le<ge;Le++)c.set(++Ae,i[Be])})}};for(var we in n)me(we)}}function I(me){return u(),c.get(me.codePointAt(0))||i.L}function h(me){return r[I(me)]}var C={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function b(me,we){var Be=36,Ae=0,De=new Map,Q=we&&new Map,K;return me.split(",").forEach(function ge(Le){if(Le.indexOf("+")!==-1)for(var Re=+Le;Re--;)ge(K);else{K=Le;var Ze=Le.split(">"),Je=Ze[0],Ye=Ze[1];Je=String.fromCodePoint(Ae+=parseInt(Je,Be)),Ye=String.fromCodePoint(Ae+=parseInt(Ye,Be)),De.set(Je,Ye),we&&Q.set(Ye,Je)}}),{map:De,reverseMap:Q}}var m,f,p;function v(){if(!m){var me=b(C.pairs,!0),we=me.map,Be=me.reverseMap;m=we,f=Be,p=b(C.canonical,!1).map}}function B(me){return v(),m.get(me)||null}function G(me){return v(),f.get(me)||null}function R(me){return v(),p.get(me)||null}var w=i.L,E=i.R,x=i.EN,W=i.ES,T=i.ET,k=i.AN,_=i.CS,U=i.B,O=i.S,Y=i.ON,z=i.BN,N=i.NSM,L=i.AL,V=i.LRO,M=i.RLO,X=i.LRE,J=i.RLE,re=i.PDF,se=i.LRI,le=i.RLI,ae=i.FSI,ce=i.PDI;function Ee(me,we){for(var Be=125,Ae=new Uint32Array(me.length),De=0;De<me.length;De++)Ae[De]=I(me[De]);var Q=new Map;function K($i,Kr){var yi=Ae[$i];Ae[$i]=Kr,Q.set(yi,Q.get(yi)-1),yi&a&&Q.set(a,Q.get(a)-1),Q.set(Kr,(Q.get(Kr)||0)+1),Kr&a&&Q.set(a,(Q.get(a)||0)+1)}for(var ge=new Uint8Array(me.length),Le=new Map,Re=[],Ze=null,Je=0;Je<me.length;Je++)Ze||Re.push(Ze={start:Je,end:me.length-1,level:we==="rtl"?1:we==="ltr"?0:MI(Je,!1)}),Ae[Je]&U&&(Ze.end=Je,Ze=null);for(var Ye=J|X|M|V|s|ce|re|U,de=function($i){return $i+($i&1?1:2)},ze=function($i){return $i+($i&1?2:1)},je=0;je<Re.length;je++){Ze=Re[je];var Pe=[{_level:Ze.level,_override:0,_isolate:0}],ke=void 0,$=0,Se=0,Ke=0;Q.clear();for(var q=Ze.start;q<=Ze.end;q++){var He=Ae[q];if(ke=Pe[Pe.length-1],Q.set(He,(Q.get(He)||0)+1),He&a&&Q.set(a,(Q.get(a)||0)+1),He&Ye)if(He&(J|X)){ge[q]=ke._level;var ue=(He===J?ze:de)(ke._level);ue<=Be&&!$&&!Se?Pe.push({_level:ue,_override:0,_isolate:0}):$||Se++}else if(He&(M|V)){ge[q]=ke._level;var _e=(He===M?ze:de)(ke._level);_e<=Be&&!$&&!Se?Pe.push({_level:_e,_override:He&M?E:w,_isolate:0}):$||Se++}else if(He&s){He&ae&&(He=MI(q+1,!0)===1?le:se),ge[q]=ke._level,ke._override&&K(q,ke._override);var qe=(He===le?ze:de)(ke._level);qe<=Be&&$===0&&Se===0?(Ke++,Pe.push({_level:qe,_override:0,_isolate:1,_isolInitIndex:q})):$++}else if(He&ce){if($>0)$--;else if(Ke>0){for(Se=0;!Pe[Pe.length-1]._isolate;)Pe.pop();var At=Pe[Pe.length-1]._isolInitIndex;At!=null&&(Le.set(At,q),Le.set(q,At)),Pe.pop(),Ke--}ke=Pe[Pe.length-1],ge[q]=ke._level,ke._override&&K(q,ke._override)}else He&re?($===0&&(Se>0?Se--:!ke._isolate&&Pe.length>1&&(Pe.pop(),ke=Pe[Pe.length-1])),ge[q]=ke._level):He&U&&(ge[q]=Ze.level);else ge[q]=ke._level,ke._override&&He!==z&&K(q,ke._override)}for(var vt=[],Et=null,Kt=Ze.start;Kt<=Ze.end;Kt++){var zt=Ae[Kt];if(!(zt&l)){var Ht=ge[Kt],Tt=zt&s,Mn=zt===ce;Et&&Ht===Et._level?(Et._end=Kt,Et._endsWithIsolInit=Tt):vt.push(Et={_start:Kt,_end:Kt,_level:Ht,_startsWithPDI:Mn,_endsWithIsolInit:Tt})}}for(var ji=[],In=0;In<vt.length;In++){var Tn=vt[In];if(!Tn._startsWithPDI||Tn._startsWithPDI&&!Le.has(Tn._start)){for(var ur=[Et=Tn],wn=void 0;Et&&Et._endsWithIsolInit&&(wn=Le.get(Et._end))!=null;)for(var ti=In+1;ti<vt.length;ti++)if(vt[ti]._start===wn){ur.push(Et=vt[ti]);break}for(var Ti=[],uo=0;uo<ur.length;uo++)for(var kr=ur[uo],j=kr._start;j<=kr._end;j++)Ti.push(j);for(var ve=ge[Ti[0]],Te=Ze.level,ye=Ti[0]-1;ye>=0;ye--)if(!(Ae[ye]&l)){Te=ge[ye];break}var Me=Ti[Ti.length-1],at=ge[Me],bt=Ze.level;if(!(Ae[Me]&s)){for(var Bt=Me+1;Bt<=Ze.end;Bt++)if(!(Ae[Bt]&l)){bt=ge[Bt];break}}ji.push({_seqIndices:Ti,_sosType:Math.max(Te,ve)%2?E:w,_eosType:Math.max(bt,at)%2?E:w})}}for(var wt=0;wt<ji.length;wt++){var _t=ji[wt],Qe=_t._seqIndices,Gt=_t._sosType,vn=_t._eosType,dn=ge[Qe[0]]&1?E:w;if(Q.get(N))for(var Fi=0;Fi<Qe.length;Fi++){var vr=Qe[Fi];if(Ae[vr]&N){for(var fn=Gt,xt=Fi-1;xt>=0;xt--)if(!(Ae[Qe[xt]]&l)){fn=Ae[Qe[xt]];break}K(vr,fn&(s|ce)?Y:fn)}}if(Q.get(x))for(var on=0;on<Qe.length;on++){var Zt=Qe[on];if(Ae[Zt]&x)for(var vi=on-1;vi>=-1;vi--){var ci=vi===-1?Gt:Ae[Qe[vi]];if(ci&o){ci===L&&K(Zt,k);break}}}if(Q.get(L))for(var Qn=0;Qn<Qe.length;Qn++){var ls=Qe[Qn];Ae[ls]&L&&K(ls,E)}if(Q.get(W)||Q.get(_))for(var yn=1;yn<Qe.length-1;yn++){var Fn=Qe[yn];if(Ae[Fn]&(W|_)){for(var Hr=0,xi=0,Za=yn-1;Za>=0&&(Hr=Ae[Qe[Za]],!!(Hr&l));Za--);for(var Ea=yn+1;Ea<Qe.length&&(xi=Ae[Qe[Ea]],!!(xi&l));Ea++);Hr===xi&&(Ae[Fn]===W?Hr===x:Hr&(x|k))&&K(Fn,Hr)}}if(Q.get(x))for(var yr=0;yr<Qe.length;yr++){var Ms=Qe[yr];if(Ae[Ms]&x){for(var ZI=yr-1;ZI>=0&&Ae[Qe[ZI]]&(T|l);ZI--)K(Qe[ZI],x);for(yr++;yr<Qe.length&&Ae[Qe[yr]]&(T|l|x);yr++)Ae[Qe[yr]]!==x&&K(Qe[yr],x)}}if(Q.get(T)||Q.get(W)||Q.get(_))for(var Tc=0;Tc<Qe.length;Tc++){var np=Qe[Tc];if(Ae[np]&(T|W|_)){K(np,Y);for(var hl=Tc-1;hl>=0&&Ae[Qe[hl]]&l;hl--)K(Qe[hl],Y);for(var Cl=Tc+1;Cl<Qe.length&&Ae[Qe[Cl]]&l;Cl++)K(Qe[Cl],Y)}}if(Q.get(x))for(var fl=0,Fc=Gt;fl<Qe.length;fl++){var ip=Qe[fl],qA=Ae[ip];qA&x?Fc===w&&K(ip,w):qA&o&&(Fc=qA)}if(Q.get(a)){var pl=E|x|k,EI=pl|w,Wa=[];{for(var hg=[],Na=0;Na<Qe.length;Na++)if(Ae[Qe[Na]]&a){var qt=me[Qe[Na]],$A=void 0;if(B(qt)!==null)if(hg.length<63)hg.push({char:qt,seqIndex:Na});else break;else if(($A=G(qt))!==null)for(var ml=hg.length-1;ml>=0;ml--){var WI=hg[ml].char;if(WI===$A||WI===G(R(qt))||B(R(WI))===qt){Wa.push([hg[ml].seqIndex,Na]),hg.length=ml;break}}}Wa.sort(function($i,Kr){return $i[0]-Kr[0]})}for(var eh=0;eh<Wa.length;eh++){for(var rp=Wa[eh],ni=rp[0],Vc=rp[1],sp=!1,_r=0,th=ni+1;th<Vc;th++){var Lc=Qe[th];if(Ae[Lc]&EI){sp=!0;var Ts=Ae[Lc]&pl?E:w;if(Ts===dn){_r=Ts;break}}}if(sp&&!_r){_r=Gt;for(var nh=ni-1;nh>=0;nh--){var op=Qe[nh];if(Ae[op]&EI){var Fs=Ae[op]&pl?E:w;Fs!==dn?_r=Fs:_r=dn;break}}}if(_r){if(Ae[Qe[ni]]=Ae[Qe[Vc]]=_r,_r!==dn){for(var Xr=ni+1;Xr<Qe.length;Xr++)if(!(Ae[Qe[Xr]]&l)){I(me[Qe[Xr]])&N&&(Ae[Qe[Xr]]=_r);break}}if(_r!==dn){for(var Ma=Vc+1;Ma<Qe.length;Ma++)if(!(Ae[Qe[Ma]]&l)){I(me[Qe[Ma]])&N&&(Ae[Qe[Ma]]=_r);break}}}}for(var Io=0;Io<Qe.length;Io++)if(Ae[Qe[Io]]&a){for(var ih=Io,rh=Io,gs=Gt,kc=Io-1;kc>=0;kc--)if(Ae[Qe[kc]]&l)ih=kc;else{gs=Ae[Qe[kc]]&pl?E:w;break}for(var Hc=vn,_c=Io+1;_c<Qe.length;_c++)if(Ae[Qe[_c]]&(a|l))rh=_c;else{Hc=Ae[Qe[_c]]&pl?E:w;break}for(var Yr=ih;Yr<=rh;Yr++)Ae[Qe[Yr]]=gs===Hc?gs:dn;Io=rh}}}for(var qi=Ze.start;qi<=Ze.end;qi++){var NI=ge[qi],zo=Ae[qi];if(NI&1?zo&(w|x|k)&&ge[qi]++:zo&E?ge[qi]++:zo&(k|x)&&(ge[qi]+=2),zo&l&&(ge[qi]=qi===0?Ze.level:ge[qi-1]),qi===Ze.end||I(me[qi])&(O|U))for(var Cg=qi;Cg>=0&&I(me[Cg])&g;Cg--)ge[Cg]=Ze.level}}return{levels:ge,paragraphs:Re};function MI($i,Kr){for(var yi=$i;yi<me.length;yi++){var Bi=Ae[yi];if(Bi&(E|L))return 1;if(Bi&(U|w)||Kr&&Bi===ce)return 0;if(Bi&s){var Vs=ap(yi);yi=Vs===-1?me.length:Vs}}return 0}function ap($i){for(var Kr=1,yi=$i+1;yi<me.length;yi++){var Bi=Ae[yi];if(Bi&U)break;if(Bi&ce){if(--Kr===0)return yi}else Bi&s&&Kr++}return-1}}var Fe="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",oe;function D(){if(!oe){var me=b(Fe,!0),we=me.map,Be=me.reverseMap;Be.forEach(function(Ae,De){we.set(De,Ae)}),oe=we}}function fe(me){return D(),oe.get(me)||null}function Ce(me,we,Be,Ae){var De=me.length;Be=Math.max(0,Be==null?0:+Be),Ae=Math.min(De-1,Ae==null?De-1:+Ae);for(var Q=new Map,K=Be;K<=Ae;K++)if(we[K]&1){var ge=fe(me[K]);ge!==null&&Q.set(K,ge)}return Q}function pe(me,we,Be,Ae){var De=me.length;Be=Math.max(0,Be==null?0:+Be),Ae=Math.min(De-1,Ae==null?De-1:+Ae);var Q=[];return we.paragraphs.forEach(function(K){var ge=Math.max(Be,K.start),Le=Math.min(Ae,K.end);if(ge<Le){for(var Re=we.levels.slice(ge,Le+1),Ze=Le;Ze>=ge&&I(me[Ze])&g;Ze--)Re[Ze]=K.level;for(var Je=K.level,Ye=1/0,de=0;de<Re.length;de++){var ze=Re[de];ze>Je&&(Je=ze),ze<Ye&&(Ye=ze|1)}for(var je=Je;je>=Ye;je--)for(var Pe=0;Pe<Re.length;Pe++)if(Re[Pe]>=je){for(var ke=Pe;Pe+1<Re.length&&Re[Pe+1]>=je;)Pe++;Pe>ke&&Q.push([ke+ge,Pe+ge])}}}),Q}function be(me,we,Be,Ae){var De=Ue(me,we,Be,Ae),Q=[].concat(me);return De.forEach(function(K,ge){Q[ge]=(we.levels[K]&1?fe(me[K]):null)||me[K]}),Q.join("")}function Ue(me,we,Be,Ae){for(var De=pe(me,we,Be,Ae),Q=[],K=0;K<me.length;K++)Q[K]=K;return De.forEach(function(ge){for(var Le=ge[0],Re=ge[1],Ze=Q.slice(Le,Re+1),Je=Ze.length;Je--;)Q[Re-Je]=Ze[Je]}),Q}return e.closingToOpeningBracket=G,e.getBidiCharType=I,e.getBidiCharTypeName=h,e.getCanonicalBracket=R,e.getEmbeddingLevels=Ee,e.getMirroredCharacter=fe,e.getMirroredCharactersMap=Ce,e.getReorderSegments=pe,e.getReorderedIndices=Ue,e.getReorderedString=be,e.openingToClosingBracket=B,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return t}const wK=/\bvoid\s+main\s*\(\s*\)\s*{/g;function KS(t){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function n(i,r){let s=Ut[r];return s?KS(s):i}return t.replace(e,n)}const dr=[];for(let t=0;t<256;t++)dr[t]=(t<16?"0":"")+t.toString(16);function wbe(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(dr[t&255]+dr[t>>8&255]+dr[t>>16&255]+dr[t>>24&255]+"-"+dr[e&255]+dr[e>>8&255]+"-"+dr[e>>16&15|64]+dr[e>>24&255]+"-"+dr[n&63|128]+dr[n>>8&255]+"-"+dr[n>>16&255]+dr[n>>24&255]+dr[i&255]+dr[i>>8&255]+dr[i>>16&255]+dr[i>>24&255]).toUpperCase()}const ou=Object.assign||function(){let t=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let i=arguments[e];if(i)for(let r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Rbe=Date.now(),b7=new WeakMap,v7=new Map;let xbe=1e10;function zS(t,e){const n=Nbe(e);let i=b7.get(t);if(i||b7.set(t,i=Object.create(null)),i[n])return new i[n];const r=`_onBeforeCompile${n}`,s=function(g,c){t.onBeforeCompile.call(this,g,c);const u=this.customProgramCacheKey()+"|"+g.vertexShader+"|"+g.fragmentShader;let I=v7[u];if(!I){const h=Zbe(this,g,e,n);I=v7[u]=h}g.vertexShader=I.vertexShader,g.fragmentShader=I.fragmentShader,ou(g.uniforms,this.uniforms),e.timeUniform&&(g.uniforms[e.timeUniform]={get value(){return Date.now()-Rbe}}),this[r]&&this[r](g)},o=function(){return a(e.chained?t:t.clone())},a=function(g){const c=Object.create(g,l);return Object.defineProperty(c,"baseMaterial",{value:t}),Object.defineProperty(c,"id",{value:xbe++}),c.uuid=wbe(),c.uniforms=ou({},g.uniforms,e.uniforms),c.defines=ou({},g.defines,e.defines),c.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",c.extensions=ou({},g.extensions,e.extensions),c._listeners=void 0,c},l={constructor:{value:o},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get(){return s},set(g){this[r]=g}},copy:{writable:!0,configurable:!0,value:function(g){return t.copy.call(this,g),!t.isShaderMaterial&&!t.isDerivedMaterial&&(ou(this.extensions,g.extensions),ou(this.defines,g.defines),ou(this.uniforms,Pn.clone(g.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const g=new t.constructor;return a(g).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let g=this._depthMaterial;return g||(g=this._depthMaterial=zS(t.isDerivedMaterial?t.getDepthMaterial():new S0({depthPacking:Rv}),e),g.defines.IS_DEPTH_MATERIAL="",g.uniforms=this.uniforms),g}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let g=this._distanceMaterial;return g||(g=this._distanceMaterial=zS(t.isDerivedMaterial?t.getDistanceMaterial():new Nv,e),g.defines.IS_DISTANCE_MATERIAL="",g.uniforms=this.uniforms),g}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:g,_distanceMaterial:c}=this;g&&g.dispose(),c&&c.dispose(),t.dispose.call(this)}}};return i[n]=o,new o}function Zbe(t,{vertexShader:e,fragmentShader:n},i,r){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:l,fragmentDefs:g,fragmentMainIntro:c,fragmentMainOutro:u,fragmentColorTransform:I,customRewriter:h,timeUniform:C}=i;if(s=s||"",o=o||"",a=a||"",g=g||"",c=c||"",u=u||"",(l||h)&&(e=KS(e)),(I||h)&&(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),n=KS(n)),h){let b=h({vertexShader:e,fragmentShader:n});e=b.vertexShader,n=b.fragmentShader}if(I){let b=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(b.push(m),"")),u=`${I}
${b.join(`
`)}
${u}`}if(C){const b=`
uniform float ${C};
`;s=b+s,g=b+g}return l&&(e=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${e}
`,s=`${s}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(b,m,f,p)=>/\battribute\s+vec[23]\s+$/.test(p.substr(0,f))?m:`troika_${m}_${r}`),t.map&&t.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),e=y7(e,r,s,o,a),n=y7(n,r,g,c,u),{vertexShader:e,fragmentShader:n}}function y7(t,e,n,i,r){return(i||r||n)&&(t=t.replace(wK,`
${n}
void troikaOrigMain${e}() {`),t+=`
void main() {
  ${i}
  troikaOrigMain${e}();
  ${r}
}`),t}function Ebe(t,e){return t==="uniforms"?void 0:typeof e=="function"?e.toString():e}let Wbe=0;const B7=new Map;function Nbe(t){const e=JSON.stringify(t,Ebe);let n=B7.get(e);return n==null&&B7.set(e,n=++Wbe),n}function Mbe(t,e,n){const{defaultFontURL:i}=n,r=Object.create(null),s=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,a="[^\\S\\u00A0]",l=new RegExp(`${a}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function g(p,v){function B(){const G=R=>{console.error(`Failure loading font ${p}${p===i?"":"; trying fallback"}`,R),p!==i&&(p=i,B())};try{const R=new XMLHttpRequest;R.open("get",p,!0),R.responseType="arraybuffer",R.onload=function(){if(R.status>=400)G(new Error(R.statusText));else if(R.status>0)try{const w=t(R.response);v(w)}catch(w){G(w)}},R.onerror=G,R.send()}catch(R){G(R)}}B()}function c(p,v){p||(p=i);let B=r[p];B?B.pending?B.pending.push(v):v(B):(r[p]={pending:[v]},g(p,G=>{let R=r[p].pending;r[p]=G,R.forEach(w=>w(G))}))}function u({text:p="",font:v=i,sdfGlyphSize:B=64,fontSize:G=1,letterSpacing:R=0,lineHeight:w="normal",maxWidth:E=s,direction:x,textAlign:W="left",textIndent:T=0,whiteSpace:k="normal",overflowWrap:_="normal",anchorX:U=0,anchorY:O=0,includeCaretPositions:Y=!1,chunkedBoundsSize:z=8192,colorRanges:N=null},L,V=!1){const M=b(),X={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),G=+G,R=+R,E=+E,w=w||"normal",T=+T,c(v,J=>{const re=isFinite(E);let se=null,le=null,ae=null,ce=null,Ee=null,Fe=null,oe=null,D=0,fe=0,Ce=k!=="nowrap";const{ascender:pe,descender:be,unitsPerEm:Ue,lineGap:me,capHeight:we,xHeight:Be}=J;X.fontLoad=b()-M;const Ae=b(),De=G/Ue;w==="normal"&&(w=(pe-be+me)/Ue),w=w*G;const Q=(w-(pe-be)*De)/2,K=-(pe*De+Q),ge=Math.min(w,(pe-be)*De),Le=(pe+be)/2*De-ge/2;let Re=T,Ze=new m;const Je=[Ze];J.forEachGlyph(p,G,R,(ze,je,Pe)=>{const ke=p.charAt(Pe),$=ze.advanceWidth*De,Se=Ze.count;let Ke;if("isEmpty"in ze||(ze.isWhitespace=!!ke&&new RegExp(a).test(ke),ze.canBreakAfter=!!ke&&l.test(ke),ze.isEmpty=ze.xMin===ze.xMax||ze.yMin===ze.yMax||o.test(ke)),!ze.isWhitespace&&!ze.isEmpty&&fe++,Ce&&re&&!ze.isWhitespace&&je+$+Re>E&&Se){if(Ze.glyphAt(Se-1).glyphObj.canBreakAfter)Ke=new m,Re=-je;else for(let He=Se;He--;)if(He===0&&_==="break-word"){Ke=new m,Re=-je;break}else if(Ze.glyphAt(He).glyphObj.canBreakAfter){Ke=Ze.splitAt(He+1);const ue=Ke.glyphAt(0).x;Re-=ue;for(let _e=Ke.count;_e--;)Ke.glyphAt(_e).x-=ue;break}Ke&&(Ze.isSoftWrapped=!0,Ze=Ke,Je.push(Ze),D=E)}let q=Ze.glyphAt(Ze.count);q.glyphObj=ze,q.x=je+Re,q.width=$,q.charIndex=Pe,ke===`
`&&(Ze=new m,Je.push(Ze),Re=-(je+$+R*G)+T)}),Je.forEach(ze=>{for(let je=ze.count;je--;){let{glyphObj:Pe,x:ke,width:$}=ze.glyphAt(je);if(!Pe.isWhitespace){ze.width=ke+$,ze.width>D&&(D=ze.width);return}}});let Ye=0,de=0;if(U&&(typeof U=="number"?Ye=-U:typeof U=="string"&&(Ye=-D*(U==="left"?0:U==="center"?.5:U==="right"?1:h(U)))),O){if(typeof O=="number")de=-O;else if(typeof O=="string"){let ze=Je.length*w;de=O==="top"?0:O==="top-baseline"?-K:O==="top-cap"?-K-we*De:O==="top-ex"?-K-Be*De:O==="middle"?ze/2:O==="bottom"?ze:O==="bottom-baseline"?ze-Q+be*De:h(O)*ze}}if(!V){const ze=e.getEmbeddingLevels(p,x);se=new Uint16Array(fe),le=new Float32Array(fe*2),ae={},Fe=[s,s,-s,-s],oe=[];let je=K;Y&&(Ee=new Float32Array(p.length*3)),N&&(ce=new Uint8Array(fe*3));let Pe=0,ke=-1,$=-1,Se,Ke;if(Je.forEach((q,He)=>{let{count:ue,width:_e}=q;if(ue>0){let qe=0;for(let Ht=ue;Ht--&&q.glyphAt(Ht).glyphObj.isWhitespace;)qe++;let At=0,vt=0;if(W==="center")At=(D-_e)/2;else if(W==="right")At=D-_e;else if(W==="justify"&&q.isSoftWrapped){let Ht=0;for(let Tt=ue-qe;Tt--;)q.glyphAt(Tt).glyphObj.isWhitespace&&Ht++;vt=(D-_e)/Ht}if(vt||At){let Ht=0;for(let Tt=0;Tt<ue;Tt++){let Mn=q.glyphAt(Tt);const ji=Mn.glyphObj;Mn.x+=At+Ht,vt!==0&&ji.isWhitespace&&Tt<ue-qe&&(Ht+=vt,Mn.width+=vt)}}const Et=e.getReorderSegments(p,ze,q.glyphAt(0).charIndex,q.glyphAt(q.count-1).charIndex);for(let Ht=0;Ht<Et.length;Ht++){const[Tt,Mn]=Et[Ht];let ji=1/0,In=-1/0;for(let Tn=0;Tn<ue;Tn++)if(q.glyphAt(Tn).charIndex>=Tt){let ur=Tn,wn=Tn;for(;wn<ue;wn++){let ti=q.glyphAt(wn);if(ti.charIndex>Mn)break;wn<ue-qe&&(ji=Math.min(ji,ti.x),In=Math.max(In,ti.x+ti.width))}for(let ti=ur;ti<wn;ti++){const Ti=q.glyphAt(ti);Ti.x=In-(Ti.x+Ti.width-ji)}break}}let Kt;const zt=Ht=>Kt=Ht;for(let Ht=0;Ht<ue;Ht++){let Tt=q.glyphAt(Ht);Kt=Tt.glyphObj;const Mn=Kt.index,ji=ze.levels[Tt.charIndex]&1;if(ji){const In=e.getMirroredCharacter(p[Tt.charIndex]);In&&J.forEachGlyph(In,0,0,zt)}if(Y){const{charIndex:In}=Tt,Tn=Tt.x+Ye,ur=Tt.x+Tt.width+Ye;Ee[In*3]=ji?ur:Tn,Ee[In*3+1]=ji?Tn:ur,Ee[In*3+2]=je+Le+de;const wn=In-ke;wn>1&&C(Ee,ke,wn),ke=In}if(N){const{charIndex:In}=Tt;for(;In>$;)$++,N.hasOwnProperty($)&&(Ke=N[$])}if(!Kt.isWhitespace&&!Kt.isEmpty){const In=Pe++;ae[Mn]||(ae[Mn]={path:Kt.path,pathBounds:[Kt.xMin,Kt.yMin,Kt.xMax,Kt.yMax]});const Tn=Tt.x+Ye,ur=je+de;le[In*2]=Tn,le[In*2+1]=ur;const wn=Tn+Kt.xMin*De,ti=ur+Kt.yMin*De,Ti=Tn+Kt.xMax*De,uo=ur+Kt.yMax*De;wn<Fe[0]&&(Fe[0]=wn),ti<Fe[1]&&(Fe[1]=ti),Ti>Fe[2]&&(Fe[2]=Ti),uo>Fe[3]&&(Fe[3]=uo),In%z===0&&(Se={start:In,end:In,rect:[s,s,-s,-s]},oe.push(Se)),Se.end++;const kr=Se.rect;if(wn<kr[0]&&(kr[0]=wn),ti<kr[1]&&(kr[1]=ti),Ti>kr[2]&&(kr[2]=Ti),uo>kr[3]&&(kr[3]=uo),se[In]=Mn,N){const j=In*3;ce[j]=Ke>>16&255,ce[j+1]=Ke>>8&255,ce[j+2]=Ke&255}}}}je-=w}),Ee){const q=p.length-ke;q>1&&C(Ee,ke,q)}}X.typesetting=b()-Ae,L({glyphIds:se,glyphPositions:le,glyphData:ae,caretPositions:Ee,caretHeight:ge,glyphColors:ce,chunkedBounds:oe,fontSize:G,unitsPerEm:Ue,ascender:pe*De,descender:be*De,capHeight:we*De,xHeight:Be*De,lineHeight:w,topBaseline:K,blockBounds:[Ye,de-Je.length*w,Ye+D,de],visibleBounds:Fe,timings:X})})}function I(p,v){u(p,B=>{const[G,R,w,E]=B.blockBounds;v({width:w-G,height:E-R})},{metricsOnly:!0})}function h(p){let v=p.match(/^([\d.]+)%$/),B=v?parseFloat(v[1]):NaN;return isNaN(B)?0:B/100}function C(p,v,B){const G=p[v*3],R=p[v*3+1],w=p[v*3+2],E=(R-G)/B;for(let x=0;x<B;x++){const W=(v+x)*3;p[W]=G+E*x,p[W+1]=G+E*(x+1),p[W+2]=w}}function b(){return(self.performance||Date).now()}function m(){this.data=[]}const f=["glyphObj","x","width","charIndex"];return m.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(p){let v=m.flyweight;return v.data=this.data,v.index=p,v},splitAt(p){let v=new m;return v.data=this.data.splice(p*f.length),v}},m.flyweight=f.reduce((p,v,B,G)=>(Object.defineProperty(p,v,{get(){return this.data[this.index*f.length+B]},set(R){this.data[this.index*f.length+B]=R}}),p),{data:null,index:0}),{typeset:u,measure:I,loadFont:c}}const zu=()=>(self.performance||Date).now(),wy=SK();let G7;function Tbe(t,e,n,i,r,s,o,a,l,g,c=!0){return c?Vbe(t,e,n,i,r,s,o,a,l,g).then(null,u=>(G7||(console.warn("WebGL SDF generation failed, falling back to JS",u),G7=!0),w7(t,e,n,i,r,s,o,a,l,g))):w7(t,e,n,i,r,s,o,a,l,g)}const d3=[],Fbe=5;let US=0;function RK(){const t=zu();for(;d3.length&&zu()-t<Fbe;)d3.shift()();US=d3.length?setTimeout(RK,0):0}const Vbe=(...t)=>new Promise((e,n)=>{d3.push(()=>{const i=zu();try{wy.webgl.generateIntoCanvas(...t),e({timing:zu()-i})}catch(r){n(r)}}),US||(US=setTimeout(RK,0))}),Lbe=4,kbe=2e3,S7={};let Hbe=0;function w7(t,e,n,i,r,s,o,a,l,g){const c="TroikaTextSDFGenerator_JS_"+Hbe++%Lbe;let u=S7[c];return u||(u=S7[c]={workerModule:Q0({name:c,workerId:c,dependencies:[SK,zu],init(I,h){const C=I().javascript.generate;return function(...b){const m=h();return{textureData:C(...b),timing:h()-m}}},getTransferables(I){return[I.textureData.buffer]}}),requests:0,idleTimer:null}),u.requests++,clearTimeout(u.idleTimer),u.workerModule(t,e,n,i,r,s).then(({textureData:I,timing:h})=>{const C=zu(),b=new Uint8Array(I.length*4);for(let m=0;m<I.length;m++)b[m*4+g]=I[m];return wy.webglUtils.renderImageData(o,b,a,l,t,e,1<<3-g),h+=zu()-C,--u.requests===0&&(u.idleTimer=setTimeout(()=>{Bbe(c)},kbe)),{timing:h}})}function _be(t){t._warm||(wy.webgl.isSupported(t),t._warm=!0)}const Xbe=wy.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Ybe(){return typeof window>"u"&&(self.window=self),function(t){var e={parse:function(r){var s=e._bin,o=new Uint8Array(r);if(s.readASCII(o,0,4)=="ttcf"){var a=4;s.readUshort(o,a),a+=2,s.readUshort(o,a),a+=2;var l=s.readUint(o,a);a+=4;for(var g=[],c=0;c<l;c++){var u=s.readUint(o,a);a+=4,g.push(e._readFont(o,u))}return g}return[e._readFont(o,0)]},_readFont:function(r,s){var o=e._bin,a=s;o.readFixed(r,s),s+=4;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2;for(var g=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],c={_data:r,_offset:a},u={},I=0;I<l;I++){var h=o.readASCII(r,s,4);s+=4,o.readUint(r,s),s+=4;var C=o.readUint(r,s);s+=4;var b=o.readUint(r,s);s+=4,u[h]={offset:C,length:b}}for(I=0;I<g.length;I++){var m=g[I];u[m]&&(c[m.trim()]=e[m.trim()].parse(r,u[m].offset,u[m].length,c))}return c},_tabOffset:function(r,s,o){for(var a=e._bin,l=a.readUshort(r,o+4),g=o+12,c=0;c<l;c++){var u=a.readASCII(r,g,4);g+=4,a.readUint(r,g),g+=4;var I=a.readUint(r,g);if(g+=4,a.readUint(r,g),g+=4,u==s)return I}return 0}};e._bin={readFixed:function(r,s){return(r[s]<<8|r[s+1])+(r[s+2]<<8|r[s+3])/65540},readF2dot14:function(r,s){return e._bin.readShort(r,s)/16384},readInt:function(r,s){return e._bin._view(r).getInt32(s)},readInt8:function(r,s){return e._bin._view(r).getInt8(s)},readShort:function(r,s){return e._bin._view(r).getInt16(s)},readUshort:function(r,s){return e._bin._view(r).getUint16(s)},readUshorts:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(e._bin.readUshort(r,s+2*l));return a},readUint:function(r,s){return e._bin._view(r).getUint32(s)},readUint64:function(r,s){return 4294967296*e._bin.readUint(r,s)+e._bin.readUint(r,s+4)},readASCII:function(r,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(r[s+l]);return a},readUnicode:function(r,s,o){for(var a="",l=0;l<o;l++){var g=r[s++]<<8|r[s++];a+=String.fromCharCode(g)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,s,o){var a=e._bin._tdec;return a&&s==0&&o==r.length?a.decode(r):e._bin.readASCII(r,s,o)},readBytes:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(r[s+l]);return a},readASCIIArray:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(String.fromCharCode(r[s+l]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,s,o,a,l){var g=e._bin,c={},u=s;g.readFixed(r,s),s+=4;var I=g.readUshort(r,s);s+=2;var h=g.readUshort(r,s);s+=2;var C=g.readUshort(r,s);return s+=2,c.scriptList=e._lctf.readScriptList(r,u+I),c.featureList=e._lctf.readFeatureList(r,u+h),c.lookupList=e._lctf.readLookupList(r,u+C,l),c},e._lctf.readLookupList=function(r,s,o){var a=e._bin,l=s,g=[],c=a.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var I=a.readUshort(r,s);s+=2;var h=e._lctf.readLookupTable(r,l+I,o);g.push(h)}return g},e._lctf.readLookupTable=function(r,s,o){var a=e._bin,l=s,g={tabs:[]};g.ltype=a.readUshort(r,s),s+=2,g.flag=a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2;for(var u=g.ltype,I=0;I<c;I++){var h=a.readUshort(r,s);s+=2;var C=o(r,u,l+h,g);g.tabs.push(C)}return g},e._lctf.numOfOnes=function(r){for(var s=0,o=0;o<32;o++)r>>>o&1&&s++;return s},e._lctf.readClassDef=function(r,s){var o=e._bin,a=[],l=o.readUshort(r,s);if(s+=2,l==1){var g=o.readUshort(r,s);s+=2;var c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++)a.push(g+u),a.push(g+u),a.push(o.readUshort(r,s)),s+=2}if(l==2){var I=o.readUshort(r,s);for(s+=2,u=0;u<I;u++)a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2}return a},e._lctf.getInterval=function(r,s){for(var o=0;o<r.length;o+=3){var a=r[o],l=r[o+1];if(r[o+2],a<=s&&s<=l)return o}return-1},e._lctf.readCoverage=function(r,s){var o=e._bin,a={};a.fmt=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.fmt==1&&(a.tab=o.readUshorts(r,s,l)),a.fmt==2&&(a.tab=o.readUshorts(r,s,3*l)),a},e._lctf.coverageIndex=function(r,s){var o=r.tab;if(r.fmt==1)return o.indexOf(s);if(r.fmt==2){var a=e._lctf.getInterval(o,s);if(a!=-1)return o[a+2]+(s-o[a])}return-1},e._lctf.readFeatureList=function(r,s){var o=e._bin,a=s,l=[],g=o.readUshort(r,s);s+=2;for(var c=0;c<g;c++){var u=o.readASCII(r,s,4);s+=4;var I=o.readUshort(r,s);s+=2;var h=e._lctf.readFeatureTable(r,a+I);h.tag=u.trim(),l.push(h)}return l},e._lctf.readFeatureTable=function(r,s){var o=e._bin,a=s,l={},g=o.readUshort(r,s);s+=2,g>0&&(l.featureParams=a+g);var c=o.readUshort(r,s);s+=2,l.tab=[];for(var u=0;u<c;u++)l.tab.push(o.readUshort(r,s+2*u));return l},e._lctf.readScriptList=function(r,s){var o=e._bin,a=s,l={},g=o.readUshort(r,s);s+=2;for(var c=0;c<g;c++){var u=o.readASCII(r,s,4);s+=4;var I=o.readUshort(r,s);s+=2,l[u.trim()]=e._lctf.readScriptTable(r,a+I)}return l},e._lctf.readScriptTable=function(r,s){var o=e._bin,a=s,l={},g=o.readUshort(r,s);s+=2,l.default=e._lctf.readLangSysTable(r,a+g);var c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var I=o.readASCII(r,s,4);s+=4;var h=o.readUshort(r,s);s+=2,l[I.trim()]=e._lctf.readLangSysTable(r,a+h)}return l},e._lctf.readLangSysTable=function(r,s){var o=e._bin,a={};o.readUshort(r,s),s+=2,a.reqFeature=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.features=o.readUshorts(r,s,l),a},e.CFF={},e.CFF.parse=function(r,s,o){var a=e._bin;(r=new Uint8Array(r.buffer,s,o))[s=0],r[++s],r[++s],r[++s],s++;var l=[];s=e.CFF.readIndex(r,s,l);for(var g=[],c=0;c<l.length-1;c++)g.push(a.readASCII(r,s+l[c],l[c+1]-l[c]));s+=l[l.length-1];var u=[];s=e.CFF.readIndex(r,s,u);var I=[];for(c=0;c<u.length-1;c++)I.push(e.CFF.readDict(r,s+u[c],s+u[c+1]));s+=u[u.length-1];var h=I[0],C=[];s=e.CFF.readIndex(r,s,C);var b=[];for(c=0;c<C.length-1;c++)b.push(a.readASCII(r,s+C[c],C[c+1]-C[c]));if(s+=C[C.length-1],e.CFF.readSubrs(r,s,h),h.CharStrings){s=h.CharStrings,C=[],s=e.CFF.readIndex(r,s,C);var m=[];for(c=0;c<C.length-1;c++)m.push(a.readBytes(r,s+C[c],C[c+1]-C[c]));h.CharStrings=m}if(h.ROS){s=h.FDArray;var f=[];for(s=e.CFF.readIndex(r,s,f),h.FDArray=[],c=0;c<f.length-1;c++){var p=e.CFF.readDict(r,s+f[c],s+f[c+1]);e.CFF._readFDict(r,p,b),h.FDArray.push(p)}s+=f[f.length-1],s=h.FDSelect,h.FDSelect=[];var v=r[s];if(s++,v!=3)throw v;var B=a.readUshort(r,s);for(s+=2,c=0;c<B+1;c++)h.FDSelect.push(a.readUshort(r,s),r[s+2]),s+=3}return h.Encoding&&(h.Encoding=e.CFF.readEncoding(r,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=e.CFF.readCharset(r,h.charset,h.CharStrings.length)),e.CFF._readFDict(r,h,b),h},e.CFF._readFDict=function(r,s,o){var a;for(var l in s.Private&&(a=s.Private[1],s.Private=e.CFF.readDict(r,a,a+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(r,a+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=o[s[l]-426+35])},e.CFF.readSubrs=function(r,s,o){var a=e._bin,l=[];s=e.CFF.readIndex(r,s,l);var g,c=l.length;g=c<1240?107:c<33900?1131:32768,o.Bias=g,o.Subrs=[];for(var u=0;u<l.length-1;u++)o.Subrs.push(a.readBytes(r,s+l[u],l[u+1]-l[u]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,s){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(r,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[s])},e.CFF.readEncoding=function(r,s,o){e._bin;var a=[".notdef"],l=r[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var g=r[s];s++;for(var c=0;c<g;c++)a.push(r[s+c]);return a},e.CFF.readCharset=function(r,s,o){var a=e._bin,l=[".notdef"],g=r[s];if(s++,g==0)for(var c=0;c<o;c++){var u=a.readUshort(r,s);s+=2,l.push(u)}else{if(g!=1&&g!=2)throw"error: format: "+g;for(;l.length<o;){u=a.readUshort(r,s),s+=2;var I=0;for(g==1?(I=r[s],s++):(I=a.readUshort(r,s),s+=2),c=0;c<=I;c++)l.push(u),u++}}return l},e.CFF.readIndex=function(r,s,o){var a=e._bin,l=a.readUshort(r,s)+1,g=r[s+=2];if(s++,g==1)for(var c=0;c<l;c++)o.push(r[s+c]);else if(g==2)for(c=0;c<l;c++)o.push(a.readUshort(r,s+2*c));else if(g==3)for(c=0;c<l;c++)o.push(16777215&a.readUint(r,s+3*c-1));else if(l!=1)throw"unsupported offset size: "+g+", count: "+l;return(s+=l*g)-1},e.CFF.getCharString=function(r,s,o){var a=e._bin,l=r[s],g=r[s+1];r[s+2],r[s+3],r[s+4];var c=1,u=null,I=null;l<=20&&(u=l,c=1),l==12&&(u=100*l+g,c=2),21<=l&&l<=27&&(u=l,c=1),l==28&&(I=a.readShort(r,s+1),c=3),29<=l&&l<=31&&(u=l,c=1),32<=l&&l<=246&&(I=l-139,c=1),247<=l&&l<=250&&(I=256*(l-247)+g+108,c=2),251<=l&&l<=254&&(I=256*-(l-251)-g-108,c=2),l==255&&(I=a.readInt(r,s+1)/65535,c=5),o.val=I??"o"+u,o.size=c},e.CFF.readCharString=function(r,s,o){for(var a=s+o,l=e._bin,g=[];s<a;){var c=r[s],u=r[s+1];r[s+2],r[s+3],r[s+4];var I=1,h=null,C=null;c<=20&&(h=c,I=1),c==12&&(h=100*c+u,I=2),c!=19&&c!=20||(h=c,I=2),21<=c&&c<=27&&(h=c,I=1),c==28&&(C=l.readShort(r,s+1),I=3),29<=c&&c<=31&&(h=c,I=1),32<=c&&c<=246&&(C=c-139,I=1),247<=c&&c<=250&&(C=256*(c-247)+u+108,I=2),251<=c&&c<=254&&(C=256*-(c-251)-u-108,I=2),c==255&&(C=l.readInt(r,s+1)/65535,I=5),g.push(C??"o"+h),s+=I}return g},e.CFF.readDict=function(r,s,o){for(var a=e._bin,l={},g=[];s<o;){var c=r[s],u=r[s+1];r[s+2],r[s+3],r[s+4];var I=1,h=null,C=null;if(c==28&&(C=a.readShort(r,s+1),I=3),c==29&&(C=a.readInt(r,s+1),I=5),32<=c&&c<=246&&(C=c-139,I=1),247<=c&&c<=250&&(C=256*(c-247)+u+108,I=2),251<=c&&c<=254&&(C=256*-(c-251)-u-108,I=2),c==255)throw C=a.readInt(r,s+1)/65535,I=5,"unknown number";if(c==30){var b=[];for(I=1;;){var m=r[s+I];I++;var f=m>>4,p=15&m;if(f!=15&&b.push(f),p!=15&&b.push(p),p==15)break}for(var v="",B=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],G=0;G<b.length;G++)v+=B[b[G]];C=parseFloat(v)}c<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][c],I=1,c==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][u],I=2)),h!=null?(l[h]=g.length==1?g[0]:g,g=[]):g.push(C),s+=I}return l},e.cmap={},e.cmap.parse=function(r,s,o){r=new Uint8Array(r.buffer,s,o),s=0;var a=e._bin,l={};a.readUshort(r,s),s+=2;var g=a.readUshort(r,s);s+=2;var c=[];l.tables=[];for(var u=0;u<g;u++){var I=a.readUshort(r,s);s+=2;var h=a.readUshort(r,s);s+=2;var C=a.readUint(r,s);s+=4;var b="p"+I+"e"+h,m=c.indexOf(C);if(m==-1){var f;m=l.tables.length,c.push(C);var p=a.readUshort(r,C);p==0?f=e.cmap.parse0(r,C):p==4?f=e.cmap.parse4(r,C):p==6?f=e.cmap.parse6(r,C):p==12?f=e.cmap.parse12(r,C):console.debug("unknown format: "+p,I,h,C),l.tables.push(f)}if(l[b]!=null)throw"multiple tables for one platform+encoding";l[b]=m}return l},e.cmap.parse0=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,a.map=[];for(var g=0;g<l-6;g++)a.map.push(r[s+g]);return a},e.cmap.parse4=function(r,s){var o=e._bin,a=s,l={};l.format=o.readUshort(r,s),s+=2;var g=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2;var c=o.readUshort(r,s);s+=2;var u=c/2;l.searchRange=o.readUshort(r,s),s+=2,l.entrySelector=o.readUshort(r,s),s+=2,l.rangeShift=o.readUshort(r,s),s+=2,l.endCount=o.readUshorts(r,s,u),s+=2*u,s+=2,l.startCount=o.readUshorts(r,s,u),s+=2*u,l.idDelta=[];for(var I=0;I<u;I++)l.idDelta.push(o.readShort(r,s)),s+=2;for(l.idRangeOffset=o.readUshorts(r,s,u),s+=2*u,l.glyphIdArray=[];s<a+g;)l.glyphIdArray.push(o.readUshort(r,s)),s+=2;return l},e.cmap.parse6=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,a.firstCode=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,a.glyphIdArray=[];for(var g=0;g<l;g++)a.glyphIdArray.push(o.readUshort(r,s)),s+=2;return a},e.cmap.parse12=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,s+=2,o.readUint(r,s),s+=4,o.readUint(r,s),s+=4;var l=o.readUint(r,s);s+=4,a.groups=[];for(var g=0;g<l;g++){var c=s+12*g,u=o.readUint(r,c+0),I=o.readUint(r,c+4),h=o.readUint(r,c+8);a.groups.push([u,I,h])}return a},e.glyf={},e.glyf.parse=function(r,s,o,a){for(var l=[],g=0;g<a.maxp.numGlyphs;g++)l.push(null);return l},e.glyf._parseGlyf=function(r,s){var o=e._bin,a=r._data,l=e._tabOffset(a,"glyf",r._offset)+r.loca[s];if(r.loca[s]==r.loca[s+1])return null;var g={};if(g.noc=o.readShort(a,l),l+=2,g.xMin=o.readShort(a,l),l+=2,g.yMin=o.readShort(a,l),l+=2,g.xMax=o.readShort(a,l),l+=2,g.yMax=o.readShort(a,l),l+=2,g.xMin>=g.xMax||g.yMin>=g.yMax)return null;if(g.noc>0){g.endPts=[];for(var c=0;c<g.noc;c++)g.endPts.push(o.readUshort(a,l)),l+=2;var u=o.readUshort(a,l);if(l+=2,a.length-l<u)return null;g.instructions=o.readBytes(a,l,u),l+=u;var I=g.endPts[g.noc-1]+1;for(g.flags=[],c=0;c<I;c++){var h=a[l];if(l++,g.flags.push(h),(8&h)!=0){var C=a[l];l++;for(var b=0;b<C;b++)g.flags.push(h),c++}}for(g.xs=[],c=0;c<I;c++){var m=(2&g.flags[c])!=0,f=(16&g.flags[c])!=0;m?(g.xs.push(f?a[l]:-a[l]),l++):f?g.xs.push(0):(g.xs.push(o.readShort(a,l)),l+=2)}for(g.ys=[],c=0;c<I;c++)m=(4&g.flags[c])!=0,f=(32&g.flags[c])!=0,m?(g.ys.push(f?a[l]:-a[l]),l++):f?g.ys.push(0):(g.ys.push(o.readShort(a,l)),l+=2);var p=0,v=0;for(c=0;c<I;c++)p+=g.xs[c],v+=g.ys[c],g.xs[c]=p,g.ys[c]=v}else{var B;g.parts=[];do{B=o.readUshort(a,l),l+=2;var G={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(g.parts.push(G),G.glyphIndex=o.readUshort(a,l),l+=2,1&B){var R=o.readShort(a,l);l+=2;var w=o.readShort(a,l);l+=2}else R=o.readInt8(a,l),l++,w=o.readInt8(a,l),l++;2&B?(G.m.tx=R,G.m.ty=w):(G.p1=R,G.p2=w),8&B?(G.m.a=G.m.d=o.readF2dot14(a,l),l+=2):64&B?(G.m.a=o.readF2dot14(a,l),l+=2,G.m.d=o.readF2dot14(a,l),l+=2):128&B&&(G.m.a=o.readF2dot14(a,l),l+=2,G.m.b=o.readF2dot14(a,l),l+=2,G.m.c=o.readF2dot14(a,l),l+=2,G.m.d=o.readF2dot14(a,l),l+=2)}while(32&B);if(256&B){var E=o.readUshort(a,l);for(l+=2,g.instr=[],c=0;c<E;c++)g.instr.push(a[l]),l++}}return g},e.GPOS={},e.GPOS.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GPOS.subt)},e.GPOS.subt=function(r,s,o,a){var l=e._bin,g=o,c={};if(c.fmt=l.readUshort(r,o),o+=2,s==1||s==2||s==3||s==7||s==8&&c.fmt<=2){var u=l.readUshort(r,o);o+=2,c.coverage=e._lctf.readCoverage(r,u+g)}if(s==1&&c.fmt==1){var I=l.readUshort(r,o);o+=2;var h=e._lctf.numOfOnes(I);I!=0&&(c.pos=e.GPOS.readValueRecord(r,o,I))}else if(s==2&&c.fmt>=1&&c.fmt<=2){I=l.readUshort(r,o),o+=2;var C=l.readUshort(r,o);o+=2,h=e._lctf.numOfOnes(I);var b=e._lctf.numOfOnes(C);if(c.fmt==1){c.pairsets=[];var m=l.readUshort(r,o);o+=2;for(var f=0;f<m;f++){var p=g+l.readUshort(r,o);o+=2;var v=l.readUshort(r,p);p+=2;for(var B=[],G=0;G<v;G++){var R=l.readUshort(r,p);p+=2,I!=0&&(k=e.GPOS.readValueRecord(r,p,I),p+=2*h),C!=0&&(_=e.GPOS.readValueRecord(r,p,C),p+=2*b),B.push({gid2:R,val1:k,val2:_})}c.pairsets.push(B)}}if(c.fmt==2){var w=l.readUshort(r,o);o+=2;var E=l.readUshort(r,o);o+=2;var x=l.readUshort(r,o);o+=2;var W=l.readUshort(r,o);for(o+=2,c.classDef1=e._lctf.readClassDef(r,g+w),c.classDef2=e._lctf.readClassDef(r,g+E),c.matrix=[],f=0;f<x;f++){var T=[];for(G=0;G<W;G++){var k=null,_=null;I!=0&&(k=e.GPOS.readValueRecord(r,o,I),o+=2*h),C!=0&&(_=e.GPOS.readValueRecord(r,o,C),o+=2*b),T.push({val1:k,val2:_})}c.matrix.push(T)}}}else{if(s==9&&c.fmt==1){var U=l.readUshort(r,o);o+=2;var O=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=U;else if(a.ltype!=U)throw"invalid extension substitution";return e.GPOS.subt(r,a.ltype,g+O)}console.debug("unsupported GPOS table LookupType",s,"format",c.fmt)}return c},e.GPOS.readValueRecord=function(r,s,o){var a=e._bin,l=[];return l.push(1&o?a.readShort(r,s):0),s+=1&o?2:0,l.push(2&o?a.readShort(r,s):0),s+=2&o?2:0,l.push(4&o?a.readShort(r,s):0),s+=4&o?2:0,l.push(8&o?a.readShort(r,s):0),s+=8&o?2:0,l},e.GSUB={},e.GSUB.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GSUB.subt)},e.GSUB.subt=function(r,s,o,a){var l=e._bin,g=o,c={};if(c.fmt=l.readUshort(r,o),o+=2,s!=1&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==4||s==5&&c.fmt<=2||s==6&&c.fmt<=2){var u=l.readUshort(r,o);o+=2,c.coverage=e._lctf.readCoverage(r,g+u)}if(s==1&&c.fmt>=1&&c.fmt<=2){if(c.fmt==1)c.delta=l.readShort(r,o),o+=2;else if(c.fmt==2){var I=l.readUshort(r,o);o+=2,c.newg=l.readUshorts(r,o,I),o+=2*c.newg.length}}else if(s==4){c.vals=[],I=l.readUshort(r,o),o+=2;for(var h=0;h<I;h++){var C=l.readUshort(r,o);o+=2,c.vals.push(e.GSUB.readLigatureSet(r,g+C))}}else if(s==5&&c.fmt==2){if(c.fmt==2){var b=l.readUshort(r,o);o+=2,c.cDef=e._lctf.readClassDef(r,g+b),c.scset=[];var m=l.readUshort(r,o);for(o+=2,h=0;h<m;h++){var f=l.readUshort(r,o);o+=2,c.scset.push(f==0?null:e.GSUB.readSubClassSet(r,g+f))}}}else if(s==6&&c.fmt==3){if(c.fmt==3){for(h=0;h<3;h++){I=l.readUshort(r,o),o+=2;for(var p=[],v=0;v<I;v++)p.push(e._lctf.readCoverage(r,g+l.readUshort(r,o+2*v)));o+=2*I,h==0&&(c.backCvg=p),h==1&&(c.inptCvg=p),h==2&&(c.ahedCvg=p)}I=l.readUshort(r,o),o+=2,c.lookupRec=e.GSUB.readSubstLookupRecords(r,o,I)}}else{if(s==7&&c.fmt==1){var B=l.readUshort(r,o);o+=2;var G=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=B;else if(a.ltype!=B)throw"invalid extension substitution";return e.GSUB.subt(r,a.ltype,g+G)}console.debug("unsupported GSUB table LookupType",s,"format",c.fmt)}return c},e.GSUB.readSubClassSet=function(r,s){var o=e._bin.readUshort,a=s,l=[],g=o(r,s);s+=2;for(var c=0;c<g;c++){var u=o(r,s);s+=2,l.push(e.GSUB.readSubClassRule(r,a+u))}return l},e.GSUB.readSubClassRule=function(r,s){var o=e._bin.readUshort,a={},l=o(r,s),g=o(r,s+=2);s+=2,a.input=[];for(var c=0;c<l-1;c++)a.input.push(o(r,s)),s+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(r,s,g),a},e.GSUB.readSubstLookupRecords=function(r,s,o){for(var a=e._bin.readUshort,l=[],g=0;g<o;g++)l.push(a(r,s),a(r,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(r,s){var o=e._bin,a=s,l=[],g=o.readUshort(r,s);s+=2;for(var c=0;c<g;c++){var u=o.readUshort(r,s);s+=2,l.push(e.GSUB.readChainSubClassRule(r,a+u))}return l},e.GSUB.readChainSubClassRule=function(r,s){for(var o=e._bin,a={},l=["backtrack","input","lookahead"],g=0;g<l.length;g++){var c=o.readUshort(r,s);s+=2,g==1&&c--,a[l[g]]=o.readUshorts(r,s,c),s+=2*a[l[g]].length}return c=o.readUshort(r,s),s+=2,a.subst=o.readUshorts(r,s,2*c),s+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(r,s){var o=e._bin,a=s,l=[],g=o.readUshort(r,s);s+=2;for(var c=0;c<g;c++){var u=o.readUshort(r,s);s+=2,l.push(e.GSUB.readLigature(r,a+u))}return l},e.GSUB.readLigature=function(r,s){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2;for(var g=0;g<l-1;g++)a.chain.push(o.readUshort(r,s)),s+=2;return a},e.head={},e.head.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.fontRevision=a.readFixed(r,s),s+=4,a.readUint(r,s),s+=4,a.readUint(r,s),s+=4,l.flags=a.readUshort(r,s),s+=2,l.unitsPerEm=a.readUshort(r,s),s+=2,l.created=a.readUint64(r,s),s+=8,l.modified=a.readUint64(r,s),s+=8,l.xMin=a.readShort(r,s),s+=2,l.yMin=a.readShort(r,s),s+=2,l.xMax=a.readShort(r,s),s+=2,l.yMax=a.readShort(r,s),s+=2,l.macStyle=a.readUshort(r,s),s+=2,l.lowestRecPPEM=a.readUshort(r,s),s+=2,l.fontDirectionHint=a.readShort(r,s),s+=2,l.indexToLocFormat=a.readShort(r,s),s+=2,l.glyphDataFormat=a.readShort(r,s),s+=2,l},e.hhea={},e.hhea.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.ascender=a.readShort(r,s),s+=2,l.descender=a.readShort(r,s),s+=2,l.lineGap=a.readShort(r,s),s+=2,l.advanceWidthMax=a.readUshort(r,s),s+=2,l.minLeftSideBearing=a.readShort(r,s),s+=2,l.minRightSideBearing=a.readShort(r,s),s+=2,l.xMaxExtent=a.readShort(r,s),s+=2,l.caretSlopeRise=a.readShort(r,s),s+=2,l.caretSlopeRun=a.readShort(r,s),s+=2,l.caretOffset=a.readShort(r,s),s+=2,s+=8,l.metricDataFormat=a.readShort(r,s),s+=2,l.numberOfHMetrics=a.readUshort(r,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(r,s,o,a){for(var l=e._bin,g={aWidth:[],lsBearing:[]},c=0,u=0,I=0;I<a.maxp.numGlyphs;I++)I<a.hhea.numberOfHMetrics&&(c=l.readUshort(r,s),s+=2,u=l.readShort(r,s),s+=2),g.aWidth.push(c),g.lsBearing.push(u);return g},e.kern={},e.kern.parse=function(r,s,o,a){var l=e._bin,g=l.readUshort(r,s);if(s+=2,g==1)return e.kern.parseV1(r,s-2,o,a);var c=l.readUshort(r,s);s+=2;for(var u={glyph1:[],rval:[]},I=0;I<c;I++){s+=2,o=l.readUshort(r,s),s+=2;var h=l.readUshort(r,s);s+=2;var C=h>>>8;if((C&=15)!=0)throw"unknown kern table format: "+C;s=e.kern.readFormat0(r,s,u)}return u},e.kern.parseV1=function(r,s,o,a){var l=e._bin;l.readFixed(r,s),s+=4;var g=l.readUint(r,s);s+=4;for(var c={glyph1:[],rval:[]},u=0;u<g;u++){l.readUint(r,s),s+=4;var I=l.readUshort(r,s);s+=2,l.readUshort(r,s),s+=2;var h=I>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;s=e.kern.readFormat0(r,s,c)}return c},e.kern.readFormat0=function(r,s,o){var a=e._bin,l=-1,g=a.readUshort(r,s);s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2;for(var c=0;c<g;c++){var u=a.readUshort(r,s);s+=2;var I=a.readUshort(r,s);s+=2;var h=a.readShort(r,s);s+=2,u!=l&&(o.glyph1.push(u),o.rval.push({glyph2:[],vals:[]}));var C=o.rval[o.rval.length-1];C.glyph2.push(I),C.vals.push(h),l=u}return s},e.loca={},e.loca.parse=function(r,s,o,a){var l=e._bin,g=[],c=a.head.indexToLocFormat,u=a.maxp.numGlyphs+1;if(c==0)for(var I=0;I<u;I++)g.push(l.readUshort(r,s+(I<<1))<<1);if(c==1)for(I=0;I<u;I++)g.push(l.readUint(r,s+(I<<2)));return g},e.maxp={},e.maxp.parse=function(r,s,o){var a=e._bin,l={},g=a.readUint(r,s);return s+=4,l.numGlyphs=a.readUshort(r,s),s+=2,g==65536&&(l.maxPoints=a.readUshort(r,s),s+=2,l.maxContours=a.readUshort(r,s),s+=2,l.maxCompositePoints=a.readUshort(r,s),s+=2,l.maxCompositeContours=a.readUshort(r,s),s+=2,l.maxZones=a.readUshort(r,s),s+=2,l.maxTwilightPoints=a.readUshort(r,s),s+=2,l.maxStorage=a.readUshort(r,s),s+=2,l.maxFunctionDefs=a.readUshort(r,s),s+=2,l.maxInstructionDefs=a.readUshort(r,s),s+=2,l.maxStackElements=a.readUshort(r,s),s+=2,l.maxSizeOfInstructions=a.readUshort(r,s),s+=2,l.maxComponentElements=a.readUshort(r,s),s+=2,l.maxComponentDepth=a.readUshort(r,s),s+=2),l},e.name={},e.name.parse=function(r,s,o){var a=e._bin,l={};a.readUshort(r,s),s+=2;var g=a.readUshort(r,s);s+=2,a.readUshort(r,s);for(var c,u=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],I=s+=2,h=0;h<g;h++){var C=a.readUshort(r,s);s+=2;var b=a.readUshort(r,s);s+=2;var m=a.readUshort(r,s);s+=2;var f=a.readUshort(r,s);s+=2;var p=a.readUshort(r,s);s+=2;var v=a.readUshort(r,s);s+=2;var B,G=u[f],R=I+12*g+v;if(C==0)B=a.readUnicode(r,R,p/2);else if(C==3&&b==0)B=a.readUnicode(r,R,p/2);else if(b==0)B=a.readASCII(r,R,p);else if(b==1)B=a.readUnicode(r,R,p/2);else if(b==3)B=a.readUnicode(r,R,p/2);else{if(C!=1)throw"unknown encoding "+b+", platformID: "+C;B=a.readASCII(r,R,p),console.debug("reading unknown MAC encoding "+b+" as ASCII")}var w="p"+C+","+m.toString(16);l[w]==null&&(l[w]={}),l[w][G!==void 0?G:f]=B,l[w]._lang=m}for(var E in l)if(l[E].postScriptName!=null&&l[E]._lang==1033)return l[E];for(var E in l)if(l[E].postScriptName!=null&&l[E]._lang==0)return l[E];for(var E in l)if(l[E].postScriptName!=null&&l[E]._lang==3084)return l[E];for(var E in l)if(l[E].postScriptName!=null)return l[E];for(var E in l){c=E;break}return console.debug("returning name table with languageID "+l[c]._lang),l[c]},e["OS/2"]={},e["OS/2"].parse=function(r,s,o){var a=e._bin.readUshort(r,s);s+=2;var l={};if(a==0)e["OS/2"].version0(r,s,l);else if(a==1)e["OS/2"].version1(r,s,l);else if(a==2||a==3||a==4)e["OS/2"].version2(r,s,l);else{if(a!=5)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(r,s,l)}return l},e["OS/2"].version0=function(r,s,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(r,s),s+=2,o.usWeightClass=a.readUshort(r,s),s+=2,o.usWidthClass=a.readUshort(r,s),s+=2,o.fsType=a.readUshort(r,s),s+=2,o.ySubscriptXSize=a.readShort(r,s),s+=2,o.ySubscriptYSize=a.readShort(r,s),s+=2,o.ySubscriptXOffset=a.readShort(r,s),s+=2,o.ySubscriptYOffset=a.readShort(r,s),s+=2,o.ySuperscriptXSize=a.readShort(r,s),s+=2,o.ySuperscriptYSize=a.readShort(r,s),s+=2,o.ySuperscriptXOffset=a.readShort(r,s),s+=2,o.ySuperscriptYOffset=a.readShort(r,s),s+=2,o.yStrikeoutSize=a.readShort(r,s),s+=2,o.yStrikeoutPosition=a.readShort(r,s),s+=2,o.sFamilyClass=a.readShort(r,s),s+=2,o.panose=a.readBytes(r,s,10),s+=10,o.ulUnicodeRange1=a.readUint(r,s),s+=4,o.ulUnicodeRange2=a.readUint(r,s),s+=4,o.ulUnicodeRange3=a.readUint(r,s),s+=4,o.ulUnicodeRange4=a.readUint(r,s),s+=4,o.achVendID=[a.readInt8(r,s),a.readInt8(r,s+1),a.readInt8(r,s+2),a.readInt8(r,s+3)],s+=4,o.fsSelection=a.readUshort(r,s),s+=2,o.usFirstCharIndex=a.readUshort(r,s),s+=2,o.usLastCharIndex=a.readUshort(r,s),s+=2,o.sTypoAscender=a.readShort(r,s),s+=2,o.sTypoDescender=a.readShort(r,s),s+=2,o.sTypoLineGap=a.readShort(r,s),s+=2,o.usWinAscent=a.readUshort(r,s),s+=2,o.usWinDescent=a.readUshort(r,s),s+=2},e["OS/2"].version1=function(r,s,o){var a=e._bin;return s=e["OS/2"].version0(r,s,o),o.ulCodePageRange1=a.readUint(r,s),s+=4,o.ulCodePageRange2=a.readUint(r,s),s+=4},e["OS/2"].version2=function(r,s,o){var a=e._bin;return s=e["OS/2"].version1(r,s,o),o.sxHeight=a.readShort(r,s),s+=2,o.sCapHeight=a.readShort(r,s),s+=2,o.usDefault=a.readUshort(r,s),s+=2,o.usBreak=a.readUshort(r,s),s+=2,o.usMaxContext=a.readUshort(r,s),s+=2},e["OS/2"].version5=function(r,s,o){var a=e._bin;return s=e["OS/2"].version2(r,s,o),o.usLowerOpticalPointSize=a.readUshort(r,s),s+=2,o.usUpperOpticalPointSize=a.readUshort(r,s),s+=2},e.post={},e.post.parse=function(r,s,o){var a=e._bin,l={};return l.version=a.readFixed(r,s),s+=4,l.italicAngle=a.readFixed(r,s),s+=4,l.underlinePosition=a.readShort(r,s),s+=2,l.underlineThickness=a.readShort(r,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(r,s){var o=r.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var l=o.tables[a];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var g=-1,c=0;c<l.endCount.length;c++)if(s<=l.endCount[c]){g=c;break}return g==-1||l.startCount[g]>s?0:65535&(l.idRangeOffset[g]!=0?l.glyphIdArray[s-l.startCount[g]+(l.idRangeOffset[g]>>1)-(l.idRangeOffset.length-g)]:s+l.idDelta[g])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(c=0;c<l.groups.length;c++){var u=l.groups[c];if(u[0]<=s&&s<=u[1])return u[2]+(s-u[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(r,s){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[s]){var a=r.SVG.entries[s];return a==null?o:(typeof a=="string"&&(a=e.SVG.toPath(a),r.SVG.entries[s]=a),a)}if(r.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},g=r.CFF,c=r.CFF.Private;if(g.ROS){for(var u=0;g.FDSelect[u+2]<=s;)u+=2;c=g.FDArray[g.FDSelect[u+1]].Private}e.U._drawCFF(r.CFF.CharStrings[s],l,g,c,o)}else r.glyf&&e.U._drawGlyf(s,r,o);return o},e.U._drawGlyf=function(r,s,o){var a=s.glyf[r];a==null&&(a=s.glyf[r]=e.glyf._parseGlyf(s,r)),a!=null&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,s,o))},e.U._simpleGlyph=function(r,s){for(var o=0;o<r.noc;o++){for(var a=o==0?0:r.endPts[o-1]+1,l=r.endPts[o],g=a;g<=l;g++){var c=g==a?l:g-1,u=g==l?a:g+1,I=1&r.flags[g],h=1&r.flags[c],C=1&r.flags[u],b=r.xs[g],m=r.ys[g];if(g==a)if(I){if(!h){e.U.P.moveTo(s,b,m);continue}e.U.P.moveTo(s,r.xs[c],r.ys[c])}else h?e.U.P.moveTo(s,r.xs[c],r.ys[c]):e.U.P.moveTo(s,(r.xs[c]+b)/2,(r.ys[c]+m)/2);I?h&&e.U.P.lineTo(s,b,m):C?e.U.P.qcurveTo(s,b,m,r.xs[u],r.ys[u]):e.U.P.qcurveTo(s,b,m,(b+r.xs[u])/2,(m+r.ys[u])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(r,s,o){for(var a=0;a<r.parts.length;a++){var l={cmds:[],crds:[]},g=r.parts[a];e.U._drawGlyf(g.glyphIndex,s,l);for(var c=g.m,u=0;u<l.crds.length;u+=2){var I=l.crds[u],h=l.crds[u+1];o.crds.push(I*c.a+h*c.b+c.tx),o.crds.push(I*c.c+h*c.d+c.ty)}for(u=0;u<l.cmds.length;u++)o.cmds.push(l.cmds[u])}},e.U._getGlyphClass=function(r,s){var o=e._lctf.getInterval(s,r);return o==-1?0:s[o+2]},e.U.getPairAdjustment=function(r,s,o){var a=!1;if(r.GPOS)for(var l=r.GPOS,g=l.lookupList,c=l.featureList,u=[],I=0;I<c.length;I++){var h=c[I];if(h.tag=="kern"){a=!0;for(var C=0;C<h.tab.length;C++)if(!u[h.tab[C]]){u[h.tab[C]]=!0;for(var b=g[h.tab[C]],m=0;m<b.tabs.length;m++)if(b.tabs[m]!=null){var f,p=b.tabs[m];if((!p.coverage||(f=e._lctf.coverageIndex(p.coverage,s))!=-1)&&b.ltype!=1){if(b.ltype==2){var v=null;if(p.fmt==1){var B=p.pairsets[f];for(I=0;I<B.length;I++)B[I].gid2==o&&(v=B[I])}else if(p.fmt==2){var G=e.U._getGlyphClass(s,p.classDef1),R=e.U._getGlyphClass(o,p.classDef2);v=p.matrix[G][R]}if(v){var w=0;return v.val1&&v.val1[2]&&(w+=v.val1[2]),v.val2&&v.val2[0]&&(w+=v.val2[0]),w}}}}}}}if(r.kern&&!a){var E=r.kern.glyph1.indexOf(s);if(E!=-1){var x=r.kern.rval[E].glyph2.indexOf(o);if(x!=-1)return r.kern.rval[E].vals[x]}}return 0},e.U._applySubs=function(r,s,o,a){for(var l=r.length-s-1,g=0;g<o.tabs.length;g++)if(o.tabs[g]!=null){var c,u=o.tabs[g];if(!u.coverage||(c=e._lctf.coverageIndex(u.coverage,r[s]))!=-1){if(o.ltype==1)r[s],u.fmt==1?r[s]=r[s]+u.delta:r[s]=u.newg[c];else if(o.ltype==4)for(var I=u.vals[c],h=0;h<I.length;h++){var C=I[h],b=C.chain.length;if(!(b>l)){for(var m=!0,f=0,p=0;p<b;p++){for(;r[s+f+(1+p)]==-1;)f++;C.chain[p]!=r[s+f+(1+p)]&&(m=!1)}if(m){for(r[s]=C.nglyph,p=0;p<b+f;p++)r[s+p+1]=-1;break}}}else if(o.ltype==5&&u.fmt==2)for(var v=e._lctf.getInterval(u.cDef,r[s]),B=u.cDef[v+2],G=u.scset[B],R=0;R<G.length;R++){var w=G[R],E=w.input;if(!(E.length>l)){for(m=!0,p=0;p<E.length;p++){var x=e._lctf.getInterval(u.cDef,r[s+1+p]);if(v==-1&&u.cDef[x+2]!=E[p]){m=!1;break}}if(m){var W=w.substLookupRecords;for(h=0;h<W.length;h+=2)W[h],W[h+1]}}}else if(o.ltype==6&&u.fmt==3){if(!e.U._glsCovered(r,u.backCvg,s-u.backCvg.length)||!e.U._glsCovered(r,u.inptCvg,s)||!e.U._glsCovered(r,u.ahedCvg,s+u.inptCvg.length))continue;var T=u.lookupRec;for(R=0;R<T.length;R+=2){v=T[R];var k=a[T[R+1]];e.U._applySubs(r,s+v,k,a)}}}}},e.U._glsCovered=function(r,s,o){for(var a=0;a<s.length;a++)if(e._lctf.coverageIndex(s[a],r[o+a])==-1)return!1;return!0},e.U.glyphsToPath=function(r,s,o){for(var a={cmds:[],crds:[]},l=0,g=0;g<s.length;g++){var c=s[g];if(c!=-1){for(var u=g<s.length-1&&s[g+1]!=-1?s[g+1]:0,I=e.U.glyphToPath(r,c),h=0;h<I.crds.length;h+=2)a.crds.push(I.crds[h]+l),a.crds.push(I.crds[h+1]);for(o&&a.cmds.push(o),h=0;h<I.cmds.length;h++)a.cmds.push(I.cmds[h]);o&&a.cmds.push("X"),l+=r.hmtx.aWidth[c],g<s.length-1&&(l+=e.U.getPairAdjustment(r,c,u))}}return a},e.U.P={},e.U.P.moveTo=function(r,s,o){r.cmds.push("M"),r.crds.push(s,o)},e.U.P.lineTo=function(r,s,o){r.cmds.push("L"),r.crds.push(s,o)},e.U.P.curveTo=function(r,s,o,a,l,g,c){r.cmds.push("C"),r.crds.push(s,o,a,l,g,c)},e.U.P.qcurveTo=function(r,s,o,a,l){r.cmds.push("Q"),r.crds.push(s,o,a,l)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,s,o,a,l){for(var g=s.stack,c=s.nStems,u=s.haveWidth,I=s.width,h=s.open,C=0,b=s.x,m=s.y,f=0,p=0,v=0,B=0,G=0,R=0,w=0,E=0,x=0,W=0,T={val:0,size:0};C<r.length;){e.CFF.getCharString(r,C,T);var k=T.val;if(C+=T.size,k=="o1"||k=="o18")g.length%2!=0&&!u&&(I=g.shift()+a.nominalWidthX),c+=g.length>>1,g.length=0,u=!0;else if(k=="o3"||k=="o23")g.length%2!=0&&!u&&(I=g.shift()+a.nominalWidthX),c+=g.length>>1,g.length=0,u=!0;else if(k=="o4")g.length>1&&!u&&(I=g.shift()+a.nominalWidthX,u=!0),h&&e.U.P.closePath(l),m+=g.pop(),e.U.P.moveTo(l,b,m),h=!0;else if(k=="o5")for(;g.length>0;)b+=g.shift(),m+=g.shift(),e.U.P.lineTo(l,b,m);else if(k=="o6"||k=="o7")for(var _=g.length,U=k=="o6",O=0;O<_;O++){var Y=g.shift();U?b+=Y:m+=Y,U=!U,e.U.P.lineTo(l,b,m)}else if(k=="o8"||k=="o24"){_=g.length;for(var z=0;z+6<=_;)f=b+g.shift(),p=m+g.shift(),v=f+g.shift(),B=p+g.shift(),b=v+g.shift(),m=B+g.shift(),e.U.P.curveTo(l,f,p,v,B,b,m),z+=6;k=="o24"&&(b+=g.shift(),m+=g.shift(),e.U.P.lineTo(l,b,m))}else{if(k=="o11")break;if(k=="o1234"||k=="o1235"||k=="o1236"||k=="o1237")k=="o1234"&&(p=m,v=(f=b+g.shift())+g.shift(),W=B=p+g.shift(),R=B,E=m,b=(w=(G=(x=v+g.shift())+g.shift())+g.shift())+g.shift(),e.U.P.curveTo(l,f,p,v,B,x,W),e.U.P.curveTo(l,G,R,w,E,b,m)),k=="o1235"&&(f=b+g.shift(),p=m+g.shift(),v=f+g.shift(),B=p+g.shift(),x=v+g.shift(),W=B+g.shift(),G=x+g.shift(),R=W+g.shift(),w=G+g.shift(),E=R+g.shift(),b=w+g.shift(),m=E+g.shift(),g.shift(),e.U.P.curveTo(l,f,p,v,B,x,W),e.U.P.curveTo(l,G,R,w,E,b,m)),k=="o1236"&&(f=b+g.shift(),p=m+g.shift(),v=f+g.shift(),W=B=p+g.shift(),R=B,w=(G=(x=v+g.shift())+g.shift())+g.shift(),E=R+g.shift(),b=w+g.shift(),e.U.P.curveTo(l,f,p,v,B,x,W),e.U.P.curveTo(l,G,R,w,E,b,m)),k=="o1237"&&(f=b+g.shift(),p=m+g.shift(),v=f+g.shift(),B=p+g.shift(),x=v+g.shift(),W=B+g.shift(),G=x+g.shift(),R=W+g.shift(),w=G+g.shift(),E=R+g.shift(),Math.abs(w-b)>Math.abs(E-m)?b=w+g.shift():m=E+g.shift(),e.U.P.curveTo(l,f,p,v,B,x,W),e.U.P.curveTo(l,G,R,w,E,b,m));else if(k=="o14"){if(g.length>0&&!u&&(I=g.shift()+o.nominalWidthX,u=!0),g.length==4){var N=g.shift(),L=g.shift(),V=g.shift(),M=g.shift(),X=e.CFF.glyphBySE(o,V),J=e.CFF.glyphBySE(o,M);e.U._drawCFF(o.CharStrings[X],s,o,a,l),s.x=N,s.y=L,e.U._drawCFF(o.CharStrings[J],s,o,a,l)}h&&(e.U.P.closePath(l),h=!1)}else if(k=="o19"||k=="o20")g.length%2!=0&&!u&&(I=g.shift()+a.nominalWidthX),c+=g.length>>1,g.length=0,u=!0,C+=c+7>>3;else if(k=="o21")g.length>2&&!u&&(I=g.shift()+a.nominalWidthX,u=!0),m+=g.pop(),b+=g.pop(),h&&e.U.P.closePath(l),e.U.P.moveTo(l,b,m),h=!0;else if(k=="o22")g.length>1&&!u&&(I=g.shift()+a.nominalWidthX,u=!0),b+=g.pop(),h&&e.U.P.closePath(l),e.U.P.moveTo(l,b,m),h=!0;else if(k=="o25"){for(;g.length>6;)b+=g.shift(),m+=g.shift(),e.U.P.lineTo(l,b,m);f=b+g.shift(),p=m+g.shift(),v=f+g.shift(),B=p+g.shift(),b=v+g.shift(),m=B+g.shift(),e.U.P.curveTo(l,f,p,v,B,b,m)}else if(k=="o26")for(g.length%2&&(b+=g.shift());g.length>0;)f=b,p=m+g.shift(),b=v=f+g.shift(),m=(B=p+g.shift())+g.shift(),e.U.P.curveTo(l,f,p,v,B,b,m);else if(k=="o27")for(g.length%2&&(m+=g.shift());g.length>0;)p=m,v=(f=b+g.shift())+g.shift(),B=p+g.shift(),b=v+g.shift(),m=B,e.U.P.curveTo(l,f,p,v,B,b,m);else if(k=="o10"||k=="o29"){var re=k=="o10"?a:o;if(g.length==0)console.debug("error: empty stack");else{var se=g.pop(),le=re.Subrs[se+re.Bias];s.x=b,s.y=m,s.nStems=c,s.haveWidth=u,s.width=I,s.open=h,e.U._drawCFF(le,s,o,a,l),b=s.x,m=s.y,c=s.nStems,u=s.haveWidth,I=s.width,h=s.open}}else if(k=="o30"||k=="o31"){var ae=g.length,ce=(z=0,k=="o31");for(z+=ae-(_=-3&ae);z<_;)ce?(p=m,v=(f=b+g.shift())+g.shift(),m=(B=p+g.shift())+g.shift(),_-z==5?(b=v+g.shift(),z++):b=v,ce=!1):(f=b,p=m+g.shift(),v=f+g.shift(),B=p+g.shift(),b=v+g.shift(),_-z==5?(m=B+g.shift(),z++):m=B,ce=!0),e.U.P.curveTo(l,f,p,v,B,b,m),z+=4}else{if((k+"").charAt(0)=="o")throw console.debug("Unknown operation: "+k,r),k;g.push(k)}}}s.x=b,s.y=m,s.nStems=c,s.haveWidth=u,s.width=I,s.open=h};var n=e,i={Typr:n};return t.Typr=n,t.default=i,Object.defineProperty(t,"__esModule",{value:!0}),t}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Kbe(){return function(t){var e=Uint8Array,n=Uint16Array,i=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(k,_){for(var U=new n(31),O=0;O<31;++O)U[O]=_+=1<<k[O-1];var Y=new i(U[30]);for(O=1;O<30;++O)for(var z=U[O];z<U[O+1];++z)Y[z]=z-U[O]<<5|O;return[U,Y]},l=a(r,2),g=l[0],c=l[1];g[28]=258,c[258]=28;for(var u=a(s,0)[0],I=new n(32768),h=0;h<32768;++h){var C=(43690&h)>>>1|(21845&h)<<1;C=(61680&(C=(52428&C)>>>2|(13107&C)<<2))>>>4|(3855&C)<<4,I[h]=((65280&C)>>>8|(255&C)<<8)>>>1}var b=function(k,_,U){for(var O=k.length,Y=0,z=new n(_);Y<O;++Y)++z[k[Y]-1];var N,L=new n(_);for(Y=0;Y<_;++Y)L[Y]=L[Y-1]+z[Y-1]<<1;if(U){N=new n(1<<_);var V=15-_;for(Y=0;Y<O;++Y)if(k[Y])for(var M=Y<<4|k[Y],X=_-k[Y],J=L[k[Y]-1]++<<X,re=J|(1<<X)-1;J<=re;++J)N[I[J]>>>V]=M}else for(N=new n(O),Y=0;Y<O;++Y)k[Y]&&(N[Y]=I[L[k[Y]-1]++]>>>15-k[Y]);return N},m=new e(288);for(h=0;h<144;++h)m[h]=8;for(h=144;h<256;++h)m[h]=9;for(h=256;h<280;++h)m[h]=7;for(h=280;h<288;++h)m[h]=8;var f=new e(32);for(h=0;h<32;++h)f[h]=5;var p=b(m,9,1),v=b(f,5,1),B=function(k){for(var _=k[0],U=1;U<k.length;++U)k[U]>_&&(_=k[U]);return _},G=function(k,_,U){var O=_/8|0;return(k[O]|k[O+1]<<8)>>(7&_)&U},R=function(k,_){var U=_/8|0;return(k[U]|k[U+1]<<8|k[U+2]<<16)>>(7&_)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(k,_,U){var O=new Error(_||w[k]);if(O.code=k,Error.captureStackTrace&&Error.captureStackTrace(O,E),!U)throw O;return O},x=function(k,_,U){var O=k.length;if(!O||U&&!U.l&&O<5)return _||new e(0);var Y=!_||U,z=!U||U.i;U||(U={}),_||(_=new e(3*O));var N,L=function(ke){var $=_.length;if(ke>$){var Se=new e(Math.max(2*$,ke));Se.set(_),_=Se}},V=U.f||0,M=U.p||0,X=U.b||0,J=U.l,re=U.d,se=U.m,le=U.n,ae=8*O;do{if(!J){U.f=V=G(k,M,1);var ce=G(k,M+1,3);if(M+=3,!ce){var Ee=k[(Be=((N=M)/8|0)+(7&N&&1)+4)-4]|k[Be-3]<<8,Fe=Be+Ee;if(Fe>O){z&&E(0);break}Y&&L(X+Ee),_.set(k.subarray(Be,Fe),X),U.b=X+=Ee,U.p=M=8*Fe;continue}if(ce==1)J=p,re=v,se=9,le=5;else if(ce==2){var oe=G(k,M,31)+257,D=G(k,M+10,15)+4,fe=oe+G(k,M+5,31)+1;M+=14;for(var Ce=new e(fe),pe=new e(19),be=0;be<D;++be)pe[o[be]]=G(k,M+3*be,7);M+=3*D;var Ue=B(pe),me=(1<<Ue)-1,we=b(pe,Ue,1);for(be=0;be<fe;){var Be,Ae=we[G(k,M,me)];if(M+=15&Ae,(Be=Ae>>>4)<16)Ce[be++]=Be;else{var De=0,Q=0;for(Be==16?(Q=3+G(k,M,3),M+=2,De=Ce[be-1]):Be==17?(Q=3+G(k,M,7),M+=3):Be==18&&(Q=11+G(k,M,127),M+=7);Q--;)Ce[be++]=De}}var K=Ce.subarray(0,oe),ge=Ce.subarray(oe);se=B(K),le=B(ge),J=b(K,se,1),re=b(ge,le,1)}else E(1);if(M>ae){z&&E(0);break}}Y&&L(X+131072);for(var Le=(1<<se)-1,Re=(1<<le)-1,Ze=M;;Ze=M){var Je=(De=J[R(k,M)&Le])>>>4;if((M+=15&De)>ae){z&&E(0);break}if(De||E(2),Je<256)_[X++]=Je;else{if(Je==256){Ze=M,J=null;break}var Ye=Je-254;if(Je>264){var de=r[be=Je-257];Ye=G(k,M,(1<<de)-1)+g[be],M+=de}var ze=re[R(k,M)&Re],je=ze>>>4;if(ze||E(3),M+=15&ze,ge=u[je],je>3&&(de=s[je],ge+=R(k,M)&(1<<de)-1,M+=de),M>ae){z&&E(0);break}Y&&L(X+131072);for(var Pe=X+Ye;X<Pe;X+=4)_[X]=_[X-ge],_[X+1]=_[X+1-ge],_[X+2]=_[X+2-ge],_[X+3]=_[X+3-ge];X=Pe}}U.l=J,U.p=Ze,U.b=X,J&&(V=1,U.m=se,U.d=re,U.n=le)}while(!V);return X==_.length?_:function(ke,$,Se){($==null||$<0)&&($=0),(Se==null||Se>ke.length)&&(Se=ke.length);var Ke=new(ke instanceof n?n:ke instanceof i?i:e)(Se-$);return Ke.set(ke.subarray($,Se)),Ke}(_,0,X)},W=new e(0),T=typeof TextDecoder<"u"&&new TextDecoder;try{T.decode(W,{stream:!0})}catch{}return t.convert_streams=function(k){var _=new DataView(k),U=0;function O(){var oe=_.getUint16(U);return U+=2,oe}function Y(){var oe=_.getUint32(U);return U+=4,oe}function z(oe){Ee.setUint16(Fe,oe),Fe+=2}function N(oe){Ee.setUint32(Fe,oe),Fe+=4}for(var L={signature:Y(),flavor:Y(),length:Y(),numTables:O(),reserved:O(),totalSfntSize:Y(),majorVersion:O(),minorVersion:O(),metaOffset:Y(),metaLength:Y(),metaOrigLength:Y(),privOffset:Y(),privLength:Y()},V=0;Math.pow(2,V)<=L.numTables;)V++;V--;for(var M=16*Math.pow(2,V),X=16*L.numTables-M,J=12,re=[],se=0;se<L.numTables;se++)re.push({tag:Y(),offset:Y(),compLength:Y(),origLength:Y(),origChecksum:Y()}),J+=16;var le,ae=new Uint8Array(12+16*re.length+re.reduce(function(oe,D){return oe+D.origLength+4},0)),ce=ae.buffer,Ee=new DataView(ce),Fe=0;return N(L.flavor),z(L.numTables),z(M),z(V),z(X),re.forEach(function(oe){N(oe.tag),N(oe.origChecksum),N(J),N(oe.origLength),oe.outOffset=J,(J+=oe.origLength)%4!=0&&(J+=4-J%4)}),re.forEach(function(oe){var D,fe=k.slice(oe.offset,oe.offset+oe.compLength);if(oe.compLength!=oe.origLength){var Ce=new Uint8Array(oe.origLength);D=new Uint8Array(fe,2),x(D,Ce)}else Ce=new Uint8Array(fe);ae.set(Ce,oe.outOffset);var pe=0;(J=oe.outOffset+oe.origLength)%4!=0&&(pe=4-J%4),ae.set(new Uint8Array(pe).buffer,oe.outOffset+oe.origLength),le=J+pe}),ce.slice(0,le)},Object.defineProperty(t,"__esModule",{value:!0}),t}({}).convert_streams}function zbe(t,e){const n={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,o=4,a=8,l=16,g=32;let c;function u(G){if(!c){const R={R:s,L:r,D:o,C:l,U:g,T:a};c=new Map;for(let w in i){let E=0;i[w].split(",").forEach(x=>{let[W,T]=x.split("+");W=parseInt(W,36),T=T?parseInt(T,36):0,c.set(E+=W,R[w]);for(let k=T;k--;)c.set(++E,R[w])})}}return c.get(G)||g}const I=1,h=2,C=3,b=4,m=[null,"isol","init","fina","medi"];function f(G){const R=new Uint8Array(G.length);let w=g,E=I,x=-1;for(let W=0;W<G.length;W++){const T=G.codePointAt(W);let k=u(T)|0,_=I;k&a||(w&(r|o|l)?k&(s|o|l)?(_=C,(E===I||E===C)&&R[x]++):k&(r|g)&&(E===h||E===b)&&R[x]--:w&(s|g)&&(E===h||E===b)&&R[x]--,E=R[W]=_,w=k,x=W,T>65535&&W++)}return R}function p(G,R){const w=[];for(let x=0;x<R.length;x++){const W=R.codePointAt(x);W>65535&&x++,w.push(t.U.codeToGlyph(G,W))}const E=G.GSUB;if(E){const{lookupList:x,featureList:W}=E;let T;const k=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,_=[];W.forEach(U=>{if(k.test(U.tag))for(let O=0;O<U.tab.length;O++){if(_[U.tab[O]])continue;_[U.tab[O]]=!0;const Y=x[U.tab[O]],z=/^(isol|init|fina|medi)$/.test(U.tag);z&&!T&&(T=f(R));for(let N=0;N<w.length;N++)(!T||!z||m[T[N]]===U.tag)&&t.U._applySubs(w,N,Y,x)}})}return w}function v(...G){for(let R=0;R<G.length;R++)if(typeof G[R]=="number")return G[R]}function B(G){const R=Object.create(null),w=G["OS/2"],E=G.hhea,x=G.head.unitsPerEm,W=v(w&&w.sTypoAscender,E&&E.ascender,x),T={unitsPerEm:x,ascender:W,descender:v(w&&w.sTypoDescender,E&&E.descender,0),capHeight:v(w&&w.sCapHeight,W),xHeight:v(w&&w.sxHeight,W),lineGap:v(w&&w.sTypoLineGap,E&&E.lineGap),forEachGlyph(k,_,U,O){let Y=0;const z=1/T.unitsPerEm*_,N=p(G,k);let L=0,V=-1;return N.forEach((M,X)=>{if(M!==-1){let J=R[M];if(!J){const{cmds:re,crds:se}=t.U.glyphToPath(G,M);let le="",ae=0;for(let D=0,fe=re.length;D<fe;D++){const Ce=n[re[D]];le+=re[D];for(let pe=1;pe<=Ce;pe++)le+=(pe>1?",":"")+se[ae++]}let ce,Ee,Fe,oe;if(se.length){ce=Ee=1/0,Fe=oe=-1/0;for(let D=0,fe=se.length;D<fe;D+=2){let Ce=se[D],pe=se[D+1];Ce<ce&&(ce=Ce),pe<Ee&&(Ee=pe),Ce>Fe&&(Fe=Ce),pe>oe&&(oe=pe)}}else ce=Fe=Ee=oe=0;J=R[M]={index:M,advanceWidth:G.hmtx.aWidth[M],xMin:ce,yMin:Ee,xMax:Fe,yMax:oe,path:le,pathCommandCount:re.length}}V!==-1&&(Y+=t.U.getPairAdjustment(G,V,M)*z),O.call(null,J,Y,L),J.advanceWidth&&(Y+=J.advanceWidth*z),U&&(Y+=U*_),V=M}L+=k.codePointAt(L)>65535?2:1}),Y}};return T}return function(R){const w=new Uint8Array(R,0,4),E=t._bin.readASCII(w,0,4);if(E==="wOFF")R=e(R);else if(E==="wOF2")throw new Error("woff2 fonts not supported");return B(t.parse(R)[0])}}const Ube=Q0({name:"Typr Font Parser",dependencies:[Ybe,Kbe,zbe],init(t,e,n){const i=t(),r=e();return n(i,r)}}),Yd={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Dbe=new et;function pd(){return(self.performance||Date).now()}const R7=Object.create(null);function xK(t,e){t=Qbe({},t);const n=pd();if(t.font=Jbe(t.font||Yd.defaultFontURL),t.text=""+t.text,t.sdfGlyphSize=t.sdfGlyphSize||Yd.sdfGlyphSize,t.colorRanges!=null){let u={};for(let I in t.colorRanges)if(t.colorRanges.hasOwnProperty(I)){let h=t.colorRanges[I];typeof h!="number"&&(h=Dbe.set(h).getHex()),u[I]=h}t.colorRanges=u}Object.freeze(t);const{textureWidth:i,sdfExponent:r}=Yd,{sdfGlyphSize:s}=t,o=i/s*4;let a=R7[s];if(!a){const u=document.createElement("canvas");u.width=i,u.height=s*256/o,a=R7[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:u,sdfTexture:new ei(u,void 0,void 0,void 0,xn,xn),contextLost:!1,glyphsByFont:new Map},a.sdfTexture.generateMipmaps=!1,Pbe(a)}const{sdfTexture:l,sdfCanvas:g}=a;let c=a.glyphsByFont.get(t.font);c||a.glyphsByFont.set(t.font,c=new Map),qbe(t).then(u=>{const{glyphIds:I,glyphPositions:h,fontSize:C,unitsPerEm:b,timings:m}=u,f=[],p=new Float32Array(I.length*4),v=C/b;let B=0,G=0;const R=pd();I.forEach((T,k)=>{let _=c.get(T);if(!_){const{path:z,pathBounds:N}=u.glyphData[T],L=Math.max(N[2]-N[0],N[3]-N[1])/s*(Yd.sdfMargin*s+.5),V=a.glyphCount++,M=[N[0]-L,N[1]-L,N[2]+L,N[3]+L];c.set(T,_={path:z,atlasIndex:V,sdfViewBox:M}),f.push(_)}const{sdfViewBox:U}=_,O=h[G++],Y=h[G++];p[B++]=O+U[0]*v,p[B++]=Y+U[1]*v,p[B++]=O+U[2]*v,p[B++]=Y+U[3]*v,I[k]=_.atlasIndex}),m.quads=(m.quads||0)+(pd()-R);const w=pd();m.sdf={};const E=g.height,x=Math.ceil(a.glyphCount/o),W=Math.pow(2,Math.ceil(Math.log2(x*s)));W>E&&(console.info(`Increasing SDF texture size ${E}->${W}`),Xbe(g,i,W),l.dispose()),Promise.all(f.map(T=>ZK(T,a,t.gpuAccelerateSDF).then(({timing:k})=>{m.sdf[T.atlasIndex]=k}))).then(()=>{f.length&&!a.contextLost&&(EK(a),l.needsUpdate=!0),m.sdfTotal=pd()-w,m.total=pd()-n,e(Object.freeze({parameters:t,sdfTexture:l,sdfGlyphSize:s,sdfExponent:r,glyphBounds:p,glyphAtlasIndices:I,glyphColors:u.glyphColors,caretPositions:u.caretPositions,caretHeight:u.caretHeight,chunkedBounds:u.chunkedBounds,ascender:u.ascender,descender:u.descender,lineHeight:u.lineHeight,capHeight:u.capHeight,xHeight:u.xHeight,topBaseline:u.topBaseline,blockBounds:u.blockBounds,visibleBounds:u.visibleBounds,timings:u.timings}))})}),Promise.resolve().then(()=>{a.contextLost||_be(g)})}function ZK({path:t,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:i,sdfCanvas:r,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:l}=Yd,g=Math.max(n[2]-n[0],n[3]-n[1]),c=Math.floor(e/4),u=c%(a/i)*i,I=Math.floor(c/(a/i))*i,h=e%4;return Tbe(i,i,t,n,g,l,r,u,I,h,o)}function Pbe(t){const e=t.sdfCanvas;e.addEventListener("webglcontextlost",n=>{console.log("Context Lost",n),n.preventDefault(),t.contextLost=!0}),e.addEventListener("webglcontextrestored",n=>{console.log("Context Restored",n),t.contextLost=!1;const i=[];t.glyphsByFont.forEach(r=>{r.forEach(s=>{i.push(ZK(s,t,!0))})}),Promise.all(i).then(()=>{EK(t),t.sdfTexture.needsUpdate=!0})})}function Obe({font:t,characters:e,sdfGlyphSize:n},i){let r=Array.isArray(e)?e.join(`
`):""+e;xK({font:t,sdfGlyphSize:n,text:r},i)}function Qbe(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}let G2;function Jbe(t){return G2||(G2=typeof document>"u"?{}:document.createElement("a")),G2.href=t,G2.href}function EK(t){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:n}=t,{width:i,height:r}=e,s=t.sdfCanvas.getContext("webgl");let o=n.image.data;(!o||o.length!==i*r*4)&&(o=new Uint8Array(i*r*4),n.image={width:i,height:r,data:o},n.flipY=!1,n.isDataTexture=!0),s.readPixels(0,0,i,r,s.RGBA,s.UNSIGNED_BYTE,o)}}const jbe=Q0({name:"Typesetter",dependencies:[Yd,Ube,Mbe,Sbe],init(t,e,n,i){const{defaultFontURL:r}=t;return n(e,i(),{defaultFontURL:r})}}),qbe=Q0({name:"Typesetter",dependencies:[jbe],init(t){return function(e){return new Promise(n=>{t.typeset(e,n)})}},getTransferables(t){const e=[t.glyphPositions.buffer,t.glyphIds.buffer];return t.caretPositions&&e.push(t.caretPositions.buffer),t.glyphColors&&e.push(t.glyphColors.buffer),e}}),x7={};function $be(t){let e=x7[t];if(!e){const n=new cg(1,1,t,t),i=n.clone(),r=n.attributes,s=i.attributes,o=new Lt,a=r.uv.count;for(let l=0;l<a;l++)s.position.array[l*3]*=-1,s.normal.array[l*3+2]*=-1;["position","normal","uv"].forEach(l=>{o.setAttribute(l,new ut([...r[l].array,...s[l].array],r[l].itemSize))}),o.setIndex([...n.index.array,...i.index.array.map(l=>l+a)]),o.translate(.5,.5,0),e=x7[t]=o}return e}const eve="aTroikaGlyphBounds",Z7="aTroikaGlyphIndex",tve="aTroikaGlyphColor";class nve extends Wx{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ho,this.boundingBox=new va}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){const n=this.getIndex().count;this.setDrawRange(e===fr?n/2:0,e===Ps?n:n/2)}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let n=$be(e);["position","normal","uv"].forEach(i=>{this.attributes[i]=n.attributes[i].clone()}),this.setIndex(n.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,n,i,r,s){PB(this,eve,e,4),PB(this,Z7,n,1),PB(this,tve,s,3),this._blockBounds=i,this._chunkedBounds=r,this.instanceCount=n.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:n,boundingBox:i}=this;if(n){const{PI:r,floor:s,min:o,max:a,sin:l,cos:g}=Math,c=r/2,u=r*2,I=Math.abs(n),h=e[0]/I,C=e[2]/I,b=s((h+c)/u)!==s((C+c)/u)?-I:o(l(h)*I,l(C)*I),m=s((h-c)/u)!==s((C-c)/u)?I:a(l(h)*I,l(C)*I),f=s((h+r)/u)!==s((C+r)/u)?I*2:a(I-g(h)*I,I-g(C)*I);i.min.set(b,e[1],n<0?-f:0),i.max.set(m,e[3],n<0?0:f)}else i.min.set(e[0],e[1],0),i.max.set(e[2],e[3],0);i.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let n=this.getAttribute(Z7).count,i=this._chunkedBounds;if(i)for(let r=i.length;r--;){n=i[r].end;let s=i[r].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=n}}function PB(t,e,n,i){const r=t.getAttribute(e);n?r&&r.array.length===n.length?(r.array.set(n),r.needsUpdate=!0):(t.setAttribute(e,new sI(n,i)),delete t._maxInstanceCount,t.dispose()):r&&t.deleteAttribute(e)}const ive=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,rve=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,sve=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,ove=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function ave(t){const e=zS(t,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new xe},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new en(0,0,0,0)},uTroikaClipRect:{value:new en(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new xe},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new et},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Pt},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:ive,vertexTransform:rve,fragmentDefs:sve,fragmentColorTransform:ove,customRewriter({vertexShader:n,fragmentShader:i}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(i)&&(i=i.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(n)||(n=n.replace(wK,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:n,fragmentShader:i}}});return e.transparent=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const yZ=new to({color:16777215,side:Ps,transparent:!0}),E7=8421504,W7=new dt,S2=new P,OB=new P,nC=[],lve=new P,QB="+x+y";function N7(t){return Array.isArray(t)?t[0]:t}let WK=()=>{const t=new pn(new cg(1,1),yZ);return WK=()=>t,t},NK=()=>{const t=new pn(new cg(1,1,32,1),yZ);return NK=()=>t,t};const gve={type:"syncstart"},cve={type:"synccomplete"},MK=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],uve=MK.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let TK=class extends pn{constructor(){const e=new nve;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=E7,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=QB,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(gve),xK({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},n=>{this._isSyncing=!1,this._textRenderInfo=n,this.geometry.updateGlyphs(n.glyphBounds,n.glyphAtlasIndices,n.blockBounds,n.chunkedBounds,n.glyphColors);const i=this._queuedSyncs;i&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{i.forEach(r=>r&&r())})),this.dispatchEvent(cve),e&&e()})))}onBeforeRender(e,n,i,r,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s),s._hadOwnSide=s.hasOwnProperty("side"),this.geometry.setSide(s._actualSide=s.side),s.side=il}onAfterRender(e,n,i,r,s,o){s._hadOwnSide?s.side=s._actualSide:delete s.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial;const n=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=yZ.clone());if((!e||e.baseMaterial!==n)&&(e=this._derivedMaterial=ave(n),n.addEventListener("dispose",function i(){n.removeEventListener("dispose",i),e.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let i=e._outlineMtl;return i||(i=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),i.isTextOutlineMaterial=!0,i.depthWrite=!1,i.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),i.dispose()})),[i,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return N7(this.material).getDepthMaterial()}get customDistanceMaterial(){return N7(this.material).getDistanceMaterial()}_prepareForRender(e){const n=e.isTextOutlineMaterial,i=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:l}=r;i.uTroikaSDFTexture.value=a,i.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),i.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,i.uTroikaSDFExponent.value=r.sdfExponent,i.uTroikaTotalBounds.value.fromArray(l),i.uTroikaUseGlyphColors.value=!n&&!!r.glyphColors;let g=0,c=0,u=0,I,h,C,b=0,m=0;if(n){let{outlineWidth:p,outlineOffsetX:v,outlineOffsetY:B,outlineBlur:G,outlineOpacity:R}=this;g=this._parsePercent(p)||0,c=Math.max(0,this._parsePercent(G)||0),I=R,b=this._parsePercent(v)||0,m=this._parsePercent(B)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(C=this.strokeColor,i.uTroikaStrokeColor.value.set(C??E7),h=this.strokeOpacity,h==null&&(h=1)),I=this.fillOpacity;i.uTroikaDistanceOffset.value=g,i.uTroikaPositionOffset.value.set(b,m),i.uTroikaBlurRadius.value=c,i.uTroikaStrokeWidth.value=u,i.uTroikaStrokeOpacity.value=h,i.uTroikaFillOpacity.value=I??1,i.uTroikaCurveRadius.value=this.curveRadius||0;let f=this.clipRect;if(f&&Array.isArray(f)&&f.length===4)i.uTroikaClipRect.value.fromArray(f);else{const p=(this.fontSize||.1)*100;i.uTroikaClipRect.value.set(l[0]-p,l[1]-p,l[2]+p,l[3]+p)}this.geometry.applyClipRect(i.uTroikaClipRect.value)}i.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=n?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new et;(s!==a._input||typeof s=="object")&&a.set(a._input=s)}let o=this.orientation||QB;if(o!==e._orientation){let a=i.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let l=o!==QB&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,g,c,u,I]=l;S2.set(0,0,0)[c]=g==="-"?1:-1,OB.set(0,0,0)[I]=u==="-"?-1:1,W7.lookAt(lve,S2.cross(OB),OB),a.setFromMatrix4(W7)}else a.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let n=e.match(/^(-?[\d.]+)%$/),i=n?parseFloat(n[1]):NaN;e=(isNaN(i)?0:i/100)*this.fontSize}return e}localPositionToTextCoords(e,n=new xe){n.copy(e);const i=this.curveRadius;return i&&(n.x=Math.atan2(e.x,Math.abs(i)-Math.abs(e.z))*Math.abs(i)),n}worldPositionToTextCoords(e,n=new xe){return S2.copy(e),this.localPositionToTextCoords(this.worldToLocal(S2),n)}raycast(e,n){const{textRenderInfo:i,curveRadius:r}=this;if(i){const s=i.blockBounds,o=r?NK():WK(),a=o.geometry,{position:l,uv:g}=a.attributes;for(let c=0;c<g.count;c++){let u=s[0]+g.getX(c)*(s[2]-s[0]);const I=s[1]+g.getY(c)*(s[3]-s[1]);let h=0;r&&(h=r-Math.cos(u/r)*r,u=Math.sin(u/r)*r),l.setXYZ(c,u,I,h)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,nC.length=0,o.raycast(e,nC);for(let c=0;c<nC.length;c++)nC[c].object=this,n.push(nC[c])}}copy(e){const n=this.geometry;return super.copy(e),this.geometry=n,uve.forEach(i=>{this[i]=e[i]}),this}clone(){return new this.constructor().copy(this)}};MK.forEach(t=>{const e="_private_"+t;Object.defineProperty(TK.prototype,t,{get(){return this[e]},set(n){n!==this[e]&&(this[e]=n,this._needsSync=!0)}})});const M7=H.forwardRef(({sdfGlyphSize:t=64,anchorX:e="center",anchorY:n="middle",font:i,fontSize:r=1,children:s,characters:o,onSync:a,...l},g)=>{const c=Go(({invalidate:C})=>C),[u]=H.useState(()=>new TK),[I,h]=H.useMemo(()=>{const C=[];let b="";return H.Children.forEach(s,m=>{typeof m=="string"||typeof m=="number"?b+=m:C.push(m)}),[C,b]},[s]);return Cle(()=>new Promise(C=>Obe({font:i,characters:o},C)),["troika-text",i,o]),H.useLayoutEffect(()=>void u.sync(()=>{c(),a&&a(u)})),H.useEffect(()=>()=>u.dispose(),[u]),H.createElement("primitive",Es({object:u,ref:g,font:i,text:h,anchorX:e,anchorY:n,fontSize:r,sdfGlyphSize:t},l),I)});function Ive(t,e,n,i){const r=class extends an{constructor(o={}){const a=Object.entries(t);super({uniforms:a.reduce((l,[g,c])=>{const u=Pn.clone({[g]:{value:c}});return{...l,...u}},{}),vertexShader:e,fragmentShader:n}),this.key="",a.forEach(([l])=>Object.defineProperty(this,l,{get:()=>this.uniforms[l].value,set:g=>this.uniforms[l].value=g})),Object.assign(this,o),i&&i(this)}};return r.key=ac.generateUUID(),r}const dve=H.forwardRef(({makeDefault:t,camera:e,regress:n,domElement:i,enableDamping:r=!0,keyEvents:s=!1,onChange:o,onStart:a,onEnd:l,...g},c)=>{const u=Go(R=>R.invalidate),I=Go(R=>R.camera),h=Go(R=>R.gl),C=Go(R=>R.events),b=Go(R=>R.setEvents),m=Go(R=>R.set),f=Go(R=>R.get),p=Go(R=>R.performance),v=e||I,B=i||C.connected||h.domElement,G=H.useMemo(()=>new MAe(v),[v]);return GI(()=>{G.enabled&&G.update()},-1),H.useEffect(()=>(s&&G.connect(s===!0?B:s),G.connect(B),()=>void G.dispose()),[s,B,n,G,u]),H.useEffect(()=>{const R=x=>{u(),n&&p.regress(),o&&o(x)},w=x=>{a&&a(x)},E=x=>{l&&l(x)};return G.addEventListener("change",R),G.addEventListener("start",w),G.addEventListener("end",E),()=>{G.removeEventListener("start",w),G.removeEventListener("end",E),G.removeEventListener("change",R)}},[o,a,l,G,u,b]),H.useEffect(()=>{if(t){const R=f().controls;return m({controls:G}),()=>m({controls:R})}},[t,G]),H.createElement("primitive",Es({ref:c,object:G,enableDamping:r},g))});function Ave(t,e){const n=t+"Geometry";return H.forwardRef(({args:i,children:r,...s},o)=>{const a=H.useRef(null);return H.useImperativeHandle(o,()=>a.current),H.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),H.createElement("mesh",Es({ref:a},s),H.createElement(n,{attach:"geometry",args:i}),r)})}const hve=Ave("box"),Cve=Ive({time:0,pixelRatio:1},` uniform float pixelRatio;
    uniform float time;
    attribute float size;  
    attribute float speed;  
    attribute float opacity;
    attribute vec3 noise;
    attribute vec3 color;
    varying vec3 vColor;
    varying float vOpacity;
    void main() {
      vec4 modelPosition = modelMatrix * vec4(position, 1.0);
      modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
      modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
      modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
      vec4 viewPosition = viewMatrix * modelPosition;
      vec4 projectionPostion = projectionMatrix * viewPosition;
      gl_Position = projectionPostion;
      gl_PointSize = size * 25. * pixelRatio;
      gl_PointSize *= (1.0 / - viewPosition.z);
      vColor = color;
      vOpacity = opacity;
    }`,` varying vec3 vColor;
    varying float vOpacity;
    void main() {
      float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
      float strength = 0.05 / distanceToCenter - 0.1;
      gl_FragColor = vec4(vColor, strength * vOpacity);
      #include <tonemapping_fragment>
      #include <${parseInt(gg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
    }`),FK=t=>t&&t.constructor===Float32Array,fve=t=>[t.r,t.g,t.b],VK=t=>t instanceof xe||t instanceof P||t instanceof en,LK=t=>Array.isArray(t)?t:VK(t)?t.toArray():[t,t,t];function iC(t,e,n){return H.useMemo(()=>{if(e!==void 0){if(FK(e))return e;if(e instanceof et){const i=Array.from({length:t*3},()=>fve(e)).flat();return Float32Array.from(i)}else if(VK(e)||Array.isArray(e)){const i=Array.from({length:t*3},()=>LK(e)).flat();return Float32Array.from(i)}return Float32Array.from({length:t},()=>e)}return Float32Array.from({length:t},n)},[e])}const T7=H.forwardRef(({noise:t=1,count:e=100,speed:n=1,opacity:i=1,scale:r=1,size:s,color:o,children:a,...l},g)=>{H.useMemo(()=>W_({SparklesImplMaterial:Cve}),[]);const c=H.useRef(null),u=Go(v=>v.viewport.dpr),I=LK(r),h=H.useMemo(()=>Float32Array.from(Array.from({length:e},()=>I.map(ac.randFloatSpread)).flat()),[e,...I]),C=iC(e,s,Math.random),b=iC(e,i),m=iC(e,n),f=iC(e*3,t),p=iC(o===void 0?e*3:e,FK(o)?o:new et(o),()=>1);return GI(v=>{c.current&&c.current.material&&(c.current.material.time=v.clock.elapsedTime)}),H.useImperativeHandle(g,()=>c.current,[]),H.createElement("points",Es({key:`particle-${e}-${JSON.stringify(r)}`},l,{ref:c}),H.createElement("bufferGeometry",null,H.createElement("bufferAttribute",{attach:"attributes-position",args:[h,3]}),H.createElement("bufferAttribute",{attach:"attributes-size",args:[C,1]}),H.createElement("bufferAttribute",{attach:"attributes-opacity",args:[b,1]}),H.createElement("bufferAttribute",{attach:"attributes-speed",args:[m,1]}),H.createElement("bufferAttribute",{attach:"attributes-color",args:[p,3]}),H.createElement("bufferAttribute",{attach:"attributes-noise",args:[f,3]})),a||H.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:u,depthWrite:!1}))});function J0(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gi(t){"@babel/helpers - typeof";return gi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gi(t)}function pve(t,e){if(gi(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(gi(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function kK(t){var e=pve(t,"string");return gi(e)==="symbol"?e:String(e)}function F7(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,kK(i.key),i)}}function j0(t,e,n){return e&&F7(t.prototype,e),n&&F7(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function DS(t,e){return DS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},DS(t,e)}function HK(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&DS(t,e)}function kb(t){return kb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},kb(t)}function mve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function PS(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bve(t,e){if(e&&(gi(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return PS(t)}function _K(t){var e=mve();return function(){var i=kb(t),r;if(e){var s=kb(this).constructor;r=Reflect.construct(i,arguments,s)}else r=i.apply(this,arguments);return bve(this,r)}}var XK={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var i=[],r=0;r<arguments.length;r++){var s=arguments[r];if(s){var o=typeof s;if(o==="string"||o==="number")i.push(s);else if(Array.isArray(s)){if(s.length){var a=n.apply(null,s);a&&i.push(a)}}else if(o==="object"){if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]")){i.push(s.toString());continue}for(var l in s)e.call(s,l)&&s[l]&&i.push(l)}}}return i.join(" ")}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(XK);var vve=XK.exports;const da=l0(vve);var YK={exports:{}},bn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cr=typeof Symbol=="function"&&Symbol.for,BZ=cr?Symbol.for("react.element"):60103,GZ=cr?Symbol.for("react.portal"):60106,Ry=cr?Symbol.for("react.fragment"):60107,xy=cr?Symbol.for("react.strict_mode"):60108,Zy=cr?Symbol.for("react.profiler"):60114,Ey=cr?Symbol.for("react.provider"):60109,Wy=cr?Symbol.for("react.context"):60110,SZ=cr?Symbol.for("react.async_mode"):60111,Ny=cr?Symbol.for("react.concurrent_mode"):60111,My=cr?Symbol.for("react.forward_ref"):60112,Ty=cr?Symbol.for("react.suspense"):60113,yve=cr?Symbol.for("react.suspense_list"):60120,Fy=cr?Symbol.for("react.memo"):60115,Vy=cr?Symbol.for("react.lazy"):60116,Bve=cr?Symbol.for("react.block"):60121,Gve=cr?Symbol.for("react.fundamental"):60117,Sve=cr?Symbol.for("react.responder"):60118,wve=cr?Symbol.for("react.scope"):60119;function co(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case BZ:switch(t=t.type,t){case SZ:case Ny:case Ry:case Zy:case xy:case Ty:return t;default:switch(t=t&&t.$$typeof,t){case Wy:case My:case Vy:case Fy:case Ey:return t;default:return e}}case GZ:return e}}}function KK(t){return co(t)===Ny}bn.AsyncMode=SZ;bn.ConcurrentMode=Ny;bn.ContextConsumer=Wy;bn.ContextProvider=Ey;bn.Element=BZ;bn.ForwardRef=My;bn.Fragment=Ry;bn.Lazy=Vy;bn.Memo=Fy;bn.Portal=GZ;bn.Profiler=Zy;bn.StrictMode=xy;bn.Suspense=Ty;bn.isAsyncMode=function(t){return KK(t)||co(t)===SZ};bn.isConcurrentMode=KK;bn.isContextConsumer=function(t){return co(t)===Wy};bn.isContextProvider=function(t){return co(t)===Ey};bn.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===BZ};bn.isForwardRef=function(t){return co(t)===My};bn.isFragment=function(t){return co(t)===Ry};bn.isLazy=function(t){return co(t)===Vy};bn.isMemo=function(t){return co(t)===Fy};bn.isPortal=function(t){return co(t)===GZ};bn.isProfiler=function(t){return co(t)===Zy};bn.isStrictMode=function(t){return co(t)===xy};bn.isSuspense=function(t){return co(t)===Ty};bn.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===Ry||t===Ny||t===Zy||t===xy||t===Ty||t===yve||typeof t=="object"&&t!==null&&(t.$$typeof===Vy||t.$$typeof===Fy||t.$$typeof===Ey||t.$$typeof===Wy||t.$$typeof===My||t.$$typeof===Gve||t.$$typeof===Sve||t.$$typeof===wve||t.$$typeof===Bve)};bn.typeOf=co;YK.exports=bn;var Rve=YK.exports,OS={},xve=function(e){};function Zve(t,e){}function Eve(t,e){}function Wve(){OS={}}function zK(t,e,n){!e&&!OS[n]&&(t(!1,n),OS[n]=!0)}function q0(t,e){zK(Zve,t,e)}function Nve(t,e){zK(Eve,t,e)}q0.preMessage=xve;q0.resetWarned=Wve;q0.noteOnce=Nve;function Gn(t,e,n){return e=kK(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function V7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?V7(Object(n),!0).forEach(function(i){Gn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V7(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function UK(t,e,n){var i=H.useRef({});return(!("value"in i.current)||n(i.current.condition,e))&&(i.current.value=t(),i.current.condition=e),i.current.value}function DK(t,e){typeof t=="function"?t(e):gi(t)==="object"&&t&&"current"in t&&(t.current=e)}function PK(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e.filter(function(r){return r});return i.length<=1?i[0]:function(r){e.forEach(function(s){DK(s,r)})}}function OK(t){var e,n,i=Rve.isMemo(t)?t.type.type:t.type;return!(typeof i=="function"&&!((e=i.prototype)!==null&&e!==void 0&&e.render)||typeof t=="function"&&!((n=t.prototype)!==null&&n!==void 0&&n.render))}function Mve(t){return t instanceof HTMLElement||t instanceof SVGElement}function Tve(t){return Mve(t)?t:t instanceof yt.Component?VV.findDOMNode(t):null}function Fve(t,e){var n=Qt({},t);return Array.isArray(e)&&e.forEach(function(i){delete n[i]}),n}function QS(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Vve(t){if(Array.isArray(t))return QS(t)}function QK(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function wZ(t,e){if(t){if(typeof t=="string")return QS(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return QS(t,e)}}function Lve(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xI(t){return Vve(t)||QK(t)||wZ(t)||Lve()}var JK=function(e){return+setTimeout(e,16)},jK=function(e){return clearTimeout(e)};typeof window<"u"&&"requestAnimationFrame"in window&&(JK=function(e){return window.requestAnimationFrame(e)},jK=function(e){return window.cancelAnimationFrame(e)});var L7=0,RZ=new Map;function qK(t){RZ.delete(t)}var II=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;L7+=1;var i=L7;function r(s){if(s===0)qK(i),e();else{var o=JK(function(){r(s-1)});RZ.set(i,o)}}return r(n),i};II.cancel=function(t){var e=RZ.get(t);return qK(e),jK(e)};function xZ(t){for(var e=0,n,i=0,r=t.length;r>=4;++i,r-=4)n=t.charCodeAt(i)&255|(t.charCodeAt(++i)&255)<<8|(t.charCodeAt(++i)&255)<<16|(t.charCodeAt(++i)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,e=(n&65535)*1540483477+((n>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(r){case 3:e^=(t.charCodeAt(i+2)&255)<<16;case 2:e^=(t.charCodeAt(i+1)&255)<<8;case 1:e^=t.charCodeAt(i)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}function kve(t,e){if(t==null)return{};var n={},i=Object.keys(t),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(n[r]=t[r]);return n}function n0(t,e){if(t==null)return{};var n=kve(t,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function Hve(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=new Set;function r(s,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,l=i.has(s);if(q0(!l,"Warning: There may be circular references"),l)return!1;if(s===o)return!0;if(n&&a>1)return!1;i.add(s);var g=a+1;if(Array.isArray(s)){if(!Array.isArray(o)||s.length!==o.length)return!1;for(var c=0;c<s.length;c++)if(!r(s[c],o[c],g))return!1;return!0}if(s&&o&&gi(s)==="object"&&gi(o)==="object"){var u=Object.keys(s);return u.length!==Object.keys(o).length?!1:u.every(function(I){return r(s[I],o[I],g)})}return!1}return r(t,e)}var k7="%",_ve=function(){function t(e){J0(this,t),Gn(this,"instanceId",void 0),Gn(this,"cache",new Map),this.instanceId=e}return j0(t,[{key:"get",value:function(n){return this.cache.get(n.join(k7))||null}},{key:"update",value:function(n,i){var r=n.join(k7),s=this.cache.get(r),o=i(s);o===null?this.cache.delete(r):this.cache.set(r,o)}}]),t}(),JS="data-token-hash",Uu="data-css-hash",Kd="__cssinjs_instance__";function Xve(){var t=Math.random().toString(12).slice(2);if(typeof document<"u"&&document.head&&document.body){var e=document.body.querySelectorAll("style[".concat(Uu,"]"))||[],n=document.head.firstChild;Array.from(e).forEach(function(r){r[Kd]=r[Kd]||t,r[Kd]===t&&document.head.insertBefore(r,n)});var i={};Array.from(document.querySelectorAll("style[".concat(Uu,"]"))).forEach(function(r){var s=r.getAttribute(Uu);if(i[s]){if(r[Kd]===t){var o;(o=r.parentNode)===null||o===void 0||o.removeChild(r)}}else i[s]=!0})}return new _ve(t)}var Yve=H.createContext({hashPriority:"low",cache:Xve(),defaultCache:!0});const ZZ=Yve;function Al(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Kve(t,e){if(!t)return!1;if(t.contains)return t.contains(e);for(var n=e;n;){if(n===t)return!0;n=n.parentNode}return!1}var H7="data-rc-order",_7="data-rc-priority",zve="rc-util-key",jS=new Map;function $K(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.mark;return e?e.startsWith("data-")?e:"data-".concat(e):zve}function Ly(t){if(t.attachTo)return t.attachTo;var e=document.querySelector("head");return e||document.body}function Uve(t){return t==="queue"?"prependQueue":t?"prepend":"append"}function ez(t){return Array.from((jS.get(t)||t).children).filter(function(e){return e.tagName==="STYLE"})}function tz(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Al())return null;var n=e.csp,i=e.prepend,r=e.priority,s=r===void 0?0:r,o=Uve(i),a=o==="prependQueue",l=document.createElement("style");l.setAttribute(H7,o),a&&s&&l.setAttribute(_7,"".concat(s)),n!=null&&n.nonce&&(l.nonce=n==null?void 0:n.nonce),l.innerHTML=t;var g=Ly(e),c=g.firstChild;if(i){if(a){var u=ez(g).filter(function(I){if(!["prepend","prependQueue"].includes(I.getAttribute(H7)))return!1;var h=Number(I.getAttribute(_7)||0);return s>=h});if(u.length)return g.insertBefore(l,u[u.length-1].nextSibling),l}g.insertBefore(l,c)}else g.appendChild(l);return l}function nz(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=Ly(e);return ez(n).find(function(i){return i.getAttribute($K(e))===t})}function iz(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=nz(t,e);if(n){var i=Ly(e);i.removeChild(n)}}function Dve(t,e){var n=jS.get(t);if(!n||!Kve(document,n)){var i=tz("",e),r=i.parentNode;jS.set(t,r),t.removeChild(i)}}function i0(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=Ly(n);Dve(i,n);var r=nz(e,n);if(r){var s,o;if((s=n.csp)!==null&&s!==void 0&&s.nonce&&r.nonce!==((o=n.csp)===null||o===void 0?void 0:o.nonce)){var a;r.nonce=(a=n.csp)===null||a===void 0?void 0:a.nonce}return r.innerHTML!==t&&(r.innerHTML=t),r}var l=tz(t,n);return l.setAttribute($K(n),e),l}function rz(t){if(Array.isArray(t))return t}function Pve(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i,r,s,o,a=[],l=!0,g=!1;try{if(s=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(c){g=!0,r=c}finally{try{if(!l&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(g)throw r}}return a}}function sz(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $n(t,e){return rz(t)||Pve(t,e)||wZ(t,e)||sz()}function Ove(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var EZ=function(){function t(){J0(this,t),Gn(this,"cache",void 0),Gn(this,"keys",void 0),Gn(this,"cacheCallTimes",void 0),this.cache=new Map,this.keys=[],this.cacheCallTimes=0}return j0(t,[{key:"size",value:function(){return this.keys.length}},{key:"internalGet",value:function(n){var i,r,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o={map:this.cache};return n.forEach(function(a){if(!o)o=void 0;else{var l,g;o=(l=o)===null||l===void 0||(g=l.map)===null||g===void 0?void 0:g.get(a)}}),(i=o)!==null&&i!==void 0&&i.value&&s&&(o.value[1]=this.cacheCallTimes++),(r=o)===null||r===void 0?void 0:r.value}},{key:"get",value:function(n){var i;return(i=this.internalGet(n,!0))===null||i===void 0?void 0:i[0]}},{key:"has",value:function(n){return!!this.internalGet(n)}},{key:"set",value:function(n,i){var r=this;if(!this.has(n)){if(this.size()+1>t.MAX_CACHE_SIZE+t.MAX_CACHE_OFFSET){var s=this.keys.reduce(function(g,c){var u=$n(g,2),I=u[1];return r.internalGet(c)[1]<I?[c,r.internalGet(c)[1]]:g},[this.keys[0],this.cacheCallTimes]),o=$n(s,1),a=o[0];this.delete(a)}this.keys.push(n)}var l=this.cache;n.forEach(function(g,c){if(c===n.length-1)l.set(g,{value:[i,r.cacheCallTimes++]});else{var u=l.get(g);u?u.map||(u.map=new Map):l.set(g,{map:new Map}),l=l.get(g).map}})}},{key:"deleteByPath",value:function(n,i){var r=n.get(i[0]);if(i.length===1){var s;return r.map?n.set(i[0],{map:r.map}):n.delete(i[0]),(s=r.value)===null||s===void 0?void 0:s[0]}var o=this.deleteByPath(r.map,i.slice(1));return(!r.map||r.map.size===0)&&!r.value&&n.delete(i[0]),o}},{key:"delete",value:function(n){if(this.has(n))return this.keys=this.keys.filter(function(i){return!Ove(i,n)}),this.deleteByPath(this.cache,n)}}]),t}();Gn(EZ,"MAX_CACHE_SIZE",20);Gn(EZ,"MAX_CACHE_OFFSET",5);var X7=0,oz=function(){function t(e){J0(this,t),Gn(this,"derivatives",void 0),Gn(this,"id",void 0),this.derivatives=Array.isArray(e)?e:[e],this.id=X7,e.length===0&&(e.length>0,void 0),X7+=1}return j0(t,[{key:"getDerivativeToken",value:function(n){return this.derivatives.reduce(function(i,r){return r(n,i)},void 0)}}]),t}(),JB=new EZ;function qS(t){var e=Array.isArray(t)?t:[t];return JB.has(e)||JB.set(e,new oz(e)),JB.get(e)}var Y7=new WeakMap;function Hb(t){var e=Y7.get(t)||"";return e||(Object.keys(t).forEach(function(n){var i=t[n];e+=n,i instanceof oz?e+=i.id:i&&gi(i)==="object"?e+=Hb(i):e+=i}),Y7.set(t,e)),e}function Qve(t,e){return xZ("".concat(e,"_").concat(Hb(t)))}var UC="random-".concat(Date.now(),"-").concat(Math.random()).replace(/\./g,""),az="_bAmBoO_";function Jve(t,e,n){if(Al()){var i,r;i0(t,UC);var s=document.createElement("div");s.style.position="fixed",s.style.left="0",s.style.top="0",e==null||e(s),document.body.appendChild(s);var o=n?n(s):(i=getComputedStyle(s).content)===null||i===void 0?void 0:i.includes(az);return(r=s.parentNode)===null||r===void 0||r.removeChild(s),iz(UC),o}return!1}var jB=void 0;function jve(){return jB===void 0&&(jB=Jve("@layer ".concat(UC," { .").concat(UC,' { content: "').concat(az,'"!important; } }'),function(t){t.className=UC})),jB}var K7=Al()?H.useLayoutEffect:H.useEffect,qve=function(e,n){var i=H.useRef(!0);K7(function(){return e(i.current)},n),K7(function(){return i.current=!1,function(){i.current=!0}},[])},$ve=Qt({},Kb),z7=$ve.useInsertionEffect,eye=function(e,n,i){H.useMemo(e,i),qve(function(){return n(!0)},i)},tye=z7?function(t,e,n){return z7(function(){return t(),e()},n)}:eye;const nye=tye;var iye=Qt({},Kb),rye=iye.useInsertionEffect,sye=function(e){var n=[],i=!1;function r(s){i||n.push(s)}return H.useEffect(function(){return i=!1,function(){i=!0,n.length&&n.forEach(function(s){return s()})}},e),r},oye=function(){return function(e){e()}},aye=typeof rye<"u"?sye:oye;const lye=aye;function lz(t,e,n,i,r){var s=H.useContext(ZZ),o=s.cache,a=[t].concat(xI(e)),l=a.join("_"),g=lye([l]),c=function(C){o.update(a,function(b){var m=b||[],f=$n(m,2),p=f[0],v=p===void 0?0:p,B=f[1],G=B,R=G||n(),w=[v,R];return C?C(w):w})};H.useMemo(function(){c()},[l]);var u=o.get(a),I=u[1];return nye(function(){r==null||r(I)},function(h){return c(function(C){var b=$n(C,2),m=b[0],f=b[1];return h&&m===0&&(r==null||r(I)),[m+1,f]}),function(){o.update(a,function(C){var b=C||[],m=$n(b,2),f=m[0],p=f===void 0?0:f,v=m[1],B=p-1;return B===0?(g(function(){return i==null?void 0:i(v,!1)}),null):[p-1,v]})}},[l]),I}var gye={},cye="css",Gu=new Map;function uye(t){Gu.set(t,(Gu.get(t)||0)+1)}function Iye(t,e){if(typeof document<"u"){var n=document.querySelectorAll("style[".concat(JS,'="').concat(t,'"]'));n.forEach(function(i){if(i[Kd]===e){var r;(r=i.parentNode)===null||r===void 0||r.removeChild(i)}})}}var dye=0;function Aye(t,e){Gu.set(t,(Gu.get(t)||0)-1);var n=Array.from(Gu.keys()),i=n.filter(function(r){var s=Gu.get(r)||0;return s<=0});n.length-i.length>dye&&i.forEach(function(r){Iye(r,e),Gu.delete(r)})}var hye=function(e,n,i,r){var s=i.getDerivativeToken(e),o=Qt(Qt({},s),n);return r&&(o=r(o)),o};function Cye(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=H.useContext(ZZ),r=i.cache.instanceId,s=n.salt,o=s===void 0?"":s,a=n.override,l=a===void 0?gye:a,g=n.formatToken,c=n.getComputedToken,u=H.useMemo(function(){return Object.assign.apply(Object,[{}].concat(xI(e)))},[e]),I=H.useMemo(function(){return Hb(u)},[u]),h=H.useMemo(function(){return Hb(l)},[l]),C=lz("token",[o,t.id,I,h],function(){var b=c?c(u,l,t):hye(u,l,t,g),m=Qve(b,o);b._tokenKey=m,uye(m);var f="".concat(cye,"-").concat(xZ(m));return b._hashId=f,[b,f]},function(b){Aye(b[0]._tokenKey,r)});return C}var fye={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},gz="comm",cz="rule",uz="decl",pye="@import",mye="@keyframes",bye="@layer",vye=Math.abs,WZ=String.fromCharCode;function Iz(t){return t.trim()}function A3(t,e,n){return t.replace(e,n)}function yye(t,e){return t.indexOf(e)}function r0(t,e){return t.charCodeAt(e)|0}function s0(t,e,n){return t.slice(e,n)}function Ll(t){return t.length}function Bye(t){return t.length}function w2(t,e){return e.push(t),t}var ky=1,EA=1,dz=0,ko=0,Ni=0,jA="";function NZ(t,e,n,i,r,s,o,a){return{value:t,root:e,parent:n,type:i,props:r,children:s,line:ky,column:EA,length:o,return:"",siblings:a}}function Gye(){return Ni}function Sye(){return Ni=ko>0?r0(jA,--ko):0,EA--,Ni===10&&(EA=1,ky--),Ni}function Aa(){return Ni=ko<dz?r0(jA,ko++):0,EA++,Ni===10&&(EA=1,ky++),Ni}function Du(){return r0(jA,ko)}function h3(){return ko}function Hy(t,e){return s0(jA,t,e)}function $S(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function wye(t){return ky=EA=1,dz=Ll(jA=t),ko=0,[]}function Rye(t){return jA="",t}function qB(t){return Iz(Hy(ko-1,ew(t===91?t+2:t===40?t+1:t)))}function xye(t){for(;(Ni=Du())&&Ni<33;)Aa();return $S(t)>2||$S(Ni)>3?"":" "}function Zye(t,e){for(;--e&&Aa()&&!(Ni<48||Ni>102||Ni>57&&Ni<65||Ni>70&&Ni<97););return Hy(t,h3()+(e<6&&Du()==32&&Aa()==32))}function ew(t){for(;Aa();)switch(Ni){case t:return ko;case 34:case 39:t!==34&&t!==39&&ew(Ni);break;case 40:t===41&&ew(t);break;case 92:Aa();break}return ko}function Eye(t,e){for(;Aa()&&t+Ni!==47+10;)if(t+Ni===42+42&&Du()===47)break;return"/*"+Hy(e,ko-1)+"*"+WZ(t===47?t:Aa())}function Wye(t){for(;!$S(Du());)Aa();return Hy(t,ko)}function Nye(t){return Rye(C3("",null,null,null,[""],t=wye(t),0,[0],t))}function C3(t,e,n,i,r,s,o,a,l){for(var g=0,c=0,u=o,I=0,h=0,C=0,b=1,m=1,f=1,p=0,v="",B=r,G=s,R=i,w=v;m;)switch(C=p,p=Aa()){case 40:if(C!=108&&r0(w,u-1)==58){yye(w+=A3(qB(p),"&","&\f"),"&\f")!=-1&&(f=-1);break}case 34:case 39:case 91:w+=qB(p);break;case 9:case 10:case 13:case 32:w+=xye(C);break;case 92:w+=Zye(h3()-1,7);continue;case 47:switch(Du()){case 42:case 47:w2(Mye(Eye(Aa(),h3()),e,n,l),l);break;default:w+="/"}break;case 123*b:a[g++]=Ll(w)*f;case 125*b:case 59:case 0:switch(p){case 0:case 125:m=0;case 59+c:f==-1&&(w=A3(w,/\f/g,"")),h>0&&Ll(w)-u&&w2(h>32?D7(w+";",i,n,u-1,l):D7(A3(w," ","")+";",i,n,u-2,l),l);break;case 59:w+=";";default:if(w2(R=U7(w,e,n,g,c,r,a,v,B=[],G=[],u,s),s),p===123)if(c===0)C3(w,e,R,R,B,s,u,a,G);else switch(I===99&&r0(w,3)===110?100:I){case 100:case 108:case 109:case 115:C3(t,R,R,i&&w2(U7(t,R,R,0,0,r,a,v,r,B=[],u,G),G),r,G,u,a,i?B:G);break;default:C3(w,R,R,R,[""],G,0,a,G)}}g=c=h=0,b=f=1,v=w="",u=o;break;case 58:u=1+Ll(w),h=C;default:if(b<1){if(p==123)--b;else if(p==125&&b++==0&&Sye()==125)continue}switch(w+=WZ(p),p*b){case 38:f=c>0?1:(w+="\f",-1);break;case 44:a[g++]=(Ll(w)-1)*f,f=1;break;case 64:Du()===45&&(w+=qB(Aa())),I=Du(),c=u=Ll(v=w+=Wye(h3())),p++;break;case 45:C===45&&Ll(w)==2&&(b=0)}}return s}function U7(t,e,n,i,r,s,o,a,l,g,c,u){for(var I=r-1,h=r===0?s:[""],C=Bye(h),b=0,m=0,f=0;b<i;++b)for(var p=0,v=s0(t,I+1,I=vye(m=o[b])),B=t;p<C;++p)(B=Iz(m>0?h[p]+" "+v:A3(v,/&\f/g,h[p])))&&(l[f++]=B);return NZ(t,e,n,r===0?cz:a,l,g,c,u)}function Mye(t,e,n,i){return NZ(t,e,n,gz,WZ(Gye()),s0(t,2,-2),0,i)}function D7(t,e,n,i,r){return NZ(t,e,n,uz,s0(t,0,i),s0(t,i+1,-1),i,r)}function tw(t,e){for(var n="",i=0;i<t.length;i++)n+=e(t[i],i,t,e)||"";return n}function Tye(t,e,n,i){switch(t.type){case bye:if(t.children.length)break;case pye:case uz:return t.return=t.return||t.value;case gz:return"";case mye:return t.return=t.value+"{"+tw(t.children,i)+"}";case cz:if(!Ll(t.value=t.props.join(",")))return""}return Ll(n=tw(t.children,i))?t.return=t.value+"{"+n+"}":""}var P7="data-ant-cssinjs-cache-path",Az="_FILE_STYLE__",Pu,hz=!0;function Fye(){if(!Pu&&(Pu={},Al())){var t=document.createElement("div");t.className=P7,t.style.position="fixed",t.style.visibility="hidden",t.style.top="-9999px",document.body.appendChild(t);var e=getComputedStyle(t).content||"";e=e.replace(/^"/,"").replace(/"$/,""),e.split(";").forEach(function(r){var s=r.split(":"),o=$n(s,2),a=o[0],l=o[1];Pu[a]=l});var n=document.querySelector("style[".concat(P7,"]"));if(n){var i;hz=!1,(i=n.parentNode)===null||i===void 0||i.removeChild(n)}document.body.removeChild(t)}}function Vye(t){return Fye(),!!Pu[t]}function Lye(t){var e=Pu[t],n=null;if(e&&Al())if(hz)n=Az;else{var i=document.querySelector("style[".concat(Uu,'="').concat(Pu[t],'"]'));i?n=i.innerHTML:delete Pu[t]}return[n,e]}var O7=Al(),kye="_skip_check_",Cz="_multi_value_";function Q7(t){var e=tw(Nye(t),Tye);return e.replace(/\{%%%\:[^;];}/g,";")}function Hye(t){return gi(t)==="object"&&t&&(kye in t||Cz in t)}function _ye(t,e,n){if(!e)return t;var i=".".concat(e),r=n==="low"?":where(".concat(i,")"):i,s=t.split(",").map(function(o){var a,l=o.trim().split(/\s+/),g=l[0]||"",c=((a=g.match(/^\w+/))===null||a===void 0?void 0:a[0])||"";return g="".concat(c).concat(r).concat(g.slice(c.length)),[g].concat(xI(l.slice(1))).join(" ")});return s.join(",")}var Xye=function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{root:!0,parentSelectors:[]},r=i.root,s=i.injectHash,o=i.parentSelectors,a=n.hashId,l=n.layer;n.path;var g=n.hashPriority,c=n.transformers,u=c===void 0?[]:c;n.linters;var I="",h={};function C(v){var B=v.getName(a);if(!h[B]){var G=t(v.style,n,{root:!1,parentSelectors:o}),R=$n(G,1),w=R[0];h[B]="@keyframes ".concat(v.getName(a)).concat(w)}}function b(v){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return v.forEach(function(G){Array.isArray(G)?b(G,B):G&&B.push(G)}),B}var m=b(Array.isArray(e)?e:[e]);if(m.forEach(function(v){var B=typeof v=="string"&&!r?{}:v;if(typeof B=="string")I+="".concat(B,`
`);else if(B._keyframe)C(B);else{var G=u.reduce(function(R,w){var E;return(w==null||(E=w.visit)===null||E===void 0?void 0:E.call(w,R))||R},B);Object.keys(G).forEach(function(R){var w=G[R];if(gi(w)==="object"&&w&&(R!=="animationName"||!w._keyframe)&&!Hye(w)){var E=!1,x=R.trim(),W=!1;(r||s)&&a?x.startsWith("@")?E=!0:x=_ye(R,a,g):r&&!a&&(x==="&"||x==="")&&(x="",W=!0);var T=t(w,n,{root:W,injectHash:E,parentSelectors:[].concat(xI(o),[x])}),k=$n(T,2),_=k[0],U=k[1];h=Qt(Qt({},h),U),I+="".concat(x).concat(_)}else{let N=function(L,V){var M=L.replace(/[A-Z]/g,function(J){return"-".concat(J.toLowerCase())}),X=V;!fye[L]&&typeof X=="number"&&X!==0&&(X="".concat(X,"px")),L==="animationName"&&V!==null&&V!==void 0&&V._keyframe&&(C(V),X=V.getName(a)),I+="".concat(M,":").concat(X,";")};var z=N,O,Y=(O=w==null?void 0:w.value)!==null&&O!==void 0?O:w;gi(w)==="object"&&w!==null&&w!==void 0&&w[Cz]&&Array.isArray(Y)?Y.forEach(function(L){N(R,L)}):N(R,Y)}})}}),!r)I="{".concat(I,"}");else if(l&&jve()){var f=l.split(","),p=f[f.length-1].trim();I="@layer ".concat(p," {").concat(I,"}"),f.length>1&&(I="@layer ".concat(l,"{%%%:%}").concat(I))}return[I,h]};function Yye(t,e){return xZ("".concat(t.join("%")).concat(e))}function Kye(){return null}function nw(t,e){var n=t.token,i=t.path,r=t.hashId,s=t.layer,o=t.nonce,a=t.clientOnly,l=t.order,g=l===void 0?0:l,c=H.useContext(ZZ),u=c.autoClear;c.mock;var I=c.defaultCache,h=c.hashPriority,C=c.container,b=c.ssrInline,m=c.transformers,f=c.linters,p=c.cache,v=n._tokenKey,B=[v].concat(xI(i)),G=O7,R=lz("style",B,function(){var T=B.join("|");if(Vye(T)){var k=Lye(T),_=$n(k,2),U=_[0],O=_[1];if(U)return[U,v,O,{},a,g]}var Y=e(),z=Xye(Y,{hashId:r,hashPriority:h,layer:s,path:i.join("-"),transformers:m,linters:f}),N=$n(z,2),L=N[0],V=N[1],M=Q7(L),X=Yye(B,M);return[M,v,X,V,a,g]},function(T,k){var _=$n(T,3),U=_[2];(k||u)&&O7&&iz(U,{mark:Uu})},function(T){var k=$n(T,4),_=k[0];k[1];var U=k[2],O=k[3];if(G&&_!==Az){var Y={mark:Uu,prepend:"queue",attachTo:C,priority:g},z=typeof o=="function"?o():o;z&&(Y.csp={nonce:z});var N=i0(_,U,Y);N[Kd]=p.instanceId,N.setAttribute(JS,v),Object.keys(O).forEach(function(L){i0(Q7(O[L]),"_effect-".concat(L),Y)})}}),w=$n(R,3),E=w[0],x=w[1],W=w[2];return function(T){var k;if(!b||G||!I)k=H.createElement(Kye,null);else{var _;k=H.createElement("style",Es({},(_={},Gn(_,JS,x),Gn(_,Uu,W),_),{dangerouslySetInnerHTML:{__html:E}}))}return H.createElement(H.Fragment,null,k,T)}}function md(t){return t.notSplit=!0,t}md(["borderTop","borderBottom"]),md(["borderTop"]),md(["borderBottom"]),md(["borderLeft","borderRight"]),md(["borderLeft"]),md(["borderRight"]);var zye=H.createContext({});const MZ=zye;function Uye(t){return rz(t)||QK(t)||wZ(t)||sz()}function iw(t,e){for(var n=t,i=0;i<e.length;i+=1){if(n==null)return;n=n[e[i]]}return n}function fz(t,e,n,i){if(!e.length)return n;var r=Uye(e),s=r[0],o=r.slice(1),a;return!t&&typeof s=="number"?a=[]:Array.isArray(t)?a=xI(t):a=Qt({},t),i&&n===void 0&&o.length===1?delete a[s][o[0]]:a[s]=fz(a[s],o,n,i),a}function $B(t,e,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.length&&i&&n===void 0&&!iw(t,e.slice(0,-1))?t:fz(t,e,n,i)}function Dye(t){return gi(t)==="object"&&t!==null&&Object.getPrototypeOf(t)===Object.prototype}function J7(t){return Array.isArray(t)?[]:{}}var Pye=typeof Reflect>"u"?Object.keys:Reflect.ownKeys;function Oye(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=J7(e[0]);return e.forEach(function(r){function s(o,a){var l=new Set(a),g=iw(r,o),c=Array.isArray(g);if(c||Dye(g)){if(!l.has(g)){l.add(g);var u=iw(i,o);c?i=$B(i,o,[]):(!u||gi(u)!=="object")&&(i=$B(i,o,J7(g))),Pye(g).forEach(function(I){s([].concat(xI(o),[I]),l)})}}else i=$B(i,o,g)}s([])}),i}const Qye=H.createContext(void 0),Jye={items_per_page:"/ page",jump_to:"Go to",jump_to_confirm:"confirm",page:"Page",prev_page:"Previous Page",next_page:"Next Page",prev_5:"Previous 5 Pages",next_5:"Next 5 Pages",prev_3:"Previous 3 Pages",next_3:"Next 3 Pages",page_size:"Page Size"};var jye={locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"OK",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",yearFormat:"YYYY",dateFormat:"M/D/YYYY",dayFormat:"D",dateTimeFormat:"M/D/YYYY HH:mm:ss",monthBeforeYear:!0,previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"};const qye={placeholder:"Select time",rangePlaceholder:["Start time","End time"]},pz=qye,$ye={lang:Object.assign({placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeQuarterPlaceholder:["Start quarter","End quarter"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"]},jye),timePickerLocale:Object.assign({},pz)},j7=$ye,Ks="${label} is not a valid ${type}",e1e={locale:"en",Pagination:Jye,DatePicker:j7,TimePicker:pz,Calendar:j7,global:{placeholder:"Please select"},Table:{filterTitle:"Filter menu",filterConfirm:"OK",filterReset:"Reset",filterEmptyText:"No filters",filterCheckall:"Select all items",filterSearchPlaceholder:"Search in filters",emptyText:"No data",selectAll:"Select current page",selectInvert:"Invert current page",selectNone:"Clear all data",selectionAll:"Select all data",sortTitle:"Sort",expand:"Expand row",collapse:"Collapse row",triggerDesc:"Click to sort descending",triggerAsc:"Click to sort ascending",cancelSort:"Click to cancel sorting"},Tour:{Next:"Next",Previous:"Previous",Finish:"Finish"},Modal:{okText:"OK",cancelText:"Cancel",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancel"},Transfer:{titles:["",""],searchPlaceholder:"Search here",itemUnit:"item",itemsUnit:"items",remove:"Remove",selectCurrent:"Select current page",removeCurrent:"Remove current page",selectAll:"Select all data",removeAll:"Remove all data",selectInvert:"Invert current page"},Upload:{uploading:"Uploading...",removeFile:"Remove file",uploadError:"Upload error",previewFile:"Preview file",downloadFile:"Download file"},Empty:{description:"No data"},Icon:{icon:"icon"},Text:{edit:"Edit",copy:"Copy",copied:"Copied",expand:"Expand"},PageHeader:{back:"Back"},Form:{optional:"(optional)",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:Ks,method:Ks,array:Ks,object:Ks,number:Ks,date:Ks,boolean:Ks,integer:Ks,float:Ks,regexp:Ks,email:Ks,url:Ks,hex:Ks},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},Image:{preview:"Preview"},QRCode:{expired:"QR code expired",refresh:"Refresh"},ColorPicker:{presetEmpty:"Empty"}},_y=e1e;Object.assign({},_y.Modal);let f3=[];const q7=()=>f3.reduce((t,e)=>Object.assign(Object.assign({},t),e),_y.Modal);function t1e(t){if(t){const e=Object.assign({},t);return f3.push(e),q7(),()=>{f3=f3.filter(n=>n!==e),q7()}}Object.assign({},_y.Modal)}const n1e=H.createContext(void 0),mz=n1e,i1e="internalMark",r1e=t=>{const{locale:e={},children:n,_ANT_MARK__:i}=t;H.useEffect(()=>t1e(e&&e.Modal),[e]);const r=H.useMemo(()=>Object.assign(Object.assign({},e),{exist:!0}),[e]);return H.createElement(mz.Provider,{value:r},n)},s1e=r1e;function pr(t,e){o1e(t)&&(t="100%");var n=a1e(t);return t=e===360?t:Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(String(t*e),10)/100),Math.abs(t-e)<1e-6?1:(e===360?t=(t<0?t%e+e:t%e)/parseFloat(String(e)):t=t%e/parseFloat(String(e)),t)}function R2(t){return Math.min(1,Math.max(0,t))}function o1e(t){return typeof t=="string"&&t.indexOf(".")!==-1&&parseFloat(t)===1}function a1e(t){return typeof t=="string"&&t.indexOf("%")!==-1}function bz(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function x2(t){return t<=1?"".concat(Number(t)*100,"%"):t}function Vu(t){return t.length===1?"0"+t:String(t)}function l1e(t,e,n){return{r:pr(t,255)*255,g:pr(e,255)*255,b:pr(n,255)*255}}function $7(t,e,n){t=pr(t,255),e=pr(e,255),n=pr(n,255);var i=Math.max(t,e,n),r=Math.min(t,e,n),s=0,o=0,a=(i+r)/2;if(i===r)o=0,s=0;else{var l=i-r;switch(o=a>.5?l/(2-i-r):l/(i+r),i){case t:s=(e-n)/l+(e<n?6:0);break;case e:s=(n-t)/l+2;break;case n:s=(t-e)/l+4;break}s/=6}return{h:s,s:o,l:a}}function eG(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*(6*n):n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function g1e(t,e,n){var i,r,s;if(t=pr(t,360),e=pr(e,100),n=pr(n,100),e===0)r=n,s=n,i=n;else{var o=n<.5?n*(1+e):n+e-n*e,a=2*n-o;i=eG(a,o,t+1/3),r=eG(a,o,t),s=eG(a,o,t-1/3)}return{r:i*255,g:r*255,b:s*255}}function rw(t,e,n){t=pr(t,255),e=pr(e,255),n=pr(n,255);var i=Math.max(t,e,n),r=Math.min(t,e,n),s=0,o=i,a=i-r,l=i===0?0:a/i;if(i===r)s=0;else{switch(i){case t:s=(e-n)/a+(e<n?6:0);break;case e:s=(n-t)/a+2;break;case n:s=(t-e)/a+4;break}s/=6}return{h:s,s:l,v:o}}function c1e(t,e,n){t=pr(t,360)*6,e=pr(e,100),n=pr(n,100);var i=Math.floor(t),r=t-i,s=n*(1-e),o=n*(1-r*e),a=n*(1-(1-r)*e),l=i%6,g=[n,o,s,s,a,n][l],c=[a,n,n,o,s,s][l],u=[s,s,a,n,n,o][l];return{r:g*255,g:c*255,b:u*255}}function sw(t,e,n,i){var r=[Vu(Math.round(t).toString(16)),Vu(Math.round(e).toString(16)),Vu(Math.round(n).toString(16))];return i&&r[0].startsWith(r[0].charAt(1))&&r[1].startsWith(r[1].charAt(1))&&r[2].startsWith(r[2].charAt(1))?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function u1e(t,e,n,i,r){var s=[Vu(Math.round(t).toString(16)),Vu(Math.round(e).toString(16)),Vu(Math.round(n).toString(16)),Vu(I1e(i))];return r&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))&&s[3].startsWith(s[3].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function I1e(t){return Math.round(parseFloat(t)*255).toString(16)}function eT(t){return zs(t)/255}function zs(t){return parseInt(t,16)}function d1e(t){return{r:t>>16,g:(t&65280)>>8,b:t&255}}var ow={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function yd(t){var e={r:0,g:0,b:0},n=1,i=null,r=null,s=null,o=!1,a=!1;return typeof t=="string"&&(t=C1e(t)),typeof t=="object"&&(Nl(t.r)&&Nl(t.g)&&Nl(t.b)?(e=l1e(t.r,t.g,t.b),o=!0,a=String(t.r).substr(-1)==="%"?"prgb":"rgb"):Nl(t.h)&&Nl(t.s)&&Nl(t.v)?(i=x2(t.s),r=x2(t.v),e=c1e(t.h,i,r),o=!0,a="hsv"):Nl(t.h)&&Nl(t.s)&&Nl(t.l)&&(i=x2(t.s),s=x2(t.l),e=g1e(t.h,i,s),o=!0,a="hsl"),Object.prototype.hasOwnProperty.call(t,"a")&&(n=t.a)),n=bz(n),{ok:o,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}var A1e="[-\\+]?\\d+%?",h1e="[-\\+]?\\d*\\.\\d+%?",Ug="(?:".concat(h1e,")|(?:").concat(A1e,")"),tG="[\\s|\\(]+(".concat(Ug,")[,|\\s]+(").concat(Ug,")[,|\\s]+(").concat(Ug,")\\s*\\)?"),nG="[\\s|\\(]+(".concat(Ug,")[,|\\s]+(").concat(Ug,")[,|\\s]+(").concat(Ug,")[,|\\s]+(").concat(Ug,")\\s*\\)?"),qo={CSS_UNIT:new RegExp(Ug),rgb:new RegExp("rgb"+tG),rgba:new RegExp("rgba"+nG),hsl:new RegExp("hsl"+tG),hsla:new RegExp("hsla"+nG),hsv:new RegExp("hsv"+tG),hsva:new RegExp("hsva"+nG),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function C1e(t){if(t=t.trim().toLowerCase(),t.length===0)return!1;var e=!1;if(ow[t])t=ow[t],e=!0;else if(t==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n=qo.rgb.exec(t);return n?{r:n[1],g:n[2],b:n[3]}:(n=qo.rgba.exec(t),n?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=qo.hsl.exec(t),n?{h:n[1],s:n[2],l:n[3]}:(n=qo.hsla.exec(t),n?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=qo.hsv.exec(t),n?{h:n[1],s:n[2],v:n[3]}:(n=qo.hsva.exec(t),n?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=qo.hex8.exec(t),n?{r:zs(n[1]),g:zs(n[2]),b:zs(n[3]),a:eT(n[4]),format:e?"name":"hex8"}:(n=qo.hex6.exec(t),n?{r:zs(n[1]),g:zs(n[2]),b:zs(n[3]),format:e?"name":"hex"}:(n=qo.hex4.exec(t),n?{r:zs(n[1]+n[1]),g:zs(n[2]+n[2]),b:zs(n[3]+n[3]),a:eT(n[4]+n[4]),format:e?"name":"hex8"}:(n=qo.hex3.exec(t),n?{r:zs(n[1]+n[1]),g:zs(n[2]+n[2]),b:zs(n[3]+n[3]),format:e?"name":"hex"}:!1)))))))))}function Nl(t){return!!qo.CSS_UNIT.exec(String(t))}var Js=function(){function t(e,n){e===void 0&&(e=""),n===void 0&&(n={});var i;if(e instanceof t)return e;typeof e=="number"&&(e=d1e(e)),this.originalInput=e;var r=yd(e);this.originalInput=e,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=(i=n.format)!==null&&i!==void 0?i:r.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}return t.prototype.isDark=function(){return this.getBrightness()<128},t.prototype.isLight=function(){return!this.isDark()},t.prototype.getBrightness=function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},t.prototype.getLuminance=function(){var e=this.toRgb(),n,i,r,s=e.r/255,o=e.g/255,a=e.b/255;return s<=.03928?n=s/12.92:n=Math.pow((s+.055)/1.055,2.4),o<=.03928?i=o/12.92:i=Math.pow((o+.055)/1.055,2.4),a<=.03928?r=a/12.92:r=Math.pow((a+.055)/1.055,2.4),.2126*n+.7152*i+.0722*r},t.prototype.getAlpha=function(){return this.a},t.prototype.setAlpha=function(e){return this.a=bz(e),this.roundA=Math.round(100*this.a)/100,this},t.prototype.isMonochrome=function(){var e=this.toHsl().s;return e===0},t.prototype.toHsv=function(){var e=rw(this.r,this.g,this.b);return{h:e.h*360,s:e.s,v:e.v,a:this.a}},t.prototype.toHsvString=function(){var e=rw(this.r,this.g,this.b),n=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.v*100);return this.a===1?"hsv(".concat(n,", ").concat(i,"%, ").concat(r,"%)"):"hsva(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(this.roundA,")")},t.prototype.toHsl=function(){var e=$7(this.r,this.g,this.b);return{h:e.h*360,s:e.s,l:e.l,a:this.a}},t.prototype.toHslString=function(){var e=$7(this.r,this.g,this.b),n=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.l*100);return this.a===1?"hsl(".concat(n,", ").concat(i,"%, ").concat(r,"%)"):"hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(this.roundA,")")},t.prototype.toHex=function(e){return e===void 0&&(e=!1),sw(this.r,this.g,this.b,e)},t.prototype.toHexString=function(e){return e===void 0&&(e=!1),"#"+this.toHex(e)},t.prototype.toHex8=function(e){return e===void 0&&(e=!1),u1e(this.r,this.g,this.b,this.a,e)},t.prototype.toHex8String=function(e){return e===void 0&&(e=!1),"#"+this.toHex8(e)},t.prototype.toHexShortString=function(e){return e===void 0&&(e=!1),this.a===1?this.toHexString(e):this.toHex8String(e)},t.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},t.prototype.toRgbString=function(){var e=Math.round(this.r),n=Math.round(this.g),i=Math.round(this.b);return this.a===1?"rgb(".concat(e,", ").concat(n,", ").concat(i,")"):"rgba(".concat(e,", ").concat(n,", ").concat(i,", ").concat(this.roundA,")")},t.prototype.toPercentageRgb=function(){var e=function(n){return"".concat(Math.round(pr(n,255)*100),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},t.prototype.toPercentageRgbString=function(){var e=function(n){return Math.round(pr(n,255)*100)};return this.a===1?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},t.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var e="#"+sw(this.r,this.g,this.b,!1),n=0,i=Object.entries(ow);n<i.length;n++){var r=i[n],s=r[0],o=r[1];if(e===o)return s}return!1},t.prototype.toString=function(e){var n=!!e;e=e??this.format;var i=!1,r=this.a<1&&this.a>=0,s=!n&&r&&(e.startsWith("hex")||e==="name");return s?e==="name"&&this.a===0?this.toName():this.toRgbString():(e==="rgb"&&(i=this.toRgbString()),e==="prgb"&&(i=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(i=this.toHexString()),e==="hex3"&&(i=this.toHexString(!0)),e==="hex4"&&(i=this.toHex8String(!0)),e==="hex8"&&(i=this.toHex8String()),e==="name"&&(i=this.toName()),e==="hsl"&&(i=this.toHslString()),e==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},t.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},t.prototype.clone=function(){return new t(this.toString())},t.prototype.lighten=function(e){e===void 0&&(e=10);var n=this.toHsl();return n.l+=e/100,n.l=R2(n.l),new t(n)},t.prototype.brighten=function(e){e===void 0&&(e=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(e/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(e/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(e/100)))),new t(n)},t.prototype.darken=function(e){e===void 0&&(e=10);var n=this.toHsl();return n.l-=e/100,n.l=R2(n.l),new t(n)},t.prototype.tint=function(e){return e===void 0&&(e=10),this.mix("white",e)},t.prototype.shade=function(e){return e===void 0&&(e=10),this.mix("black",e)},t.prototype.desaturate=function(e){e===void 0&&(e=10);var n=this.toHsl();return n.s-=e/100,n.s=R2(n.s),new t(n)},t.prototype.saturate=function(e){e===void 0&&(e=10);var n=this.toHsl();return n.s+=e/100,n.s=R2(n.s),new t(n)},t.prototype.greyscale=function(){return this.desaturate(100)},t.prototype.spin=function(e){var n=this.toHsl(),i=(n.h+e)%360;return n.h=i<0?360+i:i,new t(n)},t.prototype.mix=function(e,n){n===void 0&&(n=50);var i=this.toRgb(),r=new t(e).toRgb(),s=n/100,o={r:(r.r-i.r)*s+i.r,g:(r.g-i.g)*s+i.g,b:(r.b-i.b)*s+i.b,a:(r.a-i.a)*s+i.a};return new t(o)},t.prototype.analogous=function(e,n){e===void 0&&(e=6),n===void 0&&(n=30);var i=this.toHsl(),r=360/n,s=[this];for(i.h=(i.h-(r*e>>1)+720)%360;--e;)i.h=(i.h+r)%360,s.push(new t(i));return s},t.prototype.complement=function(){var e=this.toHsl();return e.h=(e.h+180)%360,new t(e)},t.prototype.monochromatic=function(e){e===void 0&&(e=6);for(var n=this.toHsv(),i=n.h,r=n.s,s=n.v,o=[],a=1/e;e--;)o.push(new t({h:i,s:r,v:s})),s=(s+a)%1;return o},t.prototype.splitcomplement=function(){var e=this.toHsl(),n=e.h;return[this,new t({h:(n+72)%360,s:e.s,l:e.l}),new t({h:(n+216)%360,s:e.s,l:e.l})]},t.prototype.onBackground=function(e){var n=this.toRgb(),i=new t(e).toRgb(),r=n.a+i.a*(1-n.a);return new t({r:(n.r*n.a+i.r*i.a*(1-n.a))/r,g:(n.g*n.a+i.g*i.a*(1-n.a))/r,b:(n.b*n.a+i.b*i.a*(1-n.a))/r,a:r})},t.prototype.triad=function(){return this.polyad(3)},t.prototype.tetrad=function(){return this.polyad(4)},t.prototype.polyad=function(e){for(var n=this.toHsl(),i=n.h,r=[this],s=360/e,o=1;o<e;o++)r.push(new t({h:(i+o*s)%360,s:n.s,l:n.l}));return r},t.prototype.equals=function(e){return this.toRgbString()===new t(e).toRgbString()},t}(),Z2=2,tT=.16,f1e=.05,p1e=.05,m1e=.15,vz=5,yz=4,b1e=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function nT(t){var e=t.r,n=t.g,i=t.b,r=rw(e,n,i);return{h:r.h*360,s:r.s,v:r.v}}function E2(t){var e=t.r,n=t.g,i=t.b;return"#".concat(sw(e,n,i,!1))}function v1e(t,e,n){var i=n/100,r={r:(e.r-t.r)*i+t.r,g:(e.g-t.g)*i+t.g,b:(e.b-t.b)*i+t.b};return r}function iT(t,e,n){var i;return Math.round(t.h)>=60&&Math.round(t.h)<=240?i=n?Math.round(t.h)-Z2*e:Math.round(t.h)+Z2*e:i=n?Math.round(t.h)+Z2*e:Math.round(t.h)-Z2*e,i<0?i+=360:i>=360&&(i-=360),i}function rT(t,e,n){if(t.h===0&&t.s===0)return t.s;var i;return n?i=t.s-tT*e:e===yz?i=t.s+tT:i=t.s+f1e*e,i>1&&(i=1),n&&e===vz&&i>.1&&(i=.1),i<.06&&(i=.06),Number(i.toFixed(2))}function sT(t,e,n){var i;return n?i=t.v+p1e*e:i=t.v-m1e*e,i>1&&(i=1),Number(i.toFixed(2))}function dI(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=[],i=yd(t),r=vz;r>0;r-=1){var s=nT(i),o=E2(yd({h:iT(s,r,!0),s:rT(s,r,!0),v:sT(s,r,!0)}));n.push(o)}n.push(E2(i));for(var a=1;a<=yz;a+=1){var l=nT(i),g=E2(yd({h:iT(l,a),s:rT(l,a),v:sT(l,a)}));n.push(g)}return e.theme==="dark"?b1e.map(function(c){var u=c.index,I=c.opacity,h=E2(v1e(yd(e.backgroundColor||"#141414"),yd(n[u]),I*100));return h}):n}var iG={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},p3={},rG={};Object.keys(iG).forEach(function(t){p3[t]=dI(iG[t]),p3[t].primary=p3[t][5],rG[t]=dI(iG[t],{theme:"dark",backgroundColor:"#141414"}),rG[t].primary=rG[t][5]});var y1e=p3.blue;const B1e=t=>{const{controlHeight:e}=t;return{controlHeightSM:e*.75,controlHeightXS:e*.5,controlHeightLG:e*1.25}},G1e=B1e;function S1e(t){const{sizeUnit:e,sizeStep:n}=t;return{sizeXXL:e*(n+8),sizeXL:e*(n+4),sizeLG:e*(n+2),sizeMD:e*(n+1),sizeMS:e*n,size:e*n,sizeSM:e*(n-1),sizeXS:e*(n-2),sizeXXS:e*(n-3)}}const Bz={blue:"#1677ff",purple:"#722ED1",cyan:"#13C2C2",green:"#52C41A",magenta:"#EB2F96",pink:"#eb2f96",red:"#F5222D",orange:"#FA8C16",yellow:"#FADB14",volcano:"#FA541C",geekblue:"#2F54EB",gold:"#FAAD14",lime:"#A0D911"},w1e=Object.assign(Object.assign({},Bz),{colorPrimary:"#1677ff",colorSuccess:"#52c41a",colorWarning:"#faad14",colorError:"#ff4d4f",colorInfo:"#1677ff",colorLink:"",colorTextBase:"",colorBgBase:"",fontFamily:`-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,
'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
'Noto Color Emoji'`,fontFamilyCode:"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace",fontSize:14,lineWidth:1,lineType:"solid",motionUnit:.1,motionBase:0,motionEaseOutCirc:"cubic-bezier(0.08, 0.82, 0.17, 1)",motionEaseInOutCirc:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",motionEaseOut:"cubic-bezier(0.215, 0.61, 0.355, 1)",motionEaseInOut:"cubic-bezier(0.645, 0.045, 0.355, 1)",motionEaseOutBack:"cubic-bezier(0.12, 0.4, 0.29, 1.46)",motionEaseInBack:"cubic-bezier(0.71, -0.46, 0.88, 0.6)",motionEaseInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",motionEaseOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",borderRadius:6,sizeUnit:4,sizeStep:4,sizePopupArrow:16,controlHeight:32,zIndexBase:0,zIndexPopupBase:1e3,opacityImage:1,wireframe:!1,motion:!0}),Xy=w1e;function R1e(t,e){let{generateColorPalettes:n,generateNeutralColorPalettes:i}=e;const{colorSuccess:r,colorWarning:s,colorError:o,colorInfo:a,colorPrimary:l,colorBgBase:g,colorTextBase:c}=t,u=n(l),I=n(r),h=n(s),C=n(o),b=n(a),m=i(g,c),f=t.colorLink||t.colorInfo,p=n(f);return Object.assign(Object.assign({},m),{colorPrimaryBg:u[1],colorPrimaryBgHover:u[2],colorPrimaryBorder:u[3],colorPrimaryBorderHover:u[4],colorPrimaryHover:u[5],colorPrimary:u[6],colorPrimaryActive:u[7],colorPrimaryTextHover:u[8],colorPrimaryText:u[9],colorPrimaryTextActive:u[10],colorSuccessBg:I[1],colorSuccessBgHover:I[2],colorSuccessBorder:I[3],colorSuccessBorderHover:I[4],colorSuccessHover:I[4],colorSuccess:I[6],colorSuccessActive:I[7],colorSuccessTextHover:I[8],colorSuccessText:I[9],colorSuccessTextActive:I[10],colorErrorBg:C[1],colorErrorBgHover:C[2],colorErrorBorder:C[3],colorErrorBorderHover:C[4],colorErrorHover:C[5],colorError:C[6],colorErrorActive:C[7],colorErrorTextHover:C[8],colorErrorText:C[9],colorErrorTextActive:C[10],colorWarningBg:h[1],colorWarningBgHover:h[2],colorWarningBorder:h[3],colorWarningBorderHover:h[4],colorWarningHover:h[4],colorWarning:h[6],colorWarningActive:h[7],colorWarningTextHover:h[8],colorWarningText:h[9],colorWarningTextActive:h[10],colorInfoBg:b[1],colorInfoBgHover:b[2],colorInfoBorder:b[3],colorInfoBorderHover:b[4],colorInfoHover:b[4],colorInfo:b[6],colorInfoActive:b[7],colorInfoTextHover:b[8],colorInfoText:b[9],colorInfoTextActive:b[10],colorLinkHover:p[4],colorLink:p[6],colorLinkActive:p[7],colorBgMask:new Js("#000").setAlpha(.45).toRgbString(),colorWhite:"#fff"})}const x1e=t=>{let e=t,n=t,i=t,r=t;return t<6&&t>=5?e=t+1:t<16&&t>=6?e=t+2:t>=16&&(e=16),t<7&&t>=5?n=4:t<8&&t>=7?n=5:t<14&&t>=8?n=6:t<16&&t>=14?n=7:t>=16&&(n=8),t<6&&t>=2?i=1:t>=6&&(i=2),t>4&&t<8?r=4:t>=8&&(r=6),{borderRadius:t>16?16:t,borderRadiusXS:i,borderRadiusSM:n,borderRadiusLG:e,borderRadiusOuter:r}},Z1e=x1e;function E1e(t){const{motionUnit:e,motionBase:n,borderRadius:i,lineWidth:r}=t;return Object.assign({motionDurationFast:`${(n+e).toFixed(1)}s`,motionDurationMid:`${(n+e*2).toFixed(1)}s`,motionDurationSlow:`${(n+e*3).toFixed(1)}s`,lineWidthBold:r+1},Z1e(i))}const Ml=(t,e)=>new Js(t).setAlpha(e).toRgbString(),rC=(t,e)=>new Js(t).darken(e).toHexString(),W1e=t=>{const e=dI(t);return{1:e[0],2:e[1],3:e[2],4:e[3],5:e[4],6:e[5],7:e[6],8:e[4],9:e[5],10:e[6]}},N1e=(t,e)=>{const n=t||"#fff",i=e||"#000";return{colorBgBase:n,colorTextBase:i,colorText:Ml(i,.88),colorTextSecondary:Ml(i,.65),colorTextTertiary:Ml(i,.45),colorTextQuaternary:Ml(i,.25),colorFill:Ml(i,.15),colorFillSecondary:Ml(i,.06),colorFillTertiary:Ml(i,.04),colorFillQuaternary:Ml(i,.02),colorBgLayout:rC(n,4),colorBgContainer:rC(n,0),colorBgElevated:rC(n,0),colorBgSpotlight:Ml(i,.85),colorBorder:rC(n,15),colorBorderSecondary:rC(n,6)}};function M1e(t){const e=new Array(10).fill(null).map((n,i)=>{const r=i-1,s=t*Math.pow(2.71828,r/5),o=i>1?Math.floor(s):Math.ceil(s);return Math.floor(o/2)*2});return e[1]=t,e.map(n=>{const i=n+8;return{size:n,lineHeight:i/n}})}const T1e=t=>{const e=M1e(t),n=e.map(r=>r.size),i=e.map(r=>r.lineHeight);return{fontSizeSM:n[0],fontSize:n[1],fontSizeLG:n[2],fontSizeXL:n[3],fontSizeHeading1:n[6],fontSizeHeading2:n[5],fontSizeHeading3:n[4],fontSizeHeading4:n[3],fontSizeHeading5:n[2],lineHeight:i[1],lineHeightLG:i[2],lineHeightSM:i[0],lineHeightHeading1:i[6],lineHeightHeading2:i[5],lineHeightHeading3:i[4],lineHeightHeading4:i[3],lineHeightHeading5:i[2]}},F1e=T1e;function V1e(t){const e=Object.keys(Bz).map(n=>{const i=dI(t[n]);return new Array(10).fill(1).reduce((r,s,o)=>(r[`${n}-${o+1}`]=i[o],r[`${n}${o+1}`]=i[o],r),{})}).reduce((n,i)=>(n=Object.assign(Object.assign({},n),i),n),{});return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t),e),R1e(t,{generateColorPalettes:W1e,generateNeutralColorPalettes:N1e})),F1e(t.fontSize)),S1e(t)),G1e(t)),E1e(t))}const Gz=qS(V1e),Sz={token:Xy,hashed:!0},wz=yt.createContext(Sz),L1e="5.9.2";function sG(t){return t>=0&&t<=255}function W2(t,e){const{r:n,g:i,b:r,a:s}=new Js(t).toRgb();if(s<1)return t;const{r:o,g:a,b:l}=new Js(e).toRgb();for(let g=.01;g<=1;g+=.01){const c=Math.round((n-o*(1-g))/g),u=Math.round((i-a*(1-g))/g),I=Math.round((r-l*(1-g))/g);if(sG(c)&&sG(u)&&sG(I))return new Js({r:c,g:u,b:I,a:Math.round(g*100)/100}).toRgbString()}return new Js({r:n,g:i,b:r,a:1}).toRgbString()}var k1e=globalThis&&globalThis.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function Rz(t){const{override:e}=t,n=k1e(t,["override"]),i=Object.assign({},e);Object.keys(Xy).forEach(I=>{delete i[I]});const r=Object.assign(Object.assign({},n),i),s=480,o=576,a=768,l=992,g=1200,c=1600;if(r.motion===!1){const I="0s";r.motionDurationFast=I,r.motionDurationMid=I,r.motionDurationSlow=I}return Object.assign(Object.assign(Object.assign({},r),{colorFillContent:r.colorFillSecondary,colorFillContentHover:r.colorFill,colorFillAlter:r.colorFillQuaternary,colorBgContainerDisabled:r.colorFillTertiary,colorBorderBg:r.colorBgContainer,colorSplit:W2(r.colorBorderSecondary,r.colorBgContainer),colorTextPlaceholder:r.colorTextQuaternary,colorTextDisabled:r.colorTextQuaternary,colorTextHeading:r.colorText,colorTextLabel:r.colorTextSecondary,colorTextDescription:r.colorTextTertiary,colorTextLightSolid:r.colorWhite,colorHighlight:r.colorError,colorBgTextHover:r.colorFillSecondary,colorBgTextActive:r.colorFill,colorIcon:r.colorTextTertiary,colorIconHover:r.colorText,colorErrorOutline:W2(r.colorErrorBg,r.colorBgContainer),colorWarningOutline:W2(r.colorWarningBg,r.colorBgContainer),fontSizeIcon:r.fontSizeSM,lineWidthFocus:r.lineWidth*4,lineWidth:r.lineWidth,controlOutlineWidth:r.lineWidth*2,controlInteractiveSize:r.controlHeight/2,controlItemBgHover:r.colorFillTertiary,controlItemBgActive:r.colorPrimaryBg,controlItemBgActiveHover:r.colorPrimaryBgHover,controlItemBgActiveDisabled:r.colorFill,controlTmpOutline:r.colorFillQuaternary,controlOutline:W2(r.colorPrimaryBg,r.colorBgContainer),lineType:r.lineType,borderRadius:r.borderRadius,borderRadiusXS:r.borderRadiusXS,borderRadiusSM:r.borderRadiusSM,borderRadiusLG:r.borderRadiusLG,fontWeightStrong:600,opacityLoading:.65,linkDecoration:"none",linkHoverDecoration:"none",linkFocusDecoration:"none",controlPaddingHorizontal:12,controlPaddingHorizontalSM:8,paddingXXS:r.sizeXXS,paddingXS:r.sizeXS,paddingSM:r.sizeSM,padding:r.size,paddingMD:r.sizeMD,paddingLG:r.sizeLG,paddingXL:r.sizeXL,paddingContentHorizontalLG:r.sizeLG,paddingContentVerticalLG:r.sizeMS,paddingContentHorizontal:r.sizeMS,paddingContentVertical:r.sizeSM,paddingContentHorizontalSM:r.size,paddingContentVerticalSM:r.sizeXS,marginXXS:r.sizeXXS,marginXS:r.sizeXS,marginSM:r.sizeSM,margin:r.size,marginMD:r.sizeMD,marginLG:r.sizeLG,marginXL:r.sizeXL,marginXXL:r.sizeXXL,boxShadow:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowSecondary:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTertiary:`
      0 1px 2px 0 rgba(0, 0, 0, 0.03),
      0 1px 6px -1px rgba(0, 0, 0, 0.02),
      0 2px 4px 0 rgba(0, 0, 0, 0.02)
    `,screenXS:s,screenXSMin:s,screenXSMax:o-1,screenSM:o,screenSMMin:o,screenSMMax:a-1,screenMD:a,screenMDMin:a,screenMDMax:l-1,screenLG:l,screenLGMin:l,screenLGMax:g-1,screenXL:g,screenXLMin:g,screenXLMax:c-1,screenXXL:c,screenXXLMin:c,boxShadowPopoverArrow:"2px 2px 5px rgba(0, 0, 0, 0.05)",boxShadowCard:`
      0 1px 2px -2px ${new Js("rgba(0, 0, 0, 0.16)").toRgbString()},
      0 3px 6px 0 ${new Js("rgba(0, 0, 0, 0.12)").toRgbString()},
      0 5px 12px 4px ${new Js("rgba(0, 0, 0, 0.09)").toRgbString()}
    `,boxShadowDrawerRight:`
      -6px 0 16px 0 rgba(0, 0, 0, 0.08),
      -3px 0 6px -4px rgba(0, 0, 0, 0.12),
      -9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerLeft:`
      6px 0 16px 0 rgba(0, 0, 0, 0.08),
      3px 0 6px -4px rgba(0, 0, 0, 0.12),
      9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerUp:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerDown:`
      0 -6px 16px 0 rgba(0, 0, 0, 0.08),
      0 -3px 6px -4px rgba(0, 0, 0, 0.12),
      0 -9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTabsOverflowLeft:"inset 10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowRight:"inset -10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowTop:"inset 0 10px 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowBottom:"inset 0 -10px 8px -8px rgba(0, 0, 0, 0.08)"}),i)}var oT=globalThis&&globalThis.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};const xz=(t,e,n)=>{const i=n.getDerivativeToken(t),{override:r}=e,s=oT(e,["override"]);let o=Object.assign(Object.assign({},i),{override:r});return o=Rz(o),s&&Object.entries(s).forEach(a=>{let[l,g]=a;const{theme:c}=g,u=oT(g,["theme"]);let I=u;c&&(I=xz(Object.assign(Object.assign({},o),u),{override:u},c)),o[l]=I}),o};function $0(){const{token:t,hashed:e,theme:n,components:i}=yt.useContext(wz),r=`${L1e}-${e||""}`,s=n||Gz,[o,a]=Cye(s,[Xy,t],{salt:r,override:Object.assign({override:t},i),getComputedToken:xz,formatToken:Rz});return[s,o,e?a:""]}function H1e(t){var e=H.useRef();e.current=t;var n=H.useCallback(function(){for(var i,r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return(i=e.current)===null||i===void 0?void 0:i.call.apply(i,[e].concat(s))},[]);return n}function m3(t){var e=H.useRef(!1),n=H.useState(t),i=$n(n,2),r=i[0],s=i[1];H.useEffect(function(){return e.current=!1,function(){e.current=!0}},[]);function o(a,l){l&&e.current||s(a)}return[r,o]}const Zz="anticon",_1e=(t,e)=>e||(t?`ant-${t}`:"ant"),Mc=H.createContext({getPrefixCls:_1e,iconPrefixCls:Zz}),X1e=()=>({display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),Y1e=t=>({a:{color:t.colorLink,textDecoration:t.linkDecoration,backgroundColor:"transparent",outline:"none",cursor:"pointer",transition:`color ${t.motionDurationSlow}`,"-webkit-text-decoration-skip":"objects","&:hover":{color:t.colorLinkHover},"&:active":{color:t.colorLinkActive},"&:active,\n  &:hover":{textDecoration:t.linkHoverDecoration,outline:0},"&:focus":{textDecoration:t.linkFocusDecoration,outline:0},"&[disabled]":{color:t.colorTextDisabled,cursor:"not-allowed"}}}),K1e=(t,e)=>{const{fontFamily:n,fontSize:i}=t,r=`[class^="${e}"], [class*=" ${e}"]`;return{[r]:{fontFamily:n,fontSize:i,boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"},[r]:{boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"}}}}},z1e=t=>({outline:`${t.lineWidthFocus}px solid ${t.colorPrimaryBorder}`,outlineOffset:1,transition:"outline-offset 0s, outline 0s"}),U1e=t=>({"&:focus-visible":Object.assign({},z1e(t))}),Ez=typeof CSSINJS_STATISTIC<"u";let aw=!0;function WA(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!Ez)return Object.assign.apply(Object,[{}].concat(e));aw=!1;const i={};return e.forEach(r=>{Object.keys(r).forEach(o=>{Object.defineProperty(i,o,{configurable:!0,enumerable:!0,get:()=>r[o]})})}),aw=!0,i}const aT={};function D1e(){}function P1e(t){let e,n=t,i=D1e;return Ez&&(e=new Set,n=new Proxy(t,{get(r,s){return aw&&e.add(s),r[s]}}),i=(r,s)=>{var o;aT[r]={global:Array.from(e),component:Object.assign(Object.assign({},(o=aT[r])===null||o===void 0?void 0:o.component),s)}}),{token:n,keys:e,flush:i}}const O1e=(t,e)=>{const[n,i]=$0();return nw({theme:n,token:i,hashId:"",path:["ant-design-icons",t],nonce:()=>e==null?void 0:e.nonce},()=>[{[`.${t}`]:Object.assign(Object.assign({},X1e()),{[`.${t} .${t}-icon`]:{display:"block"}})}])},Wz=O1e;function TZ(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const r=Array.isArray(t)?t:[t,t],[s]=r,o=r.join("-");return a=>{const[l,g,c]=$0(),{getPrefixCls:u,iconPrefixCls:I,csp:h}=H.useContext(Mc),C=u(),b={theme:l,token:g,hashId:c,nonce:()=>h==null?void 0:h.nonce,clientOnly:i.clientOnly,order:i.order||-999};return nw(Object.assign(Object.assign({},b),{clientOnly:!1,path:["Shared",C]}),()=>[{"&":Y1e(g)}]),Wz(I),[nw(Object.assign(Object.assign({},b),{path:[o,a,I]}),()=>{const{token:m,flush:f}=P1e(g),p=Object.assign({},g[s]);if(i.deprecatedTokens){const{deprecatedTokens:E}=i;E.forEach(x=>{let[W,T]=x;var k;(p!=null&&p[W]||p!=null&&p[T])&&((k=p[T])!==null&&k!==void 0||(p[T]=p==null?void 0:p[W]))})}const v=typeof n=="function"?n(WA(m,p??{})):n,B=Object.assign(Object.assign({},v),p),G=`.${a}`,R=WA(m,{componentCls:G,prefixCls:a,iconCls:`.${I}`,antCls:`.${C}`},B),w=e(R,{hashId:c,prefixCls:a,rootPrefixCls:C,iconPrefixCls:I,overrideComponentToken:p});return f(s,B),[i.resetStyle===!1?null:K1e(g,a),w]}),c]}}const Q1e=(t,e,n,i)=>{const r=TZ(t,e,n,Object.assign({resetStyle:!1,order:-998},i));return o=>{let{prefixCls:a}=o;return r(a),null}},J1e=`-ant-${Date.now()}-${Math.random()}`;function j1e(t,e){const n={},i=(o,a)=>{let l=o.clone();return l=(a==null?void 0:a(l))||l,l.toRgbString()},r=(o,a)=>{const l=new Js(o),g=dI(l.toRgbString());n[`${a}-color`]=i(l),n[`${a}-color-disabled`]=g[1],n[`${a}-color-hover`]=g[4],n[`${a}-color-active`]=g[6],n[`${a}-color-outline`]=l.clone().setAlpha(.2).toRgbString(),n[`${a}-color-deprecated-bg`]=g[0],n[`${a}-color-deprecated-border`]=g[2]};if(e.primaryColor){r(e.primaryColor,"primary");const o=new Js(e.primaryColor),a=dI(o.toRgbString());a.forEach((g,c)=>{n[`primary-${c+1}`]=g}),n["primary-color-deprecated-l-35"]=i(o,g=>g.lighten(35)),n["primary-color-deprecated-l-20"]=i(o,g=>g.lighten(20)),n["primary-color-deprecated-t-20"]=i(o,g=>g.tint(20)),n["primary-color-deprecated-t-50"]=i(o,g=>g.tint(50)),n["primary-color-deprecated-f-12"]=i(o,g=>g.setAlpha(g.getAlpha()*.12));const l=new Js(a[0]);n["primary-color-active-deprecated-f-30"]=i(l,g=>g.setAlpha(g.getAlpha()*.3)),n["primary-color-active-deprecated-d-02"]=i(l,g=>g.darken(2))}return e.successColor&&r(e.successColor,"success"),e.warningColor&&r(e.warningColor,"warning"),e.errorColor&&r(e.errorColor,"error"),e.infoColor&&r(e.infoColor,"info"),`
  :root {
    ${Object.keys(n).map(o=>`--${t}-${o}: ${n[o]};`).join(`
`)}
  }
  `.trim()}function q1e(t,e){const n=j1e(t,e);Al()&&i0(n,`${J1e}-dynamic-theme`)}const lw=H.createContext(!1),$1e=t=>{let{children:e,disabled:n}=t;const i=H.useContext(lw);return H.createElement(lw.Provider,{value:n??i},e)},Nz=lw,gw=H.createContext(void 0),e5e=t=>{let{children:e,size:n}=t;const i=H.useContext(gw);return H.createElement(gw.Provider,{value:n||i},e)},Yy=gw;function t5e(){const t=H.useContext(Nz),e=H.useContext(Yy);return{componentDisabled:t,componentSize:e}}function n5e(t,e){const n=t||{},i=n.inherit===!1||!e?Sz:e;return UK(()=>{if(!t)return e;const r=Object.assign({},i.components);return Object.keys(t.components||{}).forEach(s=>{r[s]=Object.assign(Object.assign({},r[s]),t.components[s])}),Object.assign(Object.assign(Object.assign({},i),n),{token:Object.assign(Object.assign({},i.token),n.token),components:r})},[n,i],(r,s)=>r.some((o,a)=>{const l=s[a];return!Hve(o,l,!0)}))}var i5e=["children"],Mz=H.createContext({});function r5e(t){var e=t.children,n=n0(t,i5e);return H.createElement(Mz.Provider,{value:n},e)}var s5e=function(t){HK(n,t);var e=_K(n);function n(){return J0(this,n),e.apply(this,arguments)}return j0(n,[{key:"render",value:function(){return this.props.children}}]),n}(H.Component),mu="none",N2="appear",M2="enter",T2="leave",lT="none",na="prepare",zd="start",Ud="active",FZ="end",Tz="prepared";function gT(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit".concat(t)]="webkit".concat(e),n["Moz".concat(t)]="moz".concat(e),n["ms".concat(t)]="MS".concat(e),n["O".concat(t)]="o".concat(e.toLowerCase()),n}function o5e(t,e){var n={animationend:gT("Animation","AnimationEnd"),transitionend:gT("Transition","TransitionEnd")};return t&&("AnimationEvent"in e||delete n.animationend.animation,"TransitionEvent"in e||delete n.transitionend.transition),n}var a5e=o5e(Al(),typeof window<"u"?window:{}),Fz={};if(Al()){var l5e=document.createElement("div");Fz=l5e.style}var F2={};function Vz(t){if(F2[t])return F2[t];var e=a5e[t];if(e)for(var n=Object.keys(e),i=n.length,r=0;r<i;r+=1){var s=n[r];if(Object.prototype.hasOwnProperty.call(e,s)&&s in Fz)return F2[t]=e[s],F2[t]}return""}var Lz=Vz("animationend"),kz=Vz("transitionend"),Hz=!!(Lz&&kz),cT=Lz||"animationend",uT=kz||"transitionend";function IT(t,e){if(!t)return null;if(gi(t)==="object"){var n=e.replace(/-\w/g,function(i){return i[1].toUpperCase()});return t[n]}return"".concat(t,"-").concat(e)}const g5e=function(t){var e=H.useRef(),n=H.useRef(t);n.current=t;var i=H.useCallback(function(o){n.current(o)},[]);function r(o){o&&(o.removeEventListener(uT,i),o.removeEventListener(cT,i))}function s(o){e.current&&e.current!==o&&r(e.current),o&&o!==e.current&&(o.addEventListener(uT,i),o.addEventListener(cT,i),e.current=o)}return H.useEffect(function(){return function(){r(e.current)}},[]),[s,r]};var _z=Al()?H.useLayoutEffect:H.useEffect;const c5e=function(){var t=H.useRef(null);function e(){II.cancel(t.current)}function n(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;e();var s=II(function(){r<=1?i({isCanceled:function(){return s!==t.current}}):n(i,r-1)});t.current=s}return H.useEffect(function(){return function(){e()}},[]),[n,e]};var u5e=[na,zd,Ud,FZ],I5e=[na,Tz],Xz=!1,d5e=!0;function Yz(t){return t===Ud||t===FZ}const A5e=function(t,e,n){var i=m3(lT),r=$n(i,2),s=r[0],o=r[1],a=c5e(),l=$n(a,2),g=l[0],c=l[1];function u(){o(na,!0)}var I=e?I5e:u5e;return _z(function(){if(s!==lT&&s!==FZ){var h=I.indexOf(s),C=I[h+1],b=n(s);b===Xz?o(C,!0):C&&g(function(m){function f(){m.isCanceled()||o(C,!0)}b===!0?f():Promise.resolve(b).then(f)})}},[t,s]),H.useEffect(function(){return function(){c()}},[]),[u,s]};function h5e(t,e,n,i){var r=i.motionEnter,s=r===void 0?!0:r,o=i.motionAppear,a=o===void 0?!0:o,l=i.motionLeave,g=l===void 0?!0:l,c=i.motionDeadline,u=i.motionLeaveImmediately,I=i.onAppearPrepare,h=i.onEnterPrepare,C=i.onLeavePrepare,b=i.onAppearStart,m=i.onEnterStart,f=i.onLeaveStart,p=i.onAppearActive,v=i.onEnterActive,B=i.onLeaveActive,G=i.onAppearEnd,R=i.onEnterEnd,w=i.onLeaveEnd,E=i.onVisibleChanged,x=m3(),W=$n(x,2),T=W[0],k=W[1],_=m3(mu),U=$n(_,2),O=U[0],Y=U[1],z=m3(null),N=$n(z,2),L=N[0],V=N[1],M=H.useRef(!1),X=H.useRef(null);function J(){return n()}var re=H.useRef(!1);function se(){Y(mu,!0),V(null,!0)}function le(we){var Be=J();if(!(we&&!we.deadline&&we.target!==Be)){var Ae=re.current,De;O===N2&&Ae?De=G==null?void 0:G(Be,we):O===M2&&Ae?De=R==null?void 0:R(Be,we):O===T2&&Ae&&(De=w==null?void 0:w(Be,we)),O!==mu&&Ae&&De!==!1&&se()}}var ae=g5e(le),ce=$n(ae,1),Ee=ce[0],Fe=function(Be){var Ae,De,Q;switch(Be){case N2:return Ae={},Gn(Ae,na,I),Gn(Ae,zd,b),Gn(Ae,Ud,p),Ae;case M2:return De={},Gn(De,na,h),Gn(De,zd,m),Gn(De,Ud,v),De;case T2:return Q={},Gn(Q,na,C),Gn(Q,zd,f),Gn(Q,Ud,B),Q;default:return{}}},oe=H.useMemo(function(){return Fe(O)},[O]),D=A5e(O,!t,function(we){if(we===na){var Be=oe[na];return Be?Be(J()):Xz}if(pe in oe){var Ae;V(((Ae=oe[pe])===null||Ae===void 0?void 0:Ae.call(oe,J(),null))||null)}return pe===Ud&&(Ee(J()),c>0&&(clearTimeout(X.current),X.current=setTimeout(function(){le({deadline:!0})},c))),pe===Tz&&se(),d5e}),fe=$n(D,2),Ce=fe[0],pe=fe[1],be=Yz(pe);re.current=be,_z(function(){k(e);var we=M.current;M.current=!0;var Be;!we&&e&&a&&(Be=N2),we&&e&&s&&(Be=M2),(we&&!e&&g||!we&&u&&!e&&g)&&(Be=T2);var Ae=Fe(Be);Be&&(t||Ae[na])?(Y(Be),Ce()):Y(mu)},[e]),H.useEffect(function(){(O===N2&&!a||O===M2&&!s||O===T2&&!g)&&Y(mu)},[a,s,g]),H.useEffect(function(){return function(){M.current=!1,clearTimeout(X.current)}},[]);var Ue=H.useRef(!1);H.useEffect(function(){T&&(Ue.current=!0),T!==void 0&&O===mu&&((Ue.current||T)&&(E==null||E(T)),Ue.current=!0)},[T,O]);var me=L;return oe[na]&&pe===zd&&(me=Qt({transition:"none"},me)),[O,pe,me,T??e]}function C5e(t){var e=t;gi(t)==="object"&&(e=t.transitionSupport);function n(r,s){return!!(r.motionName&&e&&s!==!1)}var i=H.forwardRef(function(r,s){var o=r.visible,a=o===void 0?!0:o,l=r.removeOnLeave,g=l===void 0?!0:l,c=r.forceRender,u=r.children,I=r.motionName,h=r.leavedClassName,C=r.eventProps,b=H.useContext(Mz),m=b.motion,f=n(r,m),p=H.useRef(),v=H.useRef();function B(){try{return p.current instanceof HTMLElement?p.current:Tve(v.current)}catch{return null}}var G=h5e(f,a,B,r),R=$n(G,4),w=R[0],E=R[1],x=R[2],W=R[3],T=H.useRef(W);W&&(T.current=!0);var k=H.useCallback(function(V){p.current=V,DK(s,V)},[s]),_,U=Qt(Qt({},C),{},{visible:a});if(!u)_=null;else if(w===mu)W?_=u(Qt({},U),k):!g&&T.current&&h?_=u(Qt(Qt({},U),{},{className:h}),k):c||!g&&!h?_=u(Qt(Qt({},U),{},{style:{display:"none"}}),k):_=null;else{var O,Y;E===na?Y="prepare":Yz(E)?Y="active":E===zd&&(Y="start");var z=IT(I,"".concat(w,"-").concat(Y));_=u(Qt(Qt({},U),{},{className:da(IT(I,w),(O={},Gn(O,z,z&&Y),Gn(O,I,typeof I=="string"),O)),style:x}),k)}if(H.isValidElement(_)&&OK(_)){var N=_,L=N.ref;L||(_=H.cloneElement(_,{ref:k}))}return H.createElement(s5e,{ref:v},_)});return i.displayName="CSSMotion",i}const VZ=C5e(Hz);var cw="add",uw="keep",Iw="remove",oG="removed";function f5e(t){var e;return t&&gi(t)==="object"&&"key"in t?e=t:e={key:t},Qt(Qt({},e),{},{key:String(e.key)})}function dw(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return t.map(f5e)}function p5e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=[],i=0,r=e.length,s=dw(t),o=dw(e);s.forEach(function(g){for(var c=!1,u=i;u<r;u+=1){var I=o[u];if(I.key===g.key){i<u&&(n=n.concat(o.slice(i,u).map(function(h){return Qt(Qt({},h),{},{status:cw})})),i=u),n.push(Qt(Qt({},I),{},{status:uw})),i+=1,c=!0;break}}c||n.push(Qt(Qt({},g),{},{status:Iw}))}),i<r&&(n=n.concat(o.slice(i).map(function(g){return Qt(Qt({},g),{},{status:cw})})));var a={};n.forEach(function(g){var c=g.key;a[c]=(a[c]||0)+1});var l=Object.keys(a).filter(function(g){return a[g]>1});return l.forEach(function(g){n=n.filter(function(c){var u=c.key,I=c.status;return u!==g||I!==Iw}),n.forEach(function(c){c.key===g&&(c.status=uw)})}),n}var m5e=["component","children","onVisibleChanged","onAllRemoved"],b5e=["status"],v5e=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];function y5e(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:VZ,n=function(i){HK(s,i);var r=_K(s);function s(){var o;J0(this,s);for(var a=arguments.length,l=new Array(a),g=0;g<a;g++)l[g]=arguments[g];return o=r.call.apply(r,[this].concat(l)),Gn(PS(o),"state",{keyEntities:[]}),Gn(PS(o),"removeKey",function(c){var u=o.state.keyEntities,I=u.map(function(h){return h.key!==c?h:Qt(Qt({},h),{},{status:oG})});return o.setState({keyEntities:I}),I.filter(function(h){var C=h.status;return C!==oG}).length}),o}return j0(s,[{key:"render",value:function(){var a=this,l=this.state.keyEntities,g=this.props,c=g.component,u=g.children,I=g.onVisibleChanged,h=g.onAllRemoved,C=n0(g,m5e),b=c||H.Fragment,m={};return v5e.forEach(function(f){m[f]=C[f],delete C[f]}),delete C.keys,H.createElement(b,C,l.map(function(f,p){var v=f.status,B=n0(f,b5e),G=v===cw||v===uw;return H.createElement(e,Es({},m,{key:B.key,visible:G,eventProps:B,onVisibleChanged:function(w){if(I==null||I(w,{key:B.key}),!w){var E=a.removeKey(B.key);E===0&&h&&h()}}}),function(R,w){return u(Qt(Qt({},R),{},{index:p}),w)})}))}}],[{key:"getDerivedStateFromProps",value:function(a,l){var g=a.keys,c=l.keyEntities,u=dw(g),I=p5e(c,u);return{keyEntities:I.filter(function(h){var C=c.find(function(b){var m=b.key;return h.key===m});return!(C&&C.status===oG&&h.status===Iw)})}}}]),s}(H.Component);return Gn(n,"defaultProps",{component:"div"}),n}y5e(Hz);function B5e(t){const{children:e}=t,[,n]=$0(),{motion:i}=n,r=H.useRef(!1);return r.current=r.current||i===!1,r.current?H.createElement(r5e,{motion:i},e):e}const G5e=()=>null;var S5e=globalThis&&globalThis.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};const w5e=["getTargetContainer","getPopupContainer","renderEmpty","pageHeader","input","pagination","form","select","button"],R5e="ant";let Kz;function x5e(){return Kz||R5e}function Z5e(t){return Object.keys(t).some(e=>e.endsWith("Color"))}const E5e=t=>{let{prefixCls:e,iconPrefixCls:n,theme:i}=t;e!==void 0&&(Kz=e),i&&Z5e(i)&&q1e(x5e(),i)},W5e=t=>{const{children:e,csp:n,autoInsertSpaceInButton:i,alert:r,anchor:s,form:o,locale:a,componentSize:l,direction:g,space:c,virtual:u,dropdownMatchSelectWidth:I,popupMatchSelectWidth:h,popupOverflow:C,legacyLocale:b,parentContext:m,iconPrefixCls:f,theme:p,componentDisabled:v,segmented:B,statistic:G,spin:R,calendar:w,carousel:E,cascader:x,collapse:W,typography:T,checkbox:k,descriptions:_,divider:U,drawer:O,skeleton:Y,steps:z,image:N,layout:L,list:V,mentions:M,modal:X,progress:J,result:re,slider:se,breadcrumb:le,menu:ae,pagination:ce,input:Ee,empty:Fe,badge:oe,radio:D,rate:fe,switch:Ce,transfer:pe,avatar:be,message:Ue,tag:me,table:we,card:Be,tabs:Ae,timeline:De,timePicker:Q,upload:K,notification:ge,tree:Le,colorPicker:Re,datePicker:Ze,wave:Je}=t,Ye=H.useCallback((ue,_e)=>{const{prefixCls:qe}=t;if(_e)return _e;const At=qe||m.getPrefixCls("");return ue?`${At}-${ue}`:At},[m.getPrefixCls,t.prefixCls]),de=f||m.iconPrefixCls||Zz,ze=n||m.csp;Wz(de,ze);const je=n5e(p,m.theme),Pe={csp:ze,autoInsertSpaceInButton:i,alert:r,anchor:s,locale:a||b,direction:g,space:c,virtual:u,popupMatchSelectWidth:h??I,popupOverflow:C,getPrefixCls:Ye,iconPrefixCls:de,theme:je,segmented:B,statistic:G,spin:R,calendar:w,carousel:E,cascader:x,collapse:W,typography:T,checkbox:k,descriptions:_,divider:U,drawer:O,skeleton:Y,steps:z,image:N,input:Ee,layout:L,list:V,mentions:M,modal:X,progress:J,result:re,slider:se,breadcrumb:le,menu:ae,pagination:ce,empty:Fe,badge:oe,radio:D,rate:fe,switch:Ce,transfer:pe,avatar:be,message:Ue,tag:me,table:we,card:Be,tabs:Ae,timeline:De,timePicker:Q,upload:K,notification:ge,tree:Le,colorPicker:Re,datePicker:Ze,wave:Je},ke=Object.assign({},m);Object.keys(Pe).forEach(ue=>{Pe[ue]!==void 0&&(ke[ue]=Pe[ue])}),w5e.forEach(ue=>{const _e=t[ue];_e&&(ke[ue]=_e)});const $=UK(()=>ke,ke,(ue,_e)=>{const qe=Object.keys(ue),At=Object.keys(_e);return qe.length!==At.length||qe.some(vt=>ue[vt]!==_e[vt])}),Se=H.useMemo(()=>({prefixCls:de,csp:ze}),[de,ze]);let Ke=H.createElement(H.Fragment,null,H.createElement(G5e,{dropdownMatchSelectWidth:I}),e);const q=H.useMemo(()=>{var ue,_e,qe,At;return Oye(((ue=_y.Form)===null||ue===void 0?void 0:ue.defaultValidateMessages)||{},((qe=(_e=$.locale)===null||_e===void 0?void 0:_e.Form)===null||qe===void 0?void 0:qe.defaultValidateMessages)||{},((At=$.form)===null||At===void 0?void 0:At.validateMessages)||{},(o==null?void 0:o.validateMessages)||{})},[$,o==null?void 0:o.validateMessages]);Object.keys(q).length>0&&(Ke=H.createElement(Qye.Provider,{value:q},Ke)),a&&(Ke=H.createElement(s1e,{locale:a,_ANT_MARK__:i1e},Ke)),(de||ze)&&(Ke=H.createElement(MZ.Provider,{value:Se},Ke)),l&&(Ke=H.createElement(e5e,{size:l},Ke)),Ke=H.createElement(B5e,null,Ke);const He=H.useMemo(()=>{const ue=je||{},{algorithm:_e,token:qe,components:At}=ue,vt=S5e(ue,["algorithm","token","components"]),Et=_e&&(!Array.isArray(_e)||_e.length>0)?qS(_e):Gz,Kt={};return Object.entries(At||{}).forEach(zt=>{let[Ht,Tt]=zt;const Mn=Object.assign({},Tt);"algorithm"in Mn&&(Mn.algorithm===!0?Mn.theme=Et:(Array.isArray(Mn.algorithm)||typeof Mn.algorithm=="function")&&(Mn.theme=qS(Mn.algorithm)),delete Mn.algorithm),Kt[Ht]=Mn}),Object.assign(Object.assign({},vt),{theme:Et,token:Object.assign(Object.assign({},Xy),qe),components:Kt})},[je]);return p&&(Ke=H.createElement(wz.Provider,{value:He},Ke)),v!==void 0&&(Ke=H.createElement($1e,{disabled:v},Ke)),H.createElement(Mc.Provider,{value:$},Ke)},ep=t=>{const e=H.useContext(Mc),n=H.useContext(mz);return H.createElement(W5e,Object.assign({parentContext:e,legacyLocale:n},t))};ep.ConfigContext=Mc;ep.SizeContext=Yy;ep.config=E5e;ep.useConfig=t5e;Object.defineProperty(ep,"SizeContext",{get:()=>Yy});function zz(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}function N5e(t){return zz(t)instanceof ShadowRoot}function M5e(t){return N5e(t)?zz(t):null}function T5e(t){return t.replace(/-(.)/g,function(e,n){return n.toUpperCase()})}function F5e(t,e){q0(t,"[@ant-design/icons] ".concat(e))}function dT(t){return gi(t)==="object"&&typeof t.name=="string"&&typeof t.theme=="string"&&(gi(t.icon)==="object"||typeof t.icon=="function")}function AT(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.keys(t).reduce(function(e,n){var i=t[n];switch(n){case"class":e.className=i,delete e.class;break;default:delete e[n],e[T5e(n)]=i}return e},{})}function Aw(t,e,n){return n?yt.createElement(t.tag,Qt(Qt({key:e},AT(t.attrs)),n),(t.children||[]).map(function(i,r){return Aw(i,"".concat(e,"-").concat(t.tag,"-").concat(r))})):yt.createElement(t.tag,Qt({key:e},AT(t.attrs)),(t.children||[]).map(function(i,r){return Aw(i,"".concat(e,"-").concat(t.tag,"-").concat(r))}))}function Uz(t){return dI(t)[0]}function Dz(t){return t?Array.isArray(t)?t:[t]:[]}var V5e=`
.anticon {
  display: inline-block;
  color: inherit;
  font-style: normal;
  line-height: 0;
  text-align: center;
  text-transform: none;
  vertical-align: -0.125em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.anticon > * {
  line-height: 1;
}

.anticon svg {
  display: inline-block;
}

.anticon::before {
  display: none;
}

.anticon .anticon-icon {
  display: block;
}

.anticon[tabindex] {
  cursor: pointer;
}

.anticon-spin::before,
.anticon-spin {
  display: inline-block;
  -webkit-animation: loadingCircle 1s infinite linear;
  animation: loadingCircle 1s infinite linear;
}

@-webkit-keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
`,L5e=function(e){var n=H.useContext(MZ),i=n.csp,r=n.prefixCls,s=V5e;r&&(s=s.replace(/anticon/g,r)),H.useEffect(function(){var o=e.current,a=M5e(o);i0(s,"@ant-design-icons",{prepend:!0,csp:i,attachTo:a})},[])},k5e=["icon","className","onClick","style","primaryColor","secondaryColor"],DC={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};function H5e(t){var e=t.primaryColor,n=t.secondaryColor;DC.primaryColor=e,DC.secondaryColor=n||Uz(e),DC.calculated=!!n}function _5e(){return Qt({},DC)}var Ky=function(e){var n=e.icon,i=e.className,r=e.onClick,s=e.style,o=e.primaryColor,a=e.secondaryColor,l=n0(e,k5e),g=H.useRef(),c=DC;if(o&&(c={primaryColor:o,secondaryColor:a||Uz(o)}),L5e(g),F5e(dT(n),"icon should be icon definiton, but got ".concat(n)),!dT(n))return null;var u=n;return u&&typeof u.icon=="function"&&(u=Qt(Qt({},u),{},{icon:u.icon(c.primaryColor,c.secondaryColor)})),Aw(u.icon,"svg-".concat(u.name),Qt(Qt({className:i,onClick:r,style:s,"data-icon":u.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},l),{},{ref:g}))};Ky.displayName="IconReact";Ky.getTwoToneColors=_5e;Ky.setTwoToneColors=H5e;const LZ=Ky;function Pz(t){var e=Dz(t),n=$n(e,2),i=n[0],r=n[1];return LZ.setTwoToneColors({primaryColor:i,secondaryColor:r})}function X5e(){var t=LZ.getTwoToneColors();return t.calculated?[t.primaryColor,t.secondaryColor]:t.primaryColor}var Y5e=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];Pz(y1e.primary);var zy=H.forwardRef(function(t,e){var n,i=t.className,r=t.icon,s=t.spin,o=t.rotate,a=t.tabIndex,l=t.onClick,g=t.twoToneColor,c=n0(t,Y5e),u=H.useContext(MZ),I=u.prefixCls,h=I===void 0?"anticon":I,C=u.rootClassName,b=da(C,h,(n={},Gn(n,"".concat(h,"-").concat(r.name),!!r.name),Gn(n,"".concat(h,"-spin"),!!s||r.name==="loading"),n),i),m=a;m===void 0&&l&&(m=-1);var f=o?{msTransform:"rotate(".concat(o,"deg)"),transform:"rotate(".concat(o,"deg)")}:void 0,p=Dz(g),v=$n(p,2),B=v[0],G=v[1];return H.createElement("span",Es({role:"img","aria-label":r.name},c,{ref:e,tabIndex:m,onClick:l,className:b}),H.createElement(LZ,{icon:r,primaryColor:B,secondaryColor:G,style:f}))});zy.displayName="AntdIcon";zy.getTwoToneColor=X5e;zy.setTwoToneColor=Pz;const K5e=zy,{isValidElement:Oz}=Kb;function z5e(t){return t&&Oz(t)&&t.type===H.Fragment}function U5e(t,e,n){return Oz(t)?H.cloneElement(t,typeof n=="function"?n(t.props||{}):n):e}function Qz(t,e){return U5e(t,t,e)}var D5e={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"};const P5e=D5e;var O5e=function(e,n){return H.createElement(K5e,Es({},e,{ref:n,icon:P5e}))};const Q5e=H.forwardRef(O5e);function o0(){o0=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(Y,z,N){Y[z]=N.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function g(Y,z,N){return Object.defineProperty(Y,z,{value:N,enumerable:!0,configurable:!0,writable:!0}),Y[z]}try{g({},"")}catch{g=function(N,L,V){return N[L]=V}}function c(Y,z,N,L){var V=z&&z.prototype instanceof f?z:f,M=Object.create(V.prototype),X=new U(L||[]);return r(M,"_invoke",{value:W(Y,N,X)}),M}function u(Y,z,N){try{return{type:"normal",arg:Y.call(z,N)}}catch(L){return{type:"throw",arg:L}}}e.wrap=c;var I="suspendedStart",h="suspendedYield",C="executing",b="completed",m={};function f(){}function p(){}function v(){}var B={};g(B,o,function(){return this});var G=Object.getPrototypeOf,R=G&&G(G(O([])));R&&R!==n&&i.call(R,o)&&(B=R);var w=v.prototype=f.prototype=Object.create(B);function E(Y){["next","throw","return"].forEach(function(z){g(Y,z,function(N){return this._invoke(z,N)})})}function x(Y,z){function N(V,M,X,J){var re=u(Y[V],Y,M);if(re.type!=="throw"){var se=re.arg,le=se.value;return le&&gi(le)=="object"&&i.call(le,"__await")?z.resolve(le.__await).then(function(ae){N("next",ae,X,J)},function(ae){N("throw",ae,X,J)}):z.resolve(le).then(function(ae){se.value=ae,X(se)},function(ae){return N("throw",ae,X,J)})}J(re.arg)}var L;r(this,"_invoke",{value:function(M,X){function J(){return new z(function(re,se){N(M,X,re,se)})}return L=L?L.then(J,J):J()}})}function W(Y,z,N){var L=I;return function(V,M){if(L===C)throw new Error("Generator is already running");if(L===b){if(V==="throw")throw M;return{value:t,done:!0}}for(N.method=V,N.arg=M;;){var X=N.delegate;if(X){var J=T(X,N);if(J){if(J===m)continue;return J}}if(N.method==="next")N.sent=N._sent=N.arg;else if(N.method==="throw"){if(L===I)throw L=b,N.arg;N.dispatchException(N.arg)}else N.method==="return"&&N.abrupt("return",N.arg);L=C;var re=u(Y,z,N);if(re.type==="normal"){if(L=N.done?b:h,re.arg===m)continue;return{value:re.arg,done:N.done}}re.type==="throw"&&(L=b,N.method="throw",N.arg=re.arg)}}}function T(Y,z){var N=z.method,L=Y.iterator[N];if(L===t)return z.delegate=null,N==="throw"&&Y.iterator.return&&(z.method="return",z.arg=t,T(Y,z),z.method==="throw")||N!=="return"&&(z.method="throw",z.arg=new TypeError("The iterator does not provide a '"+N+"' method")),m;var V=u(L,Y.iterator,z.arg);if(V.type==="throw")return z.method="throw",z.arg=V.arg,z.delegate=null,m;var M=V.arg;return M?M.done?(z[Y.resultName]=M.value,z.next=Y.nextLoc,z.method!=="return"&&(z.method="next",z.arg=t),z.delegate=null,m):M:(z.method="throw",z.arg=new TypeError("iterator result is not an object"),z.delegate=null,m)}function k(Y){var z={tryLoc:Y[0]};1 in Y&&(z.catchLoc=Y[1]),2 in Y&&(z.finallyLoc=Y[2],z.afterLoc=Y[3]),this.tryEntries.push(z)}function _(Y){var z=Y.completion||{};z.type="normal",delete z.arg,Y.completion=z}function U(Y){this.tryEntries=[{tryLoc:"root"}],Y.forEach(k,this),this.reset(!0)}function O(Y){if(Y||Y===""){var z=Y[o];if(z)return z.call(Y);if(typeof Y.next=="function")return Y;if(!isNaN(Y.length)){var N=-1,L=function V(){for(;++N<Y.length;)if(i.call(Y,N))return V.value=Y[N],V.done=!1,V;return V.value=t,V.done=!0,V};return L.next=L}}throw new TypeError(gi(Y)+" is not iterable")}return p.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=g(v,l,"GeneratorFunction"),e.isGeneratorFunction=function(Y){var z=typeof Y=="function"&&Y.constructor;return!!z&&(z===p||(z.displayName||z.name)==="GeneratorFunction")},e.mark=function(Y){return Object.setPrototypeOf?Object.setPrototypeOf(Y,v):(Y.__proto__=v,g(Y,l,"GeneratorFunction")),Y.prototype=Object.create(w),Y},e.awrap=function(Y){return{__await:Y}},E(x.prototype),g(x.prototype,a,function(){return this}),e.AsyncIterator=x,e.async=function(Y,z,N,L,V){V===void 0&&(V=Promise);var M=new x(c(Y,z,N,L),V);return e.isGeneratorFunction(z)?M:M.next().then(function(X){return X.done?X.value:M.next()})},E(w),g(w,l,"Generator"),g(w,o,function(){return this}),g(w,"toString",function(){return"[object Generator]"}),e.keys=function(Y){var z=Object(Y),N=[];for(var L in z)N.push(L);return N.reverse(),function V(){for(;N.length;){var M=N.pop();if(M in z)return V.value=M,V.done=!1,V}return V.done=!0,V}},e.values=O,U.prototype={constructor:U,reset:function(z){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!z)for(var N in this)N.charAt(0)==="t"&&i.call(this,N)&&!isNaN(+N.slice(1))&&(this[N]=t)},stop:function(){this.done=!0;var z=this.tryEntries[0].completion;if(z.type==="throw")throw z.arg;return this.rval},dispatchException:function(z){if(this.done)throw z;var N=this;function L(se,le){return X.type="throw",X.arg=z,N.next=se,le&&(N.method="next",N.arg=t),!!le}for(var V=this.tryEntries.length-1;V>=0;--V){var M=this.tryEntries[V],X=M.completion;if(M.tryLoc==="root")return L("end");if(M.tryLoc<=this.prev){var J=i.call(M,"catchLoc"),re=i.call(M,"finallyLoc");if(J&&re){if(this.prev<M.catchLoc)return L(M.catchLoc,!0);if(this.prev<M.finallyLoc)return L(M.finallyLoc)}else if(J){if(this.prev<M.catchLoc)return L(M.catchLoc,!0)}else{if(!re)throw new Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return L(M.finallyLoc)}}}},abrupt:function(z,N){for(var L=this.tryEntries.length-1;L>=0;--L){var V=this.tryEntries[L];if(V.tryLoc<=this.prev&&i.call(V,"finallyLoc")&&this.prev<V.finallyLoc){var M=V;break}}M&&(z==="break"||z==="continue")&&M.tryLoc<=N&&N<=M.finallyLoc&&(M=null);var X=M?M.completion:{};return X.type=z,X.arg=N,M?(this.method="next",this.next=M.finallyLoc,m):this.complete(X)},complete:function(z,N){if(z.type==="throw")throw z.arg;return z.type==="break"||z.type==="continue"?this.next=z.arg:z.type==="return"?(this.rval=this.arg=z.arg,this.method="return",this.next="end"):z.type==="normal"&&N&&(this.next=N),m},finish:function(z){for(var N=this.tryEntries.length-1;N>=0;--N){var L=this.tryEntries[N];if(L.finallyLoc===z)return this.complete(L.completion,L.afterLoc),_(L),m}},catch:function(z){for(var N=this.tryEntries.length-1;N>=0;--N){var L=this.tryEntries[N];if(L.tryLoc===z){var V=L.completion;if(V.type==="throw"){var M=V.arg;_(L)}return M}}throw new Error("illegal catch attempt")},delegateYield:function(z,N,L){return this.delegate={iterator:O(z),resultName:N,nextLoc:L},this.method==="next"&&(this.arg=t),m}},e}function hT(t,e,n,i,r,s,o){try{var a=t[s](o),l=a.value}catch(g){n(g);return}a.done?e(l):Promise.resolve(l).then(i,r)}function Jz(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function o(l){hT(s,i,r,o,a,"next",l)}function a(l){hT(s,i,r,o,a,"throw",l)}o(void 0)})}}var tp=Qt({},aO),J5e=tp.version,j5e=tp.render,q5e=tp.unmountComponentAtNode,Uy;try{var $5e=Number((J5e||"").split(".")[0]);$5e>=18&&(Uy=tp.createRoot)}catch{}function CT(t){var e=tp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;e&&gi(e)==="object"&&(e.usingClientEntryPoint=t)}var _b="__rc_react_root__";function eBe(t,e){CT(!0);var n=e[_b]||Uy(e);CT(!1),n.render(t),e[_b]=n}function tBe(t,e){j5e(t,e)}function nBe(t,e){if(Uy){eBe(t,e);return}tBe(t,e)}function iBe(t){return hw.apply(this,arguments)}function hw(){return hw=Jz(o0().mark(function t(e){return o0().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Promise.resolve().then(function(){var r;(r=e[_b])===null||r===void 0||r.unmount(),delete e[_b]}));case 1:case"end":return i.stop()}},t)})),hw.apply(this,arguments)}function rBe(t){q5e(t)}function sBe(t){return Cw.apply(this,arguments)}function Cw(){return Cw=Jz(o0().mark(function t(e){return o0().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(Uy===void 0){i.next=2;break}return i.abrupt("return",iBe(e));case 2:rBe(e);case 3:case"end":return i.stop()}},t)})),Cw.apply(this,arguments)}const oBe=function(t){if(!t)return!1;if(t instanceof Element){if(t.offsetParent)return!0;if(t.getBBox){var e=t.getBBox(),n=e.width,i=e.height;if(n||i)return!0}if(t.getBoundingClientRect){var r=t.getBoundingClientRect(),s=r.width,o=r.height;if(s||o)return!0}}return!1},aBe=t=>{const{componentCls:e,colorPrimary:n}=t;return{[e]:{position:"absolute",background:"transparent",pointerEvents:"none",boxSizing:"border-box",color:`var(--wave-color, ${n})`,boxShadow:"0 0 0 0 currentcolor",opacity:.2,"&.wave-motion-appear":{transition:[`box-shadow 0.4s ${t.motionEaseOutCirc}`,`opacity 2s ${t.motionEaseOutCirc}`].join(","),"&-active":{boxShadow:"0 0 0 6px currentcolor",opacity:0},"&.wave-quick":{transition:[`box-shadow 0.3s ${t.motionEaseInOut}`,`opacity 0.35s ${t.motionEaseInOut}`].join(",")}}}}},lBe=TZ("Wave",t=>[aBe(t)]);function gBe(t){const e=(t||"").match(/rgba?\((\d*), (\d*), (\d*)(, [\d.]*)?\)/);return e&&e[1]&&e[2]&&e[3]?!(e[1]===e[2]&&e[2]===e[3]):!0}function aG(t){return t&&t!=="#fff"&&t!=="#ffffff"&&t!=="rgb(255, 255, 255)"&&t!=="rgba(255, 255, 255, 1)"&&gBe(t)&&!/rgba\((?:\d*, ){3}0\)/.test(t)&&t!=="transparent"}function cBe(t){const{borderTopColor:e,borderColor:n,backgroundColor:i}=getComputedStyle(t);return aG(e)?e:aG(n)?n:aG(i)?i:null}const jz="ant-wave-target";function lG(t){return Number.isNaN(t)?0:t}const uBe=t=>{const{className:e,target:n,component:i}=t,r=H.useRef(null),[s,o]=H.useState(null),[a,l]=H.useState([]),[g,c]=H.useState(0),[u,I]=H.useState(0),[h,C]=H.useState(0),[b,m]=H.useState(0),[f,p]=H.useState(!1),v={left:g,top:u,width:h,height:b,borderRadius:a.map(R=>`${R}px`).join(" ")};s&&(v["--wave-color"]=s);function B(){const R=getComputedStyle(n);o(cBe(n));const w=R.position==="static",{borderLeftWidth:E,borderTopWidth:x}=R;c(w?n.offsetLeft:lG(-parseFloat(E))),I(w?n.offsetTop:lG(-parseFloat(x))),C(n.offsetWidth),m(n.offsetHeight);const{borderTopLeftRadius:W,borderTopRightRadius:T,borderBottomLeftRadius:k,borderBottomRightRadius:_}=R;l([W,T,_,k].map(U=>lG(parseFloat(U))))}if(H.useEffect(()=>{if(n){const R=II(()=>{B(),p(!0)});let w;return typeof ResizeObserver<"u"&&(w=new ResizeObserver(B),w.observe(n)),()=>{II.cancel(R),w==null||w.disconnect()}}},[]),!f)return null;const G=(i==="Checkbox"||i==="Radio")&&(n==null?void 0:n.classList.contains(jz));return H.createElement(VZ,{visible:!0,motionAppear:!0,motionName:"wave-motion",motionDeadline:5e3,onAppearEnd:(R,w)=>{var E;if(w.deadline||w.propertyName==="opacity"){const x=(E=r.current)===null||E===void 0?void 0:E.parentElement;sBe(x).then(()=>{x==null||x.remove()})}return!1}},R=>{let{className:w}=R;return H.createElement("div",{ref:r,className:da(e,{"wave-quick":G},w),style:v})})},IBe=(t,e)=>{var n;const{component:i}=e;if(i==="Checkbox"&&!(!((n=t.querySelector("input"))===null||n===void 0)&&n.checked))return;const r=document.createElement("div");r.style.position="absolute",r.style.left="0px",r.style.top="0px",t==null||t.insertBefore(r,t==null?void 0:t.firstChild),nBe(H.createElement(uBe,Object.assign({},e,{target:t})),r)},dBe=IBe;function ABe(t,e,n){const{wave:i}=H.useContext(Mc),[,r,s]=$0(),o=H1e(g=>{const c=t.current;if(i!=null&&i.disabled||!c)return;const u=c.querySelector(`.${jz}`)||c,{showEffect:I}=i||{};(I||dBe)(u,{className:e,token:r,component:n,event:g,hashId:s})}),a=H.useRef();return g=>{II.cancel(a.current),a.current=II(()=>{o(g)})}}const hBe=t=>{const{children:e,disabled:n,component:i}=t,{getPrefixCls:r}=H.useContext(Mc),s=H.useRef(null),o=r("wave"),[,a]=lBe(o),l=ABe(s,da(o,a),i);if(yt.useEffect(()=>{const c=s.current;if(!c||c.nodeType!==1||n)return;const u=I=>{!oBe(I.target)||!c.getAttribute||c.getAttribute("disabled")||c.disabled||c.className.includes("disabled")||c.className.includes("-leave")||l(I)};return c.addEventListener("click",u,!0),()=>{c.removeEventListener("click",u,!0)}},[n]),!yt.isValidElement(e))return e??null;const g=OK(e)?PK(e.ref,s):s;return Qz(e,{ref:g})},CBe=hBe,fBe=t=>{const e=yt.useContext(Yy);return yt.useMemo(()=>t?typeof t=="string"?t??e:t instanceof Function?t(e):e:e,[t,e])},pBe=fBe;globalThis&&globalThis.__rest;const mBe=H.createContext(null),bBe=(t,e)=>{const n=H.useContext(mBe),i=H.useMemo(()=>{if(!n)return"";const{compactDirection:r,isFirstItem:s,isLastItem:o}=n,a=r==="vertical"?"-vertical-":"-";return da(`${t}-compact${a}item`,{[`${t}-compact${a}first-item`]:s,[`${t}-compact${a}last-item`]:o,[`${t}-compact${a}item-rtl`]:e==="rtl"})},[t,e,n]);return{compactSize:n==null?void 0:n.compactSize,compactDirection:n==null?void 0:n.compactDirection,compactItemClassnames:i}};var vBe=globalThis&&globalThis.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};const qz=H.createContext(void 0),yBe=t=>{const{getPrefixCls:e,direction:n}=H.useContext(Mc),{prefixCls:i,size:r,className:s}=t,o=vBe(t,["prefixCls","size","className"]),a=e("btn-group",i),[,,l]=$0();let g="";switch(r){case"large":g="lg";break;case"small":g="sm";break}const c=da(a,{[`${a}-${g}`]:g,[`${a}-rtl`]:n==="rtl"},s,l);return H.createElement(qz.Provider,{value:r},H.createElement("div",Object.assign({},o,{className:c})))},BBe=yBe,fT=/^[\u4e00-\u9fa5]{2}$/,fw=fT.test.bind(fT);function pT(t){return typeof t=="string"}function gG(t){return t==="text"||t==="link"}function GBe(t,e){if(t==null)return;const n=e?" ":"";return typeof t!="string"&&typeof t!="number"&&pT(t.type)&&fw(t.props.children)?Qz(t,{children:t.props.children.split("").join(n)}):pT(t)?fw(t)?yt.createElement("span",null,t.split("").join(n)):yt.createElement("span",null,t):z5e(t)?yt.createElement("span",null,t):t}function SBe(t,e){let n=!1;const i=[];return yt.Children.forEach(t,r=>{const s=typeof r,o=s==="string"||s==="number";if(n&&o){const a=i.length-1,l=i[a];i[a]=`${l}${r}`}else i.push(r);n=o}),yt.Children.map(i,r=>GBe(r,e))}const wBe=H.forwardRef((t,e)=>{const{className:n,style:i,children:r,prefixCls:s}=t,o=da(`${s}-icon`,n);return yt.createElement("span",{ref:e,className:o,style:i},r)}),$z=wBe,mT=H.forwardRef((t,e)=>{let{prefixCls:n,className:i,style:r,iconClassName:s}=t;const o=da(`${n}-loading-icon`,i);return yt.createElement($z,{prefixCls:n,className:o,style:r,ref:e},yt.createElement(Q5e,{className:s}))}),cG=()=>({width:0,opacity:0,transform:"scale(0)"}),uG=t=>({width:t.scrollWidth,opacity:1,transform:"scale(1)"}),RBe=t=>{const{prefixCls:e,loading:n,existIcon:i,className:r,style:s}=t,o=!!n;return i?yt.createElement(mT,{prefixCls:e,className:r,style:s}):yt.createElement(VZ,{visible:o,motionName:`${e}-loading-icon-motion`,removeOnLeave:!0,onAppearStart:cG,onAppearActive:uG,onEnterStart:cG,onEnterActive:uG,onLeaveStart:uG,onLeaveActive:cG},(a,l)=>{let{className:g,style:c}=a;return yt.createElement(mT,{prefixCls:e,className:r,style:Object.assign(Object.assign({},s),c),ref:l,iconClassName:g})})},xBe=RBe,bT=(t,e)=>({[`> span, > ${t}`]:{"&:not(:last-child)":{[`&, & > ${t}`]:{"&:not(:disabled)":{borderInlineEndColor:e}}},"&:not(:first-child)":{[`&, & > ${t}`]:{"&:not(:disabled)":{borderInlineStartColor:e}}}}}),ZBe=t=>{const{componentCls:e,fontSize:n,lineWidth:i,groupBorderColor:r,colorErrorHover:s}=t;return{[`${e}-group`]:[{position:"relative",display:"inline-flex",[`> span, > ${e}`]:{"&:not(:last-child)":{[`&, & > ${e}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},"&:not(:first-child)":{marginInlineStart:-i,[`&, & > ${e}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}},[e]:{position:"relative",zIndex:1,"&:hover,\n          &:focus,\n          &:active":{zIndex:2},"&[disabled]":{zIndex:0}},[`${e}-icon-only`]:{fontSize:n}},bT(`${e}-primary`,r),bT(`${e}-danger`,s)]}},EBe=ZBe,WBe=t=>{const{componentCls:e,iconCls:n,fontWeight:i}=t;return{[e]:{outline:"none",position:"relative",display:"inline-block",fontWeight:i,whiteSpace:"nowrap",textAlign:"center",backgroundImage:"none",backgroundColor:"transparent",border:`${t.lineWidth}px ${t.lineType} transparent`,cursor:"pointer",transition:`all ${t.motionDurationMid} ${t.motionEaseInOut}`,userSelect:"none",touchAction:"manipulation",lineHeight:t.lineHeight,color:t.colorText,"&:disabled > *":{pointerEvents:"none"},"> span":{display:"inline-block"},[`${e}-icon`]:{lineHeight:0},[`> ${n} + span, > span + ${n}`]:{marginInlineStart:t.marginXS},[`&:not(${e}-icon-only) > ${e}-icon`]:{[`&${e}-loading-icon, &:not(:last-child)`]:{marginInlineEnd:t.marginXS}},"> a":{color:"currentColor"},"&:not(:disabled)":Object.assign({},U1e(t)),[`&-icon-only${e}-compact-item`]:{flex:"none"},[`&-compact-item${e}-primary`]:{[`&:not([disabled]) + ${e}-compact-item${e}-primary:not([disabled])`]:{position:"relative","&:before":{position:"absolute",top:-t.lineWidth,insetInlineStart:-t.lineWidth,display:"inline-block",width:t.lineWidth,height:`calc(100% + ${t.lineWidth*2}px)`,backgroundColor:t.colorPrimaryHover,content:'""'}}},"&-compact-vertical-item":{[`&${e}-primary`]:{[`&:not([disabled]) + ${e}-compact-vertical-item${e}-primary:not([disabled])`]:{position:"relative","&:before":{position:"absolute",top:-t.lineWidth,insetInlineStart:-t.lineWidth,display:"inline-block",width:`calc(100% + ${t.lineWidth*2}px)`,height:t.lineWidth,backgroundColor:t.colorPrimaryHover,content:'""'}}}}}}},sg=(t,e,n)=>({[`&:not(:disabled):not(${t}-disabled)`]:{"&:hover":e,"&:active":n}}),NBe=t=>({minWidth:t.controlHeight,paddingInlineStart:0,paddingInlineEnd:0,borderRadius:"50%"}),MBe=t=>({borderRadius:t.controlHeight,paddingInlineStart:t.controlHeight/2,paddingInlineEnd:t.controlHeight/2}),TBe=t=>({cursor:"not-allowed",borderColor:t.borderColorDisabled,color:t.colorTextDisabled,backgroundColor:t.colorBgContainerDisabled,boxShadow:"none"}),a0=(t,e,n,i,r,s,o,a)=>({[`&${t}-background-ghost`]:Object.assign(Object.assign({color:n||void 0,backgroundColor:e,borderColor:i||void 0,boxShadow:"none"},sg(t,Object.assign({backgroundColor:e},o),Object.assign({backgroundColor:e},a))),{"&:disabled":{cursor:"not-allowed",color:r||void 0,borderColor:s||void 0}})}),kZ=t=>({[`&:disabled, &${t.componentCls}-disabled`]:Object.assign({},TBe(t))}),eU=t=>Object.assign({},kZ(t)),Xb=t=>({[`&:disabled, &${t.componentCls}-disabled`]:{cursor:"not-allowed",color:t.colorTextDisabled}}),tU=t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},eU(t)),{backgroundColor:t.defaultBg,borderColor:t.defaultBorderColor,color:t.defaultColor,boxShadow:t.defaultShadow}),sg(t.componentCls,{color:t.colorPrimaryHover,borderColor:t.colorPrimaryHover},{color:t.colorPrimaryActive,borderColor:t.colorPrimaryActive})),a0(t.componentCls,t.ghostBg,t.defaultGhostColor,t.defaultGhostBorderColor,t.colorTextDisabled,t.colorBorder)),{[`&${t.componentCls}-dangerous`]:Object.assign(Object.assign(Object.assign({color:t.colorError,borderColor:t.colorError},sg(t.componentCls,{color:t.colorErrorHover,borderColor:t.colorErrorBorderHover},{color:t.colorErrorActive,borderColor:t.colorErrorActive})),a0(t.componentCls,t.ghostBg,t.colorError,t.colorError,t.colorTextDisabled,t.colorBorder)),kZ(t))}),FBe=t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},eU(t)),{color:t.primaryColor,backgroundColor:t.colorPrimary,boxShadow:t.primaryShadow}),sg(t.componentCls,{color:t.colorTextLightSolid,backgroundColor:t.colorPrimaryHover},{color:t.colorTextLightSolid,backgroundColor:t.colorPrimaryActive})),a0(t.componentCls,t.ghostBg,t.colorPrimary,t.colorPrimary,t.colorTextDisabled,t.colorBorder,{color:t.colorPrimaryHover,borderColor:t.colorPrimaryHover},{color:t.colorPrimaryActive,borderColor:t.colorPrimaryActive})),{[`&${t.componentCls}-dangerous`]:Object.assign(Object.assign(Object.assign({backgroundColor:t.colorError,boxShadow:t.dangerShadow,color:t.dangerColor},sg(t.componentCls,{backgroundColor:t.colorErrorHover},{backgroundColor:t.colorErrorActive})),a0(t.componentCls,t.ghostBg,t.colorError,t.colorError,t.colorTextDisabled,t.colorBorder,{color:t.colorErrorHover,borderColor:t.colorErrorHover},{color:t.colorErrorActive,borderColor:t.colorErrorActive})),kZ(t))}),VBe=t=>Object.assign(Object.assign({},tU(t)),{borderStyle:"dashed"}),LBe=t=>Object.assign(Object.assign(Object.assign({color:t.colorLink},sg(t.componentCls,{color:t.colorLinkHover,backgroundColor:t.linkHoverBg},{color:t.colorLinkActive})),Xb(t)),{[`&${t.componentCls}-dangerous`]:Object.assign(Object.assign({color:t.colorError},sg(t.componentCls,{color:t.colorErrorHover},{color:t.colorErrorActive})),Xb(t))}),kBe=t=>Object.assign(Object.assign(Object.assign({},sg(t.componentCls,{color:t.colorText,backgroundColor:t.textHoverBg},{color:t.colorText,backgroundColor:t.colorBgTextActive})),Xb(t)),{[`&${t.componentCls}-dangerous`]:Object.assign(Object.assign({color:t.colorError},Xb(t)),sg(t.componentCls,{color:t.colorErrorHover,backgroundColor:t.colorErrorBg},{color:t.colorErrorHover,backgroundColor:t.colorErrorBg}))}),HBe=t=>{const{componentCls:e}=t;return{[`${e}-default`]:tU(t),[`${e}-primary`]:FBe(t),[`${e}-dashed`]:VBe(t),[`${e}-link`]:LBe(t),[`${e}-text`]:kBe(t),[`${e}-ghost`]:a0(t.componentCls,t.ghostBg,t.colorBgContainer,t.colorBgContainer,t.colorTextDisabled,t.colorBorder)}},HZ=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const{componentCls:n,controlHeight:i,fontSize:r,lineHeight:s,lineWidth:o,borderRadius:a,buttonPaddingHorizontal:l,iconCls:g}=t,c=Math.max(0,(i-r*s)/2-o),u=`${n}-icon-only`;return[{[`${n}${e}`]:{fontSize:r,height:i,padding:`${c}px ${l}px`,borderRadius:a,[`&${u}`]:{width:i,paddingInlineStart:0,paddingInlineEnd:0,[`&${n}-round`]:{width:"auto"},[g]:{fontSize:t.buttonIconOnlyFontSize}},[`&${n}-loading`]:{opacity:t.opacityLoading,cursor:"default"},[`${n}-loading-icon`]:{transition:`width ${t.motionDurationSlow} ${t.motionEaseInOut}, opacity ${t.motionDurationSlow} ${t.motionEaseInOut}`}}},{[`${n}${n}-circle${e}`]:NBe(t)},{[`${n}${n}-round${e}`]:MBe(t)}]},_Be=t=>HZ(WA(t,{fontSize:t.contentFontSize})),XBe=t=>{const e=WA(t,{controlHeight:t.controlHeightSM,fontSize:t.contentFontSizeSM,padding:t.paddingXS,buttonPaddingHorizontal:t.paddingInlineSM,borderRadius:t.borderRadiusSM,buttonIconOnlyFontSize:t.onlyIconSizeSM});return HZ(e,`${t.componentCls}-sm`)},YBe=t=>{const e=WA(t,{controlHeight:t.controlHeightLG,fontSize:t.contentFontSizeLG,buttonPaddingHorizontal:t.paddingInlineLG,borderRadius:t.borderRadiusLG,buttonIconOnlyFontSize:t.onlyIconSizeLG});return HZ(e,`${t.componentCls}-lg`)},KBe=t=>{const{componentCls:e}=t;return{[e]:{[`&${e}-block`]:{width:"100%"}}}},nU=t=>{const{paddingInline:e,onlyIconSize:n}=t;return WA(t,{buttonPaddingHorizontal:e,buttonIconOnlyFontSize:n})},iU=t=>({fontWeight:400,defaultShadow:`0 ${t.controlOutlineWidth}px 0 ${t.controlTmpOutline}`,primaryShadow:`0 ${t.controlOutlineWidth}px 0 ${t.controlOutline}`,dangerShadow:`0 ${t.controlOutlineWidth}px 0 ${t.colorErrorOutline}`,primaryColor:t.colorTextLightSolid,dangerColor:t.colorTextLightSolid,borderColorDisabled:t.colorBorder,defaultGhostColor:t.colorBgContainer,ghostBg:"transparent",defaultGhostBorderColor:t.colorBgContainer,paddingInline:t.paddingContentHorizontal-t.lineWidth,paddingInlineLG:t.paddingContentHorizontal-t.lineWidth,paddingInlineSM:8-t.lineWidth,onlyIconSize:t.fontSizeLG,onlyIconSizeSM:t.fontSizeLG-2,onlyIconSizeLG:t.fontSizeLG+2,groupBorderColor:t.colorPrimaryHover,linkHoverBg:"transparent",textHoverBg:t.colorBgTextHover,defaultColor:t.colorText,defaultBg:t.colorBgContainer,defaultBorderColor:t.colorBorder,defaultBorderColorDisabled:t.colorBorder,contentFontSize:t.fontSize,contentFontSizeSM:t.fontSize,contentFontSizeLG:t.fontSizeLG}),zBe=TZ("Button",t=>{const e=nU(t);return[WBe(e),XBe(e),_Be(e),YBe(e),KBe(e),HBe(e),EBe(e)]},iU);function UBe(t,e,n){const{focusElCls:i,focus:r,borderElCls:s}=n,o=s?"> *":"",a=["hover",r?"focus":null,"active"].filter(Boolean).map(l=>`&:${l} ${o}`).join(",");return{[`&-item:not(${e}-last-item)`]:{marginInlineEnd:-t.lineWidth},"&-item":Object.assign(Object.assign({[a]:{zIndex:2}},i?{[`&${i}`]:{zIndex:2}}:{}),{[`&[disabled] ${o}`]:{zIndex:0}})}}function DBe(t,e,n){const{borderElCls:i}=n,r=i?`> ${i}`:"";return{[`&-item:not(${e}-first-item):not(${e}-last-item) ${r}`]:{borderRadius:0},[`&-item:not(${e}-last-item)${e}-first-item`]:{[`& ${r}, &${t}-sm ${r}, &${t}-lg ${r}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&-item:not(${e}-first-item)${e}-last-item`]:{[`& ${r}, &${t}-sm ${r}, &${t}-lg ${r}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}}}function PBe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{focus:!0};const{componentCls:n}=t,i=`${n}-compact`;return{[i]:Object.assign(Object.assign({},UBe(t,i,e)),DBe(n,i,e))}}function OBe(t,e){return{[`&-item:not(${e}-last-item)`]:{marginBottom:-t.lineWidth},"&-item":{"&:hover,&:focus,&:active":{zIndex:2},"&[disabled]":{zIndex:0}}}}function QBe(t,e){return{[`&-item:not(${e}-first-item):not(${e}-last-item)`]:{borderRadius:0},[`&-item${e}-first-item:not(${e}-last-item)`]:{[`&, &${t}-sm, &${t}-lg`]:{borderEndEndRadius:0,borderEndStartRadius:0}},[`&-item${e}-last-item:not(${e}-first-item)`]:{[`&, &${t}-sm, &${t}-lg`]:{borderStartStartRadius:0,borderStartEndRadius:0}}}}function JBe(t){const e=`${t.componentCls}-compact-vertical`;return{[e]:Object.assign(Object.assign({},OBe(t,e)),QBe(t.componentCls,e))}}const jBe=Q1e(["Button","compact"],t=>{const e=nU(t);return[PBe(e),JBe(e)]},iU);var qBe=globalThis&&globalThis.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function $Be(t){if(typeof t=="object"&&t){const e=t==null?void 0:t.delay;return{loading:!1,delay:!Number.isNaN(e)&&typeof e=="number"?e:0}}return{loading:!!t,delay:0}}const eGe=(t,e)=>{var n,i;const{loading:r=!1,prefixCls:s,type:o="default",danger:a,shape:l="default",size:g,styles:c,disabled:u,className:I,rootClassName:h,children:C,icon:b,ghost:m=!1,block:f=!1,htmlType:p="button",classNames:v,style:B={}}=t,G=qBe(t,["loading","prefixCls","type","danger","shape","size","styles","disabled","className","rootClassName","children","icon","ghost","block","htmlType","classNames","style"]),{getPrefixCls:R,autoInsertSpaceInButton:w,direction:E,button:x}=H.useContext(Mc),W=R("btn",s),[T,k]=zBe(W),_=H.useContext(Nz),U=u??_,O=H.useContext(qz),Y=H.useMemo(()=>$Be(r),[r]),[z,N]=H.useState(Y.loading),[L,V]=H.useState(!1),X=PK(e,H.createRef()),J=H.Children.count(C)===1&&!b&&!gG(o);H.useEffect(()=>{let Be=null;Y.delay>0?Be=setTimeout(()=>{Be=null,N(!0)},Y.delay):N(Y.loading);function Ae(){Be&&(clearTimeout(Be),Be=null)}return Ae},[Y]),H.useEffect(()=>{if(!X||!X.current||w===!1)return;const Be=X.current.textContent;J&&fw(Be)?L||V(!0):L&&V(!1)},[X]);const re=Be=>{const{onClick:Ae}=t;if(z||U){Be.preventDefault();return}Ae==null||Ae(Be)},se=w!==!1,{compactSize:le,compactItemClassnames:ae}=bBe(W,E),ce={large:"lg",small:"sm",middle:void 0},Ee=pBe(Be=>{var Ae,De;return(De=(Ae=g??le)!==null&&Ae!==void 0?Ae:O)!==null&&De!==void 0?De:Be}),Fe=Ee&&ce[Ee]||"",oe=z?"loading":b,D=Fve(G,["navigate"]),fe=da(W,k,{[`${W}-${l}`]:l!=="default"&&l,[`${W}-${o}`]:o,[`${W}-${Fe}`]:Fe,[`${W}-icon-only`]:!C&&C!==0&&!!oe,[`${W}-background-ghost`]:m&&!gG(o),[`${W}-loading`]:z,[`${W}-two-chinese-chars`]:L&&se&&!z,[`${W}-block`]:f,[`${W}-dangerous`]:!!a,[`${W}-rtl`]:E==="rtl"},ae,I,h,x==null?void 0:x.className),Ce=Object.assign(Object.assign({},x==null?void 0:x.style),B),pe=da(v==null?void 0:v.icon,(n=x==null?void 0:x.classNames)===null||n===void 0?void 0:n.icon),be=Object.assign(Object.assign({},(c==null?void 0:c.icon)||{}),((i=x==null?void 0:x.styles)===null||i===void 0?void 0:i.icon)||{}),Ue=b&&!z?yt.createElement($z,{prefixCls:W,className:pe,style:be},b):yt.createElement(xBe,{existIcon:!!b,prefixCls:W,loading:!!z}),me=C||C===0?SBe(C,J&&se):null;if(D.href!==void 0)return T(yt.createElement("a",Object.assign({},D,{className:da(fe,{[`${W}-disabled`]:U}),style:Ce,onClick:re,ref:X}),Ue,me));let we=yt.createElement("button",Object.assign({},G,{type:p,className:fe,style:Ce,onClick:re,disabled:U,ref:X}),Ue,me,ae&&yt.createElement(jBe,{key:"compact",prefixCls:W}));return gG(o)||(we=yt.createElement(CBe,{component:"Button",disabled:!!z},we)),T(we)},_Z=H.forwardRef(eGe);_Z.Group=BBe;_Z.__ANT_BUTTON=!0;const tGe=_Z,vT=1,Bn={STACK_ROTATION_SPEED:.004,SPAWN_OFFSET:6,SPEED:.1,BLOCK_HEIGHT:vT,INITIAL_BLOCK_SIZE:[4,vT,4],INITIAL_BLOCK_POS:{x:0,y:0,z:0},INITIAL_SCENE_POS_Y:-1},IG=({args:t=[2,.4,2],position:e=[0,0,0],active:n=!1,i,spawnOffset:r,drop:s,setDrop:o,setLastBlockData:a,stack:l=[],gameOver:g,color:c,isTrimmedBit:u=!1})=>{const I=H.useRef();let h=!0,C,b;return H.useEffect(()=>{I.current.args=t},[]),GI(()=>{C=i%2===0?"x":"z",n&&!g?(b=i%2!==0?"x":"z",l.length>1&&(I.current.position[b]=l[i-1].pos[b]),I.current.position[C]<=-r?h=!0:I.current.position[C]>=r&&(h=!1),h?I.current.position[C]+=Bn.SPEED:I.current.position[C]-=Bn.SPEED,s&&(a({pos:I.current.position,args:I.current.args,direction:C}),o(!1))):(g&&i===l.length-1||u)&&(I.current.position.y-=Bn.SPEED*2,I.current.rotation[C]-=Bn.SPEED/2)}),ne.jsx("mesh",{ref:I,position:e,rotation:[0,0,0],children:ne.jsx(hve,{args:t,children:ne.jsx("meshStandardMaterial",{color:c})})})},nGe=({setScore:t,canvasRef:e,setGameOver:n,gameOver:i,setStack:r,stack:s,isPlaying:o,setIsPlaying:a,getColor:l})=>{const g=H.useRef(),c=H.useRef(!1),u=H.useRef(!0),I=H.useRef(Bn.INITIAL_BLOCK_SIZE),[h,C]=H.useState([]),[b,m]=H.useState(Bn.INITIAL_SCENE_POS_Y),[f,p]=H.useState(!1),[v,B]=H.useState();let G,R,w,E,x,W={},T,k,_,U,O,Y,z,N,L,V,M,X,J,re,se,le;H.useEffect(()=>(e.current.addEventListener("click",ce),document.addEventListener("keyup",({code:oe})=>{(oe==="Space"||oe==="ArrowUp"||oe==="ArrowDown"||oe==="Enter")&&ce()}),()=>{document.removeEventListener("click",ce),document.removeEventListener("keyup",ce)}),[]),H.useEffect(()=>{(v&&!f&&o||s.length===0&&o)&&(w=s,_=v,U=s.length>1?s[s.length-2]:{pos:Bn.INITIAL_BLOCK_POS,args:Bn.INITIAL_BLOCK_SIZE},v&&(O=ae(v,U),_.args=O.args,_.pos.x+=O.tempOffsetX,_.pos.z+=O.tempOffsetZ,_.isDead=O.isDead),!c.current&&o&&(w[w.length-1]=_,r(oe=>[...oe,void 0]),m(oe=>oe-Bn.BLOCK_HEIGHT)))},[f,o,c.current]),H.useEffect(()=>{i||(C([]),r([]),m(Bn.INITIAL_SCENE_POS_Y),p(!1),t(0),I.current=Bn.INITIAL_BLOCK_SIZE,c.current=!1)},[i]),GI(()=>{g.current.rotation.y+=Bn.STACK_ROTATION_SPEED,o?g.current.position.y!==0&&(g.current.position.y=0):(g.current.position.y>s.length*Bn.BLOCK_HEIGHT?u.current=!1:g.current.position.y<0-Bn.BLOCK_HEIGHT&&(u.current=!0),u.current?g.current.position.y+=Bn.STACK_ROTATION_SPEED*10:g.current.position.y-=Bn.STACK_ROTATION_SPEED*10)});const ae=(oe,D)=>(Y=oe.direction,z=Y==="x"?oe.args[0]:oe.args[2],N=oe.pos[Y]-D.pos[Y],L=Math.abs(N),V=z-L,W.x=oe.direction==="x"?V:oe.args[0],W.z=oe.direction==="z"?V:oe.args[2],T=(oe.pos.x-D.pos.x)/-2,k=(oe.pos.z-D.pos.z)/-2,V<0&&!c.current?(n(!0),a(!1),B(void 0),c.current=!0,{args:[oe.args[0],Bn.BLOCK_HEIGHT,oe.args[2]],tempOffsetX:0,tempOffsetZ:0}):(M=(V/2+L/2)*Math.sign(N),X=Y==="x"?oe.pos.x+M:oe.pos.x,J=Y==="z"?oe.pos.z+M:oe.pos.z,re=Y==="x"?L:oe.args[0],se=Y==="z"?L:oe.args[2],le={position:[X,Bn.INITIAL_SCENE_POS_Y,J],args:[re,Bn.BLOCK_HEIGHT,se]},C(fe=>[...fe,le]),t(fe=>fe+1),{args:[W.x,Bn.BLOCK_HEIGHT,W.z],tempOffsetX:T,tempOffsetZ:k})),ce=()=>{p(!0)},Ee=s.map((oe,D)=>(oe?(I.current=oe==null?void 0:oe.args,E=oe==null?void 0:oe.pos.x,x=oe==null?void 0:oe.pos.z):(E=void 0,x=void 0),G=D===s.length-1,R=D%2===0?[E||Bn.SPAWN_OFFSET,Bn.INITIAL_SCENE_POS_Y-(s.length-1-D)*Bn.BLOCK_HEIGHT,x||0]:[E||0,Bn.INITIAL_SCENE_POS_Y-(s.length-1-D)*Bn.BLOCK_HEIGHT,x||-Bn.SPAWN_OFFSET],ne.jsx(IG,{position:R,args:I.current,active:G,i:D,spawnOffset:Bn.SPAWN_OFFSET,drop:f,setDrop:p,setLastBlockData:B,stack:s,gameOver:i,color:l(D)},D))),Fe=h.map((oe,D)=>ne.jsx(IG,{position:oe.position,args:oe.args,i:D,isTrimmedBit:!0,color:l(D,!0)},D));return ne.jsxs("mesh",{ref:g,children:[Ee,Fe,ne.jsx(IG,{position:[0,b,0],args:Bn.INITIAL_BLOCK_SIZE,currentGround:b,gameOver:i,isBase:!0,color:l(0)})]})},iGe=({gameOver:t,setGameOver:e,score:n,setScore:i,canvasRef:r,isEnvCentral:s})=>{const o=H.useRef(),[a,l]=H.useState(!1),[g,c]=H.useState([]),u=30,I=(b,m=!1)=>`hsl(${b*20}, ${m?"50%":"100%"}, 80%)`,h=({visible:b=!0})=>{const m=()=>{e(!1),l(!0)};return ne.jsx(Cce,{center:!0,wrapperClass:"how-to-play-component-wrapper",children:ne.jsx("div",{style:{display:b?"block":"none"},className:"how-to-play-component-container",children:ne.jsxs("div",{className:"how-to-play-inner-container",children:[ne.jsx("p",{className:"title",children:t?n>=u?"Gagné !":"Perdu !":s?"Test de capacité":"Entrainement"}),ne.jsx("hr",{}),ne.jsx("p",{children:t?n>=u?s?"Test de pilotage validé. Code primaire d'accès à la navigation : "+JV:"Test de réflexe validé. Vous pouvez lancer le test d'accès à la navigation sur l'ordinateur central.":"Vos réflexes sont encore impactés par votre sortie de l'hypersommeil. Continuez de vous entrainer...":"Empilez les blocs les uns sur les autres et atteignez un score de "+u+"."}),ne.jsxs("p",{children:["Vous pouvez utiliser les touches suivantes:",ne.jsx("span",{className:"keys",children:" Click de souris "})," |",ne.jsx("span",{className:"keys",children:" Touche Entrée "})," |",ne.jsx("span",{className:"keys",children:" Flèche du bas "})," | pour empiler les blocs."]}),ne.jsx(tGe,{className:"play-retry-button",onClick:m,children:t?"Recommencer":"Démarrer"})]})})})},C=({color:b="cyan"})=>{const m=H.useRef();return ne.jsxs("mesh",{ref:m,children:[ne.jsx(M7,{color:b,fontSize:.1,position:[0,1.7,2],children:"SCORE"}),ne.jsx(M7,{color:b,fontSize:.3,position:[0,1.5,2],children:n})]})};return ne.jsx("mesh",{ref:o,children:ne.jsx(H.Suspense,{fallback:null,children:ne.jsxs(oce,{children:[ne.jsx(dve,{enablePan:!1,enableZoom:!1,minPolarAngle:Math.PI/2,maxPolarAngle:Math.PI/2,autoRotate:!0,autoRotateSpeed:1,enableRotate:!1}),ne.jsx("ambientLight",{intensity:.3}),ne.jsx("spotLight",{position:[0,10,0],angle:.5,intensity:.8}),ne.jsx("pointLight",{position:[0,-1,2],intensity:.8}),ne.jsx(T7,{scale:100,size:30,speed:2,noise:10}),ne.jsx(T7,{scale:50,size:20,color:I(g.length)}),ne.jsxs(pbe,{children:[ne.jsx(C,{}),ne.jsx(h,{visible:!a}),ne.jsx("mesh",{rotation:[Math.PI/5,-Math.PI/5,0],position:[0,1,-2],children:ne.jsx(nGe,{setScore:i,canvasRef:r,setGameOver:e,gameOver:t,stack:g,setStack:c,isPlaying:a,setIsPlaying:l,getColor:I})})]})]})})})},rGe=({isEnvCentral:t})=>{const e=H.useRef(),[n,i]=H.useState(!1),[r,s]=H.useState(0);return H.useEffect(()=>{},[n]),ne.jsx(qle,{className:"canvas",ref:e,children:ne.jsx(iGe,{isEnvCentral:t,gameOver:n,setGameOver:i,score:r,setScore:s,canvasRef:e})})},sGe=({isEnvCentral:t})=>ne.jsxs("div",{className:"roles-container",children:[ne.jsx("div",{className:"roles-content",children:t?"Vérification réflexes et perception après sortie de l'hypersommeil :":"Entrainement réflexes pour test de pilotage"}),ne.jsx(rGe,{isEnvCentral:t})]}),oGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAApESURBVHgB7Z3PleO4EYd/s/Z9OwOXI5h2BEtnMBkMM3BnQDiCGUegdgSeDKQ9+TjtCKS9+dbrCMaqpTCrpvgHKIpAgazvPbRed5NgCfwIgiAIvoMxxsM5PV7S+8sn/42ulvn1nE6X9J9zOpzTy+XvhhFFdU77c3o9p2/CxOvXMIwJuCZrME+2vnS85GsYN1RoBfm2YOL8axgG2lruE+Il+oq2nfdVsO4Ob9uIxsYgyMThdR4ueTwI8zjC5NskBNmp9Vo6zxz5HmFsBsL9pPNI5eMLGZNvAxDuL53H5DN6ISwnncfkM95AWF46j8ln/AYhnXQek2/jENJL5zH5Ngohn3Qek29jEPJL5zH5NgJBj3Qek2/lEPRJ5zH5VgpBr3Qek29lEPRL5zH5VgKhHOk8Jl/hEMqTzmPyFQqhXOk8Jl9hEMqXzmPyFQJhPdJ5TL4CqLEu6Txz5CMYSaixLuk8EvkcjKTUWJd0nhj5nmBkoca6pPOEyFfDyIrDuqTzjMlXw1CBw7qk8/TJV8NQhcO6pPNcy1fDUMnapPP46dIMwzAMwzAMwzAMwzAMwzAMwzAMw1gH77A8dPk8QQ+E9t0WOfn1nL7AWARC+2DOEXqeCyAs/zKV0NTAuDuEtztYg3zSB2q2JB+hLaMiR8MQ+muVnPJplE6bfITf91txj04Sxk9lueTTKp1PH5EXlqz7AsFi5COEtZ9Sy7eDbulyy9cnXTHyEeIa7amGqe+AWTKsXb4x6dTLR5BdKe6wLA0gFiBnqpCGEOnUykfQOZdJI4hJS0qxkz8g/qXQauQjmHSlypd1oqA5dy7onPaIv0h4Oae/ou25X4IGsvlE/oll+QnxZcVl9Bcsd9eH5eN9GCsSx8X78AWJIayrpnNYHq0vVS5mijSCTumeBDGlks5j8gkh6JTuoyCm1NJ5uBwkZbhZ+Qg6pfsgiCmXdB6CyRcEQe/0r7FdArml8xBkZfoFy6JGPoLuOYdj4/oMPRDiy/aA5ckuH0H/RNcxcT1DH4S4Mj4gDdnkI5Qxu3rJ0nkI4WV9QDqSy0coZ0r/0NhSxxVL6EXSAWlJNhu99HI/16SIofFpp4JO8Zgk/Y+fBBvIOROniZcGqXz7kMxrQca5p39NKV6F9g7JDm2B8meN+/StVdAtHiOV72kq42NkhhrmHE4hHqEVbSz/HeYJWEG/eIxEvleMeFJHZqZBOiY0XikxgyWPkMtXBW7jgPzc9Q1Ex4hMtEjHhMYsgRB/FuDlJWVTBeZ/gA5i5eut9WLud2qSjgmNW8Iz+nc8t1mqy+cREUf3CBXKEo+Jlc91M/gSuKI26ZilxCOEC/WMgKN7ggrlicfEyPe1u/Jr4EoaO2GXEs9hotCu4HLplmGNOCqUKR4TIx/xCj+g/cJTQr1g2eHqGune8vnHyLJcLt2h84TtEDMUnpt138UbY4vSMT92fj9NLN8t9D9hW4TK955/sHhjN3O3Kp0hI0S+in+weD8OLGDSGRKm5CP+weL9ueefJp0xh0n5WLxuW8SkM+7BqHw/DCxs0gH/6/w+deX/MLH+FvE+nTp/p654XHh/g8F0D77HieWrzu8nGAz7RJ2//Va2fZ3HDcphqQ7kGrd3I2hgWerZXoU4KpTbgTwEezTYiXwa+Gcp8i0lXt/diCNua74Kt/drj4inRtj3+IIyGJLu+74Yu09bgnyhQ5YI8Txh+PbhHsMjV2rEM7StbtpBP2PSvfqFPmP8i2qX74SwHTbVRhviOTB/nxxkTO2HufmnYkw6Tge/YI3pL6tZvj3CdlgNOaFSTA7xHiF0hNCcbSzNlHRvDpwHhH1hrfI9Iyz+z5hHhfZo7Tt1sDTSGtUTOrqjgk5CpLuJfx+4kkb5QttGe9wHPlCrS3rEfYaKhR7836BzEuxQ6Y7dFUN3nkb5PiAs7lfopeTvECodp1135b6ug1Lki6ktKujkGWHxH6CLGOk4kV/xj5dPP5Ax9K6Fu3z+Hfnh2H9B2Pg3rlkOkEFoxaXOtnjbL5d0goyfApc7QA8snYtY/mcMlA8hfq45LTVf6FVn7KmKa1P+jsfA/PkCoUZcn2GF8PKuoAMuk2+RicYydIIMNchX4b47zwsnmfSR0xHh5fIcmKeW9h1/r9jy2IVkLJmiILSQlyKmjbqfyIuvGo+IL4MhAWlkWxQRt4ZbZbyfJWUQdOVPkB3pueXbIzxWGsjjI8ZrnAPas0J9lRz6+/euC36oC6SOiLlGXhrIDj5CBLVwIznlqxAe565n/Y8YFoe7m6aOWkJbbkf0S9sn3zEw3tyn2QYyH0R3WWL69rTIF1NT09V6jwPL8EVLbAcxob/d1h1WFVO+O+SjgcwDhxk44UZzyecQHuO/LusQ+mueGvNwPXnuJ7YZcpCkpEEG6TxOuPEc8sV2hFfor51q3AfXk/cT4ka8HJCHBhml8zhhEDnke0Z4fEcsXHBoa9br/GMv3Cqkp4EC6TxOGExq+QiyOL2I9ya2Fr5OX5GeBoqk8zjIgkotX+idjG6qsQxOGE+FtDRQKJ3HQRZcSvkktcySXRYxAxl82iEtDRRL53HQL19sd5BkTrtQHhFfVoR0NIiPL7l0Hgf98u0RF9sScwAS4mtfh3Q0iIstq3QeB93ySWqaHe4HQTaHcioaxJdPduk8DrLgPyANkjswO8yHEC9d9GuYZtAgvlzUSOdx0B38HvEFzP1v0tMuQTbCJdUTZNLboQ4KcdAbPAskEYHbfIQ4Ksj67eY+BRcDIb48HBTjoDd4bu9JhOAdRIHbkNYkOTqKCeHyORSAg97ga8jEYGHHToNco34S5s07n5AHwvTB6FAQDnqDl9ZKnHa4lWTOiOWc0nnGzgQOBeKgN3gHuXwsS33Jp5mRT8or2Cn65HMomAp6cZBL48WZs662GQGu5XMwFsVhnnylnl6HYPlSdelsnjltvjVJZ2Tgno80DiVJn6CxAQjLyZeyc9goEO6Pkw4iHbqIsDaTEUyNeVetdmo1xBBkgwv8qXWpQaXGRqgR3vY7QHffpVEYhPHHJq0tZywK4XaCHgc7rRqJqNHWgATDMIwc2OmuIP6AdUDn9G+08v2M9dGgff/tf2GogfC2u6PBuuDv46+ctQ2l2iyE/j62tcjnpbvutjH5MkMY79gtXb6udCafAghhdxNKlW9IOpMvI4S44UulyTclnU9cBgQjCdIHs0uRL1Q6ky8DDvHilSBfrHQ+2T3ihDisSz6pdA5GchzWIZ9JVyAOZctn0hWMQ5nymXQrwKEs+Uy6FeFQhnwm3Qpx0C2fSbdiHHTKZ9JtAAdd8pl0G8JBh3wm3QZxyCufSbdhHPLIZ9IZyeUz6YzvOKSRz6QzbnBYVj6TzhjEYRn5TDpjEof7ymfSGcHUkE2+2JVPIt0rlnsNvVEAhHnPcEik4+3ZE2KGeN7jvWAdmynUuIEwPvninHSAzRRqTEBoBTxinmzcjuMaroJxwzsYY1Ro22P8Sef0fmTZX87pBW3t5j+NAUy8eKjnbycYUfwfQ73Wi/9RGD8AAAAASUVORK5CYII=",aGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAj5SURBVHgB7Z3Nmds2EIY/Oylgj7llUoG3AzMVZEtgB3EHRCqIO5BL8C1HKRXYqUCbW262K9hoLMGWtBQFQCQwIL/3ecayZZIaEa8AiD+jFyBD3O3i/hCvDo/6nBwt83kXj4f4ZxebXXw8PE9IFM0u1rv4tIunxND1WxByBe3JOtwmW19sD9sl5BkN9oI8TRi6/RaEYN/L/Yl4iT5gP8/7kLDuCqdzRLIwBGni6Dp3h23cJW5jC8q3SARpQ+uxdJ5U+XQueQ+yGATjSeehfGQQwfjSeSgf6UUwnXQeykdOEEwvnYfyka8I8knnoXwLR5BfOg/lWyiCctJ5KN/CEJSXzkP5FoLAjnQeyjdzBPak81C+mSKwK52H8s0MgX3pPJRvJgjqkc5D+SpHUJ90HspXKYJ6pfNQvsoQ1C+dh/JVgmA+0nkoXwW0mJd0nlvkE5AstJiXdJ4U+RxIVlrMSzpPjHxvQIrQYl7SeULka0GK4jAv6TxD8rUgJnCYl3SePvlaEFM4zEs6z7F8LYhJ5iadx5dLI4QQQggJ4QXIEDq3esB+fvUzvpei9XPJz9iXoNVHX4Z2A5ahJQmoVHpGYI3486Y+dN0WhAQwRSnaLSggGUCHU5XkaaLQbTcg5ID2citMJ9x5dCCLRzB9we2+mOPZFRKIoIx0x0OvgCwKQVnpjuVjzzchAjufbm1oC9L5WINMgmDf0FaGlnewI52PDmRUBKe9S2n5WqTLscH+oHKD0+Hx7vCcw209aQM7CPZfgKq8GkbQ3xCl5EsdYjeIk6JJfJ01bCD4nn91t04Khnd+Cfk6xImgO71FOg7x8rUoi0p2ftamGvkEYZ/43PLF9EK67Bg7u0Hc6bc1ytEnXTXyCeIaONeB1BbhOY19c3QT8dpPKDPXG5LOvHyCtLnNCtOzjsinxfg42Nofx4RIZ1Y+gd1aJgIbjR56g/Yn5OMB8VfimJFPYLuAzkNEToLpaCLyaJCHagsFCexXbXqLsJw2mJ7Q3iVnWYrq5BPUUSpsDTuNHfohWCEv1cgnqKc+3SPsDG9tYC4b5Me8fIK6iiKG5pcjt/vAXLYog1n5BPVV4gzNMQeCsFxKiaeYk09QZ/nXW8TztzKOhQTmUlI8xYx8gnprDqeK53e8vu+xdqYE5lJaPKW4fIK6C12niHd+7G+FcZDAXCyIp0wq38uB/xPsD0cI4vi4i19R7930Fj4wFtD203b8GLfa1/2n3gzKd0k8wTKlI6fcKp9cWuBlykoXoHTzZBL5+sTrQOnIKanyCQLnyC3q/SLRR+h7OKYFv1xcIvULx5trG95GbtD6XfEUb3xS5PuEM0+Oh9oWcUMsh9dlkjLs+tJvvcT0dtZ7Og97vOmI7flOej3f47UI7+3Y0xEltuc76fW8eA+BK1M6ckysfL/5v3jxXgestBTpHs/+/QVkiBj57nE0sjaYz5zunJQ5nvL28PwG492LIYG51DLHOyd0zvdtuHWYp3RKqnhTIAjLpVbxlBD5Vn7h95indArFy881+b69vzXmKZ1C8cpwTT78uItfelZc2rfXBtMjWA7+C4d2an2XR4n+MceezvNUYWwxHy71fIKzJ56dU6ucGkSbs3hKX23C5mXPQr+DkPFQn+Tsuc86x9Px+LiXc4fHP7Ac/kYeXmNZdPju0zFfvzs8or/L71A/ocNbDgTLGmrVn8H9PXQcr3b5KF4ZhqT7VortLYZ3RM3yUbz8DEmnsfELtri+M2qVj+Ll5Zp0Gs4vfIewHVKjfBQvHyHSaTTHK60DV6pNPoqXh1Dpnr03h/BGqkk+ijc9odJprM5X1uE2phBzLfJRvGmJkU5D+jYSWiq1Jvko3nTESre5tCFBfPl56/JRvGmIle5ib+dxCRu0LB/FGx9t71hHVtc2mlqiwKp8FG9ctJ1j3dD3IyEb14Vih1yr8lG88dD2fUoIQQRt4otYk4/ijYO2a4oPb5DAm8QXsyQfxbsdbc8UDxxuwCW+qBX5KN5taDtml87jEl/cgnwULx1tv2LSeVxiEqXlC82Tv+xzirZbcek8LjGZkvI9IixHwfQ8BOayQVk6GJLO45CWVCn5Qo9JtpgeF5jLe5Sjg0HpPA5pyZWQ7x3CclthekI/BA5l6GBYOo9DHfKFHhKa+n5iQfg+Cq1VOCYdKpDO42BfvtAJ/dQ78R3C88h9Q32HiqTzONiXL/T0ny4nGJ8G4ftlg7x0qFA6j0Na8rmGFIfwnMauGyOIK2reIh8dKpbO42A3eUFcbiuMQ1/NkKHYIt8wm3o61MEgDnaTXyNuB2vPJ0hHEP9jNSvkQxLyczCMg83kBfGfbm2YFnFoj9Uh/rKyLfLXzxOEy+dQAQ42k4+9p+RcQBnYtv5finA+ki4fGgHB9ZwdKsLBXvKxc65LEq6xHxZXh7+nyubjA8qih5wuvQeHCnGwl/zQTi4RW9goUdu3XxwqpoE9WtgR7x52OJbPgUyCQ3npWthD5Ss131wMqceybg3tVRqQRaOf8C3ySaevJSAEexHeYXrp9HDOnCrqk5FoMU3vtwGHVhJAi70sFI4UQfBdwpBjf7qMXrauX1o4pF7hBUgoKtP94dGL9Rn7G4oewV8tJ4QQQgghZDbwm2RF/IB5ILv4axc/Id8vMeak28WXXfwHYgbB6RmHDvNC348/TmjpMqpFI+g/zTUX+bx0xwepKV9hBMPnVmuX71w6ymcAQdgJ/VrluyQd5SuIIO4qktrkuyadD90HApKF1DvFapEvVDrKVwCHtMuUrMsXK50P3iOREYd5yZcqnQPJjsM85KN0FeJQt3yUrmIc6pSP0s0Ah7rko3QzwqEO+SjdDHGwLR+lmzEONuWjdAvAwZZ8lG5BONiQj9ItEIey8lG6BeNQRj5KR7LLR+nINxzyyEfpyDMcppWP0pGLOEwjH6UjV3EYVz5KR4JpkfabF+fypUj3CTarvpNMCG67hyNFOn093iFGvt5AlPI7Z+uEdViAmzxDMF319w1YD5lcQbAXcIvbZNN5nPZwDcgzWAN5mAb7+Zg+yi5eDSz77y4+Yt+7+UdyAYoXj/Q89wgSxf8hTKrGyuoqUwAAAABJRU5ErkJggg==",lGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAqFSURBVHgB7Z3Bmdu4GUCfd/eeOeaWPxXYHYTpwFuB2UHmlqPQgd3BKBU4OeVI5ZabvRVIW4HdgVewBI/EISUAJEiA/N/3wePRkAAIPYAkCBCvUG7xcAxvzuH1+af9TC62+XoMh3P47Rh2x/D5/LmiBFEdQ3MMX47hW2Sw+9coyh1sS7ZhmGxdYX+O9wFFaVFxEuRbwmDjr1EUTq3Qe+Ikstd7nyL2feL6GlFZGUKcOHuexXkYIQ5lRQhxp9YuYWLls9eSb1BWgzCedA6VT7mJML50DpVP6URIJ51D5VOuENJL51D5lO8I00nnUPlWjjC9dA6Vb6UI80nnUPlWhjC/dA6VbyUI+UjnUPkWjpCfdA6Vb6EIcdJ9YrrnpirfwhDipZt6nJzKtxCEcqRzqHyFI5QnnUPlKxShXOkcKl9hCOVL51D5CkFYjnQOla8AapYlnWOIfIIyCTXLks4RI59BmZSaZUnnCJHPoMxCzbKkc/jIV6PMimFZ0jluyVejZIFhWdI5uuSrUbLCsCzpHJfy1ShZsjTpHPa4KhRFURRFURRFURRFURRFUSbkZ9aB7YD95zH8Tl7rT2w5jaX7P8riEJ5HLDfkQ83z89cndDDnoqh4uW7FI/MjvBy+v0flGxVhngJ9R/84vbmp6J43Yj/TORQjIJwKc+ra3CfdB/IZSCB0y6cTeAYiXBfsVPK9paxh4rYy5DSBRzidFYqUX+g/lQjpELrXIqvJG8P0ZdWF8Py9FdfyCrfnvaYqUOlJt6YMDC/z3jAdVrJ2pS1GPsFvsnUK+baUc3rto+u0+570dElXjHxC2Az/MYep15QvncO2cu1jqUjHLemyl0+Ie63EvxmO0N0nViq2Mk51PD7SZSufMO/rX7cdcQtlU5G+Bbd3/6GLQmcjnzCvdEL6L2gu2td79ksfsw+y2BcFCfO/6HrLNKekObBitFskw7gUJ58wv3TSEX/NsjCkbfWgIPmEPF7pX7Pc1s7R1eqlGOSQvXxCPutItPNRs0wM18fZkIZs5RPyke5NRzrCMuk61lQDHbKTT8hrxRzTSmeM/sCcaUh/unVkI5+Q3zJN7S+iJi0VJ9mfjuHjOf3m/Lsh/XtNDNNWtNnlE/KTDqY5zdrC3+DfyWqPuSYN7dPtF9Izm3xCntJVrfRSjCi2BRdz7CmPv10BhPRMLp+Qp3SWR9KedirCHyWNVvA3aFppvGUaJnsbfddD6lyks5hWuobxEIZLF13wd2g/Qkt5g9EmVr4gJ96nTmAg21baNeOxZxzpXBjzMqDd0j8xLbHyNT6R1xER75m2D61ppV8xDjXjSjd2xaiZVzxLrHx3W+d9YIRTS2dpSCNe6LGPWuM9qFrx7piHGPlePGP+5eL/NWESHY7h7+efU/LbMby6+P0rw7E3AkIaqnPcB4Zhj/P31u9zYNO137utUL43UFY62+qZrj+G1Pg5WrqUtK+fcj3d5kRoy3fV6v10/mlvzQU/DszT0qVEPLc7HMOvnI7/V/zLQFgeruX77Lm9a/WusH1ha2zpHFviWi7juZ9huYS0fD/u8l2L9zePBA4sr6VThhPS8v24lrbiVdwfZnNApVP6CZHv+xMXK969O5MDKp1yH1/5Xtt/XIvXxwGVTvHHR77K/mPF+1PPBgdUOiWce/KJ/ceK99eOPx5Q6ZR47spnxftL68MDKp0ynJvy/dSz8YF14fv46R88dwnY8A7lFn0+SVs8262yxsI8eG5npbOdoHvCOtPneq6aA7aySuuz7+XRNfBxw7qoSPusduzRyKVgPeoqD7F/PPT8cW3yjTXyuOsx4xrpk+6b2+DWc9o1yWdII17N+rgl3Y8Zch+4XXBrkS92rom2dtfcks6Gnduw5n4Bli5fFbDdmOL5XNuFDEnLnXvS2WDcxg/4FWKJ8tljc5OXHj33GWtQaO2RlvDcyvrmL1d8pLOhutyp8dypJPmE63FiIdMNbSu0J044m07lmc62te8Ub3hPga90+/aOIbW8BPmEbnGawDi2hAlnr5fvDTFzVD3xfKKsU6+vdDY8tXfuegFgqfLZ66quY9kT158mnE6b9u5/x6n7yQX7OGjLqeL6CndJzTwrII1FiHQ2SFck9+5uS5BP6JbuI/ksntdGKFO+UOl2fREJ4Z2oOckndH+BhvyxlaKh+7SbY4UJla63tXOYiAhzkK+vD85QFlu6W+uciJHuySfimFcUzC3flnTSWakrTtdjhlMhumB/f8Rv3oovVrQcK7clRro9npcMdqOY55ZzFU7XHfkHhuHmgDaElYHdvmbYtVnfdMGKedkQ7sTdU2ybt5GJTC2f8LKS7IlvfYRT6znGgIEn4gUUutczm+t6b0NcGUR1isf24E8p37aVduw76S6fcIwdYsuj6ohrjg7mDXHHbRiAYdrCDqGrVY6pYbZvb08a6S5bKyGcri4uYTo2zCCdw0Qmnlq+PS+/3FBSv6znMtjW+B1hdN2tN0zDhhmlc5jITKSSr2Z4SxBbsENDaJlUHXFUpCW2bAwJMExT0D40rTSeCGPKlq4rvCOM9vE2pGNDRtI5DHGZGlO+Nwxr7br2nyOEPDeuOvZPcYe7IUPpHIa4zI0l37YV785/1+hlFFIEm48QeRrSftkbMpbOYZhPvn0rzjpg3y3xouw43WU+ntN8PP++GxBnSPdI+/Jgz3hsKEA6h2Ee+RriCl8Iz6u9EzXcb5mEeKkr/GiPFN8xDhsKks5hmF6+y5r/FLBfQ1geYwZkCuGn8sY/+qtjqBnOhgKlcxjiMv+WOB4i4hDC8rYlHpu/j4Hp+V7rXVY6YRgbwvKYlXQOw7SZbwj7wraEtXRDCX0juvGMV0bKY2x3kiFDDNNl3hBW+Hv88ma3E8ZBCFty1Bcb59AZaUL4JYEhYwzTZF7wX7UxpN9u7CmGJiBt8YyzYZx3sQj+8hkKwDBN5uuA7XwK98WyRyMQMomq9ozTMB7ikT9DQRjyybzvJCbfFjSUxjN938GrY1eOvll5xUnnMOSR+VsvJUp5mnX4Xsg/MR9d8hkKpmJ+fFucijT4jubeMS+X8hkS8wtp2TE//+F61cM+vpKGz8fwL4/tDsyLzad9bWzF8DkriqIoiqIoiqIoiqIoiqIoiqIoiqKsh7le4aVE8DPLQI7hv8fw52P4H8tjcwyv0MWrs0K4HsK9YVnY43EjpMcY8q6MgNA9b2Ap8jnpLofnq3wzI9yerFK6fG3pVL4MEPxmSJUqX590Kt+MCGFzQkuT7550LtgyEJRJiF3MuBT5fKVT+WbAEC5eCfKFSudCqtlxSgeGZckXK51BmRzDMuRT6QrEULZ8Kl3BGMqUT6VbAIay5FPpFoShDPlUugViyFs+lW7BGPKUT6VbAYa85FPpVoQhD/lUuhVimFc+lW7FGOaRT6VTJpdPpVN+YJhGPpVOeYEhrXwqndKLIY18Kp1yF8O48ql0ijc1/qvu3JIvRrovjLPsp1IowrA5HDHS2fR0hpjyfQKR77JTl6GJ2OcD+o4XpYUQv7z7vbAjj1WOlIwRTgLuGSabvY6zLVyF8oJXKLeoOF2P2Z9yDK9vbGuXrbLLMu0ufio9qHjhSMdnB5Qg/gCm8g/iHYvChgAAAABJRU5ErkJggg==",gGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAkJSURBVHgB7Z09luM2FoVvjx1MWOFkfrMC9xLoFUzvwAwn9A6EWUG3V1CaFbgnmlCabLJur0By6KjaKygLJaFLpaJIPIgEH8D7nfOOzqmCIPx8BCGIIN+A9HF3iLen+P706v8mZ2m+HGJ/il8PsT3E59PfCVHRHGJziIdDPCaGf38LQgbwI9kKt8nWFbtTvoS8osFRkMcJw+ffghAcR7n3SJPIz/c+Jbz3Hi/niGRhCNLE2eFZnLsR8iALQpB2au0SJlU+P5d8C7IYBONJF6B8pBfB+NIFKB/pRDCddAHKR14gmF66AOUjTwjySRegfAtHkF+6AOVbKIL5pAtQvoUhmF+6AOVbCAI70gUoX+UI7EkXoHyVIkiT7hPy/W5K+SpDkC7dHfJC+SpBUI50AcpXOILypAtQvkIRlCtdgPIVhqB86QKUrxAE9UgXoHwF0KIu6QK3yCcgWWhRl3SBFPkcSFZa1CVdQCOfA5mFFnVJF4iRrwWZFYe6pAv0ydeCmMChLukCXfK1IKZwqEu6wLl8LYhJapMu4OvVgBBCCCGEEEIIIYQQQgghhJAkYi+ozMUeceURVMxfMD0CXppNLphaPMHx0UobUD6SCcHL3WA7zCMfT7U6BMfLsIrcvSbo3oI4h3wULx7Bc78Vt3VS0L/vNbd8FC8OL9nlAwQnk+9bjItgeD4X0vyAYydYQbBcvFy+Ty4vpL3Dc199hlEEuh3+uS5Tfyw0BHnoGukuw+xpV5B2W4mPmB5rQlkSL0Y6s/IJ7N7+FdCXaynivYP+odCjyfcGtyFIW6PbI98c7zEy3W/Iw3eR6f6OadsnzN+0In3BzHM+ge2RLhBbrlw71CyVp7i7VAnKkM6zh41Tm+cO8W2Vi2LkE5QjnSe2UVtMT4P4tsqJefkEZUnnWSOujB8wPT9FlmWL/JiVT1CedJ7Yzt5gej5GliXHQdCFOfkEZUrneYf48k49oY9dvmgxH2bkE5QrnUczof8J06E5AOZeqJ1cvqF1PIH9dboYfB2aiHR+beo/mIZ/IK5T9jiu4c3NbOt8grJHunMc9PWYK+5hh+ynXUE90nl8I1iQKiYa2CLb3ej9B+0SPsiqdIENbAl2rQ0tkirfVSe6rsdbofw5XRd+7tYo0v+M43zlVlaKtD/DJmHetoHuFCo4Th1+GErYYkSrjeGPWs3VGO9xOyvo2lJgm9SRb3C1YKfMsBTpAg66+v2IdDTLJz7uUQYp8j2gZ420VWa2Q3mXi2tHvdRvZwLdQVxaW476BKKaG+qcFtMeYAL9mcOhPLTydY56mtOCtiMsssE08gnSpiulopXPXWYQ++N1DdJ5BPrLvn3d+067b5G2DCUoG418ny7fHNMJtUgXiL1q5TK6vqH9CL3InSNAoWjkk/CmJiLxDnXuO10jTT6/1HJ3iveJeWxRF7HyfT1wh478WqXzpK5LhXbZ3fBeQX3EtOd9SNw3v6u1gc4RpAtE6V4zJN8uJNxgudIFBHnkK+5GOIkMyffEHsuWLiCYVr6lSBfok08ASneOYBr5fJ5Lki5wTT4BXh+VgmUjSP/CsfQpSxddl9k1wOuGWoE0GE+8FsvG+3TZJk+jf9fC55LlS11Y7oultmeXdF9PtXuwsQLXGory6elryyf61vGW1FhTSre09uxry4eQ6APYWDmkW0p7DrXlNiRssezGmmJOt9T2HJLOhwuJY3fa19hYt2x7dLhtv+471IX3I6bezfmbNpFvqkk+Qfo2zmaEfGpaM/VexLbdCxziG6wW+dbQy+IXlqUjL3/W+CUhvw3Kx/sQW9/7yzdrN8GULl8LvSRrDN9NyiXk61Au3gNNXaUrE6fMpFT5BPpT4xrxOGXepZ5yff9r6rm9lpFAf/l2ifKtoavjL9AztER1GRuUhe/3R2VIX4YuIcOS5BPo6rZD+s0aN8rPalAGvr+1jtzHZJxyZUYp8q0RXyc/+jd4ftCzNjRPzSll1PP9rHVjh8iphE+UsmPKunwCfZ1yRwO7+P5NqZNAgfa+HyXIt4YtyboiZT6ZA9+vKfVJurVvm/hhVuXbwZZkXdF7c5uZ8P2ZUhfXl+k3Pf/7jOM9khvoaE6v/4Md/Aj+z8i0/plmf4wcnr9GfLZP8/sh/g8beOkc9PwLI6xPOpQ/8q0RX27B+GgW6Dewge+/0Uc6LS6xEFbk2yGuvPeYDhdZBgun2xUMSBdwiYWZWz7NFSgNpkOMlGOIFQxJF3BIK9Sc8rWIK+MO07OPLEvSt8ERWMGgdAGHtMLNJV/sz1cfMT2xZblHflYwLF3AoRz5NrAzyrSRZfmEvKxQgHQBhzLki/0JsMH0COLK8oB8rICkfnS4gTe4DYc0kRyOaz05iP2WuEceJDLdrX0Tg+87Bz2jrNPdikPaEZNrz8FjoSGYlhXSyuVgCAe7hbckkxXxUnfWORjEwWbhrQllQTzBzI9E+Bbj4U6vq540JuYGV8j1jNjtIb7DvOzx/GwyiUhvud++4pDhiFEQe0TnYo/5R7yAYPg3ZIeCcLBTeIrXT9+V0g4F4mCj8BRvmC75HAqmwfxQvDjO5XOYmDG/XHSxxfz8G7bwvwnHLGh/QV78hb/+C0eD42/KhBBCCCGEEEIIIYQQQgghhBASg7W7LJEevkEdyCH+e4i/wdZdqsZiheOusz2IGQQv9w+sUBe+Pr5eS3u0vGkE3ZtWapEvSBeC8hlA0L9TqnT5LqWjfAYQxG3PK1W+a9JRvhkR6PaElibfkHQhfBsISBb8kolGutLki5WO8s2Ag168EuTTShdirps4LhKHuuRLlc6BZMehDvkoXYE4lC0fpSsYhzLlo3QV4FCWfJSuIhzKkI/SVYiDbfkoXcU42JSP0i0AB1vyUboF4WBDPkq3QBzmlY/SLRiHeeSjdCS7fJSOfMUhj3yUjrzCYVr5KB25isM08lE6MojDuPJROhJNi+Gn2sTIlyLdw+nzyUIR3LaHI0U6/3ncIUaeNhD55zpoBdokvOcDeI8XcoEcYg29TDGxhY2nHBHDCI4C7nCbbH4e50e4BuQVOZ57XzINjvMx/yqH+L4n7W84PpZpe/ZKrkDx9EjH3/YgKv4EvsqkDSgnwRgAAAAASUVORK5CYII=",cGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAk6SURBVHgB7Z3bedvIFYB/J/seP+Ztz1ZgdxCkgmwHRjrYDjSpwO5ALMF5yqOYCuytgNgK7A60PKbGpiiAwAwBzAXn/74jShSIy+DnYDA3vMK4xutjvH2KN0+v+p6cLfP1GN1T/H6M/TE+P71vGEE0x3g4xpdjPEaGfr7FMEbQnOyO22Tri8PTel9jGBc0nAR5XDB0/S2GwSkXek+cRFre+xTx2XuelxGNjSHEiXPghzivZ1iHsSGEuEtrnzCx8mlZ8i3GZhDmk85j8hlXEeaXzmPyGb0Iy0nnMfmMZwjLS+cx+YxvCOtJ5zH5No6wvnQek2+jCOmk85h8G0OIk+4T81fsmnwbQYiXbqmGfJOvcoT8pPOYfJUi5Cudx+SrDCF/6TwmXyUI5UjnMfkKRyhPOo/JVyhCudJ5TL7CEMqXzmPyFYJQj3Qek68AWuqSznOLfIKxCi11SeeJkc9hrEpLXdJ5QuRzGEloqUs6zxT5WoykOOqSznNNvhYjCxx1Sefpk6/FyApHXdJ5zuVrMbKkNuk8elwNhmEYhmEYRgja3jl1QsYh2omfr/EGyIjgHWGzgA7RBqzD5Ns4Kt1jYAzRBq7nHmOTxEg3p3gm3wa5o1+E31gOvbQeMPk2y5B0Lcsj9Mt3h1E1KaXzCCbfpuiTTu9mG9ZHMPkWR0jfNfs9/dKlHK8gmHyLIZwS90A6+e7JTzrPUMW1yXcDwvNvdAr5+qRL+SXoY0i+d6RBOFVwFzl6Tei/jKx10rXq4oH8pfPkIp/w47wVN3RSuD7udemTP9RlPFfpPC396dWwDn3yFyOfMG2w9VISlCqdpyVNefRaJ4ns5RPCRvjP3VAuA9tfYnrZJWlZ9+RP6ZmTrXxC3LQSH5kHYVi6EnuBOPpPvjAvId3BspNPSDu7ulCXdB7Hcmmm/Er4Q6GzkU/IU7oddfR3cyyXdsVOFCSkf47EkHQ14TD5viOklw7ql87jeHmsc5WPi5FPyEM6erZRMzueH+ue+chePiEf6WBb4jUsJ56yqnw/BSwrnJqhhDC6Y/zz6TUHhLT1ep+P8ZX80H3S86TnOEQk3zypn/3MzAh55XSemBxvR/hxzB0PhHc+bVg2x/Nkc9kV8pQOyhXPxz3T06hhHfGU5PIJ+UoH5YsXklYN64mnJJNPyFs6qEM8jQfGaVhXPGV1+YT8pYN6xNNoR/a7YX3xlFVnoz9EbGht6eDHHaqPKexIL1lffBrZ74Y04imx8h0IcOL90htIzI70kg2FkC+x8j1MWXkbseIDZfV325GXbOfRkjex8v12uaJXF38fCJOoI6/K4Sk40oyl/ZnxtP03+bc3+wrjkJsHrZz+hYGK85a6c7rUOMrP8TyzPoHogEm3JI56xFNC5fvCWR/Jvzy9am9UYRod5V1ejfnxbbtT22dVuu9lPS9eO+2zJp3xjFD5/uV/8eL9Y8KHOkw64yUh8ukNiegvKl7D+PiEDpPOGCZEPi3WfRNv7La4w6Qzxpkq3xv94XO8ITpMOmM6U+Rr9IeK97eBBTpMOiOcMflEf6h4v/T8s8OkM+IZlU/HXPx88WaHSXdOw6lArOk0dhN2jVm7hRfA6BiOy9plwVAa4rqH3RK/Uh99j1lo4OXB32FoGjwmCKE++tLyWw5oc/A+R5t1Uki3pz76pPv+BesG/rlF+YQ00mm01MWQdI9+gY9XFtiafDvSSPeBurgm3Re/0AeuJ8qW5AudL26OGBtrURrXpNPY+wVbxhNnC/I1rC/dlnI6H84v/JppiVS7fFqVsYZsmqvuSNP9fkmmSKfR6MJagawVfXvGE8I9vf6HOplSOfxfbn+0aEd9qHRuwnIdF3fvIVUIteZ8LePHfo9xydScrjf99NseUrCuUb4WEy+UEOk0pG8lY3e3tcvXYuKFECrd/vzD5+NqhfAp+h31lPkaxitx99Q7z3IIU8t052gvqG7on44wi2vM+YzrhOZ0k68UMVMUpJJPCJ+0x4gnRroDPefmVc/KdaGYp+I41r/sPl78/Yp4XjN+zF9JN3+x7tt5vzbdj6nDCucg5vKqXL3EXhJbmbp2zne5/VtomemSsRANVwrrCxOT02lE1XnGdg9aUz4Tb3lipXPcgIvc6FrymXjLkkQ6j4vc+BrymXjLkVQ6j4vciaXlM/GWIQvpPC5yZ5aUz8Sbn6yk8zjidmop+Uy8eclSOo8jbueWkG/ObbRsW7yspfM48pDvMOM2tO5yPxK39sWLRXh5rHvmowjpPI708mlNfl93rlSCLIHQ/wWbq9t8UdJ5HPnK947yEfql2zEPRUrnccTt/JzTNbwd2EbJ8g19oXbMQ9HSeRzpd74d2FaJk+UMSeeYh9jmUEeGONLvfNuzvdkf4LswDctKpwjhExI5MsaRfuf7vs2lyPeO9dJNmC6fowAc6Xfe9WxfE1nIlzWl8wjjg7wcBeFIv/OOcuS7I91JHypPFiedx5F+5x35yzckXct69MnnKJiG9DjylS8H6Tzn8jmMWegbM5xavj7p9MS3pEPlq6nVJwt2vDzRMYOa5mBIuhLrHI0J7Egv33tMuk3yQDr57um/5G9OulvGoZbK0KPNd4yPC+6urHNMXL28tj3rs2eKbIiYR5tryMD6moh1pb65MRIhhLdXysC6Gkw6IwAhTD4ZWE+DSRfET2ybjlMZ6yO33VzoPCZ/TFiu41TO6zAMwzAMwzCmkKLpy4jkr9SBHON/x/j7Mf5PfdxxquzvMLJBeF4lckdd6PFYe25mCPPOJpAbXjrrTJARwvXK39Llu5TO5MsAYVqLQ6nyDUln8iVECGvmKk2+Mems6S0BWmUSIl1p8k2VzuRLgCNcvBLkC5XOh42RWBFHXfLFSucwVsdRh3wmXYE4ypbPpCsYR5nymXQV4ChLPpOuIhxlyGfSVYgjb/lMuopx5CmfSbcBHHnJZ9JtCEce8pl0G8SRVj6TbsM40shn0hmry2fSGd9xrCOfSWe8wLGsfCadMYhjGflMOmOU2Gd5Dcln0hmTaRl/qs0U+WKlazE2i3DbGI4Y6XR7NkLM+DaAqO85GGPxEPGZD9gcL8YFQv/jCOaIPXk85cjIGOEk4IHbZNPyo+ZwDcYLtvi4gRAaTuUxfZVjvLmyrE5F+5lT7uZfjQFMvHCk570OI4g/AZaBzD6mx2KwAAAAAElFTkSuQmCC",uGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAdgSURBVHgB7d3dmdNGFMbxN4QC6CCnAyhB6YAOcCoIqWBPKoBUgFJBSAVrrnLJUoHNXe4gFRCdtSfxemVpZmxLc0bv73lmzWMsrdf+P5I/9PEdaMizbrzYj+f7S7tODm7ztRvb/fjUjXU37vbXEyVpunHbjS/d+JY5bPoViEbYkuwG58XWNzb7+RI90mAXyLcrDpv/CkTYLeXeID2ij9i9zvuYMe07PHyNSAsjyAvHpnm2n8ezzHlswPgWSZC3aj2MLjgnvhegxRBcLrogNz57I8P4FkBw+egCxke9BNeLLmB89IDg+tEFjI/uCaaLLmB8CyeYPrqA8S2UYL7oAsa3MIL5owsY30IIyokuYHyVE5QXXcD4KiUoN7qA8VVGUH50AeOrhMBPdAHjc07gL7qA8Tkl8BtdwPicEfiPLmB8TgjqiS5gfA6sUFd0wTnxCWgSK9QVXZATn4ImtUJd0QUp8b0GzWKFuqILYuJbgWalqCu6YCi+FagIirqiC/riW4GKoqgruuAwvhWoSLVFF4TDpRERERERERERERERERERxRJw02yamGC3Y84GjI8mIni4Nxjj80Gw2wzL5dYwgv5dEBlf2QT/P2/udp0UDO/3yvjKZJEdn0DQTXyCuJ2tGV9Z+qJzE58gbQ//GjdT92gouuLjE+QdVuIdpqdIv59TD3ui/8D11wox0RUbn8DXsUwU5QbXN17hOl4i/aTQxcQn8HcAHUW5kZ16sgWX5/ZAQQKfR21SlBfX2HiL63AXn8DvocIUZUUVM9a4nlnie4J00o1bpC/+77rxYze+gkpiz4c9L3dpk90Hax1kxZcanoDR1Wjy+FLCEzC6mk0aX2x4Aka3BJPFFxOegNEtySyv+Y4J6jvQdUkazP+u9pTZPmoRMLpra1BueGby+ASMbgoNyg7PTHo0ekY3jQblh2dy47OOJPJ34A0Y3VQa+AjP5MZ3GzPzFRjdlBr4Cc/kxvd6bMYbMLopNfAVnsmJ7wsGOlmB0U2tgb/wzEXPQLQBo5taA5/hmdT4epd6KzC6OTTwG55JjU+PZ/AejG4ODXyHZ1Li+3g8MaObRwP/4ZmU+MQmsI0EmogZ8wt/GpKyYcFL+/EU4+HNFd07lO1zN9pubEEmxHeL4e9pn4d/DL2+m3P1+s3JuEG+JvJ3rOHH2Gp3E254i/KiA8qO7XiMfjJ/QhM5/zV8GYvv3hblRQeUG1nfGPxkfkATOf81/BmKT+zNxQ9HE/CNRDp7kBvQocE3HE9O3JjRpeNHTY+FnrZH18txePbg/Qyiy7Ge5Oi6rxbe8dJNcd47NaLAOtKe6+/D+6fnPxSMj85zKjqztfBOfdqsYHyUZyi6+zWsfXOxxWm6v/wV0/sJZXgFvmNNMRSd+WQ/LLyx79d0fzl1fC3K0IBijUVn1vbDVrXvMU7B1S4Ni4nOrO1HeFe7jphAwfioX2x0WxyEZ/5EHAXjo4diozPr4yvsg+OUAzEvKb4WcY/JCuka+P6u1jpI+U5bwoRhiWer298RT8El39KlLOnMB5z4BEWQfvj5JcTXgku8Y6lLugdLO3P4Xe22G78hjYJLvqVJXdKZFhFbauccoqDm+FpwiRfkLOk2iDxwj90odZVbc3wtGJ7Jie7RKjboOxTtthu/IJ2Cq91a5axejXW07fuPpycmaLH7iOUN0uj+co7vdj0KW3uPmXPD3NzorIG3yKTIW7zWtORrcb1VbelyV6+KC9DMX15LfC2WGd6s0QWaeSdqiK/F8sIrIrpAM++M9/haLCu8oqILFHl3ynN8LZYTXpHRBYq8O+c1vhbLCK/o6ALFcuJrUX94LqILFMuIr0Xd4bmKLlDUH1+LesNzGV2gyLvzL+FDizrDcx1doHB850e0qC88O6ya++gCRX3RmRb1hSdIP5mOomCKuqIzLeoLzwji41M4oKgnOtOizvCMYHzbS4UjijqiMy3qDc/YgbJPxadwSOE/OtOi7vBMX3wKxxr416L+8MxhfIore4rrWoO8CFtDNzhjy+FY1w6PfLlD3Nl5zvYERDNgeDQLhkez4Gu8cevI221BREREREREROQKT9vpyPeog3TjL+zi+4D63GB3ssO/QcUQPNyE+wZ1sb/H/i7bZOkFqAiC/v0GaokvRBcG4yuAYHhnFe/xHUfH+AogiNtDymt8p6JjfDMSpO0T6i2+sejCsMdAQJOwd60p0XmLLzY6xjcDRXp4HuJLjS6M16DJKOqKLzc6BU1OUUd8jM4hhe/4GJ1jCp/xMboKKHzFx+gqovARH6OrkKLs+BhdxRRlxsfoFkBRVnyMbkEUZcTH6BZIMW98jG7BFPPEx+ho8vgYHf1HMU18jI4eUVw3PkZHJymuEx+jo1GKy8bH6CjaCuNntYmJLye6L6jjVPKUSXDePhw50dnv4x5idL8DkZ3XITWg24xp3oLHeKEjgviz+KSONeo4yxFdkWAX4AbnxWav42wJ14Ae+Q40pMHu9ZhdSjeeD9z2M3ZnxVkfXNIJDC+d9Fy3BSX5F+rkF/rZAh6RAAAAAElFTkSuQmCC",IGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAw6SURBVHgB7Z3BlZw6FoZ/v0mgM5ibwfNkoMmgQ1AG4wxKGbgzKCYC90RAzWqW9uxmR7/d7Oy3ezu/UlOyaSGBJBBI1P3O0WmbAnGBD0mABO/ATPFwTe9v6dfbXz2NBvN8u6aXW/rvNV2u6cttOsNEIa6pvaav1/Q9MenlJRhmBl2SnbBMNlfqrukfYBgHAr0g3zMmnb8Ew6Av5T4iXqLP6Nt5nxOWPeNtG5G5Mwhp4uhlHm55PCTm0YHlu0sIaVXrUDrDEvneg7kbCOtJZ0iVT1/IsHx3AGF96QwsH+OEkE86A8vHvIGQXzoDy8e8QthOOgPLd+cQtpfOwPLdKYT9pDOwfHcGYX/pDCzfnUAoRzoDy3dwCOVJZ2D5DgqhXOkMLN/BIJQvnYHlOwiEeqQzsHyVQ6hPOgPLVymEeqUzsHyVQahfOgPLVwmE40hnYPkqQOJY0hmWyEdgNkHiWNIZUuRTYDZF4ljSGWLk+wBmFySOJZ0hRD4JZlcUjiWdYUo+CaYIFI4lncElnwRTFArHks4wlE+CKZKjSWcwr0tjGGYJ78BMEfNiRv13+GLGFzBMBFosieUvZvx8y4fAMBPkejGjTmewgIyDXMKxgIwT3WbrkF+4YdKC86OuO0Yf/O87pjOOe/uH8fAR+0pnUgeueu8GXdKUIB3Ld0eUJh3LdwecUKZ0Q/m4zbcihP3PZollUrxc09M1PaLflqEg+v8C/cXKZeF6PoFZBUJ/Ju9ZlRDS79E9o5cqdn0K6bdp+FbLQghvd/5e8n1C/MHXj7sElkHX1CSse+/BO4R++6vsDUNwn/FbyycRf+CfsC4S8SXuGftA+Hncqhs6SZiuZraUbyoOV1LIAyXEIrAtWjL7BKlGPkLYDt5CPgmsLp3puaIQ3xvYdWBLKfWmYitePkLcWZ27m3qL9Q6ycOSXIoaMiEmnLW6vhJwQxcpHSLuKSzl4ofGExqDjnvpU1KeVY3+KiE0hLzGlcHHyEcp7l0lMBwDpyYMwvV1npKG3OfRgt8jHI+IveoqRj1DmC3TawDi6iTx823VBX2oJpKMQvq/4heAWhHLf2rS0tDvBHbfAOjwgPMZH5KM6+QjlSici4iHH8uSYT7fz1o67RViMa99XtKlGPkLZ76d7DIzn4lm+sebT25ojboWwOJ+Rn+LlI5T/UkSFZSWJvX0SeQg9QTpsQ7HyEep4E2eDsLg+OJZ1tb1yQShLPE1x8hHqef1rg7DYpGNZgXH8uYi5wNiSTeT7JWAeQt8QJsTx5Zr+jn6Efa38jnyUul90XPq4fYlb7FVY7ckqJR+hvhddN0gv8QjbVXOllnjD+Hapdgl1vl099JGUcizrkiHXtrxHWJwd9iObfL6qllBv9foSON9fHdN03BdrmusiZA0ocL7fsB9Lq12KXUifZbWVdIbQ2xRfPcu7nvPmuGJrEBbnM/YnteTrECHfx4QVlCKdhhAet3As7zrx9P/Xlq9DWIy5StxYUuVrQzKXCRmXJJ0htNeF7yay8Mx/xjodWAWWnRx7kSrf7MnTRWZYonSaBmHxa0F98auZ5RS2ia80UuSb2s/RpV2p0mkkwrfj40Q+amK5M9IQEbGV0L5zkSKf8mXWRWRSsnSamM6WOk213yTc++aMtLhi9vMjyiVWPmepJyMyKF06Q+j9PJ20DHPbJPH2TQFnxBNz4dahfGLlU3YGz4EL1iKdhhBXFcRsGyH+IuMUGY9EHcTIN3r2fTTpDA3i5SOsT6x0XaY4chEjH5mFBMIOSG3SaQjxA1rWPOhTo9SOUNoNCZXvx60VhWNKZ1CIP/A6nbFMQL2DU14W1KFeQuQ7m5mn2ne1S2d4QZp8ZkeJsNWs8skCQt3MydfpmfSXfVq4d+wX1N+fTiOwzvjUF/T7RH+95xt+7hdC3+FAYB1p/ob4h/KlMdc3T3vnLA2OUtJpGqSXPnskhWMwVfIRcGzpCHXINkyTj5cqwycfAcfdaI3EuH1hT9s7NRi3CUvpkbIGrqc1AhjviBOOg73B8jZdYPsv+riSusWjrOktjoP2yd7u17af6wrsCPIJeIr4G/rfHfYRTu/z4XNYVzd4gfrRHrm2n/SPL54fa5evwdvtOXvmU9hWugvcV7+tNd8T6kb749sHr0zdx6tVPkJcCaLnb5BfODERg8C4VKy1vT0l3Y8+hnO9OGqUzx430QUuR3A39nMKN+QIFxlT0pn98YrE/M6rTT4t2jB+iXgkegntvEKSvoWgpYktsZSVT4u6mJNOJ2VmDh1YXIt8rlFmhGXQLV8tk0IvpEmuTgACaTysmNfWhEg32p4Wx5HP3pYz8iKRVq37sOOv4TNTodKN9o0KXLB0+QjjeN8jLx2WV+tDhJVf6RcZodI5C4HYMQqlytdg3NbKSY5qXWMfC4UyiZHOu29ixiiUKl+HdUufOexbUWesg8K41CuNWOkuvowI8bcRSpJPYqY9sTKE8f4QWAdXDSRQDrHSzdYEKiHDUuRrkaf08dEgr+h2adqiDFKkCzoWKa8o2Fs+QuQZtgId8lbrAuNt2vsiI0U6vZ8oJHM9U8qd+z3laxDYnlgJaa0v15Vna61HYT9SpIsuAGTiSvaQz9XfSyIvthBn5MF+9LfXRUaqdEmP/D4krmxr+STGRXtOCAvP6ghKuMhIlU5hASpxpVvKZ7dJz8hLg22rdfs2V4vt2EU6g0pc+RbyCWxX+hg6bFvCCoy3MffTGM2u0hlUYhC55Wus9T1HLEuIj0/CvZ0CcZwQd4K0yHhwHRQhnUElBpNLPnKs6zFgOYG3B1IgHN+tpjYiD4m3zQIRsIzrIiPXrZUTCpLOoJAWVA75JMKrvKkR/i3CcI2LGKZQEVzydrftIfjj36KT6AkFSmdQSAtubfk6K3/pmEcg7KU5hHkaLN/5IiCWM9xtOIW0EyaUU0Bsu0lnUNhXPgG/PLp00KVBi/V2HjmWsUuukHtsTURMOn85WDbnSLRTRFy7SWdQ2E++BuNSQqC/9TD31EX//uyYNlVVSmv+DvH32AjjWC6Y3196XWf8/OjN8Lc1RqKdAmIoRjqDwvbyEdwHJ6QEMeMgYttMdv7qNl1Z09uJPKQjZrM9MnAb7HmWXmScAtZZnHQGhbTgQ65AXcQ+UbnAXRIphEkjHHnS7TdX9ee7x9ZZ80nPuqaGm7pS6kXGKXI9RUlnUNgu+C4gf/MdiqnSIHRgTWPNc7Z+bzG/bRJ+eV0Qwke4tYgn9XGoQoEo5A/+EWmlm4/WWt4eWEOYl1NgLP3DzHrOCEdivi0oEAchftimQsEo5A2+hb90S3mMJBz5DaWR1m+dJ5+p9iIhrrTzQfAPNk8ZiUYIl0+hAhTyBE8Yl24pg6ZtbJnV4Df7wEhPHgr+6q/BOO4lPGB8MZJ6kUGYvwugUBEK6wffoN9J+haCwHr4+rzFjCDztRcJ4wMrsR4CP8VWSEPXFD75FCpEYd3gJfI8n/Tdj4sdQdZa8z9hu76ChGWfn3LJp1AxAnVg93lzPU8VM3kIjEvOzpr2EeUylE+B2YS5DgChJdVce4lQNno/5Oh8wExgV5Up7TI1kccZDONAwC1MzBXj1KtABBjGg0ua2JLK9cgrtKpm7hSF5e0ygfSqmrlT7KrygjRacGk3yS9ghny7pn8O/t8gjX8N/n0BwwQgsLykGpacBIYJRFeVS29/6JvSFzBO/gLGhf6spa5yvyGdP9B//vN/YBiGYZhDkGtkPZOBo7Tx6Jr+g16+f+N4nK7p92v6P5hiILztfnTCsdDbY54Zp3TvZzJAcI8bOIp8RrphhwWWb2cI04NVapfPlo7lKwBC2AipWuXzScfy7QghbkxobfLNSTfsfEBgNsH1hvcjyRcqHcu3Awrx4tUgX6x0JvEYiQ1ROJZ8qdIpMJujcAz5WLoKUahbPpauYhTqlI+lOwAKdcnH0h0IhTrkY+kOiELZ8rF0B0ahTPlYujtAoSz5WLo7QqEM+Vi6O0RhX/lYujtGYR/5WDpmc/lYOuYHCtvIx9IxIxTyysfSMV4U8sjH0jGzpH7LyycfS8cEIzH/lvYQ+VKk+wp+S+hdQ1g2hiNFOr0+HiHGvA4gsj+wEpLahGWewO94YSwI4w/erZUu4M8NMDMQwj9SPNeOW/uDf4fhHZgpBPr2mP5L1/TrxLy/oX8D6GXwl/HA4sVDjmkvYKL4E23aqp+CTnFfAAAAAElFTkSuQmCC",dGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAq6SURBVHgB7Z3btdu4FUC3JwXkfubzpIJxCUwH7uAyFcRTgTAV+HYgpQL7L59UKrBTge5UYHfgCCPRpsAXAPEBUGevhXVtiQ+Q2AJAvPgGZYinc3h7Db9e/9rPpLHNt3N4vYb/ncPxHL5cP1eUIIpzqM7h6zl8jwx2/xJFGcHmZDvuk60rnK7HfUJRHAougnyfMdjjlygKl1zoA3ES2fre54h999zWEZUHQ4gT58RPcZ4mOIbyQAhxRWuXMLHy2brkW5SHQZhOuhqVTxlEmF66GpVP6USYT7oalU+5QZhfuhqVT/kTYTnpalS+B0dYXroale9BEdaTrkblezCE9aWrUfkeBCEd6WpUvo0jpCddjcq3UYQ46T6zXL+pyrcxhHjplh4np/JtBCEf6WpUvswR8pOuRuXLFCFf6WpUvswQ8peuRuXLBGE70tWofBlQsi3pau6RT1AWoWR96d4zPTHyGZRFKVlPOrkef45jh8hnUFahZHnpLAfmTXgf+UqUVTEsK53lxM/61VznGZKvREkCw3LSlSwnQZd8JUpSGJZ5eq24FaFiXprylShJMrd0QnfRVzAvTwucQ0mYA93ivaAoMyEMN+Km3kCdFL+g+FI4//93499WujkalBXlpn/4dP2suYjjZxRlYgq6ewwMyz5kKA/GgVvB5Pr5E8s2rSgPhHAr19753m3X04cMZRIMw8VpQXcxrCh30fVQ4dLs1vqKotxJiV8/6Xtnu3coyh00629DI32fuG1a0YeMBBDyHJotDD9UuLygTSvJIFzqRSfyk+9AdxNKHwXaf5sEQrtiLuSBLTqbcT967ucWzTk2rQiXh6UsZ68J3VMQc5GvxO+hwuWds19u/bfC7ejq2eR7w/QIl1++9Hz/eg7/uP5dG+HySik3Z3rrfHbEj/o1ozWvtK/zyzn8RnrYeNt0a173Ny5p9YXEEfwmW6eQ8wnzvzivL3wgLax0fW+tTH7SuBCWkGtOshbWk64OO9JgSLrk5RPiEvITyyOsL10q8vlIl6x8QrrLv7q4T6uPLJ99EAp9KXQy8gl5SRezNslW5ct2oSBBpVP5FkbIRzrLR9IVrhmeWZ5s5BPykm5PuqKpfJ4IeUn3gbB4ztXTUAXG45nlSVY+IS/pdoTF0zAfMYm6Rh0qOfkEle5eQhN1rQp8MvIJKt1UhLYjPqx8Ql7SQbrS1Qhh9/TIOqwmn5CfdOAfzxfWQ/C/t0fWY3H5hDylA794Hlgfwe8eH1mXRVejz1U6S+oJ2UTII76x8gU5Edr2lZJ0lrG47kmLXH4osfJVPgcvIw6cknQWFW8+YuUbbZg/BR4wNeksKt68xMjXmvjUXJixJEyiV9KZOzEXbwl/OhNIa8DkxHwjfB7G4MKVIbldijldzVQ5XsHllxrydGa3q+/js+c+ueV4NTE9Ma2pDu8CDpCydJYpxCsIv2ah/eMtGSdX8Syh8hn3AJ88d/RJgLWZQjxLRfva+yYndSXA0PYh8T2SNiHytZbr9Rl7n4N0lqnE6+pX7ZsZ5w40DblXuYtnCZFP6p0Kj41zkc4ylXgWoS2fu/+O++7VFsSz+Mr34yHjPduRzjKleBahXSLsrt+50sX0UW5FPIuPfD/u/1D9LjfpLFOLZ+maf1p1HPsd4WxJPMuYfKd6w4rtSGeZQzxLiWcREsjWxLOMyfcnr2xHOstc4ln6qiWGeLYonmVIPoFtSWeZUzyhXeTeO/Bxq+JZ+uQTaN9EIW/mEk/o792558e6ZfEsXc1SxS8dGz2juNj7UtEvl4x8/8j8i/Z9sf29nY3HO/JlLAf5RDgV7RzOFq9uMRKz9NpcOXQKWI9663ivPV/mKt9YL0zoWxbdgbFWOrl+J7SLkY/4I4yL90Ke9En3vd5gqB0vR/leGU7IkDfv7BivA9v/u/L5rvhZMC6eIT+GpPtx/18YvvDc5KsYT0yf4rDr5vU9vXY1MPvct7Feo9AcNAWGpLPhWG9YMn7xuchXMH4tNoz1MHQdp5xhnwN+8S3IgzHpbnLwJ/wuPgf5Tvhdi0+9qVkSGPwoG/scGM9ZfUd0VKSPj3StH1HluVPK8pX4XUNIQhrC61gGP7EF//jaENsltwS+0p3cHd/jfwNSlE8In6gU2uwxNSVh8U31TUG+0tmwd3e2FxSyEHNq8rlNHj7XYliXivE4ukWxIS1CpLNBug4y9nSbqnxCOzsv8UvUtRD8E+qER+KtgE3/EF+OfQcSwpefT0G+A7dxKvF/YCpYhwP+CVU4n1esj03374FBhg5oIg64pnwlt3FpdodVjMd9jUQU/O5r2djHvZaC9dgR7sje58AxSxSsJd+J/l9VQZq53oHxOJ2cfd6OfL8UO8LdsHEVn4PbjUKL3DXkKxn/Vflcx5J1PSE+h3Dr4Es3r+wId8LNDEYJmeC9hnyC30uYDX7xXioRK+ITy215WLJ5ZUecD1H3NaRtb2n5Ds45y57tfJuJlhgA63s/9wHH8B2McA874jww3IGJPOmc8olzrtPI9ga/OFfMh+BffZGRY52c7e8Zdj/GjhWkqzGRJ59LPnfWfjmyfdfQ674wRw4Scn6frraCZX4wO1aUrsZERmJq+Urn+HvP/Qr84zx1fe+j53lP+Bf3lbNvwbTsSEC6GhMZmSnlOznHloB93cQaCgXTEJKAJf4IbWmnetBISroaQ1ykppDPvSGhQ8KFZd9GHZKAe8IxTJ/wi0n3hnAMcSKZc/idOIT2LK4j4auRhqzw+Y3wlS9r7P0xAdsfCb8Wm8M1B7Ta+P79+jeG0DjX/M7MuV0Tw7I53yHyfPcGm/M9E0bMqvlThT1x7CLPZ1gBwzLySeR5pgw+cbY5kO+DxJyhIIxd5HkMdxBT1DYxzF/s2o7/Odqq/kpYhfxwDr/RXZQJ4RO6/2AebDz+6bmtTTtDOIsWr30Y4n4xYxNu5kaY5vUKtvkltG/7wPpY6RbP6abGkGfkhbjXZ+34mcuF7huz2sDUxHaHGhLEkGfkhTj5YkIK0lmE8Gs2JIwhz8gL88t3IC0E/2s2ZIAhz8gL88kX2ti9FMJ4/dSQEYY8I2+LwQPTSpfyfFhL1/IbWUpXY8g38ob7hTuRzzvNuuQzZExBvgjxRa9tSE5x8vUQTfkMyqpYeULmG9uES71oHcLKl3P8N4dNkLHcb09+uZySCSVtAY/kXaVQMkG41IGsgCWKoiiKoiiKoiiKoiiKoihK8mh3VUb8hW0g5/Cfc/jbOfyX7bHjMiPwFSUZhNv+0x3bwl5PPfIll/F9m0foHjWyFflq6ZrDrlS+lRGGhyrlLp8rncqXAILf6OBc5euTTuVbESFsSHpu8o1J15zTISiLELKsa47y+Uqn8q2AIVy8HOQLla4OOkdiQQzbki9WOoOyOIZtyKfSZYghb/lUuowx5CmfSrcBDHnJp9JtCEMe8ql0G8SQtnwq3YYxpCmfSvcAGNKST6V7IAxpyKfSPSCGdeVT6R4YwzryqXTK4vKpdMoPDMvIp9IpLQzzyqfSKb0Y5pFPpVNGMUwrn0qneFMS/tbFLvlipPuKLmP70Aj3zeGIkc6eT2eIKcHvsqhDFbHPC7rGi+IgTP8eszoc0VcSKCMIFwFP3CebrcfZHK5AafEGZYiCS33M/pVz+HVg2z/O4QuX3K3+q/Sg4oUjHZ+9ogTxf8+GanqlqpO4AAAAAElFTkSuQmCC",AGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAmUSURBVHgB7Z3dedw2FoY/e7cAdbBnK3C2gnA7cAncCuIOiFQQbQVyKnBSwUyucmmngmHucuekAmWOZyCPKHIIYEjigPze58Ez0ogAj8CXIPgD8BXINe6O6ZtzenP+1O/kYpk/j6k9p9+OaX9Mn87fExJFdUy7Y/p8TI+JSfPXIGQEbcka3CZbXzqcyyXkBRVOgjzOmLT8GoTg1Mr9gHiJPuLUz/uYkPcBz/uIZGMI0sTRPHfnMu4SyziA8m0SQdqh9VI6zy3yfQOyGQTTSedJlU9PZCjfBhBML52H8pFeBPNJ56F85BmC+aXzUD7yBcFy0nko38YRLC+dh/JtFEE+6TyUb2MI8kvnoXwbQWBHOg/lWzkCe9J5KN9KEdiVzkP5VobAvnQeyrcSBOVI56F8hSMoTzoP5SsUQbnSeShfYQjKl85D+QpBsB7pPJSvAGqsSzrPLfIJyCLUWJd0nhT5HMii1FiXdJ4Y+d6BZKHGuqTzhMhXg2TFYV3Sea7JV4OYwGFd0nn65KtBTOGwLuk8l/LVICZZm3QeP10aIYQQQggZ5tFA4q2uDWJBPE0HUL5NYUU8yrcxLIlH+TaENfEo30awKB7l2wBWxaN8K8eyeF6+td7+WwyBvT3Yunia1vjAw2IITnuvtcNHCeJRvkQEz0eDWZIvdMNPiSDtdVVLyyfndRb5NIygfwiiFflyiKfoxkyR7wOWQfB1uxU3dFJwfdyrBflyiaekyveAeemLqxj5BGGDrXPLl1M8xZp81+IxL58gboR/zo5zbvGUOiKOOeUL2QnMyidIm1Zi6koMxYJ4So34OjtgOmJaXnPyCcqby8SKeEqNuHqbSry3iD/cm5FPUOYEOpbEU2osL17WiYJeIR05ph3iTxI+HdN/j+lPTEs3lvbKshXCuKV+YnEIe4V8e0z/xjSofFpvsSLpttNt+AkLI7DX0rUJ8Vhp8RTBsi2ep5gp0gQ2D68t4mOieCfMyyew26drER8XxfvKovL9M2JZga0+3Rj/w3A/bwfSxffbtG5iRPL9xFn6fAL7Z69tZ91yZdnQ+JdEkLfF85g57ArKuGTSguJNRXb5BOVcp2tB8aYkm3yCsi4Ot7AhnuA0Rew9Ttfm9A5BSH1IYExLiacsLp+gvDsSLfKKp//3BwzL8m4kvwTGtKR4ymKz0euKDgkryn0brEU+8QRhddaMlGFRPCVVPo1VAteBHxJWYGFsQIt84n2IKHOo5ZPA/AfkIVW+XUjhdULBFqRTWuQRr+rJt8dJsPd42RJ+HihHAmPKJZ6SKt9YNyP6EGtFOqXF9OKlpO74CMHLx4/6Ot4SWP4BeUmR7zM6nry++LlGXGcw1x0J6/y/83t7TD93vlv05vrEpDyZotI9a/UuxWsQDqUb5i7wu5JJke879NRDjTIPr5e0sHGo3XXWJT3LVD0xSWD5B9gh9rDrugX8FJjRqnRKi+nFC6FCfz3poaXBy/7dkDgSGJMl8ZQY+XbdzKVLp7TII56yiyizHihDAvMfYI8Y+cRnqgIWti6d0iKfeIKwKwL3I2WUKp4SKt/TSYZD+dIpLfKJh/P63g+Uo4fbUm+ZxRAi34Nf+Fr/rhTplBZ5xfMIvj4koKlGuQ8JpDAm31P8O5QvndKNXyKWnVK8VATrEE8Zk+8LLcqXTqF4trgmn+gF5H91MvDiMJmC0YvMlya+uKdWEN296i5iWbZ489H3mF31umeh77AOcrXYWocVTicVb8H3zKpP0vnuy7bpm7ilQXnEtFZztXhab331qXt8NZJXAmMqqcXT+ujt4+kf24E/liZfTvH82NKx8q7VqQTGdEAZDEn3VK/XruOVJF9O8WKe2q4GypDA/AfYR70Ziv/pQdh7pO+llsglnqC/ct+jf6feRZRTonjqy7X497qQTmEx9kyVO39+j+2xC1hGOr+3x/QffD25qTrl6O96whHzLFspqHRuZJm9/0H7JyF7mvWWb44WLyXVPevbBSwjgeUfYBP1IyT+ShfWyym6Z+4DCnYo82x3afou4/yFdRPS0ilPrvnreL8gDAfKN8a3nd/lmN50vmuxHkKlU37qfqGH25iJmC3KN8ehtgpI73ryPZz/pheQu/crDwMxSWBMlg616sFjRJK+QsbObq3LN4d4oRwiynQDZUhgfivi6faP8WU/VJAgfvp5S/LlFE/PUkPq7uOVMiQwpgPyo9v9MTLJtQJdQoFW5MspniK43vLpEeVuJH8J4jWId+RhrNDUKQosyJdbPE+NUyd6f/5U4aqAfBIY0wH5aBDvhsYrIYXrQikveMstnxXxUhHYFq9BvBOaop7OeZu4kpzyUbz5aJDmw9gAp17eJa4sl3wUbx4apHngcAMucaU55KN409MgvK4mk87jEle+tHwUb1oahNfT5NJ5XGIQS8pH8aajQXgdJUkX+mYfdxFQDO78WeojVRWWQ2AD3cYO8XyPiVu7SxzstnxztHgW0wHz0STG5LAADmnBNZgXincbTWI8DgviYE8+ipdOkxiLQwYcbMlH8dJoEuNwyIiDHfkoXjxNYgwOBnBIC/4tpoXixdEkrt/BEA75g6d44aTeDnUwiEPe4CleOIL4l+k4GMYhX/AULw5BuHwOExN65yIUd/5sev4265XtSEJH1U3Ftxc/6xC/35BOi2locZq/bmwSTkvbbRSH5Vo6T0yLtySC53HtYYtr40UcCsRh2eApXjp98jkUTIXloHi3cSmfAwmG4t2Oypf0uHosU59ckLL5hIVmsVqzeDVsUOpk5rOyZvEeQMzyGoRkgOKRLKzpUPsjyqAFIYQQQgghhBDShXcICuIfWAdyTL/iJN/SD3kuQYPTuzL+ADGD4Pkj3A3Whf4/+n/pI0tbf/etGQT94wbWIp+XzifKZwDB9cEqpcvXlY7yGUAQNkKqVPmGpKN8GRHEjQktTb4x6S6HOQrIIuhZa4x0pckXKh3ly4BDvHglyBcrnU+LjJEgJxzWJV+qdA5kcRzWIR+lKxCHsuWjdAXjUKZ8lG4FOJQlH6VbEQ5lyEfpVoiDbfko3YpxsCkfpdsADrbko3QbwsGGfJRugzjklY/SbRiHPPJROrK4fJSOPOGwjHyUjrzAYV75KB0ZxGEe+SgdGcVhWvkoHQmmxvCLRWLkS5HuM+zM0UwyILhtDEeKdLo+jhAjXwYQ3SNeoF1CnntwjhfSQY7pPeJlCkl7LPuWI1IggpOAB9wmm/bjtIWrQF7wCuQaFU79Mf2UY3pzZdnfcXorzv7ikwxA8eKRnu9akCj+Bs/6bMrz04plAAAAAElFTkSuQmCC",hGe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAACeCAYAAADDhbN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAwLSURBVHgB7Z3dlds4EkY/zybQj/tYGYwzWG4GncEwBGcgZGBlIGUwfttHaiOwJwL1RGBn0KOyhLYaKvxKIgGo7jk4bYsgCIJXRZAAqQ9QQjwd0sdT+v30lz+jszw/DunllP46pN0hfTt9rihZDIc0HdL3Q3otTLz+CEWJwJFshetkk9L+VO4TFMVhwFGQ1zsmLn+EouAYhT6jTCLu730tWHeD931E5cEglImzxy9xnm5QhvJAEMpOrZIwpfJxX/IjlIeBcDvpLCqfEoRwe+ksKp8iQrifdBaVT3kH4f7SWVQ+5SeE+aSzqHwPDmF+6Swq34NCWE46i8r3YBCWl86i8j0IhHqks6h8nUOoTzqLytcphDLpvmK+cVOVrzMI5dLNPU9O5esEQjvSWVS+xiG0J51F5WsUQrvSWVS+xiC0L51F5WsEQj/SWVS+BhjRl3SWa+QjKLMwoi/pLCXyGSizMqIv6Sw58hkoizCiL+ksKfKNUBbFoC/pLCH5RihVYNCXdBZJvhFKVRj0JZ3lXL4RSpX0Jp2F92uAoiiKoihKGh+gpDDgOCb6H/x6Ha3tT77g/Wtov0BRroDF+oT8ISweO91Ax0+VAp5xmzeErqCvoFUSKH1DaCixwARF8UAom5aUevp9hqI4cKTjyPR65zRAUc6YcH/pbOQjKAqOFwCvM6avUGaBUO+3nDCvdDYZKHeFcOw77VGnfFssIx6fcvU2y50gvO+w1yYfoUya3SGtcZyiZHAcqegp6hGO3YEmn14jyFeJNcnH8uSIwnUfPGUR8qPnd9QH4ddxa+7RSUL41kQt8uXcs0udYGqQJ9+AemDJ3B8QbEY+Qtr9sKXlI+RFOkI6OZH0E+pAkq4Z+Qh5N2GXnKY+IL2eI/J4yih7g+UJSVe9fISyO/9LTSH6hPQ6EvKZEste+p5einTVykeo9/WvPgzS61hC6um2tPxbwGPHuT8KfTP5fsN1EI7fbkIeL4f039PfHvmB+tkhv/25G8HH+2r5rhGP0L90pX3Q1PWWFJS3zcfhG/K4mXwlENo7vZ4zIr3OA/JJbZsdlqeZV6QR2paO4QZLrfcGeTxnlL1GHVQvH6F96Rhu6JyO9ZBRbk77jKiHauUj9CGdZUJe4w6R8gj5B45QF9XJR+hLOibnXp5NG1w2MB+sFfJvTexQJ9XIR+hPOib3dOs28h7XTZcfUS+Ly0foUzqLQbk416Q96mcx+Qh9S2cp2cdr04A2mF0+wmNIx+TcWrlFMmiLWd9Gvy/YUIvSWUouNEpSqw/6lMqX5cTne2+gUgzuL13Lz1mUyjelFD4WFLxHP8+KGtxHuh36eLinVL7ohNd9ZoGtS0e4/KFk7vPltkNOoxPapkS+4FN1Y2ZhPUhnBeO/7lWYwXUC7pwy7ayOPfr+KQRfMr7Cchq5dekYlsDdr2cnDyF/aI0H/genHP7/eftOaJ9c+cSolzOjogfpVrjcL27EEZePMe6R3jauUPZt7dIB+oz2yZXPuAV8SVyxB+mkWyd2v84lY4lGpDfq+beaT7Gr0/+/w39ftJanzK4hR76L20kpY5Y9SCfdLLZijMKytZA31k6S2CP8D9YsMpP3xuTIR3alISHzHu1LRwhHHXfZDpdvB/gG+fTqlud+tj9tY0SfbcukyvcW5WN37XtoGN8ETXNaPgrLBlw25BrxqDhB/jKPp20ZyKegR7nPt7GZQ/27HqRjtrjctz/PlrtS7iA/mP2c8Jl9J8oEOer56rNBH8Tke2uHCX1Lt4K8bzbCjJCjnSQUCXmfPOsP8Ec9XwReoQ9i8v3kBf1KJ0Uod9/2kL+R7in0C2TxGLeRbT9mgj/qcVnSxcYf6IOQfAT0Kx1BPrDDWZ4R/qgkyUSQxZMkBeSod759aXnRdKJK8clHQJ87TQhfTFh80c53+iTI4vn6eczkLJucOvjuK/ZwscFI3YoB6LOfIX3L1k6eEf5oN0AWiSCLJ4n60VOWG/UA+WrZFbRV2CexbaTTUcvySfMJpQmYe8jRjnFF2J0+J8jiMS+4PDVbJsSlmoSyWx9Wk6R7O9W+eBa2KJ+0oywUOflG+KMd40pgTp8T/OL5+nnMgHjU813ptjqs5pPurc1C9/Faki80HObinor3Z8t8/TsgLN4obPucCfGoR4hfELVASLq3dlkHMrUiH0GOFs9C3gHhaCctP9+Ob5kkLEXKHXDJiPQvUI2EpOO0sxnHSMba5YsNh7lM8Ec74HJIa3e2jOAXj3lB+DTp1nOCjBG2s0f9V7rsScwlYzM/JWSuWT4e+nLruvHkHRCOdswEv8CEsHjbSD1GpEU9qSxOf6Je2I8Uj4bzlabElWqTT9rZPfyRYRLyuoQaihAWb0wof4+0qOe7+VrbMWBSpbtoj09IW7GmHQ9N6JQYEI92Up5ziQlh8aTl5OQZEYkCTnl7If8fqAf2IdWdjbty7gtslpaPkD+pckI8Ghknz07Ybkg85gVhuYH0qMf4rtZrmEDKHrxmJLHOsavbWuQj5N/vGhCPdszk5FkL246Jt0XkW468qMfkRvc5WCHPl52vIEL+a7uWkE/q95jIOltcHjQJd//d2zGEuHifCrc1IYwUGJZ6JcYKeZ5wolCBpqDAOeWThsN2kXUIadFuEPI9JZSVsj3pYscgL+oxk7DO3MNqK+Q7skkpuOQVBXPJJ0UTiqyzFdZJKVuKJoS4eIwbzUYhj9SvnhBGumc555DaCvlupByjn3CmkjdlziUfd1D3SLubz8tToh3jDh2uE8srLYsxyI96hF9vJJ3zAoOP72tByqrjc+FG5pKPIA+HuWxx+e3zEevf2e2miJfazyuJesyAeS8s+LiW+FAUjcfCjc0lXwxCerSTbllQYpmp5fluahvkR7054eNZ4oHBFZjCjdYg3xbp0S6lf8cQ0sRjUiIoUxr15oCP4+zSWUzhxpeUj5DXGG6fbJNRbmqZ60Beg/qi3goLSmcxhZVYSr4tLqMdBfLvkRadCOnipUZRRop6GyzHChVIZzGFlZlbPkJeg6T273xl+xiEvKFpTSajHvdkhYqksxiUVWpO+bbIi3ajkN8HIV08xo1iQyBvDVFvhQqlsxiUVW4O+Qj5jZLav/OVH2Jy8q4j+Q2Wi3orVCydxaBO+bbIi3bAZf9uDOQl5IlnnLxTJP9SUW+FBqSzGNQlHwnbio1jSutQZv4QAy7zx6avG+TV6VpWaEg6i0E98m2Rf8BGXEbIEIQ88aQINhSsEztFl7JCg9JZDMoqnzLklQPhvXybhHW2Tp2+JGwjRzxmQv5BM6e830//vsdDPk1LZzGop/KEo1CUkNediTMiXnaueO48uilhHRbN4H5PleU86lCtdBaDtipPuKxbbCaFtE6Mwckf/LGRmSDk/4aHQcUYtFP50BuefBDyxQu9mWBJCOnyGTSAQRuV3yKvf8cQ8sVjJmedOSdvhiDE514aNIRB/ZX3vcUzBKFMvJJ+3lxw98Inn0GDGNRb+dD77EIQysQrOa3PiSSfQcMMqJNSEQhl4tXazzvnXD4D5S74XrwYg1AmHlNyap8blm+Wev2Gx+QHjk/8W1IuLK7l/87/B9THN9xvlEQ5g7/hI9LHQjlfacTj0zsLzhFlQD8v11ZmgFAunqIoiqIoiqIoiqIoiqIoirIQOhLQEP9CH9Ah/e+Q/o3LMdEeWB3SB7wfX1YWhvB+CvcKfcH7Y6dupcwZVGaAID830It8VrrzeYMq38IQwg+rtC6fK53KVwGEtCekWpXPJ53KtyCEvGdCW5MvJp1N3AYEZRZ8v03bi3yp0ql8C2CQL14L8uVKZ1ONz250i0Ff8pVKZ6DMjkEf8ql0DWLQtnwqXcMYtCmfStcBBm3Jp9J1hEEb8ql0HWJQt3wqXccY1CmfSvcAGNQln0r3QBjUIZ9K94AYLCufSvfAGCwjn0qnzC6fSqe8YTCPfCqdcoHBfeVT6RQvBveRT6VTohjcVj6VTklmRPxXbVLkK5HuO+I/2Kd0DOG6ZzhKpOPt6RNiys8HiNzfvUhJU8E6a+g7XhQHgvwr37dIO9T7K0dKJRCOAu5xnWzcj+MIN0C54AOUEAOO/TH+S4f0eyDv3zj+Ms7u7K/iQcXLh4TPXqBk8Q/sTdIxCZNGIAAAAABJRU5ErkJggg==",CGe=()=>{const t=DV(),{userId:e}=LO(),n=fI.find(c=>c.id==e),i=window.localStorage.getItem("env")==="central",[r,s]=H.useState(null),o=c=>{c.preventDefault(),r?s(null):t(-1)},a=c=>{switch(c){case"Base":return ne.jsx(eQ,{currentUser:n});case"Médecin":return ne.jsx(rQ,{});case"Responsable personnel spatial":return ne.jsx(d5,{fonction:"Personnel Spatial"});case"Responsable passagers":return ne.jsx(d5,{fonction:"Passager"});case"Responsable personnel terraformation":return ne.jsx(d5,{fonction:"Terraformeur"});case"Sécurité":return ne.jsx(CQ,{});case"Pirate":return ne.jsx(hQ,{isEnvCentral:i});case"Technicien":return ne.jsx(Cee,{});case"Entrainement":return ne.jsx(sGe,{isEnvCentral:i});case"Pilote":return ne.jsx(AQ,{isEnvCentral:i});case"Réparation":return ne.jsx(fee,{isEnvCentral:i});default:return ne.jsx("div",{children:"Role non trouvé"})}},l=c=>{switch(c){case"Base":return"Mes données personnelles";case"Médecin":return"Dossiers médicaux";case"Responsable personnel spatial":return"Liste des colons";case"Responsable passagers":return"Liste des colons";case"Responsable personnel terraformation":return"Liste des colons";case"Sécurité":return"Accès";case"Pirate":return"/root/patient/database";case"Technicien":return"Technicien";case"Entrainement":return"Test de capacités";case"Pilote":return"Navigation";case"Réparation":return"Réparation";default:return c}},g=()=>{switch(n.logo){case"Médical":return ne.jsx("img",{className:"roles-img",src:aGe});case"Clandestin":return ne.jsx("img",{className:"roles-img",src:cGe});case"Eugéniste":return ne.jsx("img",{className:"roles-img",src:gGe});case"Responsable":return ne.jsx("img",{className:"roles-img",src:oGe});case"Technicien":return ne.jsx("img",{className:"roles-img",src:AGe});case"Navigateur":return ne.jsx("img",{className:"roles-img",src:uGe});case"Sécurité":return ne.jsx("img",{className:"roles-img",src:dGe});case"Politique":return ne.jsx("img",{className:"roles-img",src:IGe});case"Pontife":return ne.jsx("img",{className:"roles-img",src:hGe});case"Colon":default:return ne.jsx("img",{className:"roles-img",src:lGe})}};return ne.jsxs("div",{className:"home-container",children:[ne.jsx("div",{className:"roles-container",children:ne.jsxs("div",{className:"roles-lines",children:[g(),ne.jsxs("div",{className:"roles-title",children:["Bienvenue ",n.firstName," ",n.lastName]})]})}),n?!r&&n.roles.split(" - ").map(c=>ne.jsx("button",{className:"submenu-button",onClick:()=>s(c),children:l(c)},c)):"Pas d'utilisateur trouvé",r&&a(r),ne.jsx("button",{type:"submit",className:"login-button get-back-button",onClick:o,children:"RETOUR"})]})},fGe="/bellerophon/assets/logo-ed3ddc3c.svg",pGe=()=>{const t=DV(),e=fI.map(a=>a.id),[n,i]=H.useState(""),r=a=>{i(a.target.value.toLocaleUpperCase())},s=()=>{e.includes(n)&&n!=""?t("/bellerophon/user/"+n):(n==="RAZ"?(dm("ActivateNavigation"),dm("AlignCapteurs"),dm("MedicalBay"),dm("PosteDeControle")):n==="CEN"?(window.localStorage.setItem("env","central"),P3("Ordinateur définit comme central")):n==="LOC"?(window.localStorage.setItem("env","local"),P3("Ordinateur définit comme local")):n==="NUR"?(window.localStorage.setItem("env","nurses"),t("/bellerophon/nurses")):ki("Code  erroné : "+n),i(""))},o=a=>{a.preventDefault(),s()};return ne.jsxs("div",{className:"login-container",children:[ne.jsx("h1",{className:"login-title",children:"Bienvenue sur la page de connexion du"}),ne.jsx("img",{src:fGe,className:"login-logo",alt:"logo du projet bellerophon"}),ne.jsx("h2",{className:"login-helper",children:"Veuillez saisir votre code personnel :"}),ne.jsx("input",{className:"login-input",type:"text",maxLength:"3",value:n,onChange:r,onKeyDown:a=>{(a.key==="Enter"||a.key===13)&&s()},placeholder:"___"}),ne.jsx("button",{type:"submit",className:"login-button",onClick:o,children:"VALIDER"})]})},mGe=(t,e)=>{const[n,i]=H.useState(void 0),r=()=>{n||(console.log("started"),i(setInterval(t,e)))},s=()=>{n&&(console.log("stopped",n),i(clearInterval(n)))};return H.useEffect(()=>s,[]),[r,s,n!=null]};function bGe(){const[t,e]=H.useState(""),[n,i]=H.useState(!1),[r,s]=H.useState(-1),o=300,[a,l]=mGe(()=>s(b=>b-1),1e3),g=b=>{e(b.target.value),i(!1),s(-1)},c=()=>{s(b=>b-30)},u=()=>{s(o),i(!0),a()},I=()=>{s(-1),i(!1),l()},h=b=>{const{firstName:m,lastName:f,realGeneticCode:p,contaminated:v}=b;return n?r>0?ne.jsxs("div",{children:[ne.jsx("div",{className:"roles-lines",children:ne.jsx("button",{className:"fake-button",onDoubleClick:c,children:"Analyse en cours, veuillez patienter..."})}),ne.jsxs("div",{children:["Temps restant : ",r,"s"]}),ne.jsx("button",{type:"submit",className:"login-button",onClick:I,children:"Stopper l'analyse"})]}):(l(),ne.jsxs("div",{children:[ne.jsxs("div",{children:["Nom : ",f]}),ne.jsxs("div",{children:["Prénom : ",m]}),ne.jsx("div",{children:v}),ne.jsx("div",{children:"Code hyper-sommeil réel :"}),hR(p),ne.jsx("image",{})]})):ne.jsx("div",{children:ne.jsx("button",{type:"submit",className:"login-button",onClick:u,children:"Lancer l'analyse"})})},C=()=>{const b=fI.find(m=>m.lastName.toLocaleLowerCase()==t.toLocaleLowerCase());return ne.jsx("div",{className:"roles-content",children:b?h(b):t===""?"":"Patient non trouvé..."})};return ne.jsxs("div",{className:"roles-container",children:[ne.jsx("div",{className:"roles-title",children:"Analyse médicale "}),ne.jsx("h2",{className:"roles-content",children:"Saisissez le nom du patient :"}),ne.jsx("input",{className:"roles-inputBox",type:"text",maxLength:"20",value:t,onChange:g,placeholder:"nom du patient"}),C()]})}function vGe(){return ne.jsxs("div",{id:"root",children:[ne.jsx($O,{children:ne.jsxs(jO,{children:[ne.jsx(O2,{path:"/bellerophon/user/:userId",element:ne.jsx(CGe,{})}),ne.jsx(O2,{path:"/bellerophon",element:ne.jsx(pGe,{})}),ne.jsx(O2,{path:"/bellerophon/nurses",element:ne.jsx(bGe,{})})]})}),ne.jsx(l9,{})]})}dG.createRoot(document.getElementById("root")).render(ne.jsx(yt.StrictMode,{children:ne.jsx(vGe,{})}))});export default yGe();
